<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  
  
  <title>Hexo</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
  <meta property="og:type" content="website">
<meta property="og:title" content="Hexo">
<meta property="og:url" content="http://example.com/page/9/index.html">
<meta property="og:site_name" content="Hexo">
<meta property="og:locale" content="en_US">
<meta property="article:author" content="John Doe">
<meta name="twitter:card" content="summary">
  
    <link rel="alternate" href="/atom.xml" title="Hexo" type="application/atom+xml">
  
  
    <link rel="shortcut icon" href="/favicon.png">
  
  
    
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/typeface-source-code-pro@0.0.71/index.min.css">

  
  
<link rel="stylesheet" href="/css/style.css">

  
    
<link rel="stylesheet" href="/fancybox/jquery.fancybox.min.css">

  
<meta name="generator" content="Hexo 6.2.0"></head>

<body>
  <div id="container">
    <div id="wrap">
      <header id="header">
  <div id="banner"></div>
  <div id="header-outer" class="outer">
    <div id="header-title" class="inner">
      <h1 id="logo-wrap">
        <a href="/" id="logo">Hexo</a>
      </h1>
      
    </div>
    <div id="header-inner" class="inner">
      <nav id="main-nav">
        <a id="main-nav-toggle" class="nav-icon"></a>
        
          <a class="main-nav-link" href="/">Home</a>
        
          <a class="main-nav-link" href="/archives">Archives</a>
        
      </nav>
      <nav id="sub-nav">
        
          <a id="nav-rss-link" class="nav-icon" href="/atom.xml" title="RSS Feed"></a>
        
        <a id="nav-search-btn" class="nav-icon" title="Search"></a>
      </nav>
      <div id="search-form-wrap">
        <form action="//google.com/search" method="get" accept-charset="UTF-8" class="search-form"><input type="search" name="q" class="search-form-input" placeholder="Search"><button type="submit" class="search-form-submit">&#xF002;</button><input type="hidden" name="sitesearch" value="http://example.com"></form>
      </div>
    </div>
  </div>
</header>

      <div class="outer">
        <section id="main">
  
    <article id="post-React/React-01-概念" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2019/10/20/React/React-01-%E6%A6%82%E5%BF%B5/" class="article-date">
  <time class="dt-published" datetime="2019-10-20T01:24:49.000Z" itemprop="datePublished">2019-10-20</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/%E6%A1%86%E6%9E%B6/">框架</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/2019/10/20/React/React-01-%E6%A6%82%E5%BF%B5/">React 概念</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <h2 id="一、什么是react"><a href="#一、什么是react" class="headerlink" title="一、什么是react"></a>一、什么是react</h2><ul>
<li>react是由Facebook开发的一个JavaScript库，而不是一个框架。当时Facebook需要解决一个问题，开发（或者说是构建）一个数据不断变化的大型应用。而数据变化会带来两个很严重的问题</li>
</ul>
<h2 id="二、react的特点"><a href="#二、react的特点" class="headerlink" title="二、react的特点"></a>二、react的特点</h2><ul>
<li>简单：学习简单，代码简单</li>
<li>声明式（编程）：自动<code>DOM</code>操作</li>
</ul>
<blockquote>
<p><code>React</code>的核心是组件，组件的设计目的是提升代码的复用率、降低测试难度和代码复杂度。</p>
</blockquote>
<ul>
<li>提高代码复用率：组件将数据与逻辑封装</li>
<li>降低测试难度：组件高内聚低耦合，很容易对单个组件进行测试</li>
<li>降低代码复杂度：使用<code>JSX</code>语法，更直观的在js文件中看<code>HTML</code>代码，提高可读性</li>
</ul>
<h2 id="三、react的开发环境的配置"><a href="#三、react的开发环境的配置" class="headerlink" title="三、react的开发环境的配置"></a>三、react的开发环境的配置</h2><blockquote>
<p>如果是要直接在<code>HTML</code>上编辑，需要下载<code>react.js</code>与<code>react-dom.js</code>。如果要使用JSX语法，则需要使用转换<code>JSX</code>语法的插件。这里使用<code>brower.js</code>。在线地址：<a target="_blank" rel="noopener" href="https://cdnjs.cloudflare.com/ajax/libs/babel-core/5.8.23/browser.min.js">https://cdnjs.cloudflare.com/ajax/libs/babel-core/5.8.23/browser.min.js</a></p>
</blockquote>
<ul>
<li><code>react.js</code>：<code>react</code>的核心库</li>
<li><code>react-dom.js</code>：提供操作<code>DOM</code>相关的功能</li>
<li><code>brower,js</code>：将使用的<code>JSX</code>语法转换成<code>JavaScript</code>语法</li>
</ul>
<blockquote>
<p>注意：三者引用顺序必须是<code>react</code>、<code>react-dom</code>、<code>brower</code></p>
</blockquote>
<h2 id="四、React、ReactDOM中有什么"><a href="#四、React、ReactDOM中有什么" class="headerlink" title="四、React、ReactDOM中有什么"></a>四、React、ReactDOM中有什么</h2><p><img src="https://poetries1.gitee.io/img-repo/2019/10/449.png" alt="img"><br><img src="https://poetries1.gitee.io/img-repo/2019/10/450.png" alt="img"></p>
<h2 id="五、yeoman环境"><a href="#五、yeoman环境" class="headerlink" title="五、yeoman环境"></a>五、yeoman环境</h2><blockquote>
<p><code>yeoman</code>前端脚手架工具</p>
</blockquote>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cnpm i -g yeoman</span><br></pre></td></tr></table></figure>

<ul>
<li><a target="_blank" rel="noopener" href="http://yeoman.io/">http://yeoman.io/</a></li>
</ul>
<blockquote>
<p><a target="_blank" rel="noopener" href="https://github.com/react-webpack-generators/generator-react-webpack#readme">https://github.com/react-webpack-generators/generator-react-webpack#readme</a></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"># Make sure both is installed globally</span><br><span class="line">npm install -g yo</span><br><span class="line">npm install -g generator-react-webpack</span><br><span class="line"></span><br><span class="line"># Create a new directory, and `cd` into it:</span><br><span class="line">mkdir my-new-project &amp;&amp; cd my-new-project</span><br><span class="line"></span><br><span class="line"># Run the generator</span><br><span class="line">yo react-webpack</span><br></pre></td></tr></table></figure>
</blockquote>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"># Start for development</span><br><span class="line">npm start # or</span><br><span class="line">npm run serve</span><br><span class="line"></span><br><span class="line"># Start the dev-server with the dist version</span><br><span class="line">npm run serve:dist</span><br><span class="line"></span><br><span class="line"># Just build the dist version and copy static files</span><br><span class="line">npm run dist</span><br><span class="line"></span><br><span class="line"># Run unit tests</span><br><span class="line">npm test</span><br><span class="line"></span><br><span class="line"># Auto-run unit tests on file changes</span><br><span class="line">npm run test:watch</span><br><span class="line"></span><br><span class="line"># Lint all files in src (also automatically done AFTER tests are run)</span><br><span class="line">npm run lint</span><br><span class="line"></span><br><span class="line"># Clean up the dist directory</span><br><span class="line">npm run clean</span><br><span class="line"></span><br><span class="line"># Just copy the static assets</span><br><span class="line">npm run copy</span><br></pre></td></tr></table></figure>

<h2 id="六、React脚手架搭建"><a href="#六、React脚手架搭建" class="headerlink" title="六、React脚手架搭建"></a>六、React脚手架搭建</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">npm i create-react-app</span><br><span class="line"></span><br><span class="line">create-react-app your-app-name &amp;&amp; cd your-app-name</span><br><span class="line"></span><br><span class="line">npm install </span><br><span class="line"></span><br><span class="line">npm start</span><br></pre></td></tr></table></figure>
      
    </div>
    <footer class="article-footer">
      <a data-url="http://example.com/2019/10/20/React/React-01-%E6%A6%82%E5%BF%B5/" data-id="cl7icg6vi00p1ugungwh45dmn" data-title="React 概念" class="article-share-link">Share</a>
      
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/React/" rel="tag">React</a></li></ul>

    </footer>
  </div>
  
</article>



  
    <article id="post-部署/Nginx基础配置" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2019/09/24/%E9%83%A8%E7%BD%B2/Nginx%E5%9F%BA%E7%A1%80%E9%85%8D%E7%BD%AE/" class="article-date">
  <time class="dt-published" datetime="2019-09-24T11:54:18.000Z" itemprop="datePublished">2019-09-24</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/liunx/">liunx</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/2019/09/24/%E9%83%A8%E7%BD%B2/Nginx%E5%9F%BA%E7%A1%80%E9%85%8D%E7%BD%AE/">Nginx基础配置</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <blockquote>
<p>Nginx 配置文件在线生成: <a target="_blank" rel="noopener" href="https://nginxconfig.io/">https://nginxconfig.io/</a></p>
</blockquote>
<h3 id="Nginx的启动、停止与重启"><a href="#Nginx的启动、停止与重启" class="headerlink" title="Nginx的启动、停止与重启"></a>Nginx的启动、停止与重启</h3><ul>
<li>建立软连接<code>Nginx</code>到<code>/usr/bin</code>目录下 <code>ln -s /usr/sbin/nginx /usr/bin</code></li>
</ul>
<h4 id="启动"><a href="#启动" class="headerlink" title="启动"></a>启动</h4><ul>
<li>启动代码格式：<code>nginx</code>安装目录地址 <code>-c nginx</code>配置文件地址</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[root@LinuxServer sbin]# /usr/local/nginx/sbin/nginx -c /usr/local/nginx/conf/nginx.conf</span><br></pre></td></tr></table></figure>

<h4 id="停止"><a href="#停止" class="headerlink" title="停止"></a>停止</h4><blockquote>
<p>nginx的停止有三种方式</p>
</blockquote>
<p><strong>从容停止</strong></p>
<ul>
<li>查看进程号 <code>ps -ef|grep nginx</code></li>
</ul>
<p><img src="http://images2015.cnblogs.com/blog/848552/201601/848552-20160102182744854-1291053517.png" alt="img"></p>
<ul>
<li>杀死进程 kill -QUIT 2072</li>
</ul>
<p><img src="http://images2015.cnblogs.com/blog/848552/201601/848552-20160102182652354-960281274.png" alt="img"></p>
<p><strong>快速停止</strong></p>
<ul>
<li>查看进程号 <code>ps -ef|grep nginx</code></li>
</ul>
<p><img src="http://images2015.cnblogs.com/blog/848552/201601/848552-20160102183103651-1859453208.png" alt="img"></p>
<ul>
<li>杀死进程 <code>kill -TERM 2132</code> <code>kill -INT 2132</code></li>
</ul>
<p><img src="http://images2015.cnblogs.com/blog/848552/201601/848552-20160102183340010-2024212451.png" alt="img"></p>
<ul>
<li>强制停止 <code>pkill -9 nginx</code></li>
</ul>
<p><strong>重启</strong></p>
<blockquote>
<p>验证<code>nginx</code>配置文件是否正确</p>
</blockquote>
<ul>
<li>方法一：进入<code>nginx</code>安装目录<code>sbin</code>下，输入命令<code>./nginx -t</code><br>看到如下显示<code>nginx.conf syntax is ok nginx.conf test is successful</code>说明配置文件正确</li>
</ul>
<p><img src="http://images2015.cnblogs.com/blog/848552/201601/848552-20160102184633432-1268782338.png" alt="img"></p>
<ul>
<li>方法二：在启动命令<code>-c</code>前加<code>-t</code></li>
</ul>
<p><img src="http://images2015.cnblogs.com/blog/848552/201601/848552-20160102185023385-456612180.png" alt="img"></p>
<p><strong>重启Nginx服务</strong></p>
<ul>
<li>方法一：进入<code>nginx</code>可执行目录<code>sbin</code>下，输入命令<code>./nginx -s reload</code>即可</li>
</ul>
<p><img src="http://images2015.cnblogs.com/blog/848552/201601/848552-20160102185521057-1341380905.png" alt="img"></p>
<ul>
<li>方法二：查找当前<code>nginx</code>进程号，然后输入命令：<code>kill -HUP</code> 进程号 实现重启<code>nginx</code>服务</li>
</ul>
<p><img src="http://images2015.cnblogs.com/blog/848552/201601/848552-20160102185838167-234856506.png" alt="img"></p>
<h3 id="Nginx基础配置"><a href="#Nginx基础配置" class="headerlink" title="Nginx基础配置"></a>Nginx基础配置</h3><ul>
<li>在<code>Nginx</code>目录下的<code>vhost或conf.d</code>目录下新建一个配置文件（如<code>poetries-80.conf</code>）</li>
<li>把server的内容配置进去</li>
<li>在<code>Nginx.conf</code>中的<code>http</code>下<code>include</code>配置文件</li>
<li>检测配置文件是否出错 <code>切换到/etc/nginx下 nginx -t</code></li>
<li>重新加载配置文件 <code>nginx -c /usr/local/etc/nginx/nginx.conf</code></li>
<li>在重启<code>Nginx</code> <code>nginx -s reload</code></li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line">user  root;  //Nginx需要有有一个用户</span><br><span class="line">worker_processes  2; // Nginx进程数 最大1024</span><br><span class="line">pid        conf/nginx.pid; </span><br><span class="line">worker_rlimit_nofile 2048;</span><br><span class="line">events &#123;</span><br><span class="line">    use epoll;</span><br><span class="line">    worker_connections  2048;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">http &#123;</span><br><span class="line"> </span><br><span class="line"></span><br><span class="line">	server &#123;</span><br><span class="line">       listen       80;</span><br><span class="line">       server_name  119.29.145.252;</span><br><span class="line">	   </span><br><span class="line">       location / &#123;</span><br><span class="line">           root   /usr/local/nginx/html;</span><br><span class="line">           index  index.html index.htm;</span><br><span class="line">        &#125;</span><br><span class="line">   &#125;</span><br><span class="line">   server &#123;</span><br><span class="line">       listen       3001;</span><br><span class="line">       server_name  119.29.145.252;</span><br><span class="line">	   </span><br><span class="line">       location / &#123;</span><br><span class="line">           root   /usr/local/nginx/book;</span><br><span class="line">           index  index.html index.htm;</span><br><span class="line">        &#125;</span><br><span class="line">   &#125;</span><br><span class="line">   server &#123;</span><br><span class="line">       listen       9000;</span><br><span class="line">       server_name  119.29.145.252;</span><br><span class="line">	   </span><br><span class="line">       location / &#123;</span><br><span class="line">           root   /usr/local/nginx/vue;</span><br><span class="line">           index  index.html index.htm;</span><br><span class="line">        &#125;</span><br><span class="line">   &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="一些错误"><a href="#一些错误" class="headerlink" title="一些错误"></a>一些错误</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">nginx: [error] invalid PID number “” in “/usr/local/var/run/nginx/nginx.pid”</span><br></pre></td></tr></table></figure>

<ul>
<li>解决办法：<code>nginx -c /usr/local/etc/nginx/nginx.conf</code></li>
<li><code>nginx -s reload</code></li>
</ul>
<p><strong>权限问题导致Nginx 403 Forbidden错误的解决方法</strong></p>
<ul>
<li>在<code>nginx.conf</code>头部加入一行 <code>user root;</code></li>
<li>重启<code>nginx</code>再访问，就可以正常访问了</li>
</ul>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://example.com/2019/09/24/%E9%83%A8%E7%BD%B2/Nginx%E5%9F%BA%E7%A1%80%E9%85%8D%E7%BD%AE/" data-id="cl7icg7b000waugun706z14hk" data-title="Nginx基础配置" class="article-share-link">Share</a>
      
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/nginx/" rel="tag">nginx</a></li></ul>

    </footer>
  </div>
  
</article>



  
    <article id="post-部署/Nginx学习" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2019/08/30/%E9%83%A8%E7%BD%B2/Nginx%E5%AD%A6%E4%B9%A0/" class="article-date">
  <time class="dt-published" datetime="2019-08-30T13:45:58.000Z" itemprop="datePublished">2019-08-30</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/liunx/">liunx</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/2019/08/30/%E9%83%A8%E7%BD%B2/Nginx%E5%AD%A6%E4%B9%A0/">Nginx学习</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <blockquote>
<p>Nginx 配置文件在线生成: <a target="_blank" rel="noopener" href="https://nginxconfig.io/">https://nginxconfig.io/</a></p>
</blockquote>
<blockquote>
<p><code>Nginx</code> 是一款面向性能设计的 <code>HTTP</code> 服务器，能反向代理 <code>HTTP</code>，<code>HTTPS</code> 和邮件相关(<code>SMTP</code>，<code>POP3</code>，<code>IMAP</code>)的协议链接。并且提供了负载均衡以及 <code>HTTP</code> 缓存。它的设计充分使用异步事件模型，削减上下文调度的开销，提高服务器并发能力。采用了模块化设计，提供了丰富模块的第三方模块。</p>
</blockquote>
<ul>
<li>所以关于 &#96;Nginx，有这些标签：「异步」「事件」「模块化」「高性能」「高并发」「反向代理」「负载均衡」</li>
</ul>
<h2 id="一、安装"><a href="#一、安装" class="headerlink" title="一、安装"></a>一、安装</h2><h3 id="1-1-安装依赖"><a href="#1-1-安装依赖" class="headerlink" title="1.1 安装依赖"></a>1.1 安装依赖</h3><blockquote>
<p><code>prce</code>(重定向支持)和<code>openssl</code>(<code>https</code>支持，如果不需要<code>https</code>可以不安装)</p>
</blockquote>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">yum install -y pcre-devel </span><br><span class="line">yum -y install gcc make gcc-c++ wget</span><br><span class="line">yum -y install openssl openssl-devel</span><br></pre></td></tr></table></figure>

<p><code>CentOS 6.5</code> 我安装的时候是选择的“基本服务器”，默认这两个包都没安装全，所以这两个都运行安装即可</p>
<h3 id="1-2-下载"><a href="#1-2-下载" class="headerlink" title="1.2 下载"></a>1.2 下载</h3><p><a target="_blank" rel="noopener" href="http://nginx.org/download/">nginx的所有版本在这里</a></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">wget http://nginx.org/download/nginx-1.13.3.tar.gz</span><br><span class="line">wget http://nginx.org/download/nginx-1.13.7.tar.gz</span><br><span class="line"></span><br><span class="line"># 如果没有安装wget</span><br><span class="line"># 下载已编译版本</span><br><span class="line">$ yum install wget</span><br><span class="line"></span><br><span class="line"># 解压压缩包</span><br><span class="line">tar zxf nginx-1.13.3.tar.gz</span><br></pre></td></tr></table></figure>

<h3 id="1-3-编译安装"><a href="#1-3-编译安装" class="headerlink" title="1.3 编译安装"></a>1.3 编译安装</h3><p>然后进入目录编译安装，<a target="_blank" rel="noopener" href="http://blog.poetries.top/2018/02/25/nginx-study/#configure%E5%8F%82%E6%95%B0%E8%AF%B4%E6%98%8E">configure参数说明</a></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">cd nginx-1.11.5</span><br><span class="line">./configure</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">....</span><br><span class="line">Configuration summary</span><br><span class="line">  + using system PCRE library</span><br><span class="line">  + OpenSSL library is not used</span><br><span class="line">  + using system zlib library</span><br><span class="line"></span><br><span class="line">  nginx path prefix: &quot;/usr/local/nginx&quot;</span><br><span class="line">  nginx binary file: &quot;/usr/local/nginx/sbin/nginx&quot;</span><br><span class="line">  nginx modules path: &quot;/usr/local/nginx/modules&quot;</span><br><span class="line">  nginx configuration prefix: &quot;/usr/local/nginx/conf&quot;</span><br><span class="line">  nginx configuration file: &quot;/usr/local/nginx/conf/nginx.conf&quot;</span><br><span class="line">  nginx pid file: &quot;/usr/local/nginx/logs/nginx.pid&quot;</span><br><span class="line">  nginx error log file: &quot;/usr/local/nginx/logs/error.log&quot;</span><br><span class="line">  nginx http access log file: &quot;/usr/local/nginx/logs/access.log&quot;</span><br><span class="line">  nginx http client request body temporary files: &quot;client_body_temp&quot;</span><br><span class="line">  nginx http proxy temporary files: &quot;proxy_temp&quot;</span><br><span class="line">  nginx http fastcgi temporary files: &quot;fastcgi_temp&quot;</span><br><span class="line">  nginx http uwsgi temporary files: &quot;uwsgi_temp&quot;</span><br><span class="line">  nginx http scgi temporary files: &quot;scgi_temp&quot;</span><br></pre></td></tr></table></figure>

<blockquote>
<p>安装报错误的话比如：<code>“C compiler cc is not found”</code>，这个就是缺少编译环境，安装一下就可以了 <code>yum -y install gcc make gcc-c++ openssl-devel</code></p>
</blockquote>
<p>如果没有<code>error</code>信息，就可以执行下边的安装了：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">make</span><br><span class="line">make install</span><br></pre></td></tr></table></figure>

<h3 id="1-4-nginx测试"><a href="#1-4-nginx测试" class="headerlink" title="1.4 nginx测试"></a>1.4 nginx测试</h3><ul>
<li>运行下面命令会出现两个结果，一般情况<code>nginx</code>会安装在<code>/usr/local/nginx</code>目录中</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">cd /usr/local/nginx/sbin/</span><br><span class="line">./nginx -t</span><br><span class="line"></span><br><span class="line"># nginx: the configuration file /usr/local/nginx/conf/nginx.conf syntax is ok</span><br><span class="line"># nginx: configuration file /usr/local/nginx/conf/nginx.conf test is successful</span><br></pre></td></tr></table></figure>

<h3 id="1-5-设置全局nginx命令"><a href="#1-5-设置全局nginx命令" class="headerlink" title="1.5 设置全局nginx命令"></a>1.5 设置全局nginx命令</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">vi ~/.bash_profile</span><br></pre></td></tr></table></figure>

<p>将下面内容添加到 <code>~/.bash_profile</code> 文件中</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">PATH=$PATH:$HOME/bin:/usr/local/nginx/sbin/</span><br><span class="line">export PATH</span><br></pre></td></tr></table></figure>

<p>运行命令 <strong><code>source ~/.bash_profile</code></strong> 让配置立即生效。你就可以全局运行 <code>nginx</code> 命令了。</p>
<h2 id="二、开机自启动"><a href="#二、开机自启动" class="headerlink" title="二、开机自启动"></a>二、开机自启动</h2><p><strong>开机自启动方法一</strong></p>
<ul>
<li>编辑 <strong><code>vi /lib/systemd/system/nginx.service</code></strong> 文件，没有创建一个 <strong><code>touch nginx.service</code></strong> - 然后将如下内容根据具体情况进行修改后，添加到<code>nginx.service</code>文件中：</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line">[Unit]</span><br><span class="line">Description=nginx</span><br><span class="line">After=network.target remote-fs.target nss-lookup.target</span><br><span class="line"></span><br><span class="line">[Service]</span><br><span class="line"></span><br><span class="line">Type=forking</span><br><span class="line">PIDFile=/var/run/nginx.pid</span><br><span class="line">ExecStartPre=/usr/local/nginx/sbin/nginx -t -c /usr/local/nginx/conf/nginx.conf</span><br><span class="line">ExecStart=/usr/local/nginx/sbin/nginx -c /usr/local/nginx/conf/nginx.conf</span><br><span class="line">ExecReload=/bin/kill -s HUP $MAINPID</span><br><span class="line">ExecStop=/bin/kill -s QUIT $MAINPID</span><br><span class="line">PrivateTmp=true</span><br><span class="line"></span><br><span class="line">[Install]</span><br><span class="line">WantedBy=multi-user.target</span><br><span class="line">[Unit]:服务的说明  </span><br><span class="line">Description:描述服务  </span><br><span class="line">After:描述服务类别  </span><br><span class="line">[Service]服务运行参数的设置  </span><br><span class="line">Type=forking是后台运行的形式  </span><br><span class="line">ExecStart为服务的具体运行命令  </span><br><span class="line">ExecReload为重启命令  </span><br><span class="line">ExecStop为停止命令  </span><br><span class="line">PrivateTmp=True表示给服务分配独立的临时空间  </span><br><span class="line">注意：[Service]的启动、重启、停止命令全部要求使用绝对路径  </span><br><span class="line">[Install]运行级别下服务安装的相关设置，可设置为多用户，即系统运行级别为3</span><br></pre></td></tr></table></figure>

<p>保存退出。</p>
<p>设置开机启动，使配置生效：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">systemctl enable nginx.service</span><br><span class="line"># 输出下面内容表示成功了</span><br><span class="line">Created symlink from /etc/systemd/system/multi-user.target.wants/nginx.service to /usr/lib/systemd/system/nginx.service.</span><br></pre></td></tr></table></figure>

<p><strong>开机自启动方法二</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">vi /etc/rc.local</span><br><span class="line"></span><br><span class="line"># 在 rc.local 文件中，添加下面这条命令</span><br><span class="line">/usr/local/nginx/sbin/nginx start</span><br></pre></td></tr></table></figure>

<ul>
<li>如果开机后发现自启动脚本没有执行，你要去确认一下<code>rc.local</code>这个文件的访问权限是否是可执行的，因为<code>rc.local</code>默认是不可执行的。修改<code>rc.local</code>访问权限，增加可执行权限：</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">chmod +x /etc/rc.d/rc.local</span><br></pre></td></tr></table></figure>

<h2 id="三、运维"><a href="#三、运维" class="headerlink" title="三、运维"></a>三、运维</h2><h3 id="3-1-服务管理"><a href="#3-1-服务管理" class="headerlink" title="3.1 服务管理"></a>3.1 服务管理</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"># 启动</span><br><span class="line">/usr/local/nginx/sbin/nginx</span><br><span class="line"></span><br><span class="line"># 重启</span><br><span class="line">/usr/local/nginx/sbin/nginx -s reload</span><br><span class="line"></span><br><span class="line"># 关闭进程</span><br><span class="line">/usr/local/nginx/sbin/nginx -s stop</span><br><span class="line"></span><br><span class="line"># 平滑关闭nginx</span><br><span class="line">/usr/local/nginx/sbin/nginx -s quit</span><br><span class="line"></span><br><span class="line"># 查看nginx的安装状态，</span><br><span class="line">/usr/local/nginx/sbin/nginx -V</span><br></pre></td></tr></table></figure>

<p><strong>关闭防火墙，或者添加防火墙规则就可以测试了</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">service iptables stop</span><br></pre></td></tr></table></figure>

<p>或者编辑配置文件：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">vi /etc/sysconfig/iptables</span><br></pre></td></tr></table></figure>

<p>添加这样一条开放80端口的规则后保存：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">-A INPUT -m state --state NEW -m tcp -p tcp --dport 80 -j ACCEPT</span><br></pre></td></tr></table></figure>

<p>重启服务即可:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">service iptables restart</span><br><span class="line"># 命令进行查看目前nat</span><br><span class="line">iptables -t nat -L</span><br></pre></td></tr></table></figure>

<h3 id="3-2-重启服务防火墙报错解决"><a href="#3-2-重启服务防火墙报错解决" class="headerlink" title="3.2 重启服务防火墙报错解决"></a>3.2 重启服务防火墙报错解决</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">service iptables restart</span><br><span class="line"># Redirecting to /bin/systemctl restart  iptables.service</span><br><span class="line"># Failed to restart iptables.service: Unit iptables.service failed to load: No such file or directory.</span><br></pre></td></tr></table></figure>

<ul>
<li>在<code>CentOS 7</code>或<code>RHEL 7</code>或<code>Fedora</code>中防火墙由 <strong><code>firewalld</code></strong> 来管理，当然你可以还原传统的管理方式。或则使用新的命令进行管理。<br>假如采用传统请执行一下命令</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"># 传统命令</span><br><span class="line">systemctl stop firewalld</span><br><span class="line">systemctl mask firewalld</span><br><span class="line"># 安装命令</span><br><span class="line">yum install iptables-services</span><br><span class="line"></span><br><span class="line">systemctl enable iptables </span><br><span class="line">service iptables restart</span><br></pre></td></tr></table></figure>

<h2 id="四、nginx卸载"><a href="#四、nginx卸载" class="headerlink" title="四、nginx卸载"></a>四、nginx卸载</h2><ul>
<li>如果通过<code>yum</code>安装，使用下面命令安装。</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">yum remove nginx</span><br></pre></td></tr></table></figure>

<ul>
<li>编译安装，删除<code>/usr/local/nginx</code>目录即可</li>
<li>如果配置了自启动脚本，也需要删除。</li>
</ul>
<h2 id="五、参数说明"><a href="#五、参数说明" class="headerlink" title="五、参数说明"></a>五、参数说明</h2><table>
<thead>
<tr>
<th align="left">参数</th>
<th align="left">说明</th>
</tr>
</thead>
<tbody><tr>
<td align="left">–prefix&#x3D;&#96;&#96;</td>
<td align="left">Nginx安装路径。如果没有指定，默认为 &#x2F;usr&#x2F;local&#x2F;nginx。</td>
</tr>
<tr>
<td align="left">–sbin-path&#x3D;&#96;&#96;</td>
<td align="left">Nginx可执行文件安装路径。只能安装时指定，如果没有指定，默认为&#96;&#96;&#x2F;sbin&#x2F;nginx。</td>
</tr>
<tr>
<td align="left">–conf-path&#x3D;&#96;&#96;</td>
<td align="left">在没有给定-c选项下默认的nginx.conf的路径。如果没有指定，默认为&#96;&#96;&#x2F;conf&#x2F;nginx.conf。</td>
</tr>
<tr>
<td align="left">–pid-path&#x3D;&#96;&#96;</td>
<td align="left">在nginx.conf中没有指定pid指令的情况下，默认的nginx.pid的路径。如果没有指定，默认为 &#96;&#96;&#x2F;logs&#x2F;nginx.pid。</td>
</tr>
<tr>
<td align="left">–lock-path&#x3D;&#96;&#96;</td>
<td align="left">nginx.lock文件的路径。</td>
</tr>
<tr>
<td align="left">–error-log-path&#x3D;&#96;&#96;</td>
<td align="left">在nginx.conf中没有指定error_log指令的情况下，默认的错误日志的路径。如果没有指定，默认为 &#96;&#96;&#x2F;- logs&#x2F;error.log。</td>
</tr>
<tr>
<td align="left">–http-log-path&#x3D;&#96;&#96;</td>
<td align="left">在nginx.conf中没有指定access_log指令的情况下，默认的访问日志的路径。如果没有指定，默认为 &#96;&#96;&#x2F;- logs&#x2F;access.log。</td>
</tr>
<tr>
<td align="left">–user&#x3D;&#96;&#96;</td>
<td align="left">在nginx.conf中没有指定user指令的情况下，默认的nginx使用的用户。如果没有指定，默认为 nobody。</td>
</tr>
<tr>
<td align="left">–group&#x3D;&#96;&#96;</td>
<td align="left">在nginx.conf中没有指定user指令的情况下，默认的nginx使用的组。如果没有指定，默认为 nobody。</td>
</tr>
<tr>
<td align="left">–builddir&#x3D;DIR</td>
<td align="left">指定编译的目录</td>
</tr>
<tr>
<td align="left">–with-rtsig_module</td>
<td align="left">启用 rtsig 模块</td>
</tr>
<tr>
<td align="left">–with-select_module –without-select_module</td>
<td align="left">允许或不允许开启SELECT模式，如果 configure 没有找到更合适的模式，比如：kqueue(sun os),epoll (linux kenel 2.6+), rtsig(- 实时信号)或者&#x2F;dev&#x2F;poll(一种类似select的模式，底层实现与SELECT基本相 同，都是采用轮训方法) SELECT模式将是默认安装模式</td>
</tr>
<tr>
<td align="left">–with-poll_module –without-poll_module</td>
<td align="left">Whether or not to enable the poll module. This module is enabled by, default if a more suitable method such as kqueue, epoll, rtsig or &#x2F;dev&#x2F;poll is not discovered by configure.</td>
</tr>
<tr>
<td align="left">–with-http_ssl_module</td>
<td align="left">Enable ngx_http_ssl_module. Enables SSL support and the ability to handle HTTPS requests. Requires OpenSSL. On Debian, this is libssl-dev. 开启HTTP SSL模块，使NGINX可以支持HTTPS请求。这个模块需要已经安装了OPENSSL，在DEBIAN上是libssl</td>
</tr>
<tr>
<td align="left">–with-http_realip_module</td>
<td align="left">启用 ngx_http_realip_module</td>
</tr>
<tr>
<td align="left">–with-http_addition_module</td>
<td align="left">启用 ngx_http_addition_module</td>
</tr>
<tr>
<td align="left">–with-http_sub_module</td>
<td align="left">启用 ngx_http_sub_module</td>
</tr>
<tr>
<td align="left">–with-http_dav_module</td>
<td align="left">启用 ngx_http_dav_module</td>
</tr>
<tr>
<td align="left">–with-http_flv_module</td>
<td align="left">启用 ngx_http_flv_module</td>
</tr>
<tr>
<td align="left">–with-http_stub_status_module</td>
<td align="left">启用 “server status” 页</td>
</tr>
<tr>
<td align="left">–without-http_charset_module</td>
<td align="left">禁用 ngx_http_charset_module</td>
</tr>
<tr>
<td align="left">–without-http_gzip_module</td>
<td align="left">禁用 ngx_http_gzip_module. 如果启用，需要 zlib 。</td>
</tr>
<tr>
<td align="left">–without-http_ssi_module</td>
<td align="left">禁用 ngx_http_ssi_module</td>
</tr>
<tr>
<td align="left">–without-http_userid_module</td>
<td align="left">禁用 ngx_http_userid_module</td>
</tr>
<tr>
<td align="left">–without-http_access_module</td>
<td align="left">禁用 ngx_http_access_module</td>
</tr>
<tr>
<td align="left">–without-http_auth_basic_module</td>
<td align="left">禁用 ngx_http_auth_basic_module</td>
</tr>
<tr>
<td align="left">–without-http_autoindex_module</td>
<td align="left">禁用 ngx_http_autoindex_module</td>
</tr>
<tr>
<td align="left">–without-http_geo_module</td>
<td align="left">禁用 ngx_http_geo_module</td>
</tr>
<tr>
<td align="left">–without-http_map_module</td>
<td align="left">禁用 ngx_http_map_module</td>
</tr>
<tr>
<td align="left">–without-http_referer_module</td>
<td align="left">禁用 ngx_http_referer_module</td>
</tr>
<tr>
<td align="left">–without-http_rewrite_module</td>
<td align="left">禁用 ngx_http_rewrite_module. 如果启用需要 PCRE 。</td>
</tr>
<tr>
<td align="left">–without-http_proxy_module</td>
<td align="left">禁用 ngx_http_proxy_module</td>
</tr>
<tr>
<td align="left">–without-http_fastcgi_module</td>
<td align="left">禁用 ngx_http_fastcgi_module</td>
</tr>
<tr>
<td align="left">–without-http_memcached_module</td>
<td align="left">禁用 ngx_http_memcached_module</td>
</tr>
<tr>
<td align="left">–without-http_limit_zone_module</td>
<td align="left">禁用 ngx_http_limit_zone_module</td>
</tr>
<tr>
<td align="left">–without-http_empty_gif_module</td>
<td align="left">禁用 ngx_http_empty_gif_module</td>
</tr>
<tr>
<td align="left">–without-http_browser_module</td>
<td align="left">禁用 ngx_http_browser_module</td>
</tr>
<tr>
<td align="left">–without-http_upstream_ip_hash_module</td>
<td align="left">禁用 ngx_http_upstream_ip_hash_module</td>
</tr>
<tr>
<td align="left">–with-http_perl_module</td>
<td align="left">启用 ngx_http_perl_module</td>
</tr>
<tr>
<td align="left">–with-perl_modules_path&#x3D;PATH</td>
<td align="left">指定 perl 模块的路径</td>
</tr>
<tr>
<td align="left">–with-perl&#x3D;PATH</td>
<td align="left">指定 perl 执行文件的路径</td>
</tr>
<tr>
<td align="left">–http-log-path&#x3D;PATH</td>
<td align="left">Set path to the http access log</td>
</tr>
<tr>
<td align="left">–http-client-body-temp-path&#x3D;PATH</td>
<td align="left">Set path to the http client request body temporary files</td>
</tr>
<tr>
<td align="left">–http-proxy-temp-path&#x3D;PATH</td>
<td align="left">Set path to the http proxy temporary files</td>
</tr>
<tr>
<td align="left">–http-fastcgi-temp-path&#x3D;PATH</td>
<td align="left">Set path to the http fastcgi temporary files</td>
</tr>
<tr>
<td align="left">–without-http</td>
<td align="left">禁用 HTTP server</td>
</tr>
<tr>
<td align="left">–with-mail</td>
<td align="left">启用 IMAP4&#x2F;POP3&#x2F;SMTP 代理模块</td>
</tr>
<tr>
<td align="left">–with-mail_ssl_module</td>
<td align="left">启用 ngx_mail_ssl_module</td>
</tr>
<tr>
<td align="left">–with-cc&#x3D;PATH</td>
<td align="left">指定 C 编译器的路径</td>
</tr>
<tr>
<td align="left">–with-cpp&#x3D;PATH</td>
<td align="left">指定 C 预处理器的路径</td>
</tr>
<tr>
<td align="left">–with-cc-opt&#x3D;OPTIONS</td>
<td align="left">Additional parameters which will be added to the variable CFLAGS. With the use of the system library PCRE in FreeBSD, it is necessary to indicate –with-cc-opt&#x3D;”-I &#x2F;usr&#x2F;local&#x2F;include”. If we are using select() and it is necessary to increase the number of file descriptors, then this also can be assigned here: –with-cc-opt&#x3D;”-D FD_SETSIZE&#x3D;2048”.</td>
</tr>
<tr>
<td align="left">–with-ld-opt&#x3D;OPTIONS</td>
<td align="left">Additional parameters passed to the linker. With the use of the system library PCRE in - FreeBSD, it is necessary to indicate –with-ld-opt&#x3D;”-L &#x2F;usr&#x2F;local&#x2F;lib”.</td>
</tr>
<tr>
<td align="left">–with-cpu-opt&#x3D;CPU</td>
<td align="left">为特定的 CPU 编译，有效的值包括：pentium, pentiumpro, pentium3, pentium4, athlon, opteron, amd64, sparc32, sparc64, ppc64</td>
</tr>
<tr>
<td align="left">–without-pcre</td>
<td align="left">禁止 PCRE 库的使用。同时也会禁止 HTTP rewrite 模块。在 “location” 配置指令中的正则表达式也需要 PCRE 。</td>
</tr>
<tr>
<td align="left">–with-pcre&#x3D;DIR</td>
<td align="left">指定 PCRE 库的源代码的路径。</td>
</tr>
<tr>
<td align="left">–with-pcre-opt&#x3D;OPTIONS</td>
<td align="left">Set additional options for PCRE building.</td>
</tr>
<tr>
<td align="left">–with-md5&#x3D;DIR</td>
<td align="left">Set path to md5 library sources.</td>
</tr>
<tr>
<td align="left">–with-md5-opt&#x3D;OPTIONS</td>
<td align="left">Set additional options for md5 building.</td>
</tr>
<tr>
<td align="left">–with-md5-asm</td>
<td align="left">Use md5 assembler sources.</td>
</tr>
<tr>
<td align="left">–with-sha1&#x3D;DIR</td>
<td align="left">Set path to sha1 library sources.</td>
</tr>
<tr>
<td align="left">–with-sha1-opt&#x3D;OPTIONS</td>
<td align="left">Set additional options for sha1 building.</td>
</tr>
<tr>
<td align="left">–with-sha1-asm</td>
<td align="left">Use sha1 assembler sources.</td>
</tr>
<tr>
<td align="left">–with-zlib&#x3D;DIR</td>
<td align="left">Set path to zlib library sources.</td>
</tr>
<tr>
<td align="left">–with-zlib-opt&#x3D;OPTIONS</td>
<td align="left">Set additional options for zlib building.</td>
</tr>
<tr>
<td align="left">–with-zlib-asm&#x3D;CPU</td>
<td align="left">Use zlib assembler sources optimized for specified CPU, valid values are: pentium, pentiumpro</td>
</tr>
<tr>
<td align="left">–with-openssl&#x3D;DIR</td>
<td align="left">Set path to OpenSSL library sources</td>
</tr>
<tr>
<td align="left">–with-openssl-opt&#x3D;OPTIONS</td>
<td align="left">Set additional options for OpenSSL building</td>
</tr>
<tr>
<td align="left">–with-debug</td>
<td align="left">启用调试日志</td>
</tr>
<tr>
<td align="left">–add-module&#x3D;PATH</td>
<td align="left">Add in a third-party module found in directory PATH</td>
</tr>
</tbody></table>
<h2 id="六、配置"><a href="#六、配置" class="headerlink" title="六、配置"></a>六、配置</h2><ul>
<li>在<code>Centos</code> 默认配置文件在 <strong><code>/usr/local/nginx-1.5.1/conf/nginx.conf</code></strong> 我们要在这里配置一些文件。<code>nginx.conf</code>是主配置文件，由若干个部分组成，每个大括号<code>&#123;&#125;</code>表示一个部分。每一行指令都由分号结束<code>;</code>，标志着一行的结束。</li>
</ul>
<h3 id="6-1-常用正则"><a href="#6-1-常用正则" class="headerlink" title="6.1 常用正则"></a>6.1 常用正则</h3><table>
<thead>
<tr>
<th align="left">正则</th>
<th align="left">说明</th>
<th align="left">正则</th>
<th align="left">说明</th>
</tr>
</thead>
<tbody><tr>
<td align="left"><code>.</code></td>
<td align="left">匹配除换行符以外的任意字符</td>
<td align="left"><code>$</code></td>
<td align="left">匹配字符串的结束</td>
</tr>
<tr>
<td align="left"><code>?</code></td>
<td align="left">重复0次或1次</td>
<td align="left"><code>&#123;n&#125;</code></td>
<td align="left">重复n次</td>
</tr>
<tr>
<td align="left"><code>+</code></td>
<td align="left">重复1次或更多次</td>
<td align="left"><code>&#123;n,&#125;</code></td>
<td align="left">重复n次或更多次</td>
</tr>
<tr>
<td align="left"><code>*</code></td>
<td align="left">重复0次或更多次</td>
<td align="left"><code>[c]</code></td>
<td align="left">匹配单个字符c</td>
</tr>
<tr>
<td align="left"><code>\d</code></td>
<td align="left">匹配数字</td>
<td align="left"><code>[a-z]</code></td>
<td align="left">匹配a-z小写字母的任意一个</td>
</tr>
<tr>
<td align="left"><code>^</code></td>
<td align="left">匹配字符串的开始</td>
<td align="left">-</td>
<td align="left">-</td>
</tr>
</tbody></table>
<h3 id="6-2-全局变量"><a href="#6-2-全局变量" class="headerlink" title="6.2 全局变量"></a>6.2 全局变量</h3><table>
<thead>
<tr>
<th align="left">变量</th>
<th align="left">说明</th>
<th align="left">变量</th>
<th align="left">说明</th>
</tr>
</thead>
<tbody><tr>
<td align="left"><code>$args</code></td>
<td align="left">这个变量等于请求行中的参数，同<code>$query_string</code></td>
<td align="left"><code>$remote_port</code></td>
<td align="left">客户端的端口。</td>
</tr>
<tr>
<td align="left"><code>$content_length</code></td>
<td align="left">请求头中的<code>Content-length</code>字段。</td>
<td align="left"><code>$remote_user</code></td>
<td align="left">已经经过<code>Auth Basic Module</code>验证的用户名。</td>
</tr>
<tr>
<td align="left"><code>$content_type</code></td>
<td align="left">请求头中的<code>Content-Type</code>字段。</td>
<td align="left"><code>$request_filename</code></td>
<td align="left">当前请求的文件路径，由<code>root</code>或<code>alias</code>指令与<code>URI</code>请求生成。</td>
</tr>
<tr>
<td align="left"><code>$document_root</code></td>
<td align="left">当前请求在<code>root</code>指令中指定的值。</td>
<td align="left"><code>$scheme</code></td>
<td align="left"><code>HTTP</code>方法（如<code>http</code>，<code>https</code>）。</td>
</tr>
<tr>
<td align="left"><code>$host</code></td>
<td align="left">请求主机头字段，否则为服务器名称。</td>
<td align="left"><code>$server_protocol</code></td>
<td align="left">请求使用的协议，通常是<code>HTTP/1.0</code>或<code>HTTP/1.1</code>。</td>
</tr>
<tr>
<td align="left"><code>$http_user_agent</code></td>
<td align="left">客户端<code>agent</code>信息</td>
<td align="left"><code>$server_addr</code></td>
<td align="left">服务器地址，在完成一次系统调用后可以确定这个值。</td>
</tr>
<tr>
<td align="left"><code>$http_cookie</code></td>
<td align="left">客户端<code>cookie</code>信息</td>
<td align="left"><code>$server_name</code></td>
<td align="left">服务器名称。</td>
</tr>
<tr>
<td align="left"><code>$limit_rate</code></td>
<td align="left">这个变量可以限制连接速率。</td>
<td align="left"><code>$server_port</code></td>
<td align="left">请求到达服务器的端口号。</td>
</tr>
<tr>
<td align="left"><code>$request_method</code></td>
<td align="left">客户端请求的动作，通常为<code>GET</code>或<code>POST</code>。</td>
<td align="left"><code>$request_uri</code></td>
<td align="left">包含请求参数的原始<code>URI</code>，不包含主机名，如：<code>/foo/bar.php?arg=baz</code>。</td>
</tr>
<tr>
<td align="left"><code>$remote_addr</code></td>
<td align="left">客户端的IP地址。</td>
<td align="left"><code>$uri</code></td>
<td align="left">不带请求参数的当前<code>URI</code>，<code>$uri</code>不包含主机名，如<code>/foo/bar.html</code>。</td>
</tr>
<tr>
<td align="left"><code>$document_uri</code></td>
<td align="left">与<code>$uri</code>相同。</td>
<td align="left">-</td>
<td align="left">-</td>
</tr>
</tbody></table>
<p>例如请求：<code>http://localhost:3000/test1/test2/test.php</code></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">$host：localhost  </span><br><span class="line">$server_port：3000  </span><br><span class="line">$request_uri：/test1/test2/test.php  </span><br><span class="line">$document_uri：/test1/test2/test.php  </span><br><span class="line">$document_root：/var/www/html  </span><br><span class="line">$request_filename：/var/www/html/test1/test2/test.php</span><br></pre></td></tr></table></figure>

<h3 id="6-3-符号参考"><a href="#6-3-符号参考" class="headerlink" title="6.3 符号参考"></a>6.3 符号参考</h3><table>
<thead>
<tr>
<th align="left">符号</th>
<th align="left">说明</th>
<th align="left">符号</th>
<th align="left">说明</th>
<th align="left">符号</th>
<th align="left">说明</th>
</tr>
</thead>
<tbody><tr>
<td align="left"><code>k</code>,<code>K</code></td>
<td align="left">千字节</td>
<td align="left"><code>m</code>,<code>M</code></td>
<td align="left">兆字节</td>
<td align="left"><code>ms</code></td>
<td align="left">毫秒</td>
</tr>
<tr>
<td align="left"><code>s</code></td>
<td align="left">秒</td>
<td align="left"><code>m</code></td>
<td align="left">分钟</td>
<td align="left"><code>h</code></td>
<td align="left">小时</td>
</tr>
<tr>
<td align="left"><code>d</code></td>
<td align="left">日</td>
<td align="left"><code>w</code></td>
<td align="left">周</td>
<td align="left"><code>M</code></td>
<td align="left">一个月, <code>30</code>天</td>
</tr>
</tbody></table>
<ul>
<li>例如，”8k”，”1m” 代表字节数计量。</li>
<li>例如，”1h 30m”，”1y 6M”。代表 “1小时 30分”，”1年零6个月”。</li>
</ul>
<h3 id="6-4-配置文件"><a href="#6-4-配置文件" class="headerlink" title="6.4 配置文件"></a>6.4 配置文件</h3><ul>
<li><code>nginx</code> 的配置系统由一个主配置文件和其他一些辅助的配置文件构成。这些配置文件均是纯文本文件，全部位于 <code>nginx</code> 安装目录下的 <code>conf</code> 目录下。</li>
<li>指令由 <code>nginx</code> 的各个模块提供，不同的模块会提供不同的指令来实现配置。<br>指令除了 <code>Key-Value</code> 的形式，还有作用域指令。</li>
<li><code>nginx.conf</code> 中的配置信息，根据其逻辑上的意义，对它们进行了分类，也就是分成了多个作用域，或者称之为配置指令上下文。不同的作用域含有一个或者多个配置项。</li>
</ul>
<blockquote>
<p>下面的这些上下文指令是用的比较多：</p>
</blockquote>
<table>
<thead>
<tr>
<th align="left"><code>Directive</code></th>
<th align="left"><code>Description</code></th>
<th align="left"><code>Contains Directive</code></th>
</tr>
</thead>
<tbody><tr>
<td align="left"><code>main</code></td>
<td align="left"><code>nginx</code> 在运行时与具体业务功能（比如 <code>http</code> 服务或者 <code>email</code>服务代理）无关的一些参数，比如工作进程数，运行的身份等。</td>
<td align="left"><code>user</code>, <code>worker_processes</code>, <code>error_log</code>, <code>events</code>, <code>http</code>, <code>mail</code></td>
</tr>
<tr>
<td align="left"><code>http</code></td>
<td align="left">与提供 <code>http</code> 服务相关的一些配置参数。例如：是否使用 <code>keepalive</code>啊，是否使用<code>gzip</code> 进行压缩等。</td>
<td align="left"><code>server</code></td>
</tr>
<tr>
<td align="left"><code>server</code></td>
<td align="left"><code>http</code> 服务上支持若干虚拟主机。每个虚拟主机一个对应的 <code>server</code> 配置项，配置项里面包含该虚拟主机相关的配置。在提供 <code>mail</code> 服务的代理时，也可以建立若干 <code>server.</code> 每个 <code>server</code> 通过监听的地址来区分。</td>
<td align="left"><code>listen</code>, <code>server_name</code>,<code>access_log</code>, <code>location</code>, <code>protocol</code>, <code>proxy</code>, <code>smtp_auth</code>, <code>xclient</code></td>
</tr>
<tr>
<td align="left"><code>location</code></td>
<td align="left"><code>http</code> 服务中，某些特定的 <code>URL</code> 对应的一系列配置项。</td>
<td align="left"><code>index</code>, <code>root</code></td>
</tr>
<tr>
<td align="left"><code>mail</code></td>
<td align="left">实现<code>email</code>相关的 <code>SMTP/IMAP/POP3</code> 代理时，共享的一些配置项（因为可能实现多个代理，工作在多个监听地址上）。</td>
<td align="left"><code>server</code>,<code>http</code>, <code>imap_capabilities</code></td>
</tr>
<tr>
<td align="left"><code>include</code></td>
<td align="left">以便增强配置文件的可读性，使得部分配置文件可以重新使用。</td>
<td align="left">-</td>
</tr>
<tr>
<td align="left"><code>valid_referers</code></td>
<td align="left">用来校验<code>Http</code>请求头<code>Referer</code>是否有效。</td>
<td align="left">-</td>
</tr>
<tr>
<td align="left"><code>try_files</code></td>
<td align="left">用在<code>server</code>部分，不过最常见的还是用在<code>location</code>部分，它会按照给定的参数顺序进行尝试，第一个被匹配到的将会被使用。</td>
<td align="left">-</td>
</tr>
<tr>
<td align="left"><code>if</code></td>
<td align="left">当在<code>location</code>块中使用<code>if</code>指令，在某些情况下它并不按照预期运行，一般来说避免使用<code>if</code>指令。</td>
<td align="left">-</td>
</tr>
</tbody></table>
<ul>
<li>例如我们再 <strong><code>nginx.conf</code></strong> 里面引用两个配置 <code>vhost/example.com.conf</code>和 <code>vhost/gitlab.com.conf</code> 它们都被放在一个我自己新建的目录 <code>vhost</code>下面。<code>nginx.conf</code> 配置如下：</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line">worker_processes  1;</span><br><span class="line">events &#123;</span><br><span class="line">    worker_connections  1024;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">http &#123;</span><br><span class="line">    include       mime.types;</span><br><span class="line">    default_type  application/octet-stream;</span><br><span class="line"></span><br><span class="line">    #log_format  main  &#x27;$remote_addr - $remote_user [$time_local] &quot;$request&quot; &#x27;</span><br><span class="line">    #                  &#x27;$status $body_bytes_sent &quot;$http_referer&quot; &#x27;</span><br><span class="line">    #                  &#x27;&quot;$http_user_agent&quot; &quot;$http_x_forwarded_for&quot;&#x27;;</span><br><span class="line"></span><br><span class="line">    #access_log  logs/access.log  main;</span><br><span class="line"></span><br><span class="line">    sendfile        on;</span><br><span class="line">    #tcp_nopush     on;</span><br><span class="line"></span><br><span class="line">    #keepalive_timeout  0;</span><br><span class="line">    keepalive_timeout  65;</span><br><span class="line"></span><br><span class="line">    #gzip  on;</span><br><span class="line">    server &#123;</span><br><span class="line">        listen       80;</span><br><span class="line">        server_name  localhost;</span><br><span class="line">        location / &#123;</span><br><span class="line">            root   html;</span><br><span class="line">            index  index.html index.htm;</span><br><span class="line">        &#125;</span><br><span class="line">        error_page   500 502 503 504  /50x.html;</span><br><span class="line">        location = /50x.html &#123;</span><br><span class="line">            root   html;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    include  vhost/example.com.conf;</span><br><span class="line">    include  vhost/gitlab.com.conf;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ul>
<li>简单的配置: <code>example.com.conf</code></li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">server &#123;</span><br><span class="line">    #侦听的80端口</span><br><span class="line">    listen       80;</span><br><span class="line">    server_name  baidu.com app.baidu.com; # 这里指定域名</span><br><span class="line">    index        index.html index.htm;    # 这里指定默认入口页面</span><br><span class="line">    root /home/www/app.baidu.com;         # 这里指定目录</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="6-5-内置预定义变量"><a href="#6-5-内置预定义变量" class="headerlink" title="6.5 内置预定义变量"></a>6.5 内置预定义变量</h3><ul>
<li><code>Nginx</code>提供了许多预定义的变量，也可以通过使用<code>set</code>来设置变量。你可以在<code>if</code>中使用预定义变量，也可以将它们传递给代理服务器。以下是一些常见的预定义变量，<a target="_blank" rel="noopener" href="http://nginx.org/en/docs/varindex.html">更多详见</a></li>
</ul>
<table>
<thead>
<tr>
<th align="left">变量名称</th>
<th align="left">值</th>
</tr>
</thead>
<tbody><tr>
<td align="left"><code>$args_name</code></td>
<td align="left">在请求中的<code>name</code>参数</td>
</tr>
<tr>
<td align="left"><code>$args</code> &#96;</td>
<td align="left">所有请求参数</td>
</tr>
<tr>
<td align="left"><code>$query_string</code></td>
<td align="left"><code>$args</code>的别名</td>
</tr>
<tr>
<td align="left"><code>$content_length</code></td>
<td align="left">请求头<code>Content-Length</code>的值</td>
</tr>
<tr>
<td align="left"><code>$content_type</code></td>
<td align="left">请求头<code>Content-Type</code>的值</td>
</tr>
<tr>
<td align="left"><code>$host</code></td>
<td align="left">如果当前有<code>Host</code>，则为请求头<code>Host</code>的值；如果没有这个头，那么该值等于匹配该请求的<code>server_name</code>的值</td>
</tr>
<tr>
<td align="left"><code>$remote_addr</code></td>
<td align="left">客户端的<code>IP</code>地址</td>
</tr>
<tr>
<td align="left"><code>$request</code></td>
<td align="left">完整的请求，从客户端收到，包括<code>Http</code>请求方法、<code>URI</code>、<code>Http</code>协议、头、请求体</td>
</tr>
<tr>
<td align="left"><code>$request_uri</code></td>
<td align="left">完整请求的<code>URI</code>，从客户端来的请求，包括参数</td>
</tr>
<tr>
<td align="left"><code>$scheme</code></td>
<td align="left">当前请求的协议</td>
</tr>
<tr>
<td align="left"><code>$uri</code></td>
<td align="left">当前请求的标准化<code>URI</code></td>
</tr>
</tbody></table>
<h3 id="6-6-反向代理"><a href="#6-6-反向代理" class="headerlink" title="6.6 反向代理"></a>6.6 反向代理</h3><ul>
<li>反向代理是一个<code>Web</code>服务器，它接受客户端的连接请求，然后将请求转发给上游服务器，并将从服务器得到的结果返回给连接的客户端。下面简单的反向代理的例子：</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">server &#123;  </span><br><span class="line">  listen       80;                                                        </span><br><span class="line">  server_name  localhost;                                              </span><br><span class="line">  client_max_body_size 1024M;  # 允许客户端请求的最大单文件字节数</span><br><span class="line"></span><br><span class="line">  location / &#123;</span><br><span class="line">    proxy_pass                         http://localhost:8080;</span><br><span class="line">    proxy_set_header Host              $host:$server_port;</span><br><span class="line">    proxy_set_header X-Forwarded-For   $remote_addr; # HTTP的请求端真实的IP</span><br><span class="line">    proxy_set_header X-Forwarded-Proto $scheme;      # 为了正确地识别实际用户发出的协议是 http 还是 https</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ul>
<li>复杂的配置: <code>gitlab.com.conf</code>。</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">server &#123;</span><br><span class="line">    #侦听的80端口</span><br><span class="line">    listen       80;</span><br><span class="line">    server_name  git.example.cn;</span><br><span class="line">    location / &#123;</span><br><span class="line">        proxy_pass   http://localhost:3000;</span><br><span class="line">        #以下是一些反向代理的配置可删除</span><br><span class="line">        proxy_redirect             off;</span><br><span class="line">        #后端的Web服务器可以通过X-Forwarded-For获取用户真实IP</span><br><span class="line">        proxy_set_header           Host $host;</span><br><span class="line">        client_max_body_size       10m; #允许客户端请求的最大单文件字节数</span><br><span class="line">        client_body_buffer_size    128k; #缓冲区代理缓冲用户端请求的最大字节数</span><br><span class="line">        proxy_connect_timeout      300; #nginx跟后端服务器连接超时时间(代理连接超时)</span><br><span class="line">        proxy_send_timeout         300; #后端服务器数据回传时间(代理发送超时)</span><br><span class="line">        proxy_read_timeout         300; #连接成功后，后端服务器响应时间(代理接收超时)</span><br><span class="line">        proxy_buffer_size          4k; #设置代理服务器（nginx）保存用户头信息的缓冲区大小</span><br><span class="line">        proxy_buffers              4 32k; #proxy_buffers缓冲区，网页平均在32k以下的话，这样设置</span><br><span class="line">        proxy_busy_buffers_size    64k; #高负荷下缓冲大小（proxy_buffers*2）</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ul>
<li>代理到上游服务器的配置中，最重要的是<code>proxy_pass</code>指令。以下是代理模块中的一些常用指令：</li>
</ul>
<table>
<thead>
<tr>
<th align="left">指令</th>
<th align="left">说明</th>
</tr>
</thead>
<tbody><tr>
<td align="left"><code>proxy_connect_timeout</code></td>
<td align="left"><code>Nginx</code>从接受请求至连接到上游服务器的最长等待时间</td>
</tr>
<tr>
<td align="left"><code>proxy_send_timeout</code></td>
<td align="left">后端服务器数据回传时间(代理发送超时)</td>
</tr>
<tr>
<td align="left"><code>proxy_read_timeout</code></td>
<td align="left">连接成功后，后端服务器响应时间(代理接收超时)</td>
</tr>
<tr>
<td align="left"><code>proxy_cookie_domain</code></td>
<td align="left">替代从上游服务器来的<code>Set-Cookie</code>头的<code>domain</code>属性</td>
</tr>
<tr>
<td align="left"><code>proxy_cookie_path</code></td>
<td align="left">替代从上游服务器来的<code>Set-Cookie</code>头的<code>path</code>属性</td>
</tr>
<tr>
<td align="left"><code>proxy_buffer_size</code></td>
<td align="left">设置代理服务器（<code>nginx</code>）保存用户头信息的缓冲区大小</td>
</tr>
<tr>
<td align="left"><code>proxy_buffers</code></td>
<td align="left"><code>proxy_buffers</code>缓冲区，网页平均在多少k以下</td>
</tr>
<tr>
<td align="left"><code>proxy_set_header</code></td>
<td align="left">重写发送到上游服务器头的内容，也可以通过将某个头部的值设置为空字符串，而不发送某个头部的方法实现</td>
</tr>
<tr>
<td align="left"><code>proxy_ignore_headers</code></td>
<td align="left">这个指令禁止处理来自代理服务器的应答。</td>
</tr>
<tr>
<td align="left"><code>proxy_intercept_errors</code></td>
<td align="left">使<code>nginx</code>阻止<code>HTTP</code>应答代码为<code>400</code>或者更高的应答。</td>
</tr>
</tbody></table>
<h3 id="6-7-负载均衡"><a href="#6-7-负载均衡" class="headerlink" title="6.7 负载均衡"></a>6.7 负载均衡</h3><ul>
<li><code>upstream</code>指令启用一个新的配置区段，在该区段定义一组上游服务器。这些服务器可能被设置不同的权重，也可能出于对服务器进行维护，标记为<code>down</code>。</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line">upstream gitlab &#123;</span><br><span class="line">    ip_hash;</span><br><span class="line">    # upstream的负载均衡，weight是权重，可以根据机器配置定义权重。weigth参数表示权值，权值越高被分配到的几率越大。</span><br><span class="line">    server 192.168.122.11:8081 ;</span><br><span class="line">    server 127.0.0.1:82 weight=3;</span><br><span class="line">    server 127.0.0.1:83 weight=3 down;</span><br><span class="line">    server 127.0.0.1:84 weight=3; max_fails=3  fail_timeout=20s;</span><br><span class="line">    server 127.0.0.1:85 weight=4;;</span><br><span class="line">    keepalive 32;</span><br><span class="line">&#125;</span><br><span class="line">server &#123;</span><br><span class="line">    #侦听的80端口</span><br><span class="line">    listen       80;</span><br><span class="line">    server_name  git.example.cn;</span><br><span class="line">    location / &#123;</span><br><span class="line">        proxy_pass   http://gitlab;    #在这里设置一个代理，和upstream的名字一样</span><br><span class="line">        #以下是一些反向代理的配置可删除</span><br><span class="line">        proxy_redirect             off;</span><br><span class="line">        #后端的Web服务器可以通过X-Forwarded-For获取用户真实IP</span><br><span class="line">        proxy_set_header           Host $host;</span><br><span class="line">        proxy_set_header           X-Real-IP $remote_addr;</span><br><span class="line">        proxy_set_header           X-Forwarded-For $proxy_add_x_forwarded_for;</span><br><span class="line">        client_max_body_size       10m;  #允许客户端请求的最大单文件字节数</span><br><span class="line">        client_body_buffer_size    128k; #缓冲区代理缓冲用户端请求的最大字节数</span><br><span class="line">        proxy_connect_timeout      300;  #nginx跟后端服务器连接超时时间(代理连接超时)</span><br><span class="line">        proxy_send_timeout         300;  #后端服务器数据回传时间(代理发送超时)</span><br><span class="line">        proxy_read_timeout         300;  #连接成功后，后端服务器响应时间(代理接收超时)</span><br><span class="line">        proxy_buffer_size          4k; #设置代理服务器（nginx）保存用户头信息的缓冲区大小</span><br><span class="line">        proxy_buffers              4 32k;# 缓冲区，网页平均在32k以下的话，这样设置</span><br><span class="line">        proxy_busy_buffers_size    64k; #高负荷下缓冲大小（proxy_buffers*2）</span><br><span class="line">        proxy_temp_file_write_size 64k; #设定缓存文件夹大小，大于这个值，将从upstream服务器传</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ul>
<li>每个请求按时间顺序逐一分配到不同的后端服务器，如果后端服务器<code>down</code>掉，能自动剔除。</li>
</ul>
<p><strong>负载均衡：</strong></p>
<ul>
<li><code>upstream</code>模块能够使用3种负载均衡算法：轮询、IP哈希、最少连接数。</li>
</ul>
<p><strong>轮询：</strong></p>
<ul>
<li>默认情况下使用轮询算法，不需要配置指令来激活它，它是基于在队列中谁是下一个的原理确保访问均匀地分布到每个上游服务器；</li>
</ul>
<p><strong>IP哈希：</strong></p>
<ul>
<li>通过<code>ip_hash</code>指令来激活，Nginx通过IPv4地址的前3个字节或者整个IPv6地址作为哈希键来实现，同一个IP地址总是能被映射到同一个上游服务器；</li>
</ul>
<p><strong>最少连接数：</strong></p>
<ul>
<li>通过<code>least_conn</code>指令来激活，该算法通过选择一个活跃数最少的上游服务器进行连接。如果上游服务器处理能力不同，可以通过给<code>server</code>配置<code>weight</code>权重来说明，该算法将考虑到不同服务器的加权最少连接数。</li>
</ul>
<h4 id="6-7-1-RR"><a href="#6-7-1-RR" class="headerlink" title="6.7.1 RR"></a>6.7.1 RR</h4><p><strong>简单配置</strong></p>
<blockquote>
<p>这里我配置了2台服务器，当然实际上是一台，只是端口不一样而已，而8081的服务器是不存在的，也就是说访问不到，但是我们访问 <code>http://localhost</code> 的时候，也不会有问题，会默认跳转到<code>http://localhost:8080</code>具体是因为Nginx会自动判断服务器的状态，如果服务器处于不能访问（服务器挂了），就不会跳转到这台服务器，所以也避免了一台服务器挂了影响使用的情况，由于Nginx默认是RR策略，所以我们不需要其他更多的设置</p>
</blockquote>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">upstream test &#123;</span><br><span class="line">    server localhost:8080;</span><br><span class="line">    server localhost:8081;</span><br><span class="line">&#125;</span><br><span class="line">server &#123;</span><br><span class="line">    listen       81;</span><br><span class="line">    server_name  localhost;</span><br><span class="line">    client_max_body_size 1024M;</span><br><span class="line"> </span><br><span class="line">    location / &#123;</span><br><span class="line">        proxy_pass http://test;</span><br><span class="line">        proxy_set_header Host $host:$server_port;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>负载均衡的核心代码为</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">upstream test &#123;</span><br><span class="line">    server localhost:8080;</span><br><span class="line">    server localhost:8081;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="6-7-2-权重"><a href="#6-7-2-权重" class="headerlink" title="6.7.2 权重"></a>6.7.2 权重</h4><ul>
<li>指定轮询几率，<code>weight</code>和访问比率成正比，用于后端服务器性能不均的情况。 例如</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">upstream test &#123;</span><br><span class="line">    server localhost:8080 weight=9;</span><br><span class="line">    server localhost:8081 weight=1;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ul>
<li>那么10次一般只会有<code>1</code>次会访问到<code>8081</code>，而有<code>9</code>次会访问到<code>8080</code></li>
</ul>
<h4 id="6-7-3-ip-hash"><a href="#6-7-3-ip-hash" class="headerlink" title="6.7.3 ip_hash"></a>6.7.3 ip_hash</h4><blockquote>
<p>上面的2种方式都有一个问题，那就是下一个请求来的时候请求可能分发到另外一个服务器，当我们的程序不是无状态的时候（采用了<code>session</code>保存数据），这时候就有一个很大的很问题了，比如把登录信息保存到了<code>session</code>中，那么跳转到另外一台服务器的时候就需要重新登录了，所以很多时候我们需要一个客户只访问一个服务器，那么就需要用<code>iphash</code>了，<code>iphash</code>的每个请求按访问<code>ip</code>的<code>hash</code>结果分配，这样每个访客固定访问一个后端服务器，可以解决<code>session</code>的问题。</p>
</blockquote>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">upstream test &#123;</span><br><span class="line">    ip_hash;</span><br><span class="line">    server localhost:8080;</span><br><span class="line">    server localhost:8081;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="6-7-4-fair"><a href="#6-7-4-fair" class="headerlink" title="6.7.4 fair"></a>6.7.4 fair</h4><ul>
<li>这是个第三方模块，按后端服务器的响应时间来分配请求，响应时间短的优先分配。</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">upstream backend &#123;</span><br><span class="line">    fair;</span><br><span class="line">    server localhost:8080;</span><br><span class="line">    server localhost:8081;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="6-7-5-url-hash"><a href="#6-7-5-url-hash" class="headerlink" title="6.7.5 url_hash"></a>6.7.5 url_hash</h4><blockquote>
<p>这是个第三方模块，按访问<code>url</code>的<code>hash</code>结果来分配请求，使每个<code>url</code>定向到同一个后端服务器，后端服务器为缓存时比较有效。 在<code>upstream</code>中加入<code>hash</code>语句，<code>server</code>语句中不能写入<code>weight</code>等其他的参数，<code>hash_method</code>是使用的<code>hash</code>算法</p>
</blockquote>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">upstream backend &#123;</span><br><span class="line">    hash $request_uri;</span><br><span class="line">    hash_method crc32;</span><br><span class="line">    server localhost:8080;</span><br><span class="line">    server localhost:8081;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ul>
<li>以上<code>5</code>种负载均衡各自适用不同情况下使用，所以可以根据实际情况选择使用哪种策略模式，不过<code>fair</code>和<code>url_hash</code>需要安装第三方模块才能使用</li>
</ul>
<p><strong>server指令可选参数：</strong></p>
<ul>
<li><code>weight</code>：设置一个服务器的访问权重，数值越高，收到的请求也越多；</li>
<li><code>fail_timeout</code>：在这个指定的时间内服务器必须提供响应，如果在这个时间内没有收到响应，那么服务器将会被标记为<code>down</code>状态；</li>
<li><code>max_fails</code>：设置在<code>fail_timeout</code>时间之内尝试对一个服务器连接的最大次数，如果超过这个次数，那么服务器将会被标记为<code>down</code>;</li>
<li><code>down</code>：标记一个服务器不再接受任何请求；</li>
<li><code>backup</code>：一旦其他服务器宕机，那么有该标记的机器将会接收请求。</li>
</ul>
<p><strong>keepalive指令：</strong></p>
<ul>
<li><code>Nginx</code>服务器将会为每一个<code>worker</code>进行保持同上游服务器的连接。</li>
</ul>
<h3 id="6-8-屏蔽ip"><a href="#6-8-屏蔽ip" class="headerlink" title="6.8 屏蔽ip"></a>6.8 屏蔽ip</h3><ul>
<li>在<code>nginx</code>的配置文件<code>nginx.conf</code>中加入如下配置，可以放到<code>http</code>, <code>server</code>, <code>location</code>, <code>limit_except</code>语句块，需要注意相对路径，本例当中<code>nginx.conf</code>，<code>blocksip.conf</code>在同一个目录中。</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">include blockip.conf;</span><br></pre></td></tr></table></figure>

<ul>
<li>在<code>blockip.conf</code>里面输入内容，如：</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">deny 165.91.122.67;</span><br><span class="line"></span><br><span class="line">deny IP;   # 屏蔽单个ip访问</span><br><span class="line">allow IP;  # 允许单个ip访问</span><br><span class="line">deny all;  # 屏蔽所有ip访问</span><br><span class="line">allow all; # 允许所有ip访问</span><br><span class="line">deny 123.0.0.0/8   # 屏蔽整个段即从123.0.0.1到123.255.255.254访问的命令</span><br><span class="line">deny 124.45.0.0/16 # 屏蔽IP段即从123.45.0.1到123.45.255.254访问的命令</span><br><span class="line">deny 123.45.6.0/24 # 屏蔽IP段即从123.45.6.1到123.45.6.254访问的命令</span><br><span class="line"></span><br><span class="line"># 如果你想实现这样的应用，除了几个IP外，其他全部拒绝</span><br><span class="line">allow 1.1.1.1; </span><br><span class="line">allow 1.1.1.2;</span><br><span class="line">deny all;</span><br></pre></td></tr></table></figure>

<h2 id="七、第三方模块安装方法"><a href="#七、第三方模块安装方法" class="headerlink" title="七、第三方模块安装方法"></a>七、第三方模块安装方法</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">./configure --prefix=/你的安装目录  --add-module=/第三方模块目录</span><br></pre></td></tr></table></figure>

<h2 id="八、重定向"><a href="#八、重定向" class="headerlink" title="八、重定向"></a>八、重定向</h2><ul>
<li><code>permanent</code> 永久性重定向。请求日志中的状态码为301</li>
<li><code>redirect</code> 临时重定向。请求日志中的状态码为302</li>
</ul>
<h3 id="8-1-重定向整个网站"><a href="#8-1-重定向整个网站" class="headerlink" title="8.1 重定向整个网站"></a>8.1 重定向整个网站</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">server &#123;</span><br><span class="line">    server_name old-site.com</span><br><span class="line">    return 301 $scheme://new-site.com$request_uri;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="8-2-重定向单页"><a href="#8-2-重定向单页" class="headerlink" title="8.2 重定向单页"></a>8.2 重定向单页</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">server &#123;</span><br><span class="line">    location = /oldpage.html &#123;</span><br><span class="line">        return 301 http://example.org/newpage.html;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="8-3-重定向整个子路径"><a href="#8-3-重定向整个子路径" class="headerlink" title="8.3 重定向整个子路径"></a>8.3 重定向整个子路径</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">location /old-site &#123;</span><br><span class="line">    rewrite ^/old-site/(.*) http://example.org/new-site/$1 permanent;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="九、性能"><a href="#九、性能" class="headerlink" title="九、性能"></a>九、性能</h2><h3 id="9-1-内容缓存"><a href="#9-1-内容缓存" class="headerlink" title="9.1 内容缓存"></a>9.1 内容缓存</h3><ul>
<li>允许浏览器基本上永久地缓存静态内容。 <code>Nginx</code>将为您设置<code>Expires</code>和<code>Cache-Control</code>头信息。</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">location /static &#123;</span><br><span class="line">    root /data;</span><br><span class="line">    expires max;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ul>
<li>如果要求浏览器永远不会缓存响应（例如用于跟踪请求），请使用<code>-1</code>。</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">location = /empty.gif &#123;</span><br><span class="line">    empty_gif;</span><br><span class="line">    expires -1;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="9-2-Gzip压缩"><a href="#9-2-Gzip压缩" class="headerlink" title="9.2 Gzip压缩"></a>9.2 Gzip压缩</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">gzip  on;</span><br><span class="line">gzip_buffers 16 8k;</span><br><span class="line">gzip_comp_level 6;</span><br><span class="line">gzip_http_version 1.1;</span><br><span class="line">gzip_min_length 256;</span><br><span class="line">gzip_proxied any;</span><br><span class="line">gzip_vary on;</span><br><span class="line">gzip_types</span><br><span class="line">    text/xml application/xml application/atom+xml application/rss+xml application/xhtml+xml image/svg+xml</span><br><span class="line">    text/javascript application/javascript application/x-javascript</span><br><span class="line">    text/x-json application/json application/x-web-app-manifest+json</span><br><span class="line">    text/css text/plain text/x-component</span><br><span class="line">    font/opentype application/x-font-ttf application/vnd.ms-fontobject</span><br><span class="line">    image/x-icon;</span><br><span class="line">gzip_disable  &quot;msie6&quot;;</span><br></pre></td></tr></table></figure>

<h3 id="9-3-打开文件缓存"><a href="#9-3-打开文件缓存" class="headerlink" title="9.3 打开文件缓存"></a>9.3 打开文件缓存</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">open_file_cache max=1000 inactive=20s;</span><br><span class="line">open_file_cache_valid 30s;</span><br><span class="line">open_file_cache_min_uses 2;</span><br><span class="line">open_file_cache_errors on;</span><br></pre></td></tr></table></figure>

<h3 id="9-4-SSL缓存"><a href="#9-4-SSL缓存" class="headerlink" title="9.4 SSL缓存"></a>9.4 SSL缓存</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">ssl_session_cache shared:SSL:10m;</span><br><span class="line">ssl_session_timeout 10m;</span><br></pre></td></tr></table></figure>

<h3 id="9-5-上游Keepalive"><a href="#9-5-上游Keepalive" class="headerlink" title="9.5 上游Keepalive"></a>9.5 上游Keepalive</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">upstream backend &#123;</span><br><span class="line">    server 127.0.0.1:8080;</span><br><span class="line">    keepalive 32;</span><br><span class="line">&#125;</span><br><span class="line">server &#123;</span><br><span class="line">    ...</span><br><span class="line">    location /api/ &#123;</span><br><span class="line">        proxy_pass http://backend;</span><br><span class="line">        proxy_http_version 1.1;</span><br><span class="line">        proxy_set_header Connection &quot;&quot;;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="9-6-监控"><a href="#9-6-监控" class="headerlink" title="9.6 监控"></a>9.6 监控</h3><ul>
<li>使用<code>ngxtop</code>实时解析<code>nginx</code>访问日志，并且将处理结果输出到终端，功能类似于系统命令<code>top</code>。所有示例都读取<code>nginx</code>配置文件的访问日志位置和格式。如果要指定访问日志文件和&#x2F;或日志格式，请使用-f和-a选项。</li>
<li>注意：在<code>nginx</code>配置中<code>/usr/local/nginx/conf/nginx.conf</code>日志文件必须是绝对路径。</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"># 安装 ngxtop</span><br><span class="line">pip install ngxtop</span><br><span class="line"></span><br><span class="line"># 实时状态</span><br><span class="line">ngxtop</span><br><span class="line"># 状态为404的前10个请求的路径：</span><br><span class="line">ngxtop top request_path --filter &#x27;status == 404&#x27;</span><br><span class="line"></span><br><span class="line"># 发送总字节数最多的前10个请求</span><br><span class="line">ngxtop --order-by &#x27;avg(bytes_sent) * count&#x27;</span><br><span class="line"></span><br><span class="line"># 排名前十位的IP，例如，谁攻击你最多</span><br><span class="line">ngxtop --group-by remote_addr</span><br><span class="line"></span><br><span class="line"># 打印具有4xx或5xx状态的请求，以及status和http referer</span><br><span class="line">ngxtop -i &#x27;status &gt;= 400&#x27; print request status http_referer</span><br><span class="line"></span><br><span class="line"># 由200个请求路径响应发送的平均正文字节以&#x27;foo&#x27;开始：</span><br><span class="line">ngxtop avg bytes_sent --filter &#x27;status == 200 and request_path.startswith(&quot;foo&quot;)&#x27;</span><br><span class="line"></span><br><span class="line"># 使用“common”日志格式从远程机器分析apache访问日志</span><br><span class="line">ssh remote tail -f /var/log/apache2/access.log | ngxtop -f common</span><br></pre></td></tr></table></figure>

<h2 id="十、常见使用场景"><a href="#十、常见使用场景" class="headerlink" title="十、常见使用场景"></a>十、常见使用场景</h2><h3 id="10-1-跨域问题"><a href="#10-1-跨域问题" class="headerlink" title="10.1 跨域问题"></a>10.1 跨域问题</h3><ul>
<li>在工作中，有时候会遇到一些接口不支持跨域，这时候可以简单的添加<code>add_headers</code>来支持<code>cors</code>跨域。配置如下：</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">server &#123;</span><br><span class="line">  listen 80;</span><br><span class="line">  server_name api.xxx.com;</span><br><span class="line">    </span><br><span class="line">  add_header &#x27;Access-Control-Allow-Origin&#x27; &#x27;*&#x27;;</span><br><span class="line">  add_header &#x27;Access-Control-Allow-Credentials&#x27; &#x27;true&#x27;;</span><br><span class="line">  add_header &#x27;Access-Control-Allow-Methods&#x27; &#x27;GET,POST,HEAD&#x27;;</span><br><span class="line"></span><br><span class="line">  location / &#123;</span><br><span class="line">    proxy_pass http://127.0.0.1:3000;</span><br><span class="line">    proxy_set_header X-Real-IP $remote_addr;</span><br><span class="line">    proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;</span><br><span class="line">    proxy_set_header Host  $http_host;    </span><br><span class="line">  &#125; </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ul>
<li>上面更改头信息，还有一种，使用 <a target="_blank" rel="noopener" href="http://nginx.org/en/docs/http/ngx_http_rewrite_module.html">rewrite</a> 指令重定向URI来解决跨域问题。</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line">upstream test &#123;</span><br><span class="line">  server 127.0.0.1:8080;</span><br><span class="line">  server localhost:8081;</span><br><span class="line">&#125;</span><br><span class="line">server &#123;</span><br><span class="line">  listen 80;</span><br><span class="line">  server_name api.xxx.com;</span><br><span class="line">  location / &#123; </span><br><span class="line">    root  html;                   #去请求../html文件夹里的文件</span><br><span class="line">    index  index.html index.htm;  #首页响应地址</span><br><span class="line">  &#125;</span><br><span class="line">  # 用于拦截请求，匹配任何以 /api/开头的地址，</span><br><span class="line">  # 匹配符合以后，停止往下搜索正则。</span><br><span class="line">  location ^~/api/&#123; </span><br><span class="line">    # 代表重写拦截进来的请求，并且只能对域名后边的除去传递的参数外的字符串起作用，</span><br><span class="line">    # 例如www.a.com/proxy/api/msg?meth=1&amp;par=2重写，只对/proxy/api/msg重写。</span><br><span class="line">    # rewrite后面的参数是一个简单的正则 ^/api/(.*)$，</span><br><span class="line">    # $1代表正则中的第一个()，$2代表第二个()的值，以此类推。</span><br><span class="line">    rewrite ^/api/(.*)$ /$1 break;</span><br><span class="line">    </span><br><span class="line">    # 把请求代理到其他主机 </span><br><span class="line">    # 其中 http://www.b.com/ 写法和 http://www.b.com写法的区别如下</span><br><span class="line">    # 如果你的请求地址是他 http://server/html/test.jsp</span><br><span class="line">    # 配置一： http://www.b.com/ 后面有“/” </span><br><span class="line">    #         将反向代理成 http://www.b.com/html/test.jsp 访问</span><br><span class="line">    # 配置一： http://www.b.com 后面没有有“/” </span><br><span class="line">    #         将反向代理成 http://www.b.com/test.jsp 访问</span><br><span class="line">    proxy_pass http://test;</span><br><span class="line"></span><br><span class="line">    # 如果 proxy_pass  URL 是 http://a.xx.com/platform/ 这种情况</span><br><span class="line">    # proxy_cookie_path应该设置成 /platform/ / (注意两个斜杠之间有空格)。</span><br><span class="line">    proxy_cookie_path /platfrom/ /;</span><br><span class="line"></span><br><span class="line">    # http://nginx.org/en/docs/http/ngx_http_proxy_module.html#proxy_pass_header</span><br><span class="line">    # 设置 Cookie 头通过</span><br><span class="line">    proxy_pass_header Set-Cookie;</span><br><span class="line">  &#125; </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="10-2-跳转到带www的域上面"><a href="#10-2-跳转到带www的域上面" class="headerlink" title="10.2 跳转到带www的域上面"></a>10.2 跳转到带www的域上面</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">server &#123;</span><br><span class="line">    listen 80;</span><br><span class="line">    # 配置正常的带www的域名</span><br><span class="line">    server_name www.wangchujiang.com;</span><br><span class="line">    root /home/www/wabg/download;</span><br><span class="line">    location / &#123;</span><br><span class="line">        try_files $uri $uri/ /index.html =404;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">server &#123;</span><br><span class="line">    # 这个要放到下面，</span><br><span class="line">    # 将不带www的 wangchujiang.com 永久性重定向到  https://www.wangchujiang.com</span><br><span class="line">    server_name wangchujiang.com;</span><br><span class="line">    rewrite ^(.*) https://www.wangchujiang.com$1 permanent;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="10-3-代理转发"><a href="#10-3-代理转发" class="headerlink" title="10.3 代理转发"></a>10.3 代理转发</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line">upstream server-api&#123;</span><br><span class="line">    # api 代理服务地址</span><br><span class="line">    server 127.0.0.1:3110;    </span><br><span class="line">&#125;</span><br><span class="line">upstream server-resource&#123;</span><br><span class="line">    # 静态资源 代理服务地址</span><br><span class="line">    server 127.0.0.1:3120;</span><br><span class="line">&#125;</span><br><span class="line">server &#123;</span><br><span class="line">    listen       3111;</span><br><span class="line">    server_name  localhost;      # 这里指定域名</span><br><span class="line">    root /home/www/server-statics;</span><br><span class="line">    # 匹配 api 路由的反向代理到API服务</span><br><span class="line">    location ^~/api/ &#123;</span><br><span class="line">        rewrite ^/(.*)$ /$1 break;</span><br><span class="line">        proxy_pass http://server-api;</span><br><span class="line">    &#125;</span><br><span class="line">    # 假设这里验证码也在API服务中</span><br><span class="line">    location ^~/captcha &#123;</span><br><span class="line">        rewrite ^/(.*)$ /$1 break;</span><br><span class="line">        proxy_pass http://server-api;</span><br><span class="line">    &#125;</span><br><span class="line">    # 假设你的图片资源全部在另外一个服务上面</span><br><span class="line">    location ^~/img/ &#123;</span><br><span class="line">        rewrite ^/(.*)$ /$1 break;</span><br><span class="line">        proxy_pass http://server-resource;</span><br><span class="line">    &#125;</span><br><span class="line">    # 路由在前端，后端没有真实路由，在路由不存在的 404状态的页面返回 /index.html</span><br><span class="line">    # 这个方式使用场景，你在写React或者Vue项目的时候，没有真实路由</span><br><span class="line">    location / &#123;</span><br><span class="line">        try_files $uri $uri/ /index.html =404;</span><br><span class="line">        #                               ^ 空格很重要</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="10-4-代理转发连接替换"><a href="#10-4-代理转发连接替换" class="headerlink" title="10.4 代理转发连接替换"></a>10.4 代理转发连接替换</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">location ^~/api/upload &#123;</span><br><span class="line">    rewrite ^/(.*)$ /wfs/v1/upload break;</span><br><span class="line">    proxy_pass http://wfs-api;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="10-5-ssl配置"><a href="#10-5-ssl配置" class="headerlink" title="10.5 ssl配置"></a>10.5 ssl配置</h3><ul>
<li><p>超文本传输安全协议（缩写：HTTPS，英语：Hypertext Transfer Protocol Secure）是超文本传输协议和SSL&#x2F;TLS的组合，用以提供加密通讯及对网络服务器身份的鉴定。HTTPS连接经常被用于万维网上的交易支付和企业信息系统中敏感信息的传输。HTTPS不应与在RFC 2660中定义的安全超文本传输协议（S-HTTP）相混。HTTPS 目前已经是所有注重隐私和安全的网站的首选，随着技术的不断发展，HTTPS 网站已不再是大型网站的专利，所有普通的个人站长和博客均可以自己动手搭建一个安全的加密的网站。</p>
</li>
<li><p>创建<code>SSL</code>证书，如果你购买的证书，就可以直接下载</p>
</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">sudo mkdir /etc/nginx/ssl</span><br><span class="line"># 创建了有效期100年，加密强度为RSA2048的SSL密钥key和X509证书文件。</span><br><span class="line">sudo openssl req -x509 -nodes -days 36500 -newkey rsa:2048 -keyout /etc/nginx/ssl/nginx.key -out /etc/nginx/ssl/nginx.crt</span><br><span class="line"># 上面命令，会有下面需要填写内容</span><br><span class="line">Country Name (2 letter code) [AU]:US</span><br><span class="line">State or Province Name (full name) [Some-State]:New York</span><br><span class="line">Locality Name (eg, city) []:New York City</span><br><span class="line">Organization Name (eg, company) [Internet Widgits Pty Ltd]:Bouncy Castles, Inc.</span><br><span class="line">Organizational Unit Name (eg, section) []:Ministry of Water Slides</span><br><span class="line">Common Name (e.g. server FQDN or YOUR name) []:your_domain.com</span><br><span class="line">Email Address []:admin@your_domain.com</span><br></pre></td></tr></table></figure>

<ul>
<li>创建自签证书</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">首先，创建证书和私钥的目录</span><br><span class="line"># mkdir -p /etc/nginx/cert</span><br><span class="line"># cd /etc/nginx/cert</span><br><span class="line">创建服务器私钥，命令会让你输入一个口令：</span><br><span class="line"># openssl genrsa -des3 -out nginx.key 2048</span><br><span class="line">创建签名请求的证书（CSR）：</span><br><span class="line"># openssl req -new -key nginx.key -out nginx.csr</span><br><span class="line">在加载SSL支持的Nginx并使用上述私钥时除去必须的口令：</span><br><span class="line"># cp nginx.key nginx.key.org</span><br><span class="line"># openssl rsa -in nginx.key.org -out nginx.key</span><br><span class="line">最后标记证书使用上述私钥和CSR：</span><br><span class="line"># openssl x509 -req -days 365 -in nginx.csr -signkey nginx.key -out nginx.crt</span><br></pre></td></tr></table></figure>

<p>查看目前nginx编译选项</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sbin/nginx -V</span><br></pre></td></tr></table></figure>

<p>输出下面内容</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">nginx version: nginx/1.7.8</span><br><span class="line">built by gcc 4.4.7 20120313 (Red Hat 4.4.7-4) (GCC)</span><br><span class="line">TLS SNI support enabled</span><br><span class="line">configure arguments: --prefix=/usr/local/nginx-1.7.8 --with-http_ssl_module --with-http_spdy_module --with-http_stub_status_module --with-pcre</span><br></pre></td></tr></table></figure>

<p>如果依赖的模块不存在，可以进入安装目录，输入下面命令重新编译安装。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">./configure --prefix=/usr/local/nginx --with-http_stub_status_module --with-http_ssl_module</span><br></pre></td></tr></table></figure>

<p>运行完成之后还需要<code>make</code> (不用make install)</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"># 备份nginx的二进制文件</span><br><span class="line">cp -rf /usr/local/nginx/sbin/nginx　 /usr/local/nginx/sbin/nginx.bak</span><br><span class="line"># 覆盖nginx的二进制文件</span><br><span class="line">cp -rf objs/nginx   /usr/local/nginx/sbin/</span><br></pre></td></tr></table></figure>

<p>HTTPS server</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line">server &#123;</span><br><span class="line">    listen       443 ssl;</span><br><span class="line">    server_name  localhost;</span><br><span class="line"></span><br><span class="line">    ssl_certificate /etc/nginx/ssl/nginx.crt;</span><br><span class="line">    ssl_certificate_key /etc/nginx/ssl/nginx.key;</span><br><span class="line">    # 禁止在header中出现服务器版本，防止黑客利用版本漏洞攻击</span><br><span class="line">    server_tokens off;</span><br><span class="line">    # 设置ssl/tls会话缓存的类型和大小。如果设置了这个参数一般是shared，buildin可能会参数内存碎片，默认是none，和off差不多，停用缓存。如shared:SSL:10m表示我所有的nginx工作进程共享ssl会话缓存，官网介绍说1M可以存放约4000个sessions。 </span><br><span class="line">    ssl_session_cache    shared:SSL:1m; </span><br><span class="line"></span><br><span class="line">    # 客户端可以重用会话缓存中ssl参数的过期时间，内网系统默认5分钟太短了，可以设成30m即30分钟甚至4h。</span><br><span class="line">    ssl_session_timeout  5m; </span><br><span class="line"></span><br><span class="line">    # 选择加密套件，不同的浏览器所支持的套件（和顺序）可能会不同。</span><br><span class="line">    # 这里指定的是OpenSSL库能够识别的写法，你可以通过 openssl -v cipher &#x27;RC4:HIGH:!aNULL:!MD5&#x27;（后面是你所指定的套件加密算法） 来看所支持算法。</span><br><span class="line">    ssl_ciphers  HIGH:!aNULL:!MD5;</span><br><span class="line"></span><br><span class="line">    # 设置协商加密算法时，优先使用我们服务端的加密套件，而不是客户端浏览器的加密套件。</span><br><span class="line">    ssl_prefer_server_ciphers  on;</span><br><span class="line"></span><br><span class="line">    location / &#123;</span><br><span class="line">        root   html;</span><br><span class="line">        index  index.html index.htm;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="10-6-强制将http重定向到https"><a href="#10-6-强制将http重定向到https" class="headerlink" title="10.6 强制将http重定向到https"></a>10.6 强制将http重定向到https</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">server &#123;</span><br><span class="line">    listen       80;</span><br><span class="line">    server_name  example.com;</span><br><span class="line">    rewrite ^ https://$http_host$request_uri? permanent;    # 强制将http重定向到https</span><br><span class="line">    # 在错误页面和“服务器”响应头字段中启用或禁用发射nginx版本。 防止黑客利用版本漏洞攻击</span><br><span class="line">    server_tokens off;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="10-7-两个虚拟主机"><a href="#10-7-两个虚拟主机" class="headerlink" title="10.7 两个虚拟主机"></a>10.7 两个虚拟主机</h3><ul>
<li>纯静态<code>-html</code> 支持</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">http &#123;</span><br><span class="line">    server &#123;</span><br><span class="line">        listen          80;</span><br><span class="line">        server_name     www.domain1.com;</span><br><span class="line">        access_log      logs/domain1.access.log main;</span><br><span class="line">        location / &#123;</span><br><span class="line">            index index.html;</span><br><span class="line">            root  /var/www/domain1.com/htdocs;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    server &#123;</span><br><span class="line">        listen          80;</span><br><span class="line">        server_name     www.domain2.com;</span><br><span class="line">        access_log      logs/domain2.access.log main;</span><br><span class="line">        location / &#123;</span><br><span class="line">            index index.html;</span><br><span class="line">            root  /var/www/domain2.com/htdocs;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="10-8-虚拟主机标准配置"><a href="#10-8-虚拟主机标准配置" class="headerlink" title="10.8 虚拟主机标准配置"></a>10.8 虚拟主机标准配置</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">http &#123;</span><br><span class="line">  server &#123;</span><br><span class="line">    listen          80 default;</span><br><span class="line">    server_name     _ *;</span><br><span class="line">    access_log      logs/default.access.log main;</span><br><span class="line">    location / &#123;</span><br><span class="line">       index index.html;</span><br><span class="line">       root  /var/www/default/htdocs;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="10-9-防盗链"><a href="#10-9-防盗链" class="headerlink" title="10.9 防盗链"></a>10.9 防盗链</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">location ~* \.(gif|jpg|png|swf|flv)$ &#123;</span><br><span class="line">   root html</span><br><span class="line">   valid_referers none blocked *.nginxcn.com;</span><br><span class="line">   if ($invalid_referer) &#123;</span><br><span class="line">     rewrite ^/ www.nginx.cn</span><br><span class="line">     #return 404;</span><br><span class="line">   &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="10-10虚拟目录配置"><a href="#10-10虚拟目录配置" class="headerlink" title="10.10虚拟目录配置"></a>10.10虚拟目录配置</h3><p>alias指定的目录是准确的，root是指定目录的上级目录，并且该上级目录要含有location指定名称的同名目录。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">location /img/ &#123;</span><br><span class="line">    alias /var/www/image/;</span><br><span class="line">&#125;</span><br><span class="line"># 访问/img/目录里面的文件时，ningx会自动去/var/www/image/目录找文件</span><br><span class="line">location /img/ &#123;</span><br><span class="line">    root /var/www/image;</span><br><span class="line">&#125;</span><br><span class="line"># 访问/img/目录下的文件时，nginx会去/var/www/image/img/目录下找文件。]</span><br></pre></td></tr></table></figure>

<h3 id="10-11-防盗图配置"><a href="#10-11-防盗图配置" class="headerlink" title="10.11 防盗图配置"></a>10.11 防盗图配置</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">location ~ \/public\/(css|js|img)\/.*\.(js|css|gif|jpg|jpeg|png|bmp|swf) &#123;</span><br><span class="line">    valid_referers none blocked *.jslite.io;</span><br><span class="line">    if ($invalid_referer) &#123;</span><br><span class="line">        rewrite ^/  http://wangchujiang.com/piratesp.png;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="10-12-屏蔽-git等文件"><a href="#10-12-屏蔽-git等文件" class="headerlink" title="10.12 屏蔽.git等文件"></a>10.12 屏蔽.git等文件</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">location ~ (.git|.gitattributes|.gitignore|.svn) &#123;</span><br><span class="line">    deny all;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="域名路径加不加需要都能正常访问"><a href="#域名路径加不加需要都能正常访问" class="headerlink" title="域名路径加不加需要都能正常访问"></a>域名路径加不加需要都能正常访问</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">http://wangchujiang.com/api/index.php?a=1&amp;name=wcj</span><br><span class="line">                                  ^ 有后缀</span><br><span class="line"></span><br><span class="line">http://wangchujiang.com/api/index?a=1&amp;name=wcj</span><br><span class="line">                                 ^ 没有后缀</span><br></pre></td></tr></table></figure>

<ul>
<li><code>nginx rewrite</code>规则如下：</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">rewrite ^/(.*)/$ /index.php?/$1 permanent;</span><br><span class="line">if (!-d $request_filename)&#123;</span><br><span class="line">        set $rule_1 1$rule_1;</span><br><span class="line">&#125;</span><br><span class="line">if (!-f $request_filename)&#123;</span><br><span class="line">        set $rule_1 2$rule_1;</span><br><span class="line">&#125;</span><br><span class="line">if ($rule_1 = &quot;21&quot;)&#123;</span><br><span class="line">        rewrite ^/ /index.php last;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="十一、错误问题"><a href="#十一、错误问题" class="headerlink" title="十一、错误问题"></a>十一、错误问题</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">The plain HTTP request was sent to HTTPS port</span><br></pre></td></tr></table></figure>

<ul>
<li>解决办法，<code>fastcgi_param HTTPS $https if_not_empty</code> 添加这条规则，</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">server &#123;</span><br><span class="line">    listen 443 ssl; # 注意这条规则</span><br><span class="line">    server_name  my.domain.com;</span><br><span class="line">    </span><br><span class="line">    fastcgi_param HTTPS $https if_not_empty;</span><br><span class="line">    fastcgi_param HTTPS on;</span><br><span class="line"></span><br><span class="line">    ssl_certificate /etc/ssl/certs/your.pem;</span><br><span class="line">    ssl_certificate_key /etc/ssl/private/your.key;</span><br><span class="line"></span><br><span class="line">    location / &#123;</span><br><span class="line">        # Your config here...</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="十二、精品文章参考"><a href="#十二、精品文章参考" class="headerlink" title="十二、精品文章参考"></a>十二、精品文章参考</h2><ul>
<li><a target="_blank" rel="noopener" href="https://my.oschina.net/u/3341316/blog/877206">负载均衡原理的解析</a></li>
<li><a target="_blank" rel="noopener" href="http://blog.githuber.cn/posts/73">Nginx泛域名解析，实现多个二级域名</a></li>
<li><a target="_blank" rel="noopener" href="https://www.nginx.com/blog/inside-nginx-how-we-designed-for-performance-scale/">深入 NGINX: 我们如何设计性能和扩展</a></li>
<li><a target="_blank" rel="noopener" href="https://www.nginx.com/blog/inside-nginx-how-we-designed-for-performance-scale/">Inside NGINX: How We Designed for Performance &amp; Scale</a></li>
<li><a target="_blank" rel="noopener" href="http://tengine.taobao.org/book/index.html">Nginx开发从入门到精通</a></li>
<li><a target="_blank" rel="noopener" href="http://os.51cto.com/art/201703/535326.htm#topx">Nginx的优化与防盗链</a></li>
<li><a target="_blank" rel="noopener" href="https://segmentfault.com/a/1190000009769143">实战开发一个Nginx扩展 (Nginx Module)</a></li>
<li><a target="_blank" rel="noopener" href="https://my.oschina.net/xshuai/blog/917097">Nginx+Keepalived(双机热备)搭建高可用负载均衡环境(HA)</a></li>
<li><a target="_blank" rel="noopener" href="http://www.huxd.org/articles/2017/07/24/1500890692329.html">Nginx 平滑升级</a></li>
<li><a target="_blank" rel="noopener" href="https://mp.weixin.qq.com/s?__biz=MzIxNzg5ODE0OA==&mid=2247483708&idx=1&sn=90b0b1dccd9c337922a0588245277666&chksm=97f38cf7a08405e1928e0b46d923d630e529e7db8ac7ca2a91310a075986f8bcb2cee5b4953d#rd">Nginx最新模块—ngx_http_mirror_module分析可以做版本发布前的预先验证，进行流量放大后的压测等等</a></li>
</ul>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://example.com/2019/08/30/%E9%83%A8%E7%BD%B2/Nginx%E5%AD%A6%E4%B9%A0/" data-id="cl7icg7b100wcugunhc213ujq" data-title="Nginx学习" class="article-share-link">Share</a>
      
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/nginx/" rel="tag">nginx</a></li></ul>

    </footer>
  </div>
  
</article>



  
    <article id="post-http/进程和线程" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2019/07/20/http/%E8%BF%9B%E7%A8%8B%E5%92%8C%E7%BA%BF%E7%A8%8B/" class="article-date">
  <time class="dt-published" datetime="2019-07-20T07:13:48.000Z" itemprop="datePublished">2019-07-20</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F/">操作系统</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/2019/07/20/http/%E8%BF%9B%E7%A8%8B%E5%92%8C%E7%BA%BF%E7%A8%8B/">进程和线程</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <blockquote>
<p>进程是资源分配的基本单位，它是程序执行时的一个实例，在程序运行时创建；线程是程序执行的最小单位，是进程的一个执行流，一个线程由多个线程组成的。</p>
</blockquote>
<p><img src="https://img.php.cn/upload/article/000/000/028/5ccfc5a49e323744.jpg" alt="img"></p>
<p><strong>什么是进程</strong></p>
<p>进程是资源（CPU、内存等）分配的基本单位，它是程序执行时的一个实例。</p>
<p>程序运行时系统就会创建一个进程，并为它分配资源，然后把该进程放入进程就绪队列</p>
<p>进程调度器选中它的时候就会为它分配CPU时间，程序开始真正运行。</p>
<p><img src="https://img.php.cn/upload/article/000/000/028/5ccfc59f97a82532.jpg" alt="img"></p>
<p><strong>什么是线程</strong></p>
<p>线程是程序执行时的最小单位，它是进程的一个执行流，是CPU调度和分派的基本单位。</p>
<p>一个进程可以由很多个线程组成，线程间共享进程的所有资源，每个线程有自己的堆栈和局部变量。</p>
<p>线程由CPU独立调度执行，在多CPU环境下就允许多个线程同时运行。同样多线程也可以实现并发操作，每个请求分配一个线程来处理。</p>
<p><img src="https://img.php.cn/upload/article/000/000/028/5ccfc5bfa2c62416.jpg" alt="img"></p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://example.com/2019/07/20/http/%E8%BF%9B%E7%A8%8B%E5%92%8C%E7%BA%BF%E7%A8%8B/" data-id="cl7icz36a013wugun8ybiauih" data-title="进程和线程" class="article-share-link">Share</a>
      
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F/" rel="tag">操作系统</a></li></ul>

    </footer>
  </div>
  
</article>



  
    <article id="post-nodejs/nodejs-koa2" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2019/06/27/nodejs/nodejs-koa2/" class="article-date">
  <time class="dt-published" datetime="2019-06-27T01:27:18.000Z" itemprop="datePublished">2019-06-27</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/%E5%90%8E%E7%AB%AF/">后端</a>►<a class="article-category-link" href="/categories/%E5%90%8E%E7%AB%AF/%E6%A1%86%E6%9E%B6/">框架</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/2019/06/27/nodejs/nodejs-koa2/">node-koa2总结</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <h1 id="一、Koa框架介绍以及Koa环境搭建"><a href="#一、Koa框架介绍以及Koa环境搭建" class="headerlink" title="一、Koa框架介绍以及Koa环境搭建"></a>一、Koa框架介绍以及Koa环境搭建</h1><h2 id="1-1-Koa-框架介绍"><a href="#1-1-Koa-框架介绍" class="headerlink" title="1.1 Koa 框架介绍"></a>1.1 Koa 框架介绍</h2><blockquote>
<p><code>Node.js</code> 是一个异步的世界，官方 <code>API</code> 支持的都是 <code>callback</code> 形式的异步编程模型，这 会带来许多问题，例如:</p>
</blockquote>
<ol>
<li><code>callback</code> 嵌套问题</li>
<li>异步函数中可能同步调用 callback 返回 数据，带来不一致性。为了解决以上问题 <code>Koa</code> 出现了</li>
</ol>
<p><strong>Koa – 基于 Node.js 平台的下一代 web 开发框架</strong></p>
<blockquote>
<p><code>koa</code> 是由 <code>Express</code> 原班人马打造的，致力于成为一个更小、更富有表现力、更健壮的 Web 框架。 使用 <code>koa</code> 编写 <code>web</code> 应用，可以免除重复繁琐的回调函数嵌套， 并极大地提 升错误处理的效率。<code>koa</code>不在内核方法中绑定任何中间件， 它仅仅提供了一个轻量优雅的 函数库，使得编写 Web 应用变得得心应手。开发思路和 express 差不多，最大的特点就是 可以避免异步嵌套</p>
</blockquote>
<h2 id="1-2-Koa2-x-框架的安装使用"><a href="#1-2-Koa2-x-框架的安装使用" class="headerlink" title="1.2 Koa2.x 框架的安装使用"></a>1.2 Koa2.x 框架的安装使用</h2><p><strong>1. 安装 Node.js 8.x 以上的版本</strong></p>
<blockquote>
<p>开发 <code>Koa2</code> 之前，<code>Node.js</code> 是有要求的，它要求 <code>Node.js</code> 版本高于 <code>V7.6</code>。因为 <code>node.js 7.6</code>版本 开始完全支持 <code>async/await</code>，所以才能完全你支持我们的 Koa2&#96;</p>
</blockquote>
<p><strong>2. 安装 Koa</strong></p>
<blockquote>
<p>安装 <code>Koa</code> 框架和我们以前安装其他模块是一样的</p>
</blockquote>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm install --save koa / cnpm install --save koa</span><br></pre></td></tr></table></figure>

<blockquote>
<p><code>--save</code> 参数，表示自动修改 <code>package.json</code> 文件，自动添加依赖项</p>
</blockquote>
<p><strong>简单使用</strong></p>
<p><img src="https://poetries1.gitee.io/img-repo/2019/10/494.png" alt="img"></p>
<h1 id="二、koa-路由-get传值、动态路由"><a href="#二、koa-路由-get传值、动态路由" class="headerlink" title="二、koa 路由 get传值、动态路由"></a>二、koa 路由 get传值、动态路由</h1><h2 id="2-1-Koa-路由"><a href="#2-1-Koa-路由" class="headerlink" title="2.1 Koa 路由"></a>2.1 Koa 路由</h2><ul>
<li>路由(<code>Routing</code>)是由一个 <code>URI</code>(或者叫路径)和一个特定的 <code>HTTP</code> 方法(<code>GET</code>、<code>POST</code>等)<br>组成的，涉及到应用如何响应客户端对某个网站节点的访问</li>
<li>通俗的讲:路由就是根据不同的 <code>URL</code> 地址，加载不同的页面实现不同的功能</li>
<li><code>Koa</code> 中的路由和 <code>Express</code> 有所不同，在 <code>Express</code> 中直接引入 <code>Express</code> 就可以配置路由，但是在 <code>Koa</code>中我们需要安装对应的 <code>koa-router</code> 路由模块来实现</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm install --save koa-router</span><br></pre></td></tr></table></figure>

<p><img src="https://poetries1.gitee.io/img-repo/2019/10/495.png" alt="img"></p>
<h2 id="2-2-Koa-路由-get-传值"><a href="#2-2-Koa-路由-get-传值" class="headerlink" title="2.2 Koa 路由 get 传值"></a>2.2 Koa 路由 get 传值</h2><blockquote>
<p>在 <code>koa2</code> 中 <code>GET</code> 传值通过 <code>request</code> 接收，但是接收的方法有两种:<code>query</code> 和 <code>querystring</code></p>
</blockquote>
<ul>
<li><code>query</code>:返回的是格式化好的参数对象。</li>
<li><code>querystring</code>:返回的是请求字符串</li>
</ul>
<p><img src="https://poetries1.gitee.io/img-repo/2019/10/496.png" alt="img"></p>
<h2 id="2-3-Koa-动态路由"><a href="#2-3-Koa-动态路由" class="headerlink" title="2.3 Koa 动态路由"></a>2.3 Koa 动态路由</h2><p><img src="https://poetries1.gitee.io/img-repo/2019/10/497.png" alt="img"></p>
<h1 id="三、koa-中间件及执行流程"><a href="#三、koa-中间件及执行流程" class="headerlink" title="三、koa 中间件及执行流程"></a>三、koa 中间件及执行流程</h1><h2 id="3-1-koa中间件的洋葱图执行流程"><a href="#3-1-koa中间件的洋葱图执行流程" class="headerlink" title="3.1 koa中间件的洋葱图执行流程"></a>3.1 koa中间件的洋葱图执行流程</h2><p><img src="https://poetries1.gitee.io/img-repo/2019/10/498.gif" alt="img"></p>
<h2 id="3-2-koa-中间件"><a href="#3-2-koa-中间件" class="headerlink" title="3.2 koa 中间件"></a>3.2 koa 中间件</h2><h3 id="3-2-1-什么是-Koa-的中间件"><a href="#3-2-1-什么是-Koa-的中间件" class="headerlink" title="3.2.1 什么是 Koa 的中间件"></a>3.2.1 什么是 Koa 的中间件</h3><ul>
<li>通俗的讲:中间件就是匹配路由之前或者匹配路由完成做的一系列的操作，我们就可以<br>把它叫做中间件</li>
<li>在<code>express</code>中间件(<code>Middleware</code>)是一个函数，它可以访问请求对象(request object (req)), 响应对象(<code>response object (res)</code>), 和 <code>web</code> 应用中处理请求-响应循环流程中的中间件，一 般被命名为 next 的变量。在 <code>Koa</code> 中中间件和 <code>express</code> 有点类似。</li>
</ul>
<p><strong>中间件的功能包括</strong></p>
<ul>
<li>执行任何代码</li>
<li>修改请求和响应对象</li>
<li>终结请求-响应循环</li>
<li>调用堆栈中的下一个中间件</li>
</ul>
<blockquote>
<p>如果我的 <code>get</code>、<code>post</code> 回调函数中，没有 <code>next</code> 参数，那么就匹配上第一个路由，就不会往下匹 配了。如果想往下匹配的话，那么需要写 <code>next()</code></p>
</blockquote>
<h3 id="3-2-2-Koa-应用可使用如下几种中间件"><a href="#3-2-2-Koa-应用可使用如下几种中间件" class="headerlink" title="3.2.2 Koa 应用可使用如下几种中间件"></a>3.2.2 Koa 应用可使用如下几种中间件</h3><p><strong>1. 应用级中间件</strong></p>
<p><img src="https://poetries1.gitee.io/img-repo/2019/10/499.png" alt="img"></p>
<p><strong>2. 路由中间件</strong></p>
<p><img src="https://poetries1.gitee.io/img-repo/2019/10/500.png" alt="img"></p>
<p><strong>3. 错误处理中间件</strong></p>
<p><img src="https://poetries1.gitee.io/img-repo/2019/10/501.png" alt="img"></p>
<p><strong>4. 第三方中间件</strong></p>
<p><img src="https://poetries1.gitee.io/img-repo/2019/10/502.png" alt="img"></p>
<h3 id="3-2-3-Koa-中间件的执行顺序"><a href="#3-2-3-Koa-中间件的执行顺序" class="headerlink" title="3.2.3 Koa 中间件的执行顺序"></a>3.2.3 Koa 中间件的执行顺序</h3><blockquote>
<p><code>Koa</code> 的中间件和 <code>Express</code> 不同，<code>Koa</code> 选择了洋葱圈模型</p>
</blockquote>
<p><img src="https://poetries1.gitee.io/img-repo/2019/10/503.png" alt="img"></p>
<h1 id="四、koa-ejs模板引擎使用-以及ejs配置全局数据"><a href="#四、koa-ejs模板引擎使用-以及ejs配置全局数据" class="headerlink" title="四、koa ejs模板引擎使用 以及ejs配置全局数据"></a>四、koa ejs模板引擎使用 以及ejs配置全局数据</h1><p><strong>1. 安装 koa-views 和 ejs</strong></p>
<ul>
<li>安装 <code>koa-views npm install --save koa-views / cnpm install --save koa-views</code></li>
<li>安装 <code>ejs npm install ejs --save / cnpm install ejs --save</code></li>
</ul>
<p><strong>2. 引入 koa-views 配置中间件</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">const views = require(&#x27;koa-views&#x27;);</span><br><span class="line"></span><br><span class="line">app.use(views(&#x27;views&#x27;, &#123; map: &#123;html: &#x27;ejs&#x27; &#125;&#125;));</span><br></pre></td></tr></table></figure>

<p><strong>3. Koa 中使用 ejs</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">router.get(&#x27;/add&#x27;,async (ctx)=&gt;&#123; </span><br><span class="line">    let title = &#x27;hello koa2&#x27; </span><br><span class="line">    </span><br><span class="line">    await ctx.render(index&#x27;,&#123; title &#125;)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>

<p><strong>4. Ejs 引入模板</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;%- include header.ejs %&gt;</span><br></pre></td></tr></table></figure>

<p><strong>5. Ejs 绑定数据</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;%=h%&gt;</span><br></pre></td></tr></table></figure>

<p><strong>6. Ejs 绑定 html 数据</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;%-h%&gt;</span><br></pre></td></tr></table></figure>

<p><strong>7. Ejs 模板判断语句</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&lt;% if(true)&#123; %&gt;</span><br><span class="line">    &lt;div&gt;true&lt;/div&gt;</span><br><span class="line">&lt;%&#125; else&#123; %&gt;</span><br><span class="line">    &lt;div&gt;false&lt;/div&gt;</span><br><span class="line">&lt;%&#125; %&gt;</span><br></pre></td></tr></table></figure>

<p><strong>8. Ejs 模板中循环数据</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&lt;%for(var i=0;i&lt;list.length;i++) &#123; %&gt;</span><br><span class="line">    &lt;li&gt;&lt;%=list[i] %&gt;&lt;/li&gt;</span><br><span class="line">&lt;%&#125;%&gt;</span><br></pre></td></tr></table></figure>

<h1 id="五、koa-post-提交数据-koa-bodyparser-中间件的使用"><a href="#五、koa-post-提交数据-koa-bodyparser-中间件的使用" class="headerlink" title="五、koa post 提交数据 koa-bodyparser 中间件的使用"></a>五、koa post 提交数据 koa-bodyparser 中间件的使用</h1><h2 id="5-1-原生-Nodejs-获取-post-提交数据"><a href="#5-1-原生-Nodejs-获取-post-提交数据" class="headerlink" title="5.1 原生 Nodejs 获取 post 提交数据"></a>5.1 原生 Nodejs 获取 post 提交数据</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">function parsePostData(ctx)&#123;</span><br><span class="line">    return new Promise((resolve,reject)=&gt;&#123;</span><br><span class="line">        try&#123;</span><br><span class="line">            let postdata=&quot;&quot;;</span><br><span class="line">            ctx.req.on(&#x27;data&#x27;,(data)=&gt;&#123;</span><br><span class="line">                postdata += data</span><br><span class="line">            &#125;)</span><br><span class="line">            ctx.req.on(&quot;end&quot;,function()&#123;</span><br><span class="line">                resolve(postdata);</span><br><span class="line">            &#125;)</span><br><span class="line">        &#125;catch(error)&#123;</span><br><span class="line">            reject(error);</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="5-2-Koa-中-koa-bodyparser-中间件的使用"><a href="#5-2-Koa-中-koa-bodyparser-中间件的使用" class="headerlink" title="5.2 Koa 中 koa-bodyparser 中间件的使用"></a>5.2 Koa 中 koa-bodyparser 中间件的使用</h2><p><strong>1. 安装 koa-bodyparser</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm install --save koa-bodyparser</span><br></pre></td></tr></table></figure>

<p><strong>2. 安装 引入配置中间件</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">var Koa = require(&#x27;koa&#x27;);</span><br><span class="line">var bodyParser = require(&#x27;koa-bodyparser&#x27;);</span><br><span class="line"></span><br><span class="line">var app = new Koa();</span><br><span class="line"></span><br><span class="line">app.use(bodyParser());</span><br><span class="line">app.use(async ctx =&gt; &#123;</span><br><span class="line">    ctx.body = ctx.request.body;</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>

<p><strong>3. 使用</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ctx.request.body // 获取 post 提交的数据</span><br></pre></td></tr></table></figure>

<h1 id="六、koa-static静态资源中间件"><a href="#六、koa-static静态资源中间件" class="headerlink" title="六、koa-static静态资源中间件"></a>六、koa-static静态资源中间件</h1><p><strong>1. 安装 koa-static</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm install --save koa-static</span><br></pre></td></tr></table></figure>

<p><strong>2. 引入配置中间件</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">const static = require(&#x27;koa-static&#x27;);</span><br><span class="line"></span><br><span class="line">app.use(static(</span><br><span class="line">    path.join( __dirname, &#x27;public&#x27;)</span><br><span class="line">))</span><br></pre></td></tr></table></figure>

<h1 id="七、koa-art-template高性能模板引擎的使用"><a href="#七、koa-art-template高性能模板引擎的使用" class="headerlink" title="七、koa art-template高性能模板引擎的使用"></a>七、koa art-template高性能模板引擎的使用</h1><h2 id="7-1-常见模板引擎的性能对比"><a href="#7-1-常见模板引擎的性能对比" class="headerlink" title="7.1 常见模板引擎的性能对比"></a>7.1 常见模板引擎的性能对比</h2><blockquote>
<p>适用于 <code>koa</code> 的模板引擎选择非常多，比如 <code>jade</code>、<code>ejs</code>、<code>nunjucks</code>、<code>art-template</code> 等</p>
</blockquote>
<ul>
<li><code>art-template</code> 是一个简约、超快的模板引擎</li>
<li>它采用作用域预声明的技术来优化模板渲染速度，从而获得接近 JavaScript 极限的运行 性能，并且同时支持 NodeJS 和浏览器。</li>
<li><code>art-template</code> 支持 <code>ejs</code> 的语法，也可以用自己的类似 <code>angular</code> 数据绑定的语法</li>
<li>中文文档: <a target="_blank" rel="noopener" href="http://aui.github.io/art-template/zh-cn/docs">http://aui.github.io/art-template/zh-cn/docs</a></li>
</ul>
<p><img src="https://poetries1.gitee.io/img-repo/2019/10/504.png" alt="img"></p>
<p><img src="https://poetries1.gitee.io/img-repo/2019/10/505.png" alt="img"></p>
<h2 id="7-2-在-Koa-中使用-art-template-模板引擎"><a href="#7-2-在-Koa-中使用-art-template-模板引擎" class="headerlink" title="7.2 在 Koa 中使用 art-template 模板引擎"></a>7.2 在 Koa 中使用 art-template 模板引擎</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">npm install --save art-template </span><br><span class="line">npm install --save koa-art-template</span><br><span class="line">const Koa = require(&#x27;koa&#x27;);</span><br><span class="line">const render = require(&#x27;koa-art-template&#x27;);</span><br><span class="line"></span><br><span class="line">const app = new Koa();</span><br><span class="line"></span><br><span class="line">render(app, &#123;</span><br><span class="line">    root: path.join(__dirname, &#x27;view&#x27;),</span><br><span class="line">    extname: &#x27;.art&#x27;,</span><br><span class="line">    debug: process.env.NODE_ENV !== &#x27;production&#x27;</span><br><span class="line">&#125;);</span><br><span class="line">app.use(async function (ctx) &#123;</span><br><span class="line">    await ctx.render(&#x27;user&#x27;);</span><br><span class="line">&#125;);</span><br><span class="line">app.listen(8080);</span><br></pre></td></tr></table></figure>

<h2 id="7-3-art-template-模板引擎语法"><a href="#7-3-art-template-模板引擎语法" class="headerlink" title="7.3 art-template 模板引擎语法"></a>7.3 art-template 模板引擎语法</h2><blockquote>
<p>参考:<a target="_blank" rel="noopener" href="http://aui.github.io/art-template/zh-cn/docs/syntax.html">http://aui.github.io/art-template/zh-cn/docs/syntax.html</a></p>
</blockquote>
<h1 id="八、koa-Cookie的使用"><a href="#八、koa-Cookie的使用" class="headerlink" title="八、koa Cookie的使用"></a>八、koa Cookie的使用</h1><h2 id="8-1-Koa-Cookie-的使用"><a href="#8-1-Koa-Cookie-的使用" class="headerlink" title="8.1 Koa Cookie 的使用"></a>8.1 Koa Cookie 的使用</h2><p><strong>1. Koa 中设置 Cookie 的值</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ctx.cookies.set(name, value, [options])</span><br></pre></td></tr></table></figure>

<blockquote>
<p>通过 <code>options</code> 设置 <code>cookie name</code> 的 <code>value</code></p>
</blockquote>
<p><img src="https://poetries1.gitee.io/img-repo/2019/10/506.png" alt="img"></p>
<p><strong>2. Koa 中获取 Cookie 的值</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ctx.cookies.get(&#x27;name&#x27;);</span><br></pre></td></tr></table></figure>

<h2 id="8-2-Koa-中设置中文-Cookie"><a href="#8-2-Koa-中设置中文-Cookie" class="headerlink" title="8.2 Koa 中设置中文 Cookie"></a>8.2 Koa 中设置中文 Cookie</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">console.log(new Buffer(&#x27;hello, world!&#x27;).toString(&#x27;base64&#x27;));// 转换成 base64 字符 串:aGVsbG8sIHdvcmxkIQ==</span><br><span class="line"></span><br><span class="line">console.log(new Buffer(&#x27;aGVsbG8sIHdvcmxkIQ==&#x27;, &#x27;base64&#x27;).toString());// 还原 base 64 字符串:hello, world!</span><br></pre></td></tr></table></figure>

<h1 id="九、koa-Session-的使用"><a href="#九、koa-Session-的使用" class="headerlink" title="九、koa Session 的使用"></a>九、koa Session 的使用</h1><h2 id="9-1-Session-简单介绍"><a href="#9-1-Session-简单介绍" class="headerlink" title="9.1 Session 简单介绍"></a>9.1 Session 简单介绍</h2><blockquote>
<p><code>session</code> 是另一种记录客户状态的机制，不同的是 <code>Cookie</code> 保存在客户端浏览器中，而 <code>session</code> 保存在服务器上</p>
</blockquote>
<h2 id="9-2-Session-的工作流程"><a href="#9-2-Session-的工作流程" class="headerlink" title="9.2 Session 的工作流程"></a>9.2 Session 的工作流程</h2><blockquote>
<p>当浏览器访问服务器并发送第一次请求时，服务器端会创建一个 <code>session</code> 对象，生 成一个类似于 <code>key</code>,<code>value</code> 的键值对， 然后将<code>key(cookie)</code>返回到浏览器(客户)端，浏览 器下次再访问时，携带 <code>key(cookie)</code>，找到对应的 <code>session(value)</code>。 客户的信息都保存 在 <code>session</code> 中</p>
</blockquote>
<h2 id="9-3-koa-session-的使用"><a href="#9-3-koa-session-的使用" class="headerlink" title="9.3 koa-session 的使用"></a>9.3 koa-session 的使用</h2><p><strong>1. 安装 express-session</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm install koa-session --save</span><br></pre></td></tr></table></figure>

<p><strong>2. 引入 express-session</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">const session = require(&#x27;koa-session&#x27;);</span><br></pre></td></tr></table></figure>

<p><strong>3. 设置官方文档提供的中间件</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">app.keys = [&#x27;some secret hurr&#x27;];</span><br><span class="line">const CONFIG = &#123;</span><br><span class="line">    key: &#x27;koa:sess&#x27;, //cookie key (default is koa:sess)</span><br><span class="line">    maxAge: 86400000, // cookie 的过期时间 maxAge in ms (default is 1 days)</span><br><span class="line">    overwrite: true, //是否可以 overwrite (默认 default true)</span><br><span class="line">    httpOnly: true, //cookie 是否只有服务器端可以访问 httpOnly or not (default true)</span><br><span class="line">    signed: true, //签名默认 true</span><br><span class="line">    rolling:false, //在每次请求时强行设置cookie，这将重置cookie过期时间(默认:false)</span><br><span class="line">    renew: false, //(boolean) renew session when session is nearly expired</span><br><span class="line">&#125;</span><br><span class="line">app.use(session(CONFIG, app));</span><br></pre></td></tr></table></figure>

<p><strong>4. 使用</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">//设置值 </span><br><span class="line">ctx.session.username = &quot;张三&quot;;</span><br><span class="line"></span><br><span class="line">// 获取值 </span><br><span class="line">ctx.session.username</span><br></pre></td></tr></table></figure>

<h2 id="9-4-Cookie-和-Session-区别"><a href="#9-4-Cookie-和-Session-区别" class="headerlink" title="9.4 Cookie 和 Session 区别"></a>9.4 Cookie 和 Session 区别</h2><ul>
<li><code>cookie</code> 数据存放在客户的浏览器上，<code>session</code> 数据放在服务器上</li>
<li><code>cookie</code> 不是很安全，别人可以分析存放在本地的 <code>COOKIE</code> 并进行 <code>COOKIE</code> 欺骗 考虑到安全应当使用 <code>session</code></li>
<li><code>session</code>会在一定时间内保存在服务器上。当访问增多，会比较占用你服务器的性能 考虑到减轻服务器性能方面，应当使用 <code>COOKIE</code></li>
<li>单个 <code>cookie</code> 保存的数据不能超过 <code>4K</code>，很多浏览器都限制一个站点最多保存 <code>20</code> 个 <code>cookie</code></li>
</ul>
<h1 id="十、Koa-操作-Mongodb-数据库"><a href="#十、Koa-操作-Mongodb-数据库" class="headerlink" title="十、Koa 操作 Mongodb 数据库"></a>十、Koa 操作 Mongodb 数据库</h1><blockquote>
<p>官方文档:<a target="_blank" rel="noopener" href="http://mongodb.github.io/node-mongodb-native/">http://mongodb.github.io/node-mongodb-native/</a></p>
</blockquote>
<h1 id="十一、Koa-应用生成器以及-Koa-路由模-块化"><a href="#十一、Koa-应用生成器以及-Koa-路由模-块化" class="headerlink" title="十一、Koa 应用生成器以及 Koa 路由模 块化"></a>十一、Koa 应用生成器以及 Koa 路由模 块化</h1><h2 id="11-1-koa-应用生成器"><a href="#11-1-koa-应用生成器" class="headerlink" title="11.1 koa 应用生成器"></a>11.1 koa 应用生成器</h2><blockquote>
<p>通过应用 <code>koa</code> 脚手架生成工具 可以快速创建一个基于 <code>koa2</code> 的应用的骨架</p>
</blockquote>
<p><strong>1. 全局安装</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm install koa-generator -g</span><br></pre></td></tr></table></figure>

<p><strong>2. 创建项目</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">koa koa_demo</span><br></pre></td></tr></table></figure>

<p><strong>3. 安装依赖</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">cd koa_demo</span><br><span class="line"></span><br><span class="line">npm install</span><br></pre></td></tr></table></figure>

<p><strong>4. 启动项目</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm start</span><br></pre></td></tr></table></figure>

<h2 id="11-2-koa-搭建模块化路由-x2F-层级路由"><a href="#11-2-koa-搭建模块化路由-x2F-层级路由" class="headerlink" title="11.2 koa 搭建模块化路由&#x2F;层级路由"></a>11.2 koa 搭建模块化路由&#x2F;层级路由</h2><ol>
<li>在目录下面新建一个文件夹 <code>routes</code></li>
<li>在 <code>routes</code> 里面配置对应的子页面</li>
<li>比如在 <code>routes</code> 新建 <code>index.js</code></li>
</ol>
<p><img src="https://poetries1.gitee.io/img-repo/2019/10/507.png" alt="img"></p>
<ol>
<li>然后在主应用中加载子路由模块:</li>
</ol>
<p><img src="https://poetries1.gitee.io/img-repo/2019/10/508.png" alt="img"></p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://example.com/2019/06/27/nodejs/nodejs-koa2/" data-id="cl7icg76200qyuguncy1whm2p" data-title="node-koa2总结" class="article-share-link">Share</a>
      
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/nodejs/" rel="tag">nodejs</a></li></ul>

    </footer>
  </div>
  
</article>



  
    <article id="post-nodejs/express" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2019/06/07/nodejs/express/" class="article-date">
  <time class="dt-published" datetime="2019-06-06T18:16:34.000Z" itemprop="datePublished">2019-06-07</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/%E5%90%8E%E7%AB%AF/">后端</a>►<a class="article-category-link" href="/categories/%E5%90%8E%E7%AB%AF/%E6%A1%86%E6%9E%B6/">框架</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/2019/06/07/nodejs/express/">node-express框架总结</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <h2 id="一、概述"><a href="#一、概述" class="headerlink" title="一、概述"></a>一、概述</h2><blockquote>
<p>官网 <a target="_blank" rel="noopener" href="http://expressjs.com/zh-cn/">http://expressjs.com/zh-cn/</a></p>
</blockquote>
<blockquote>
<p><code>Express</code>是目前最流行的基于Node.js的Web开发框架，可以快速地搭建一个完整功能的网站</p>
</blockquote>
<p><strong>环境搭建</strong></p>
<blockquote>
<p><a target="_blank" rel="noopener" href="http://www.expressjs.com.cn/starter/generator.html">http://www.expressjs.com.cn/starter/generator.html</a></p>
</blockquote>
<blockquote>
<p>通过应用生成器工具 <code>express-generator</code>可以快速创建一个应用的骨架</p>
</blockquote>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ npm install express-generator -g</span><br></pre></td></tr></table></figure>

<h2 id="二、运行原理"><a href="#二、运行原理" class="headerlink" title="二、运行原理"></a>二、运行原理</h2><p><strong>底层：http模块</strong></p>
<blockquote>
<p>Express框架建立在node.js内置的http模块上。http模块生成服务器的原始代码如下</p>
</blockquote>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">var http = require(&quot;http&quot;);</span><br><span class="line"></span><br><span class="line">var app = http.createServer(function(request, response) &#123;</span><br><span class="line">  response.writeHead(200, &#123;&quot;Content-Type&quot;: &quot;text/plain&quot;&#125;);</span><br><span class="line">  response.end(&quot;Hello world!&quot;);</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">app.listen(3000, &quot;localhost&quot;);</span><br></pre></td></tr></table></figure>

<blockquote>
<p>Express框架的核心是对http模块的再包装。上面的代码用Express改写如下</p>
</blockquote>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">var express = require(&#x27;express&#x27;);</span><br><span class="line">var app = express();</span><br><span class="line"></span><br><span class="line">app.get(&#x27;/&#x27;, function (req, res) &#123;</span><br><span class="line">  res.send(&#x27;Hello world!&#x27;);</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">app.listen(3000);</span><br></pre></td></tr></table></figure>

<blockquote>
<p>Express框架等于在http模块之上，加了一个中间层</p>
</blockquote>
<p><strong>什么是中间件</strong></p>
<blockquote>
<ul>
<li>简单说，中间件（middleware）就是处理HTTP请求的函数。它最大的特点就是，一个中间件处理完，再传递给下一个中间件。App实例在运行过程中，会调用一系列的中间件</li>
<li>每个中间件可以从App实例，接收三个参数，依次为request对象（代表HTTP请求）、response对象（代表HTTP回应），next回调函数（代表下一个中间件）。每个中间件都可以对HTTP请求（request对象）进行加工，并且决定是否调用next方法，将request对象再传给下一个中间件。</li>
</ul>
</blockquote>
<ul>
<li>一个不进行任何操作、只传递<code>request</code>对象的中间件，就是下面这样</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">function uselessMiddleware(req, res, next) &#123;</span><br><span class="line">  next();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ul>
<li>上面代码的next就是下一个中间件。如果它带有参数，则代表抛出一个错误，参数为错误文本</li>
<li>抛出错误以后，后面的中间件将不再执行，直到发现一个错误处理函数为止</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">function uselessMiddleware(req, res, next) &#123;</span><br><span class="line">  next(&#x27;出错了！&#x27;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="三、use方法"><a href="#三、use方法" class="headerlink" title="三、use方法"></a>三、use方法</h2><blockquote>
<p>use是express注册中间件的方法，它返回一个函数。下面是一个连续调用两个中间件的例子</p>
</blockquote>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">var express = require(&quot;express&quot;);</span><br><span class="line">var http = require(&quot;http&quot;);</span><br><span class="line"></span><br><span class="line">var app = express();</span><br><span class="line"></span><br><span class="line">app.use(function(request, response, next) &#123;</span><br><span class="line">  console.log(&quot;In comes a &quot; + request.method + &quot; to &quot; + request.url);</span><br><span class="line">  next();</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">app.use(function(request, response) &#123;</span><br><span class="line">  response.writeHead(200, &#123; &quot;Content-Type&quot;: &quot;text/plain&quot; &#125;);</span><br><span class="line">  response.end(&quot;Hello world!\n&quot;);</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">http.createServer(app).listen(1337);</span><br></pre></td></tr></table></figure>

<blockquote>
<p>上面代码使用app.use方法，注册了两个中间件。收到HTTP请求后，先调用第一个中间件，在控制台输出一行信息，然后通过next方法，将执行权传给第二个中间件，输出HTTP回应。由于第二个中间件没有调用next方法，所以request对象就不再向后传递了</p>
</blockquote>
<ul>
<li>use方法内部可以对访问路径进行判断，据此就能实现简单的路由，根据不同的请求网址，返回不同的网页内容</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line">var express = require(&quot;express&quot;);</span><br><span class="line">var http = require(&quot;http&quot;);</span><br><span class="line"></span><br><span class="line">var app = express();</span><br><span class="line"></span><br><span class="line">app.use(function(request, response, next) &#123;</span><br><span class="line">  if (request.url == &quot;/&quot;) &#123;</span><br><span class="line">    response.writeHead(200, &#123; &quot;Content-Type&quot;: &quot;text/plain&quot; &#125;);</span><br><span class="line">    response.end(&quot;Welcome to the homepage!\n&quot;);</span><br><span class="line">  &#125; else &#123;</span><br><span class="line">    next();</span><br><span class="line">  &#125;</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">app.use(function(request, response, next) &#123;</span><br><span class="line">  if (request.url == &quot;/about&quot;) &#123;</span><br><span class="line">    response.writeHead(200, &#123; &quot;Content-Type&quot;: &quot;text/plain&quot; &#125;);</span><br><span class="line">  &#125; else &#123;</span><br><span class="line">    next();</span><br><span class="line">  &#125;</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">app.use(function(request, response) &#123;</span><br><span class="line">  response.writeHead(404, &#123; &quot;Content-Type&quot;: &quot;text/plain&quot; &#125;);</span><br><span class="line">  response.end(&quot;404 error!\n&quot;);</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">http.createServer(app).listen(1337);</span><br></pre></td></tr></table></figure>

<blockquote>
<p>上面代码通过<code>request.url</code>属性，判断请求的网址，从而返回不同的内容。注意，<code>app.use</code>方法一共登记了三个中间件，只要请求路径匹配，就不会将执行权交给下一个中间件。因此，最后一个中间件会返回<code>404</code>错误，即前面的中间件都没匹配请求路径，找不到所要请求的资源</p>
</blockquote>
<ul>
<li>除了在回调函数内部判断请求的网址，<code>use</code>方法也允许将请求网址写在第一个参数。这代表，只有请求路径匹配这个参数，后面的中间件才会生效。无疑，这样写更加清晰和方便</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">// 只对根目录的请求，调用某个中间件</span><br><span class="line">app.use(&#x27;/path&#x27;, someMiddleware);</span><br></pre></td></tr></table></figure>

<ul>
<li>因此，上面的代码可以写成下面的样子</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">ar express = require(&quot;express&quot;);</span><br><span class="line">var http = require(&quot;http&quot;);</span><br><span class="line"></span><br><span class="line">var app = express();</span><br><span class="line"></span><br><span class="line">app.use(&quot;/home&quot;, function(request, response, next) &#123;</span><br><span class="line">  response.writeHead(200, &#123; &quot;Content-Type&quot;: &quot;text/plain&quot; &#125;);</span><br><span class="line">  response.end(&quot;Welcome to the homepage!\n&quot;);</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">app.use(&quot;/about&quot;, function(request, response, next) &#123;</span><br><span class="line">  response.writeHead(200, &#123; &quot;Content-Type&quot;: &quot;text/plain&quot; &#125;);</span><br><span class="line">  response.end(&quot;Welcome to the about page!\n&quot;);</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">app.use(function(request, response) &#123;</span><br><span class="line">  response.writeHead(404, &#123; &quot;Content-Type&quot;: &quot;text/plain&quot; &#125;);</span><br><span class="line">  response.end(&quot;404 error!\n&quot;);</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">http.createServer(app).listen(1337)</span><br></pre></td></tr></table></figure>

<h2 id="四、Express的方法"><a href="#四、Express的方法" class="headerlink" title="四、Express的方法"></a>四、Express的方法</h2><p><strong>all方法和HTTP动词方法</strong></p>
<blockquote>
<p>针对不同的请求，Express提供了use方法的一些别名。比如，上面代码也可以用别名的形式来写</p>
</blockquote>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">var express = require(&quot;express&quot;);</span><br><span class="line">var http = require(&quot;http&quot;);</span><br><span class="line">var app = express();</span><br><span class="line"></span><br><span class="line">app.all(&quot;*&quot;, function(request, response, next) &#123;</span><br><span class="line">  response.writeHead(200, &#123; &quot;Content-Type&quot;: &quot;text/plain&quot; &#125;);</span><br><span class="line">  next();</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">app.get(&quot;/&quot;, function(request, response) &#123;</span><br><span class="line">  response.end(&quot;Welcome to the homepage!&quot;);</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">app.get(&quot;/about&quot;, function(request, response) &#123;</span><br><span class="line">  response.end(&quot;Welcome to the about page!&quot;);</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">app.get(&quot;*&quot;, function(request, response) &#123;</span><br><span class="line">  response.end(&quot;404!&quot;);</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">http.createServer(app).listen(1337);</span><br></pre></td></tr></table></figure>

<blockquote>
<ul>
<li>上面代码的all方法表示，所有请求都必须通过该中间件，参数中的“*”表示对所有路径有效。get方法则是只有GET动词的HTTP请求通过该中间件，它的第一个参数是请求的路径。由于get方法的回调函数没有调用next方法，所以只要有一个中间件被调用了，后面的中间件就不会再被调用了</li>
<li>除了get方法以外，Express还提供post、put、delete方法，即HTTP动词都是Express的方法</li>
</ul>
</blockquote>
<ul>
<li>除了get方法以外，Express还提供post、put、delete方法，即HTTP动词都是Express的方法</li>
<li>这些方法的第一个参数，都是请求的路径。除了绝对匹配以外，Express允许模式匹配</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">app.get(&quot;/hello/:who&quot;, function(req, res) &#123;</span><br><span class="line">  res.end(&quot;Hello, &quot; + req.params.who + &quot;.&quot;);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<h2 id="五、set方法"><a href="#五、set方法" class="headerlink" title="五、set方法"></a>五、set方法</h2><blockquote>
<p>set方法用于指定变量的值</p>
</blockquote>
<ul>
<li><p>使用set方法，为系统变量“views”和“view engine”指定值</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">app.set(&quot;views&quot;, __dirname + &quot;/views&quot;);</span><br><span class="line"></span><br><span class="line">app.set(&quot;view engine&quot;, &quot;jade&quot;);</span><br></pre></td></tr></table></figure></li>
</ul>
<h2 id="六、response对象"><a href="#六、response对象" class="headerlink" title="六、response对象"></a>六、response对象</h2><p><strong>（1）response.redirect方法</strong></p>
<blockquote>
<p>response.redirect方法允许网址的重定向</p>
</blockquote>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">response.redirect(&quot;/hello/anime&quot;);</span><br><span class="line">response.redirect(&quot;http://www.example.com&quot;);</span><br><span class="line">response.redirect(301, &quot;http://www.example.com&quot;);</span><br></pre></td></tr></table></figure>

<p><strong>（2）response.sendFile方法</strong></p>
<blockquote>
<p>response.sendFile方法用于发送文件</p>
</blockquote>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">response.sendFile(&quot;/path/to/anime.mp4&quot;);</span><br></pre></td></tr></table></figure>

<p><strong>（3）response.render方法</strong></p>
<blockquote>
<p>response.render方法用于渲染网页模板。</p>
</blockquote>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">//  使用render方法，将message变量传入index模板，渲染成HTML网页</span><br><span class="line">app.get(&quot;/&quot;, function(request, response) &#123;</span><br><span class="line">  response.render(&quot;index&quot;, &#123; message: &quot;Hello World&quot; &#125;);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<h2 id="七、requst对象"><a href="#七、requst对象" class="headerlink" title="七、requst对象"></a>七、requst对象</h2><p><strong>（1）request.ip</strong></p>
<blockquote>
<p>request.ip属性用于获得HTTP请求的IP地址</p>
</blockquote>
<p><strong>（2）request.files</strong></p>
<blockquote>
<p>request.files用于获取上传的文件</p>
</blockquote>
<h2 id="八、搭建HTTPs服务器"><a href="#八、搭建HTTPs服务器" class="headerlink" title="八、搭建HTTPs服务器"></a>八、搭建HTTPs服务器</h2><blockquote>
<p>使用Express搭建HTTPs加密服务器，也很简单</p>
</blockquote>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">var fs = require(&#x27;fs&#x27;);</span><br><span class="line">var options = &#123;</span><br><span class="line">  key: fs.readFileSync(&#x27;E:/ssl/myserver.key&#x27;),</span><br><span class="line">  cert: fs.readFileSync(&#x27;E:/ssl/myserver.crt&#x27;),</span><br><span class="line">  passphrase: &#x27;1234&#x27;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">var https = require(&#x27;https&#x27;);</span><br><span class="line">var express = require(&#x27;express&#x27;);</span><br><span class="line">var app = express();</span><br><span class="line"></span><br><span class="line">app.get(&#x27;/&#x27;, function(req, res)&#123;</span><br><span class="line">  res.send(&#x27;Hello World Expressjs&#x27;);</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">var server = https.createServer(options, app);</span><br><span class="line">server.listen(8084);</span><br><span class="line">console.log(&#x27;Server is running on port 8084&#x27;);</span><br></pre></td></tr></table></figure>

<h2 id="九、静态网页模板"><a href="#九、静态网页模板" class="headerlink" title="九、静态网页模板"></a>九、静态网页模板</h2><blockquote>
<ul>
<li>在项目目录之中，建立一个子目录views，用于存放网页模板</li>
<li>假定这个项目有三个路径：根路径（&#x2F;）、自我介绍（&#x2F;about）和文章（&#x2F;article）。那么，app.js可以这样写</li>
</ul>
</blockquote>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">// 向服务器发送信息的方法，从send变成了sendfile，后者专门用于发送文件</span><br><span class="line">var express = require(&#x27;express&#x27;);</span><br><span class="line">var app = express();</span><br><span class="line"> </span><br><span class="line">app.get(&#x27;/&#x27;, function(req, res) &#123;</span><br><span class="line">   res.sendfile(&#x27;./views/index.html&#x27;);</span><br><span class="line">&#125;);</span><br><span class="line"> </span><br><span class="line">app.get(&#x27;/about&#x27;, function(req, res) &#123;</span><br><span class="line">   res.sendfile(&#x27;./views/about.html&#x27;);</span><br><span class="line">&#125;);</span><br><span class="line"> </span><br><span class="line">app.get(&#x27;/article&#x27;, function(req, res) &#123;</span><br><span class="line">   res.sendfile(&#x27;./views/article.html&#x27;);</span><br><span class="line">&#125;);</span><br><span class="line"> </span><br><span class="line">app.listen(3000);</span><br></pre></td></tr></table></figure>

<h2 id="十、动态网页模板"><a href="#十、动态网页模板" class="headerlink" title="十、动态网页模板"></a>十、动态网页模板</h2><p><strong>安装模板引擎</strong></p>
<blockquote>
<p>Express支持多种模板引擎，这里采用Handlebars模板引擎的服务器端版本hbs模板引擎</p>
</blockquote>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm install hbs --save-dev</span><br></pre></td></tr></table></figure>

<ul>
<li>安装模板引擎之后，就要改写app.js</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">// app.js文件</span><br><span class="line"></span><br><span class="line">var express = require(&#x27;express&#x27;);</span><br><span class="line">var app = express();</span><br><span class="line"></span><br><span class="line">// 加载hbs模块</span><br><span class="line">var hbs = require(&#x27;hbs&#x27;);</span><br><span class="line"></span><br><span class="line">// 指定模板文件的后缀名为html</span><br><span class="line">app.set(&#x27;view engine&#x27;, &#x27;html&#x27;);</span><br><span class="line"></span><br><span class="line">// 运行hbs模块</span><br><span class="line">app.engine(&#x27;html&#x27;, hbs.__express);</span><br><span class="line"></span><br><span class="line">app.get(&#x27;/&#x27;, function (req, res)&#123;</span><br><span class="line">	res.render(&#x27;index&#x27;);</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">app.get(&#x27;/about&#x27;, function(req, res) &#123;</span><br><span class="line">	res.render(&#x27;about&#x27;);</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">app.get(&#x27;/article&#x27;, function(req, res) &#123;</span><br><span class="line">	res.render(&#x27;article&#x27;);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<blockquote>
<p>上面代码改用render方法，对网页模板进行渲染。render方法的参数就是模板的文件名，默认放在子目录views之中，后缀名已经在前面指定为html，这里可以省略。所以，res.render(‘index’) 就是指，把子目录views下面的index.html文件，交给模板引擎hbs渲染</p>
</blockquote>
<h2 id="十一、新建数据脚本"><a href="#十一、新建数据脚本" class="headerlink" title="十一、新建数据脚本"></a>十一、新建数据脚本</h2><blockquote>
<ul>
<li>渲染是指将数据代入模板的过程。实际运用中，数据都是保存在数据库之中的，这里为了简化问题，假定数据保存在一个脚本文件中</li>
<li>在项目目录中，新建一个文件blog.js，用于存放数据。blog.js的写法符合CommonJS规范，使得它可以被require语句加载</li>
</ul>
</blockquote>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">// blog.js文件</span><br><span class="line"></span><br><span class="line">var entries = [</span><br><span class="line">	&#123;&quot;id&quot;:1, &quot;title&quot;:&quot;第一篇&quot;, &quot;body&quot;:&quot;正文&quot;, &quot;published&quot;:&quot;6/2/2013&quot;&#125;,</span><br><span class="line">	&#123;&quot;id&quot;:2, &quot;title&quot;:&quot;第二篇&quot;, &quot;body&quot;:&quot;正文&quot;, &quot;published&quot;:&quot;6/3/2013&quot;&#125;,</span><br><span class="line">	&#123;&quot;id&quot;:3, &quot;title&quot;:&quot;第三篇&quot;, &quot;body&quot;:&quot;正文&quot;, &quot;published&quot;:&quot;6/4/2013&quot;&#125;,</span><br><span class="line">	&#123;&quot;id&quot;:4, &quot;title&quot;:&quot;第四篇&quot;, &quot;body&quot;:&quot;正文&quot;, &quot;published&quot;:&quot;6/5/2013&quot;&#125;,</span><br><span class="line">	&#123;&quot;id&quot;:5, &quot;title&quot;:&quot;第五篇&quot;, &quot;body&quot;:&quot;正文&quot;, &quot;published&quot;:&quot;6/10/2013&quot;&#125;,</span><br><span class="line">	&#123;&quot;id&quot;:6, &quot;title&quot;:&quot;第六篇&quot;, &quot;body&quot;:&quot;正文&quot;, &quot;published&quot;:&quot;6/12/2013&quot;&#125;</span><br><span class="line">];</span><br><span class="line"></span><br><span class="line">exports.getBlogEntries = function ()&#123;</span><br><span class="line">   return entries;</span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line">exports.getBlogEntry = function (id)&#123;</span><br><span class="line">   for(var i=0; i &lt; entries.length; i++)&#123;</span><br><span class="line">      if(entries[i].id == id) return entries[i];</span><br><span class="line">   &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="十二、新建网页模板"><a href="#十二、新建网页模板" class="headerlink" title="十二、新建网页模板"></a>十二、新建网页模板</h2><blockquote>
<p>接着，新建模板文件<code>index.html</code></p>
</blockquote>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">&lt;!-- views/index.html文件 --&gt;</span><br><span class="line"></span><br><span class="line">&lt;h1&gt;文章列表&lt;/h1&gt;</span><br><span class="line"> </span><br><span class="line">&#123;&#123;#each entries&#125;&#125;</span><br><span class="line">   &lt;p&gt;</span><br><span class="line">      &lt;a href=&quot;/article/&#123;&#123;id&#125;&#125;&quot;&gt;&#123;&#123;title&#125;&#125;&lt;/a&gt;&lt;br/&gt;</span><br><span class="line">      Published: &#123;&#123;published&#125;&#125;</span><br><span class="line">   &lt;/p&gt;</span><br><span class="line">&#123;&#123;/each&#125;&#125;</span><br><span class="line">&lt;!-- views/about.html文件 --&gt;</span><br><span class="line"></span><br><span class="line">&lt;h1&gt;自我介绍&lt;/h1&gt;</span><br><span class="line"> </span><br><span class="line">&lt;p&gt;正文&lt;/p&gt;</span><br><span class="line">&lt;!-- views/article.html文件 --&gt;</span><br><span class="line"></span><br><span class="line">&lt;h1&gt;&#123;&#123;blog.title&#125;&#125;&lt;/h1&gt;</span><br><span class="line">Published: &#123;&#123;blog.published&#125;&#125;</span><br><span class="line"> </span><br><span class="line">&lt;p/&gt;</span><br><span class="line"> </span><br><span class="line">&#123;&#123;blog.body&#125;&#125;</span><br></pre></td></tr></table></figure>

<blockquote>
<p>可以看到，上面三个模板文件都只有网页主体。因为网页布局是共享的，所以布局的部分可以单独新建一个文件<code>layout.html</code></p>
</blockquote>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">&lt;!-- views/layout.html文件 --&gt;</span><br><span class="line"></span><br><span class="line">&lt;html&gt;</span><br><span class="line"> </span><br><span class="line">&lt;head&gt;</span><br><span class="line">   &lt;title&gt;&#123;&#123;title&#125;&#125;&lt;/title&gt;</span><br><span class="line">&lt;/head&gt;</span><br><span class="line"> </span><br><span class="line">&lt;body&gt;</span><br><span class="line"> </span><br><span class="line">	&#123;&#123;&#123;body&#125;&#125;&#125;</span><br><span class="line"> </span><br><span class="line">   &lt;footer&gt;</span><br><span class="line">      &lt;p&gt;</span><br><span class="line">         &lt;a href=&quot;/&quot;&gt;首页&lt;/a&gt; - &lt;a href=&quot;/about&quot;&gt;自我介绍&lt;/a&gt;</span><br><span class="line">      &lt;/p&gt;</span><br><span class="line">   &lt;/footer&gt;</span><br><span class="line">    </span><br><span class="line">&lt;/body&gt;</span><br><span class="line">&lt;/html&gt;</span><br></pre></td></tr></table></figure>

<h2 id="十三、渲染模板"><a href="#十三、渲染模板" class="headerlink" title="十三、渲染模板"></a>十三、渲染模板</h2><blockquote>
<p>最后，改写app.js文件</p>
</blockquote>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line">// app.js文件</span><br><span class="line"></span><br><span class="line">var express = require(&#x27;express&#x27;);</span><br><span class="line">var app = express();</span><br><span class="line"> </span><br><span class="line">var hbs = require(&#x27;hbs&#x27;);</span><br><span class="line"></span><br><span class="line">// 加载数据模块</span><br><span class="line">var blogEngine = require(&#x27;./blog&#x27;);</span><br><span class="line"> </span><br><span class="line">app.set(&#x27;view engine&#x27;, &#x27;html&#x27;);</span><br><span class="line">app.engine(&#x27;html&#x27;, hbs.__express);</span><br><span class="line">app.use(express.bodyParser());</span><br><span class="line"> </span><br><span class="line">app.get(&#x27;/&#x27;, function(req, res) &#123;</span><br><span class="line">   res.render(&#x27;index&#x27;,&#123;title:&quot;最近文章&quot;, entries:blogEngine.getBlogEntries()&#125;);</span><br><span class="line">&#125;);</span><br><span class="line"> </span><br><span class="line">app.get(&#x27;/about&#x27;, function(req, res) &#123;</span><br><span class="line">   res.render(&#x27;about&#x27;, &#123;title:&quot;自我介绍&quot;&#125;);</span><br><span class="line">&#125;);</span><br><span class="line"> </span><br><span class="line">app.get(&#x27;/article/:id&#x27;, function(req, res) &#123;</span><br><span class="line">   var entry = blogEngine.getBlogEntry(req.params.id);</span><br><span class="line">   res.render(&#x27;article&#x27;,&#123;title:entry.title, blog:entry&#125;);</span><br><span class="line">&#125;);</span><br><span class="line"> </span><br><span class="line">app.listen(3000);</span><br></pre></td></tr></table></figure>

<ul>
<li>上面代码中的render方法，现在加入了第二个参数，表示模板变量绑定的数据</li>
</ul>
<h2 id="十四、指定静态文件目录"><a href="#十四、指定静态文件目录" class="headerlink" title="十四、指定静态文件目录"></a>十四、指定静态文件目录</h2><blockquote>
<p>模板文件默认存放在views子目录。这时，如果要在网页中加载静态文件（比如样式表、图片等），就需要另外指定一个存放静态文件的目录</p>
</blockquote>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">app.use(express.static(&#x27;public&#x27;));</span><br></pre></td></tr></table></figure>

<blockquote>
<p>上面代码在文件app.js之中，指定静态文件存放的目录是public。于是，当浏览器发出非HTML文件请求时，服务器端就到public目录寻找这个文件。比如，浏览器发出如下的样式表请求：</p>
</blockquote>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;link href=&quot;/bootstrap/css/bootstrap.css&quot; rel=&quot;stylesheet&quot;&gt;</span><br></pre></td></tr></table></figure>

<ul>
<li>服务器端就到<code>public/bootstrap/css/</code>目录中寻找<code>bootstrap.css</code>文件</li>
</ul>
<h2 id="十五、Express-Router用法"><a href="#十五、Express-Router用法" class="headerlink" title="十五、Express.Router用法"></a>十五、Express.Router用法</h2><blockquote>
<p>从<code>Express 4.0</code>开始，路由器功能成了一个单独的组件<code>Express.Router</code>。它好像小型的<code>express</code>应用程序一样，有自己的<code>use</code>、<code>get</code>、<code>param</code>和<code>route</code>方法</p>
</blockquote>
<p><strong>基本用法</strong></p>
<blockquote>
<p>首先，Express.Router是一个构造函数，调用后返回一个路由器实例。然后，使用该实例的HTTP动词方法，为不同的访问路径，指定回调函数；最后，挂载到某个路径。</p>
</blockquote>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">var router = express.Router();</span><br><span class="line"></span><br><span class="line">router.get(&#x27;/&#x27;, function(req, res) &#123;</span><br><span class="line">  res.send(&#x27;首页&#x27;);</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">router.get(&#x27;/about&#x27;, function(req, res) &#123;</span><br><span class="line">  res.send(&#x27;关于&#x27;);</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">app.use(&#x27;/&#x27;, router);</span><br></pre></td></tr></table></figure>

<blockquote>
<ul>
<li>上面代码先定义了两个访问路径，然后将它们挂载到根目录</li>
<li>这种路由器可以自由挂载的做法，为程序带来了更大的灵活性，既可以定义多个路由器实例，也可以为将同一个路由器实例挂载到多个路径。</li>
</ul>
</blockquote>
<h2 id="十六、router-route方法"><a href="#十六、router-route方法" class="headerlink" title="十六、router.route方法"></a>十六、router.route方法</h2><blockquote>
<p>router实例对象的route方法，可以接受访问路径作为参数</p>
</blockquote>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">var router = express.Router();</span><br><span class="line"></span><br><span class="line">router.route(&#x27;/api&#x27;)</span><br><span class="line">	.post(function(req, res) &#123;</span><br><span class="line">		// ...</span><br><span class="line">	&#125;)</span><br><span class="line">	.get(function(req, res) &#123;</span><br><span class="line">		Bear.find(function(err, bears) &#123;</span><br><span class="line">			if (err) res.send(err);</span><br><span class="line">			res.json(bears);</span><br><span class="line">		&#125;);</span><br><span class="line">	&#125;);</span><br><span class="line"></span><br><span class="line">app.use(&#x27;/&#x27;, router);</span><br></pre></td></tr></table></figure>

<h2 id="十七、router中间件"><a href="#十七、router中间件" class="headerlink" title="十七、router中间件"></a>十七、router中间件</h2><blockquote>
<p>use方法为router对象指定中间件，即在数据正式发给用户之前，对数据进行处理。下面就是一个中间件的例子</p>
</blockquote>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">router.use(function(req, res, next) &#123;</span><br><span class="line">	console.log(req.method, req.url);</span><br><span class="line">	next();	</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<ul>
<li>上面代码中，回调函数的next参数，表示接受其他中间件的调用。函数体中的next()，表示将数据传递给下一个中间件</li>
<li>注意，中间件的放置顺序很重要，等同于执行顺序。而且，中间件必须放在HTTP动词方法之前，否则不会执行</li>
</ul>
<h2 id="十八、对路径参数的处理"><a href="#十八、对路径参数的处理" class="headerlink" title="十八、对路径参数的处理"></a>十八、对路径参数的处理</h2><blockquote>
<p>router对象的param方法用于路径参数的处理，可以</p>
</blockquote>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">router.param(&#x27;name&#x27;, function(req, res, next, name) &#123;</span><br><span class="line">	// 对name进行验证或其他处理……</span><br><span class="line">	console.log(name);</span><br><span class="line">	req.name = name;</span><br><span class="line">	next();	</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">router.get(&#x27;/hello/:name&#x27;, function(req, res) &#123;</span><br><span class="line">	res.send(&#x27;hello &#x27; + req.name + &#x27;!&#x27;);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<blockquote>
<p>上面代码中，get方法为访问路径指定了name参数，param方法则是对name参数进行处理。注意，param方法必须放在HTTP动词方法之前</p>
</blockquote>
<h2 id="十九、app-route"><a href="#十九、app-route" class="headerlink" title="十九、app.route"></a>十九、app.route</h2><blockquote>
<ul>
<li>假定app是Express的实例对象，Express 4.0为该对象提供了一个route属性。app.route实际上是express.Router()的缩写形式，直接挂载到根路径</li>
<li>因此，对同一个路径指定get和post方法的回调函数，可以写成链式形式</li>
</ul>
</blockquote>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">app.route(&#x27;/login&#x27;)</span><br><span class="line">	.get(function(req, res) &#123;</span><br><span class="line">		res.send(&#x27;this is the login form&#x27;);</span><br><span class="line">	&#125;)</span><br><span class="line">	.post(function(req, res) &#123;</span><br><span class="line">		console.log(&#x27;processing&#x27;);</span><br><span class="line">		res.send(&#x27;processing the login form!&#x27;);</span><br><span class="line">	&#125;);</span><br></pre></td></tr></table></figure>

<h2 id="二十、上传文件"><a href="#二十、上传文件" class="headerlink" title="二十、上传文件"></a>二十、上传文件</h2><ul>
<li>首先，在网页插入上传文件的表单</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&lt;form action=&quot;/pictures/upload&quot; method=&quot;POST&quot; enctype=&quot;multipart/form-data&quot;&gt;</span><br><span class="line">  Select an image to upload:</span><br><span class="line">  &lt;input type=&quot;file&quot; name=&quot;image&quot;&gt;</span><br><span class="line">  &lt;input type=&quot;submit&quot; value=&quot;Upload Image&quot;&gt;</span><br><span class="line">&lt;/form&gt;</span><br></pre></td></tr></table></figure>

<blockquote>
<p>然后，服务器脚本建立指向&#x2F;upload目录的路由。这时可以安装multer模块，它提供了上传文件的许多功能</p>
</blockquote>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">var express = require(&#x27;express&#x27;);</span><br><span class="line">var router = express.Router();</span><br><span class="line">var multer = require(&#x27;multer&#x27;);</span><br><span class="line"></span><br><span class="line">var uploading = multer(&#123;</span><br><span class="line">  dest: __dirname + &#x27;../public/uploads/&#x27;,</span><br><span class="line">  // 设定限制，每次最多上传1个文件，文件大小不超过1MB</span><br><span class="line">  limits: &#123;fileSize: 1000000, files:1&#125;,</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line">router.post(&#x27;/upload&#x27;, uploading, function(req, res) &#123;</span><br><span class="line"></span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line">module.exports = router</span><br></pre></td></tr></table></figure>
      
    </div>
    <footer class="article-footer">
      <a data-url="http://example.com/2019/06/07/nodejs/express/" data-id="cl7icg6ui00omugun7dl6b8zd" data-title="node-express框架总结" class="article-share-link">Share</a>
      
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/nodejs/" rel="tag">nodejs</a></li></ul>

    </footer>
  </div>
  
</article>



  
    <article id="post-nodejs/nodejs-websocker与socket.io的区别" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2019/05/26/nodejs/nodejs-websocker%E4%B8%8Esocket.io%E7%9A%84%E5%8C%BA%E5%88%AB/" class="article-date">
  <time class="dt-published" datetime="2019-05-26T05:16:35.000Z" itemprop="datePublished">2019-05-26</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/%E5%90%8E%E7%AB%AF/">后端</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/2019/05/26/nodejs/nodejs-websocker%E4%B8%8Esocket.io%E7%9A%84%E5%8C%BA%E5%88%AB/">nodejs-websocker与socket.io的区别</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <h1 id="第一部分-WebSocket"><a href="#第一部分-WebSocket" class="headerlink" title="第一部分 WebSocket"></a>第一部分 WebSocket</h1><h2 id="一、WebSocket-解决了什么问题"><a href="#一、WebSocket-解决了什么问题" class="headerlink" title="一、WebSocket 解决了什么问题"></a>一、WebSocket 解决了什么问题</h2><ul>
<li>客户端(浏览器)和服务器端进行通信，只能由客户端发起<code>ajax</code>请求，才能进行通信，服务器端无法主动向客户端推送信息</li>
<li>当出现类似体育赛事、聊天室、实时位置之类的场景时，客户端要获取服务器端的变化，就只能通过轮询(定时请求)来了解服务器端有没有新的信息变化</li>
</ul>
<p>轮询效率低，非常浪费资源(需要不断发送请求，不停链接服务器)</p>
<blockquote>
<p><code>WebSocket</code>的出现，让服务器端可以主动向服务器端发送信息，使得浏览器具备了实时双向通信的能力,这就是<code>WebSocket</code>解决的问题</p>
</blockquote>
<p><strong>一个超简单例子</strong></p>
<blockquote>
<p>新建一个<code>html</code>文件，将本栗子找个地方跑一下试试，即可轻松入门<code>WebSocket</code></p>
</blockquote>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">function socketConnect(url) &#123;</span><br><span class="line">    // 客户端与服务器进行连接</span><br><span class="line">    let ws = new WebSocket(url); // 返回`WebSocket`对象，赋值给变量ws</span><br><span class="line">    // 连接成功回调</span><br><span class="line">    ws.onopen = e =&gt; &#123;</span><br><span class="line">        console.log(&#x27;连接成功&#x27;, e)</span><br><span class="line">        ws.send(&#x27;我发送消息给服务端&#x27;); // 客户端与服务器端通信</span><br><span class="line">    &#125;</span><br><span class="line">    // 监听服务器端返回的信息</span><br><span class="line">    ws.onmessage = e =&gt; &#123;</span><br><span class="line">        console.log(&#x27;服务器端返回：&#x27;, e.data)</span><br><span class="line">        // do something</span><br><span class="line">    &#125;</span><br><span class="line">    return ws; // 返回websocket对象</span><br><span class="line">&#125;</span><br><span class="line">let wsValue = socketConnect(&#x27;ws://121.40.165.18:8800&#x27;); // websocket对象</span><br></pre></td></tr></table></figure>

<blockquote>
<p>上述栗子中<code>WebSocket</code>的接口地址出自：<code>WebSocket</code> 在线测试，在开发的时候也可以用于测试后端给的地址是否可用</p>
</blockquote>
<p><img src="https://poetries1.gitee.io/img-repo/2019/10/389.png" alt="img"></p>
<h2 id="二、webSocket的class类"><a href="#二、webSocket的class类" class="headerlink" title="二、webSocket的class类"></a>二、webSocket的class类</h2><blockquote>
<p>当项目中很多地方使用<code>WebSocket</code>，把它封成一个<code>class</code>类，是更好的选择</p>
</blockquote>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br></pre></td><td class="code"><pre><span class="line">class WebSocketClass &#123;</span><br><span class="line">    /**</span><br><span class="line">     * @description: 初始化实例属性，保存参数</span><br><span class="line">     * @param &#123;String&#125; url ws的接口</span><br><span class="line">     * @param &#123;Function&#125; msgCallback 服务器信息的回调传数据给函数</span><br><span class="line">     * @param &#123;String&#125; name 可选值 用于区分ws，用于debugger</span><br><span class="line">     */</span><br><span class="line">    constructor(url, msgCallback, name = &#x27;default&#x27;) &#123;</span><br><span class="line">        this.url = url;</span><br><span class="line">        this.msgCallback = msgCallback;</span><br><span class="line">        this.name = name;</span><br><span class="line">        this.ws = null;  // websocket对象</span><br><span class="line">        this.status = null; // websocket是否关闭</span><br><span class="line">    &#125;</span><br><span class="line">    /**</span><br><span class="line">     * @description: 初始化 连接websocket或重连webSocket时调用</span><br><span class="line">     * @param &#123;*&#125; 可选值 要传的数据</span><br><span class="line">     */</span><br><span class="line">    connect(data) &#123;</span><br><span class="line">        // 新建 WebSocket 实例</span><br><span class="line">        this.ws = new WebSocket(this.url);</span><br><span class="line">        this.ws.onopen = e =&gt; &#123;</span><br><span class="line">            // 连接ws成功回调</span><br><span class="line">            this.status = &#x27;open&#x27;;</span><br><span class="line">            console.log(`$&#123;this.name&#125;连接成功`, e)</span><br><span class="line">            // this.heartCheck();</span><br><span class="line">            if (data !== undefined) &#123;</span><br><span class="line">                // 有要传的数据,就发给后端</span><br><span class="line">                return this.ws.send(data);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        // 监听服务器端返回的信息</span><br><span class="line">        this.ws.onmessage = e =&gt; &#123;</span><br><span class="line">            // 把数据传给回调函数，并执行回调</span><br><span class="line">            // if (e.data === &#x27;pong&#x27;) &#123;</span><br><span class="line">            //     this.pingPong = &#x27;pong&#x27;; // 服务器端返回pong,修改pingPong的状态</span><br><span class="line">            // &#125;</span><br><span class="line">            return this.msgCallback(e.data);</span><br><span class="line">        &#125;</span><br><span class="line">        // ws关闭回调</span><br><span class="line">        this.ws.onclose = e =&gt; &#123;</span><br><span class="line">            this.closeHandle(e); // 判断是否关闭</span><br><span class="line">        &#125;</span><br><span class="line">        // ws出错回调</span><br><span class="line">        this.onerror = e =&gt; &#123;</span><br><span class="line">            this.closeHandle(e); // 判断是否关闭</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    // heartCheck() &#123;</span><br><span class="line">    //     // 心跳机制的时间可以自己与后端约定</span><br><span class="line">    //     this.pingPong = &#x27;ping&#x27;; // ws的心跳机制状态值</span><br><span class="line">    //     this.pingInterval = setInterval(() =&gt; &#123;</span><br><span class="line">    //         if (this.ws.readyState === 1) &#123;</span><br><span class="line">    //             // 检查ws为链接状态 才可发送</span><br><span class="line">    //             this.ws.send(&#x27;ping&#x27;); // 客户端发送ping</span><br><span class="line">    //         &#125;</span><br><span class="line">    //     &#125;, 10000)</span><br><span class="line">    //     this.pongInterval = setInterval(() =&gt; &#123;</span><br><span class="line">    //         this.pingPong = false;</span><br><span class="line">    //         if (this.pingPong === &#x27;ping&#x27;) &#123;</span><br><span class="line">    //             this.closeHandle(&#x27;pingPong没有改变为pong&#x27;); // 没有返回pong 重启webSocket</span><br><span class="line">    //         &#125;</span><br><span class="line">    //         // 重置为ping 若下一次 ping 发送失败 或者pong返回失败(pingPong不会改成pong)，将重启</span><br><span class="line">    //         console.log(&#x27;返回pong&#x27;)</span><br><span class="line">    //         this.pingPong = &#x27;ping&#x27;</span><br><span class="line">    //     &#125;, 20000)</span><br><span class="line">    // &#125;</span><br><span class="line">    // 发送信息给服务器</span><br><span class="line">    sendHandle(data) &#123;</span><br><span class="line">        console.log(`$&#123;this.name&#125;发送消息给服务器:`, data)</span><br><span class="line">        return this.ws.send(data);</span><br><span class="line">    &#125;</span><br><span class="line">    closeHandle(e = &#x27;err&#x27;) &#123;</span><br><span class="line">        // 因为webSocket并不稳定，规定只能手动关闭(调closeMyself方法)，否则就重连</span><br><span class="line">        if (this.status !== &#x27;close&#x27;) &#123;</span><br><span class="line">            console.log(`$&#123;this.name&#125;断开，重连websocket`, e)</span><br><span class="line">            // if (this.pingInterval !== undefined &amp;&amp; this.pongInterval !== undefined) &#123;</span><br><span class="line">            //     // 清除定时器</span><br><span class="line">            //     clearInterval(this.pingInterval);</span><br><span class="line">            //     clearInterval(this.pongInterval);</span><br><span class="line">            // &#125;</span><br><span class="line">            this.connect(); // 重连</span><br><span class="line">        &#125; else &#123;</span><br><span class="line">            console.log(`$&#123;this.name&#125;websocket手动关闭`)</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    // 手动关闭WebSocket</span><br><span class="line">    closeMyself() &#123;</span><br><span class="line">        console.log(`关闭$&#123;this.name&#125;`)</span><br><span class="line">        this.status = &#x27;close&#x27;;</span><br><span class="line">        return this.ws.close();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">function someFn(data) &#123;</span><br><span class="line">    console.log(&#x27;接收服务器消息的回调：&#x27;, data);</span><br><span class="line">&#125;</span><br><span class="line">// const wsValue = new WebSocketClass(&#x27;ws://121.40.165.18:8800&#x27;, someFn, &#x27;wsName&#x27;); // 这个链接一天只能发送消息50次</span><br><span class="line">const wsValue = new WebSocketClass(&#x27;wss://echo.websocket.org&#x27;, someFn, &#x27;wsName&#x27;); // 阮一峰老师教程链接</span><br><span class="line">wsValue.connect(&#x27;立即与服务器通信&#x27;); // 连接服务器</span><br><span class="line">// setTimeout(() =&gt; &#123;</span><br><span class="line">//     wsValue.sendHandle(&#x27;传消息给服务器&#x27;)</span><br><span class="line">// &#125;, 1000);</span><br><span class="line">// setTimeout(() =&gt; &#123;</span><br><span class="line">//     wsValue.closeMyself(); // 关闭ws</span><br><span class="line">// &#125;, 10000)</span><br></pre></td></tr></table></figure>

<blockquote>
<p>可以把<code>class</code>放在一个js文件里面,<code>export</code>出去，然后在需要用的地方再<code>import</code>进来，把参数传进去就可以用了</p>
</blockquote>
<h2 id="三、WebSocket不稳定"><a href="#三、WebSocket不稳定" class="headerlink" title="三、WebSocket不稳定"></a>三、WebSocket不稳定</h2><blockquote>
<p><code>WebSocket</code>并不稳定，在使用一段时间后，可能会断开连接，貌似至今没有一个为何会断开连接的公论，所以我们需要让<code>WebSocket</code>保持连接状态，这里推荐两种方法</p>
</blockquote>
<h3 id="3-1-WebSocket设置变量，判断是否手动关闭连接"><a href="#3-1-WebSocket设置变量，判断是否手动关闭连接" class="headerlink" title="3.1 WebSocket设置变量，判断是否手动关闭连接"></a>3.1 WebSocket设置变量，判断是否手动关闭连接</h3><blockquote>
<p><code>class</code>类中就是用的这种方式:设置一个变量，在<code>webSocket</code>关闭&#x2F;报错的回调中，判断是不是手动关闭的，如果不是的话，就重新连接，这样做的优缺点如下</p>
</blockquote>
<ul>
<li>优点：请求较少(相对于心跳连接)，易设置。</li>
<li>缺点：可能会导致丢失数据,在断开重连的这段时间中，恰好双方正在通信</li>
</ul>
<h3 id="3-2-WebSocket心跳机制"><a href="#3-2-WebSocket心跳机制" class="headerlink" title="3.2 WebSocket心跳机制"></a>3.2 WebSocket心跳机制</h3><blockquote>
<p>因为第一种方案的缺点，并且可能会有其他一些未知情况导致断开连接而没有触发Error或Close事件。这样就导致实际连接已经断开了，而客户端和服务端却不知道，还在傻傻的等着消息来</p>
</blockquote>
<ul>
<li>想出了一种叫做心跳机制的解决方法：</li>
<li>客户端就像心跳一样每隔固定的时间发送一次ping，来告诉服务器，我还活着，而服务器也会返回pong，来告诉客户端，服务器还活着。</li>
<li>具体的实现方法，在上面<code>class</code>的注释中，将其打开，即可看到效果</li>
</ul>
<h2 id="四、关于WebSocket"><a href="#四、关于WebSocket" class="headerlink" title="四、关于WebSocket"></a>四、关于WebSocket</h2><h3 id="4-1-WebSocket的当前状态-WebSocket-readyState"><a href="#4-1-WebSocket的当前状态-WebSocket-readyState" class="headerlink" title="4.1 WebSocket的当前状态:WebSocket.readyState"></a>4.1 WebSocket的当前状态:<code>WebSocket.readyState</code></h3><p><strong>下面是WebSocket.readyState的四个值(四种状态)：</strong></p>
<ul>
<li><code>0</code>: 表示正在连接</li>
<li><code>1</code>: 表示连接成功，可以通信了</li>
<li><code>2</code>: 表示连接正在关闭</li>
<li><code>3</code>: 表示连接已经关闭，或者打开连接失败</li>
</ul>
<blockquote>
<p>我们可以利用当前状态来做一些事情，比如上面栗子中当<code>WebSocket</code>链接成功后，才允许客户端发<code>送ping</code></p>
</blockquote>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">if (this.ws.readyState === 1) &#123;</span><br><span class="line">    // 检查ws为链接状态 才可发送</span><br><span class="line">    this.ws.send(&#x27;ping&#x27;); // 客户端发送ping</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="4-2-WebSocket还可以发送-x2F-接收-二进制数据"><a href="#4-2-WebSocket还可以发送-x2F-接收-二进制数据" class="headerlink" title="4.2 WebSocket还可以发送&#x2F;接收 二进制数据"></a>4.2 <code>WebSocket</code>还可以发送&#x2F;接收 二进制数据</h3><blockquote>
<p>二进制数据包括：<code>blob</code>对象和<code>Arraybuffer</code>对象，所以我们需要分开来处理</p>
</blockquote>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"> // 接收数据</span><br><span class="line">ws.onmessage = function(event)&#123;</span><br><span class="line">    if(event.data instanceof ArrayBuffer)&#123;</span><br><span class="line">        // 判断 ArrayBuffer 对象</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    if(event.data instanceof Blob)&#123;</span><br><span class="line">        // 判断 Blob 对象</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">// 发送 Blob 对象的例子</span><br><span class="line">let file = document.querySelector(&#x27;input[type=&quot;file&quot;]&#x27;).files[0];</span><br><span class="line">ws.send(file);</span><br><span class="line"></span><br><span class="line">// 发送 ArrayBuffer 对象的例子</span><br><span class="line">var img = canvas_context.getImageData(0, 0, 400, 320);</span><br><span class="line">var binary = new Uint8Array(img.data.length);</span><br><span class="line">for (var i = 0; i &lt; img.data.length; i++) &#123;</span><br><span class="line">    binary[i] = img.data[i];</span><br><span class="line">&#125;</span><br><span class="line">ws.send(binary.buffer);</span><br></pre></td></tr></table></figure>

<blockquote>
<p>如果你要发送的二进制数据很大的话，如何判断发送完毕：</p>
</blockquote>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">webSocket.bufferedAmount属性，表示还有多少字节的二进制数据没有发送出去：</span><br><span class="line"></span><br><span class="line">var data = new ArrayBuffer(10000000);</span><br><span class="line">socket.send(data);</span><br><span class="line">if (socket.bufferedAmount === 0) &#123;</span><br><span class="line">    // 发送完毕</span><br><span class="line">&#125; else &#123;</span><br><span class="line">    // 发送还没结束</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="五、WebSocket的优点"><a href="#五、WebSocket的优点" class="headerlink" title="五、WebSocket的优点"></a>五、WebSocket的优点</h2><ul>
<li>双向通信</li>
<li>数据格式比较轻量，性能开销小，通信高效<ul>
<li>协议控制的数据包头部较小，而<code>HTTP</code>协议每次通信都需要携带完整的头部</li>
</ul>
</li>
<li>更好的二进制支持</li>
<li>没有同源限制，客户端可以与任意服务器通信</li>
<li>与 <code>HTTP</code> 协议有着良好的兼容性。默认端口也是<code>80</code>和<code>443</code>，并且握手阶段采用 <code>HTTP</code> 协议，因此握手时不容易屏蔽，能通过各种 <code>HTTP</code> 代理服务器</li>
</ul>
<h1 id="第二部分-socket-io"><a href="#第二部分-socket-io" class="headerlink" title="第二部分 socket.io"></a>第二部分 <code>socket.io</code></h1><h2 id="一、原生Node与socket-io通信"><a href="#一、原生Node与socket-io通信" class="headerlink" title="一、原生Node与socket.io通信"></a>一、原生Node与socket.io通信</h2><blockquote>
<p>原生<code>nodejs</code>结合<code>Socket.io</code>实现服务器和客户端的相互通信</p>
</blockquote>
<blockquote>
<p>官方文档 <a target="_blank" rel="noopener" href="https://socket.io/">https://socket.io</a></p>
</blockquote>
<h3 id="1-1-搭建服务"><a href="#1-1-搭建服务" class="headerlink" title="1.1 搭建服务"></a>1.1 搭建服务</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"># 新建目录</span><br><span class="line">mkdir socket &amp;&amp; cd socket</span><br><span class="line"></span><br><span class="line"># 生成package.json</span><br><span class="line">npm init -y</span><br><span class="line"></span><br><span class="line"># 安装socket</span><br><span class="line">npm install socket.io</span><br><span class="line">// app.js</span><br><span class="line"></span><br><span class="line">var http = require(&quot;http&quot;);</span><br><span class="line"></span><br><span class="line">var server = http.createServer(function(req,res)&#123;</span><br><span class="line">    if(req.url == &quot;/&quot;)&#123; //显示首页</span><br><span class="line">        fs.readFile(&quot;./index.html&quot;,function(err,data)&#123; </span><br><span class="line">            res.end(data);</span><br><span class="line">        &#125;); </span><br><span class="line">    &#125;</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">var io = require(&#x27;socket.io&#x27;)(server);</span><br><span class="line"></span><br><span class="line">//监听连接事件 </span><br><span class="line">io.on(&quot;connection&quot;,function(socket)&#123;</span><br><span class="line">    console.log(&quot;1 个客户端连接了&quot;); </span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line">server.listen(3000,&quot;127.0.0.1&quot;,function()&#123;</span><br><span class="line">    console.log(&#x27;app run at 127.0.0.1:3000&#x27;)</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">// 写完这句话之后，你就会发现，http://127.0.0.1:3000/socket.io/socket.io.js 就是一个 js 文件 的地址了</span><br></pre></td></tr></table></figure>

<h3 id="1-2-新建页面"><a href="#1-2-新建页面" class="headerlink" title="1.2 新建页面"></a>1.2 新建页面</h3><blockquote>
<p>现在需要制作一个<code>index</code>页面，这个页面中，必须引用秘密<code>js</code>文件。调用<code>io</code>函数，取得<code>socket</code> 对象</p>
</blockquote>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">&lt;!DOCTYPE html&gt; &lt;html lang=&quot;en&quot;&gt; &lt;head&gt;</span><br><span class="line">&lt;meta charset=&quot;UTF-8&quot;&gt;</span><br><span class="line">&lt;title&gt;Document&lt;/title&gt; &lt;/head&gt;</span><br><span class="line">&lt;body&gt;</span><br><span class="line"></span><br><span class="line">&lt;h1&gt;我是 index 页面，我引用了秘密 script 文件&lt;/h1&gt;</span><br><span class="line"></span><br><span class="line">&lt;script type=&quot;text/javascript&quot; src=&quot;/socket.io/socket.io.js&quot;&gt;&lt;/script&gt; &lt;script type=&quot;text/javascript&quot;&gt;</span><br><span class="line">    var socket = io(); </span><br><span class="line">    console.log(socket)</span><br><span class="line">&lt;/script&gt;</span><br><span class="line"></span><br><span class="line">&lt;/body&gt; </span><br><span class="line">&lt;/html&gt;</span><br></pre></td></tr></table></figure>

<blockquote>
<p>至此，服务器和客户端都有 <code>socket</code> 对象了。服务器的 <code>socket</code> 对象:</p>
</blockquote>
<blockquote>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">socket对象</span><br></pre></td></tr></table></figure>
</blockquote>
<p><img src="https://poetries1.gitee.io/img-repo/2019/10/390.png" alt="img"><br><img src="https://poetries1.gitee.io/img-repo/2019/10/391.png" alt="img"></p>
<h3 id="1-3-服务器端通过emit广播，通过on接收广播"><a href="#1-3-服务器端通过emit广播，通过on接收广播" class="headerlink" title="1.3 服务器端通过emit广播，通过on接收广播"></a>1.3 服务器端通过emit广播，通过on接收广播</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line">// app.js</span><br><span class="line"></span><br><span class="line">var http = require(&quot;http&quot;);</span><br><span class="line"></span><br><span class="line">var server = http.createServer(function(req,res)&#123;</span><br><span class="line">    if(req.url == &quot;/&quot;)&#123; //显示首页</span><br><span class="line">        fs.readFile(&quot;./index.html&quot;,function(err,data)&#123; </span><br><span class="line">            res.end(data);</span><br><span class="line">        &#125;); </span><br><span class="line">    &#125;</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">var io = require(&#x27;socket.io&#x27;)(server);</span><br><span class="line"></span><br><span class="line">//监听连接事件 </span><br><span class="line">io.on(&#x27;connection&#x27;,function(socket) &#123;</span><br><span class="line">    console.log(&#x27;和服务器建立连接了&#x27;);</span><br><span class="line">    </span><br><span class="line">    socket.on(&#x27;to-server&#x27;,function(data) &#123;</span><br><span class="line">    </span><br><span class="line">        // 接收客户端传过来的数据</span><br><span class="line">        console.log(&#x27;客户端说:&#x27; + data);</span><br><span class="line">        </span><br><span class="line">        // 向客户端发送数据</span><br><span class="line">        // socket 只给当前发送消息给服务端的客户端发送消息</span><br><span class="line">        socket.emit(&#x27;to-client&#x27;,&#x27;我是服务器返回的数据&#x27;);</span><br><span class="line">        </span><br><span class="line">    &#125;) </span><br><span class="line">    socket.on(&#x27;disconnect&#x27;,function() &#123;</span><br><span class="line">        console.log(&#x27;断开连接了&#x27;);</span><br><span class="line">    &#125;)</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line">server.listen(3000,&quot;127.0.0.1&quot;,function()&#123;</span><br><span class="line">    console.log(&#x27;app run at 127.0.0.1:3000&#x27;)</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<p><img src="https://poetries1.gitee.io/img-repo/2019/10/392.png" alt="img"></p>
<blockquote>
<p>每一个连接上来的用户，都有一个 <code>socket</code>。由于我们的 <code>emit</code> 语句，是 <code>socket.emit()</code>发 出的，所以指的是向这个客户端发出语句。<br>广播，就是给所有当前连接的用户发送信息:</p>
</blockquote>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">var io = require(&#x27;socket.io&#x27;)(server);</span><br><span class="line"></span><br><span class="line">io.on(&#x27;connection&#x27;,function(socket) &#123;</span><br><span class="line"></span><br><span class="line">    console.log(&#x27;和服务器建立连接了&#x27;)</span><br><span class="line">    </span><br><span class="line">    socket.on(&#x27;to-server&#x27;,function(data) &#123;</span><br><span class="line">    </span><br><span class="line">        console.log(&#x27;客户端说:&#x27; + data);</span><br><span class="line">        </span><br><span class="line">        // io 给所有建立连接的客户端发送数据，不管是哪个客户端发送消息，都会对所有客户端进行广播一次</span><br><span class="line">        io.emit(&#x27;to-client&#x27;,&#x27;我是服务器返回的数据&#x27;);</span><br><span class="line">    &#125;) </span><br><span class="line">    socket.on(&#x27;disconnect&#x27;,function() &#123;</span><br><span class="line">        console.log(&#x27;断开连接了&#x27;);</span><br><span class="line">    &#125;)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>

<p><img src="https://poetries1.gitee.io/img-repo/2019/10/393.png" alt="img"><br><img src="https://poetries1.gitee.io/img-repo/2019/10/394.png" alt="img"></p>
<ul>
<li><code>io.emit()</code>可以实现聊天室消息群发</li>
<li><code>socket.emit()</code>可以实现聊天机器人，一对一发送</li>
</ul>
<h3 id="1-4-客户端端通过emit广播，通过on接收广播"><a href="#1-4-客户端端通过emit广播，通过on接收广播" class="headerlink" title="1.4 客户端端通过emit广播，通过on接收广播"></a>1.4 客户端端通过emit广播，通过on接收广播</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line">// index.html</span><br><span class="line">&lt;!DOCTYPE html&gt; </span><br><span class="line">&lt;html lang=&quot;en&quot;&gt; </span><br><span class="line">&lt;head&gt;</span><br><span class="line">    &lt;meta charset=&quot;UTF-8&quot;&gt;</span><br><span class="line">    &lt;title&gt;socket demo&lt;/title&gt; </span><br><span class="line">&lt;/head&gt;</span><br><span class="line">&lt;body&gt;</span><br><span class="line"></span><br><span class="line">&lt;h1&gt;我是 index 页面，我引用了秘密 script 文件&lt;/h1&gt;</span><br><span class="line">&lt;button id=&quot;btn&quot;&gt;给服务端发送数据&lt;/button&gt;</span><br><span class="line"></span><br><span class="line">&lt;script type=&quot;text/javascript&quot; src=&quot;/socket.io/socket.io.js&quot;&gt;&lt;/script&gt; &lt;script type=&quot;text/javascript&quot;&gt;</span><br><span class="line"></span><br><span class="line">    // 连接的地址http://localhost:3000 后台提供</span><br><span class="line">    var socket = io.connect(&#x27;http://localhost:3000&#x27;);</span><br><span class="line"></span><br><span class="line">    // 客户端建立连接</span><br><span class="line">    socket.on(&#x27;connect&#x27;,function() &#123;</span><br><span class="line">        console.log(&#x27;客户端和服务端建立连接了&#x27;);</span><br><span class="line">    &#125;) </span><br><span class="line"></span><br><span class="line">    socket.on(&#x27;disconnect&#x27;,function() &#123;</span><br><span class="line">        console.log(&#x27;客户端和服务端断开连接了&#x27;);</span><br><span class="line">    &#125;) </span><br><span class="line"></span><br><span class="line">    // 客户端给服务端发送数据后，监听服务端返回的数据</span><br><span class="line">    socket.on(&#x27;to-client&#x27;,function(data) &#123;</span><br><span class="line">        console.log(&#x27;客户端说:&#x27; + data);</span><br><span class="line">    &#125;) </span><br><span class="line"></span><br><span class="line">    var btn = document.getElementById(&#x27;btn&#x27;);</span><br><span class="line"></span><br><span class="line">    btn.onclick = function() &#123;</span><br><span class="line">        socket.emit(&#x27;to-server&#x27;,&#x27;我是客户端的数据&#x27;);</span><br><span class="line">    &#125;</span><br><span class="line">&lt;/script&gt;</span><br><span class="line"></span><br><span class="line">&lt;/body&gt; </span><br><span class="line">&lt;/html&gt;</span><br></pre></td></tr></table></figure>

<h2 id="二、聊天室、智能机器人实现原理"><a href="#二、聊天室、智能机器人实现原理" class="headerlink" title="二、聊天室、智能机器人实现原理"></a>二、聊天室、智能机器人实现原理</h2><h3 id="2-1-express简单例子"><a href="#2-1-express简单例子" class="headerlink" title="2.1 express简单例子"></a>2.1 express简单例子</h3><blockquote>
<p><code>Express</code> 结合 <code>Socket.io</code> 实现服务器和客户 端的相互通信、聊天室、智能机器人实现 原理</p>
</blockquote>
<blockquote>
<ul>
<li><a target="_blank" rel="noopener" href="http://www.expressjs.com.cn/starter/generator.html">express文档</a></li>
<li><a target="_blank" rel="noopener" href="https://socket.io/docs">socket.io文档</a></li>
</ul>
</blockquote>
<p><strong>1. Server (app.js)</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">var app = require(&#x27;express&#x27;)();</span><br><span class="line">var server = require(&#x27;http&#x27;).Server(app);</span><br><span class="line">var io = require(&#x27;socket.io&#x27;)(server);</span><br><span class="line"></span><br><span class="line">server.listen(80);</span><br><span class="line">// WARNING: app.listen(80) will NOT work here!</span><br><span class="line"></span><br><span class="line">app.get(&#x27;/&#x27;, function (req, res) &#123;</span><br><span class="line">  res.sendFile(__dirname + &#x27;/index.html&#x27;);</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">io.on(&#x27;connection&#x27;, function (socket) &#123;</span><br><span class="line">  socket.emit(&#x27;news&#x27;, &#123; hello: &#x27;world&#x27; &#125;);</span><br><span class="line">  socket.on(&#x27;my other event&#x27;, function (data) &#123;</span><br><span class="line">    console.log(data);</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<p><strong>2. Client (index.html)</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">&lt;script src=&quot;/socket.io/socket.io.js&quot;&gt;&lt;/script&gt;</span><br><span class="line">&lt;script&gt;</span><br><span class="line">  var socket = io.connect(&#x27;http://localhost&#x27;);</span><br><span class="line">  socket.on(&#x27;news&#x27;, function (data) &#123;</span><br><span class="line">    console.log(data);</span><br><span class="line">    socket.emit(&#x27;my other event&#x27;, &#123; my: &#x27;data&#x27; &#125;);</span><br><span class="line">  &#125;);</span><br><span class="line">&lt;/script&gt;</span><br></pre></td></tr></table></figure>

<h3 id="2-2-express实现智能机器人"><a href="#2-2-express实现智能机器人" class="headerlink" title="2.2 express实现智能机器人"></a>2.2 express实现智能机器人</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br></pre></td><td class="code"><pre><span class="line">&lt;!--views/index.ejx--&gt;</span><br><span class="line">&lt;html&gt;</span><br><span class="line">&lt;head&gt;</span><br><span class="line">  &lt;title&gt;&lt;/title&gt;</span><br><span class="line"></span><br><span class="line">    &lt;script src=&quot;/jquery-1.11.3.min.js&quot;&gt;&lt;/script&gt;</span><br><span class="line"></span><br><span class="line">    &lt;script src=&quot;/socket.io/socket.io.js&quot;&gt;&lt;/script&gt;</span><br><span class="line">&lt;/head&gt;</span><br><span class="line">&lt;body&gt;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    &lt;input type=&quot;text&quot; id=&quot;msg&quot;/&gt;</span><br><span class="line"></span><br><span class="line">    &lt;br/&gt;</span><br><span class="line">    &lt;br/&gt;</span><br><span class="line"></span><br><span class="line">    &lt;button id=&quot;send&quot;&gt;发送&lt;/button&gt;</span><br><span class="line"></span><br><span class="line">&lt;/body&gt;</span><br><span class="line">&lt;/html&gt;</span><br><span class="line"></span><br><span class="line">&lt;script&gt;</span><br><span class="line">$(function()&#123;</span><br><span class="line"></span><br><span class="line">    var socket = io.connect(&#x27;http://127.0.0.1:8000&#x27;);</span><br><span class="line"></span><br><span class="line">    //群聊功能--聊天室</span><br><span class="line">    $(&#x27;#send&#x27;).click(function()&#123;</span><br><span class="line">        var msg=$(&#x27;#msg&#x27;).val();</span><br><span class="line"></span><br><span class="line">        socket.emit(&#x27;message&#x27;,msg);  /*客户端给服务器发送数据*/</span><br><span class="line"></span><br><span class="line">    &#125;)</span><br><span class="line">    //接受服务器返回的数据</span><br><span class="line">    socket.on(&#x27;servermessage&#x27;,function(data)&#123;</span><br><span class="line"></span><br><span class="line">        console.log(data)</span><br><span class="line">    &#125;)</span><br><span class="line"></span><br><span class="line">&#125;)</span><br><span class="line">&lt;/script&gt;</span><br><span class="line">// app.js</span><br><span class="line"></span><br><span class="line">var express=require(&#x27;express&#x27;);</span><br><span class="line"></span><br><span class="line">var app=express();</span><br><span class="line"></span><br><span class="line">/*第一步*/</span><br><span class="line">var server = require(&#x27;http&#x27;).Server(app);</span><br><span class="line">var io = require(&#x27;socket.io&#x27;)(server);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">app.set(&#x27;view engine&#x27;,&#x27;ejs&#x27;);</span><br><span class="line">app.use(express.static(&#x27;public&#x27;));</span><br><span class="line"></span><br><span class="line">app.get(&#x27;/&#x27;,function(req,res)&#123;</span><br><span class="line">    //res.send(&#x27;首页&#x27;);</span><br><span class="line">    res.render(&#x27;index&#x27;);</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">app.get(&#x27;/news&#x27;,function(req,res)&#123;</span><br><span class="line">    res.send(&#x27;news&#x27;);</span><br><span class="line"></span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line">//2.监听端口</span><br><span class="line">server.listen(8000,&#x27;127.0.0.1&#x27;);   /*改ip*/</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">//3、写socket的代码</span><br><span class="line"></span><br><span class="line">io.on(&#x27;connection&#x27;, function (socket) &#123;</span><br><span class="line">  console.log(&#x27;建立链接&#x27;)</span><br><span class="line"></span><br><span class="line">    socket.on(&#x27;message&#x27;,function(data)&#123;</span><br><span class="line"></span><br><span class="line">        console.log(data);</span><br><span class="line"></span><br><span class="line">        //io.emit  广播 --- 聊天室</span><br><span class="line">        //socket.emit  谁给我发的信息我回返回给谁 --- 智能机器人</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">        //io.emit(&#x27;servermessage&#x27;,data);   /*服务器给客户端发送数据*/</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">        if(data==1)&#123;</span><br><span class="line"></span><br><span class="line">            var msg=&#x27;您当前的话费有2元&#x27;</span><br><span class="line">        &#125;else if(data==2)&#123;</span><br><span class="line">            var msg=&#x27;您当前的流量有200M&#x27;</span><br><span class="line"></span><br><span class="line">        &#125;else&#123;</span><br><span class="line">            var msg=&#x27;请输入正确的信息&#x27;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        socket.emit(&#x27;servermessage&#x27;,msg);</span><br><span class="line"></span><br><span class="line">    &#125;)</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<blockquote>
<p><a target="_blank" rel="noopener" href="https://github.com/poetries/socket.io-demo/tree/master/express-socket-chat">完整代码</a></p>
</blockquote>
<h3 id="2-3-express结合socket-io及数据库实现智能机器人"><a href="#2-3-express结合socket-io及数据库实现智能机器人" class="headerlink" title="2.3 express结合socket.io及数据库实现智能机器人"></a>2.3 express结合<code>socket.io</code>及数据库实现智能机器人</h3><blockquote>
<p>跨域也可以访问<code>socket.io</code></p>
</blockquote>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br></pre></td><td class="code"><pre><span class="line">// app.js</span><br><span class="line"></span><br><span class="line">var express=require(&#x27;express&#x27;);</span><br><span class="line"></span><br><span class="line">var app=express();</span><br><span class="line"></span><br><span class="line">var DB=require(&#x27;./module/db.js&#x27;);</span><br><span class="line"></span><br><span class="line">/*第一步*/</span><br><span class="line">var server = require(&#x27;http&#x27;).Server(app);</span><br><span class="line">var io = require(&#x27;socket.io&#x27;)(server);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">app.set(&#x27;view engine&#x27;,&#x27;ejs&#x27;);</span><br><span class="line">app.use(express.static(&#x27;public&#x27;));</span><br><span class="line"></span><br><span class="line">app.get(&#x27;/&#x27;,function(req,res)&#123;</span><br><span class="line">    //res.send(&#x27;首页&#x27;);</span><br><span class="line">    res.render(&#x27;index&#x27;);</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">app.get(&#x27;/news&#x27;,function(req,res)&#123;</span><br><span class="line">    res.send(&#x27;news&#x27;);</span><br><span class="line"></span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line">//2.监听端口</span><br><span class="line">server.listen(8000,&#x27;127.0.0.1&#x27;, function () &#123;</span><br><span class="line">    console.log(&#x27;app run at 127.0.0.1:8000&#x27;)</span><br><span class="line">&#125;);   /*改ip*/</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">//3、写socket的代码</span><br><span class="line"></span><br><span class="line">io.on(&#x27;connection&#x27;, function (socket) &#123;</span><br><span class="line">    console.log(&#x27;建立链接&#x27;)</span><br><span class="line"></span><br><span class="line">    socket.on(&#x27;message&#x27;,function(data)&#123;</span><br><span class="line"></span><br><span class="line">        console.log(data)</span><br><span class="line">        //socket.emit(&#x27;servermessage&#x27;,msg);</span><br><span class="line"></span><br><span class="line">        var msg=data.msg||&#x27;&#x27;;  /*获取客户端的数据*/</span><br><span class="line"></span><br><span class="line">        //去服务器查询数据</span><br><span class="line"></span><br><span class="line">        DB.find(&#x27;article&#x27;,&#123;&#x27;title&#x27;:&#123;$regex:new RegExp(msg)&#125;&#125;,&#123;&#x27;title&#x27;:1&#125;,function(err,data)&#123;</span><br><span class="line"></span><br><span class="line">            console.log(data);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">            socket.emit(&#x27;servermessage&#x27;,&#123;</span><br><span class="line">                result:data</span><br><span class="line">            &#125;);</span><br><span class="line">        &#125;)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    &#125;)</span><br><span class="line">&#125;);</span><br><span class="line">&lt;!DOCTYPE&gt;</span><br><span class="line">&lt;html&gt;</span><br><span class="line">&lt;head&gt;</span><br><span class="line">    &lt;title&gt;&lt;/title&gt;</span><br><span class="line">    &lt;script</span><br><span class="line">  src=&quot;https://code.jquery.com/jquery-3.3.1.min.js&quot;</span><br><span class="line">  integrity=&quot;sha256-FgpCb/KJQlLNfOu91ta32o/NMZxltwRo8QtmkMRdAu8=&quot;</span><br><span class="line">  crossorigin=&quot;anonymous&quot;&gt;&lt;/script&gt;</span><br><span class="line"></span><br><span class="line">    &lt;script src=&quot;/socket.io/socket.io.js&quot;&gt;&lt;/script&gt;</span><br><span class="line">    &lt;style&gt;</span><br><span class="line"></span><br><span class="line">        .box&#123;</span><br><span class="line">            width: 300px;</span><br><span class="line">            height: 400px;</span><br><span class="line">            margin: 0 auto;</span><br><span class="line">            border: 1px solid #666;</span><br><span class="line">            margin-top:20px;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">        &#125;</span><br><span class="line">        .list&#123;</span><br><span class="line">            width: 300px;</span><br><span class="line">            height: 360px;</span><br><span class="line">            overflow-y: auto;</span><br><span class="line">        &#125;</span><br><span class="line">        .message&#123;</span><br><span class="line">            height: 40px;</span><br><span class="line">            line-height: 44px;</span><br><span class="line">            display: flex;</span><br><span class="line">        &#125;</span><br><span class="line">        .message input&#123;</span><br><span class="line"></span><br><span class="line">            border: 1px solid #666;</span><br><span class="line">        &#125;</span><br><span class="line">        .message input[type=&#x27;text&#x27;]&#123;</span><br><span class="line">            flex: 1;</span><br><span class="line">            height: 38px;</span><br><span class="line">        &#125;</span><br><span class="line">        .message input[type=&#x27;button&#x27;]&#123;</span><br><span class="line">            width: 100px;</span><br><span class="line">            height: 40px;</span><br><span class="line">            border: 1px solid #666;</span><br><span class="line">        &#125;</span><br><span class="line">    &lt;/style&gt;</span><br><span class="line">&lt;/head&gt;</span><br><span class="line">&lt;body&gt;</span><br><span class="line"></span><br><span class="line">    &lt;div class=&quot;box&quot;&gt;</span><br><span class="line">        &lt;div class=&quot;list&quot;&gt;</span><br><span class="line">            &lt;div id=&quot;list&quot;&gt;</span><br><span class="line">            &lt;/div&gt;</span><br><span class="line">            &lt;div class=&quot;footer&quot; id=&quot;footer&quot;&gt;</span><br><span class="line"></span><br><span class="line">            &lt;/div&gt;</span><br><span class="line">        &lt;/div&gt;</span><br><span class="line">        </span><br><span class="line">        &lt;div class=&quot;message&quot;&gt;</span><br><span class="line">            &lt;input type=&quot;text&quot; id=&quot;msg&quot; /&gt;</span><br><span class="line">            &lt;input type=&quot;button&quot; id=&quot;send&quot; value=&quot;发送&quot;/&gt;</span><br><span class="line">        &lt;/div&gt;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    &lt;/div&gt;</span><br><span class="line"></span><br><span class="line">&lt;/body&gt;</span><br><span class="line">&lt;/html&gt;</span><br><span class="line"></span><br><span class="line">&lt;script&gt;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    $(function()&#123;</span><br><span class="line"></span><br><span class="line">        var socket = io.connect(&#x27;http://127.0.0.1:8000&#x27;);</span><br><span class="line"></span><br><span class="line">        socket.on(&#x27;servermessage&#x27;,function(data)&#123;</span><br><span class="line"></span><br><span class="line">            if(data.result.length)</span><br><span class="line"></span><br><span class="line">            &#123;</span><br><span class="line">                var str=&#x27;&lt;ul&gt;&#x27;;</span><br><span class="line">                for(var i=0;i&lt;data.result.length;i++)&#123;</span><br><span class="line"></span><br><span class="line">                    str+=&#x27;&lt;li&gt;&#x27;+data.result[i].title+&#x27;&lt;/li&gt;&#x27;;</span><br><span class="line">                &#125;</span><br><span class="line">                str+=&#x27;&lt;/ul&gt;&#x27;;</span><br><span class="line">            &#125;else&#123;</span><br><span class="line"></span><br><span class="line">                var str=&#x27;&lt;p&gt;没有找到您要的数据，请联系人工客服&lt;/p&gt;&#x27;</span><br><span class="line">            &#125;</span><br><span class="line">            $(&#x27;#list&#x27;).append(str);</span><br><span class="line">            $(&#x27;#footer&#x27;).get(0).scrollIntoView();</span><br><span class="line"></span><br><span class="line">        &#125;)</span><br><span class="line"></span><br><span class="line">        var username=&#x27;zhangsan&#x27;+Math.floor(Math.random()*10);</span><br><span class="line"></span><br><span class="line">        //群聊功能--聊天室</span><br><span class="line">        $(&#x27;#send&#x27;).click(function()&#123;</span><br><span class="line">            var msg=$(&#x27;#msg&#x27;).val();</span><br><span class="line">            socket.emit(&#x27;message&#x27;,&#123;</span><br><span class="line">                &#x27;username&#x27;:username,</span><br><span class="line">                &#x27;msg&#x27;:msg</span><br><span class="line">            &#125;);</span><br><span class="line">            $(&#x27;#list&#x27;).append(`&lt;p&gt;&lt;strong&gt;$&#123;username&#125;:&lt;/strong&gt;  $&#123;msg&#125;&lt;/p&gt;`);</span><br><span class="line"></span><br><span class="line">            $(&#x27;#msg&#x27;).val();</span><br><span class="line"></span><br><span class="line">        &#125;)</span><br><span class="line">    &#125;)</span><br><span class="line">&lt;/script&gt;</span><br></pre></td></tr></table></figure>

<blockquote>
<p><a target="_blank" rel="noopener" href="https://github.com/poetries/socket.io-demo/tree/master/express-socket-chat-use-db">完整代码</a></p>
</blockquote>
<h2 id="三、Koa中Socket-io的使用"><a href="#三、Koa中Socket-io的使用" class="headerlink" title="三、Koa中Socket.io的使用"></a>三、Koa中Socket.io的使用</h2><p><strong>1. 服务端配置</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"># 1 安装</span><br><span class="line">cnpm i -S koa-socket</span><br><span class="line">// app.js</span><br><span class="line"></span><br><span class="line">// 2 引入</span><br><span class="line">const IO = require( &#x27;koa-socket&#x27; )</span><br><span class="line"></span><br><span class="line">// 3 实例化</span><br><span class="line">const io = new IO()</span><br><span class="line"></span><br><span class="line">io.attach( app )</span><br><span class="line"></span><br><span class="line">// 4 配置服务端</span><br><span class="line"></span><br><span class="line">app._io.on( &#x27;connection&#x27;, socket =&gt; &#123;</span><br><span class="line"></span><br><span class="line">console.log(&#x27;建立连接了&#x27;);</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>

<p><strong>2. 客户端代码</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&lt;script src=&quot;http://localhost:3000/socket.io/socket.io.js&quot;&gt;&lt;/script&gt;</span><br><span class="line">&lt;script&gt;</span><br><span class="line">   var socket=io.connect(&#x27;http://localhost:3000/&#x27;)</span><br><span class="line">&lt;/script&gt;</span><br></pre></td></tr></table></figure>

<blockquote>
<p><a target="_blank" rel="noopener" href="https://github.com/poetries/socket.io-demo/tree/master/koa-socket.io">完整代码</a></p>
</blockquote>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://example.com/2019/05/26/nodejs/nodejs-websocker%E4%B8%8Esocket.io%E7%9A%84%E5%8C%BA%E5%88%AB/" data-id="cl7icg76200r0ugunars4afj1" data-title="nodejs-websocker与socket.io的区别" class="article-share-link">Share</a>
      
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/nodejs/" rel="tag">nodejs</a></li></ul>

    </footer>
  </div>
  
</article>



  
    <article id="post-nodejs/node-基础篇" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2019/05/14/nodejs/node-%E5%9F%BA%E7%A1%80%E7%AF%87/" class="article-date">
  <time class="dt-published" datetime="2019-05-14T14:21:25.000Z" itemprop="datePublished">2019-05-14</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/%E5%90%8E%E7%AB%AF/">后端</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/2019/05/14/nodejs/node-%E5%9F%BA%E7%A1%80%E7%AF%87/">node-基础总结</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <h1 id="一、nodejs介绍"><a href="#一、nodejs介绍" class="headerlink" title="一、nodejs介绍"></a>一、nodejs介绍</h1><h2 id="1-1-简介"><a href="#1-1-简介" class="headerlink" title="1.1 简介"></a>1.1 简介</h2><ul>
<li><code>nodejs</code>是一个<code>JavaScript</code>运行环境。它让 <code>JavaScript</code> 可以开发后端程序，实现几乎其他后端语言实现的所有功能</li>
<li><code>Nodejs</code> 是基于 <code>V8</code> 引擎，<code>V8</code> 是 <code>Google</code> 发布的开源 <code>JavaScript</code> 引擎，本身就是用于 <code>Chrome</code> 浏览器 的 <code>JS</code> 解释部分， <code>V8</code> 搬到了服务器上，用于做服务器的软件</li>
<li>短短几年的时间，Node 取得了巨大的成功。在企业界，Node 的应用也越来越广泛，2016 年 nodeJS 官方的调查报告。2016 年全球有 350 万开发者使用 nodeJS,相比去年保持了 100%的增长率。像 Yahoo、 Microsoft 这样的大公司，有好多应用已经迁移到 Node 了。国内的阿里巴巴、网易、腾讯、新浪、百度等 公司的很多线上产品也纷纷改用 Node 开发，并取得了很好的效果。据统计很多 A 轮、 B 轮的创业公司更 喜欢使用 NodeJs 开发。</li>
</ul>
<blockquote>
<p><a target="_blank" rel="noopener" href="https://nodejs.org/static/documents/2016-survey-report.pdf">https://nodejs.org/static/documents/2016-survey-report.pdf</a></p>
</blockquote>
<h2 id="1-2-NodeJs-的优势"><a href="#1-2-NodeJs-的优势" class="headerlink" title="1.2 NodeJs 的优势"></a>1.2 NodeJs 的优势</h2><p><strong>1. NodeJs 语法完全是 js 语法，只要你懂 JS 基础就可以学会 Nodejs 后端开发</strong></p>
<blockquote>
<p>Node 打破了过去 JavaScript 只能在浏览器中运行的局面。前后端编程环境统一，可以大大降低开发成本</p>
</blockquote>
<p><strong>2. NodeJs 超强的高并发能力</strong></p>
<ul>
<li><code>Node.js</code> 的首要目标是提供一种简单的、用于创建高性能服务器及可在该服务器中运行的各种应用程 序的开发工具</li>
<li>首先让我们来看一下现在的服务器端语言中存在着什么问题。<br>在 <code>Java</code>、<code>PHP</code> 或者<code>.net</code> 等服务器端语言中，会为每一个客户端连接创建一个新的线程。而每个线程需要耗费大约 <code>2MB</code> 内存<br>理论上，一个 <code>8GB</code> 内存的服务器可以同时连接的最大用户数为 <code>4000</code> 个左右<br>。要让 <code>Web</code> 应用程序支持更多的用户，就 需要增加服务器的数量，而 <code>Web</code> 应用程序的硬件成本当然就上升了</li>
<li><code>Node.js</code> 不为每个客户连接创建一个新的线程，而仅仅使用一个线程。当有用户连接了，就触发一个 内部事件，通过非阻塞 <code>I/O</code>、事件驱动机制，让 <code>Node.js</code> 程序宏观上也是并行的。使用 <code>Node.js</code>，一个 <code>8GB</code> 内存的服务器，可以同时处理超过 <code>4 万</code>用户的连接</li>
</ul>
<p><strong>3. 实现高性能服务器</strong></p>
<ul>
<li>严格地说，<code>Node.js</code> 是一个用于开发各种 Web 服务器的开发工具。在 <code>Node.js</code> 服务器中，运行的是高性能 <code>V8 JavaScript</code> 脚本语言，该语言是一种可以运行在服务器端的 <code>JavaScript</code> 脚本语言</li>
<li>那么，什么是 <code>V8 JavaScript</code> 脚本语言呢?该语言是一种被 <code>V8 JavaScript</code> 引擎所解析并执行的脚本语言。<code>V8 JavaScript</code> 引擎是由 <code>Google</code> 公司使用 C++语言开发的一种高性能 <code>JavaScript</code> 引擎，该引擎并不局限于在浏览 器中运行。<code>Node.js</code> 将其转用在了服务器中，并且为其提供了许多附加的具有各种不同用途的 <code>API</code>。例如， 在一个服务器中，经常需要处理各种二进制数据。在 <code>JavaScript</code> 脚本语言中，只具有非常有限的对二进制数 据的处理能力，而 <code>Node.js</code> 所提供的 <code>Buffer</code> 类则提供了丰富的对二进制数据的处理能力</li>
<li>另外，在 <code>V8 JavaScript</code>引擎内部使用一种全新的编译技术。这意味着开发者编写的高端的 <code>JavaScript</code> 脚本代码与开发者编写的低端的C语言具有非常相近的执行效率，这也是<code>Node.js</code>服务器可以提供的一个重要特性</li>
</ul>
<p><strong>4. 开发周期短、开发成本低、学习成本低。</strong></p>
<ul>
<li><code>Node.js</code> 自身哲学，是花最小的硬件成本，追求更高的并发，更高的处理性能。</li>
<li>特点:<code>Node.js uses an event-driven, non-blocking I/O model that makes it lightweight and efficient.</code></li>
</ul>
<h2 id="1-3-NodeJs-适合做什么"><a href="#1-3-NodeJs-适合做什么" class="headerlink" title="1.3 NodeJs 适合做什么"></a>1.3 NodeJs 适合做什么</h2><blockquote>
<p>在短短几年多的时间里，<code>Node</code> 变得非常热门，使用者也非常多。这些使用者对于 <code>Node</code> 的各自倚重点也各部相同，经过整理,主要有下几类</p>
</blockquote>
<p><strong>1. 前后端编程语言环境统一</strong></p>
<blockquote>
<p>这类重点的代表是雅虎。雅虎开放了 <code>Cocktai</code> 框架，利用 自己深厚的前端沉淀，将 <code>YUI3</code> 这个前端框架的能力借助 <code>Node</code> 延伸到服务器端，使得使用 者摆脱了日常工作中一边写 <code>JavaScript</code> —边写 <code>PHP</code> 所帯来的上下文交换负担</p>
</blockquote>
<p><strong>2. Node 带来的高性能 I&#x2F;0 用于实时应用</strong></p>
<blockquote>
<p><code>Voxer</code> 将 <code>Node</code> 应用在实时语音上。国内腾讯的 朋友网将 Node 应用在长连接中，以提供实时功能，花瓣网、蘑菇街等公司通过 <code>socket.io</code> 实 现实时通知的功能。</p>
</blockquote>
<p><strong>3. 并行 I&#x2F;0 使得使用者可以更高效地利用分布式环境</strong></p>
<blockquote>
<p>阿里巴巴 eBay 是这方面的典型。 阿里巴巴的 NodeFox 和 eBay 的 ql.io 都是借用 Node 并行 I&#x2F;O 的能力，更高效地使用已有的 数据</p>
</blockquote>
<p><strong>4. 并行 I&#x2F;O •有效利用稳定接口提升 Web 渲染能力</strong></p>
<blockquote>
<p>雪球财经和 Linkedln 的移动版网站均 是这种案例，撇弃 同步等待式的顺序请求，大胆采用并行丨&#x2F;〇，加速数据的获取进而提升 Web 的渲染速度</p>
</blockquote>
<p><strong>5. 云计算平台提供 Node 支持</strong></p>
<blockquote>
<p>微软将 Node 引入 Azure 的开发中，阿里云、百度均纷纷 在云服务器上提供 Node 应用托管服务，Joyent 更是云计算中提供 Node 支持的代表。这类 平台看重 JavaScript 带来的开发上的优势，以及低资源占用、高性能的特点</p>
</blockquote>
<p><strong>6. 游戏开发领域</strong></p>
<blockquote>
<p>游戏领域对实时和并发有很高的要求，网易开源了 pomelo 实时框架， 可以应用在游戏和高实时应用中</p>
</blockquote>
<p><strong>7. 工具类应用</strong></p>
<blockquote>
<p>过去依赖 <code>java</code> 或其他语言构建的前端工具类应用，纷纷被一些前端工程 师用 <code>Node</code> 重写，用前端熟悉的语言为前端构建熟悉的工具</p>
</blockquote>
<h1 id="二、HTTP模块、URL模块-supervisor工具"><a href="#二、HTTP模块、URL模块-supervisor工具" class="headerlink" title="二、HTTP模块、URL模块 supervisor工具"></a>二、HTTP模块、URL模块 supervisor工具</h1><blockquote>
<p>用 <code>Node.js</code> 时，我们不仅仅在实现一个应用，同时还实现了整个 <code>HTTP</code> 服务器</p>
</blockquote>
<h2 id="2-1-创建一个简单的程序"><a href="#2-1-创建一个简单的程序" class="headerlink" title="2.1 创建一个简单的程序"></a>2.1 创建一个简单的程序</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">var http = require(&#x27;http&#x27;);</span><br><span class="line"></span><br><span class="line">http.createServer(function(request, response) &#123;</span><br><span class="line">    // 发送 HTTP 头部</span><br><span class="line">    // HTTP 状态值: 200 : OK</span><br><span class="line">    //设置 HTTP 头部，状态码是 200，文件类型是 html，字符集是 utf8 response.writeHead(200,&#123;&quot;Content-Type&quot;:&quot;text/html;charset=UTF-8&quot;&#125;);</span><br><span class="line">    // 发送响应数据 &quot;Hello World&quot;</span><br><span class="line">    res.end(&quot;哈哈哈哈，我买了一个 iPhone&quot; + (1 + 2 + 3) + &quot;s&quot;);</span><br><span class="line">&#125;).listen(8888);</span><br><span class="line">// 终端打印如下信息</span><br><span class="line">console.log(&#x27;Server running at http://127.0.0.1:8888/&#x27;);</span><br></pre></td></tr></table></figure>

<blockquote>
<p>你会发现，我们本地写一个 <code>js</code>，打死都不能直接拖入浏览器运行，但是有了 <code>node</code>，我 们任何一个 <code>js</code> 文件，都可以通过 <code>node</code> 来运行。也就是说，<code>node</code> 就是一个 <code>js</code> 的执行环境</p>
</blockquote>
<h2 id="2-2-HTTP-模块、URL模块"><a href="#2-2-HTTP-模块、URL模块" class="headerlink" title="2.2 HTTP 模块、URL模块"></a>2.2 HTTP 模块、URL模块</h2><blockquote>
<p><code>Node.js</code> 中，将很多的功能，划分为了一个个 <code>module</code>(模块)。 <code>Node.js</code> 中的很多功能都 是通过模块实现</p>
</blockquote>
<h3 id="2-2-1、HTTP-模块的使用"><a href="#2-2-1、HTTP-模块的使用" class="headerlink" title="2.2.1、HTTP 模块的使用"></a>2.2.1、HTTP 模块的使用</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">//引用模块</span><br><span class="line">var http = require(&quot;http&quot;);</span><br><span class="line">//创建一个服务器，回调函数表示接收到请求之后做的事情</span><br><span class="line">var server = http.createServer(function(req, res) &#123; //req 参数表示请求，res 表示响应</span><br><span class="line">    console.log(&quot;服务器接收到了请求&quot; + req.url);</span><br><span class="line">    res.end(); // End 方法使 Web 服务器停止处理脚本并返回当前结果</span><br><span class="line">&#125;);</span><br><span class="line">//监听端口</span><br><span class="line">server.listen(3000, &quot;127.0.0.1&quot;);</span><br></pre></td></tr></table></figure>

<p><strong>设置一个响应头</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">res.writeHead(200,&#123;&quot;Content-Type&quot;:&quot;text/html;charset=UTF8&quot;&#125;);</span><br></pre></td></tr></table></figure>

<p><img src="https://poetries1.gitee.io/img-repo/2019/10/356.png" alt="img"></p>
<ul>
<li>我们现在来看一下 <code>req</code> 里面能够使用的东西</li>
<li>最关键的就是 <code>req.url</code> 属性，表示用户的请求 <code>URL</code> 地址。所有的路由设计，都是通过 <code>req.url</code> 来实现的。</li>
<li>我们比较关心的不是拿到 <code>URL</code>，而是识别这个 <code>URL</code></li>
<li>识别 <code>URL</code>，用到了下面的 <code>URL</code> 模块</li>
</ul>
<h3 id="2-2-2、URL-模块的使用"><a href="#2-2-2、URL-模块的使用" class="headerlink" title="2.2.2、URL 模块的使用"></a>2.2.2、URL 模块的使用</h3><ul>
<li><code>url.parse()</code> 解析<code>URL</code></li>
<li><code>url.format(urlObject)</code> 是上面 <code>url.parse()</code> 操作的逆向操作</li>
<li><code>url.resolve(from, to)</code> 添加或者替换地址</li>
</ul>
<p><strong>1. url.parse()</strong></p>
<p><img src="https://poetries1.gitee.io/img-repo/2019/10/357.png" alt="img"></p>
<p><img src="https://poetries1.gitee.io/img-repo/2019/10/358.png" alt="img"></p>
<p><strong>2. url.format()</strong></p>
<p><img src="https://poetries1.gitee.io/img-repo/2019/10/359.png" alt="img"></p>
<p><strong>3. url.resolve()</strong></p>
<p><img src="https://poetries1.gitee.io/img-repo/2019/10/360.png" alt="img"></p>
<h2 id="2-3-Nodejs-自启动工具-supervisor"><a href="#2-3-Nodejs-自启动工具-supervisor" class="headerlink" title="2.3 Nodejs 自启动工具 supervisor"></a>2.3 Nodejs 自启动工具 supervisor</h2><blockquote>
<p><code>supervisor</code> 会不停的 <code>watch</code> 你应用下面的所有文件，发现有文件被修改，就重新载入程序文件这样就实现了部署，修改了程序文件后马上就能看到变更后的结果。麻麻再也不用担心我的重启 <code>nodejs</code> 了</p>
</blockquote>
<p><strong>首先安装 supervisor</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm install -g supervisor</span><br></pre></td></tr></table></figure>

<p><strong>使用 supervisor 代替 node 命令启动应用</strong></p>
<p><img src="https://poetries1.gitee.io/img-repo/2019/10/361.png" alt="img"></p>
<h1 id="三、CommonJs-和-Nodejs-模块"><a href="#三、CommonJs-和-Nodejs-模块" class="headerlink" title="三、CommonJs 和 Nodejs 模块"></a>三、CommonJs 和 Nodejs 模块</h1><h2 id="3-1-什么是-CommonJs"><a href="#3-1-什么是-CommonJs" class="headerlink" title="3.1 什么是 CommonJs"></a>3.1 什么是 CommonJs</h2><blockquote>
<p><code>JavaScript</code> 是一个强大面向对象语言，它有很多快速高效的解释器。然而， <code>JavaScript</code> 标准定义的 <code>API</code> 是为了构建基于浏览器的应用程序。并没有制定一个用于更广泛的应用程序 的标准库。<br>,而不只是停留在小脚本程序 的阶段。用 <code>CommonJS API</code> 编写出的应用，不仅可以利用 <code>JavaScript</code>开发客户端应用，而且还可以编写以下应 用</p>
</blockquote>
<ul>
<li>服务器端 <code>JavaScript</code> 应用程序。(<code>nodejs</code>)</li>
<li>命令行工具</li>
<li>桌面图形界面应用程序</li>
</ul>
<blockquote>
<p><code>CommonJS</code> 就是模块化的标准，<code>nodejs</code> 就是 <code>CommonJS</code>(模块化)的实现</p>
</blockquote>
<h2 id="3-2-Nodejs-中的模块化"><a href="#3-2-Nodejs-中的模块化" class="headerlink" title="3.2 Nodejs 中的模块化"></a>3.2 Nodejs 中的模块化</h2><blockquote>
<p><code>Node</code> 应用由模块组成，采用 <code>CommonJS</code> 模块规范</p>
</blockquote>
<h3 id="3-2-1-在-Node-中，模块分为两类"><a href="#3-2-1-在-Node-中，模块分为两类" class="headerlink" title="3.2.1 在 Node 中，模块分为两类"></a>3.2.1 在 Node 中，模块分为两类</h3><ul>
<li>一类是 <code>Node</code> 提供的模块,称为核心模块;另一类是用户编写的模块，称为文件模块</li>
</ul>
<blockquote>
<ul>
<li>核心模块部分在 <code>Node</code> 源代码的编译过程中，编译进了二进制执行文件。在 <code>Node</code> 进程启动时，部分核心模块就被直接加载进内存中，所以这部分核心模块引入时，文件定位和 编译执行这两个步骤可以省略掉，并且在路径分析中优先判断，所以它的加载速度是最快的。 如:<code>HTTP</code> 模块 、<code>URL</code> 模块、<code>Fs</code> 模块都是 <code>nodejs</code> 内置的核心模块，可以直接引入使用</li>
<li>文件模块则是在运行时动态加载，需要完整的路径分析、文件定位、编译执行过程、速度相比核心模块稍微慢一些，但是用的非常多。这些模块需要我们自己定义。接下来我 们看一下 <code>nodejs</code> 中的自定义模块。</li>
</ul>
</blockquote>
<h3 id="3-2-2-CommonJS-Nodejs-中自定义模块的规定"><a href="#3-2-2-CommonJS-Nodejs-中自定义模块的规定" class="headerlink" title="3.2.2 CommonJS(Nodejs)中自定义模块的规定"></a>3.2.2 CommonJS(Nodejs)中自定义模块的规定</h3><ol>
<li>我们可以把公共的功能抽离成为一个单独的 <code>js</code> 文件作为一个模块，默认情况下面这 个模块里面的方法或者属性，外面是没法访问的。如果要让外部可以访问模块里面的方法或 者属性，就必须在模块里面通过 <code>exports</code> 或者 <code>module.exports</code> 暴露属性或者方法</li>
<li>在需要使用这些模块的文件中，通过 <code>require</code> 的方式引入这个模块。这个时候就可以 使用模块里面暴露的属性和方法</li>
</ol>
<p><img src="https://poetries1.gitee.io/img-repo/2019/10/362.png" alt="img"></p>
<h3 id="3-2-3-定义使用模块"><a href="#3-2-3-定义使用模块" class="headerlink" title="3.2.3 定义使用模块"></a>3.2.3 定义使用模块</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">// 定义一个 tools.js 的模块 //模块定义</span><br><span class="line">var tools = &#123;</span><br><span class="line">    sayHello: function() &#123;</span><br><span class="line">        return &#x27;hello NodeJS&#x27;;</span><br><span class="line">    &#125;,</span><br><span class="line">    add: function(x, y) &#123;</span><br><span class="line">        return x + y;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br><span class="line">// 模块接口的暴露</span><br><span class="line">// module.exports = tools; exports.sayHello = tools.sayHello; exports.add = tools.add;</span><br><span class="line">var http = require(&#x27;http&#x27;);</span><br><span class="line">// 引入自定义的 tools.js 模块</span><br><span class="line">var tools = require(&#x27;./tools&#x27;);</span><br><span class="line"></span><br><span class="line">tools.sa yHello(); //使用模块</span><br></pre></td></tr></table></figure>

<h1 id="四、NPM第三方模块和package"><a href="#四、NPM第三方模块和package" class="headerlink" title="四、NPM第三方模块和package"></a>四、NPM第三方模块和package</h1><h2 id="4-1-包与-NPM"><a href="#4-1-包与-NPM" class="headerlink" title="4.1 包与 NPM"></a>4.1 包与 NPM</h2><h3 id="4-1-1-包"><a href="#4-1-1-包" class="headerlink" title="4.1.1 包"></a>4.1.1 包</h3><blockquote>
<p><code>Nodejs</code> 中除了它自己提供的核心模块外，我们可以自定义模块，也可以使用 第三方的模块。<code>Nodejs</code>中第三方模块由包组成，可以通过包来对一组具有相互依 赖关系的模块进行统一管理</p>
</blockquote>
<p><img src="https://poetries1.gitee.io/img-repo/2019/10/363.png" alt="img"></p>
<p><strong>完全符合 CommonJs 规范的包目录一般包含如下这些文件</strong></p>
<ul>
<li><code>package.json</code> :包描述文件</li>
<li><code>bin</code> :用于存放可执行二进制文件的目录</li>
<li><code>lib</code> :用于存放 <code>JavaScript</code> 代码的目录</li>
<li><code>doc</code> :用于存放文档的目录</li>
</ul>
<blockquote>
<p>在 <code>NodeJs</code> 中通过 <code>NPM</code> 命令来下载第三方的模块(包)</p>
</blockquote>
<h3 id="4-1-2-NPM-介绍"><a href="#4-1-2-NPM-介绍" class="headerlink" title="4.1.2 NPM 介绍"></a>4.1.2 NPM 介绍</h3><ul>
<li>npm 是世界上最大的开放源代码的生态系统。我们可以通过 npm 下载各种各样的包，<br>这些源代码(包)我们可以在 <a target="_blank" rel="noopener" href="https://www.npmjs.com/">https://www.npmjs.com</a> 找到</li>
</ul>
<blockquote>
<p><code>npm</code> 是随同 <code>NodeJS</code> 一起安装的包管理工具，能解决 <code>NodeJS</code> 代码部署上的很多问题，常见的使用场景有 以下几种</p>
</blockquote>
<ul>
<li>允许用户从 <code>NPM</code> 服务器下载别人编写的第三方包到本地使用</li>
<li>允许用户从 <code>NPM</code> 服务器下载并安装别人编写的命令行程序(工具)到本地使用</li>
<li>允许用户将自己编写的包或命令行程序上传到 <code>NPM</code> 服务器供别人使用</li>
</ul>
<p><strong>NPM 命令详解</strong></p>
<ul>
<li><code>npm -v</code> 查看 <code>npm</code> 版本</li>
<li><code>npm install</code> 使用 <code>npm</code> 命令安装模块</li>
<li><code>npm uninstall moudleName</code> 卸载模块</li>
<li><code>npm list</code> 查看当前目录下已安装的 <code>node</code> 包</li>
<li><code>npm info jquery</code> 查看 <code>jquery</code> 的版本</li>
<li>指定版本安装 <code>npm install jquery@1.8.0</code></li>
</ul>
<h2 id="4-2-package-json"><a href="#4-2-package-json" class="headerlink" title="4.2 package.json"></a>4.2 package.json</h2><blockquote>
<p><code>package.json</code> 定义了这个项目所需要的各种模块,以及项目的配置信息(比如名称、<br>版本、许可证等元数据)</p>
</blockquote>
<p><strong>1. 创建 package.json</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">npm init</span><br><span class="line">npm init –yes</span><br></pre></td></tr></table></figure>

<p><strong>2. 安装模块并把模块写入 package.json(依赖)</strong></p>
<ul>
<li><code>npm install babel-cli --save-dev</code></li>
<li><code>npm install 模块 --save</code></li>
</ul>
<p><strong>3. dependencies 与 devDependencies 之间的区别</strong></p>
<ul>
<li>使用 <code>npm install node_module –save</code> 自动更新 <code>dependencies</code> 字段值;</li>
<li>使用 <code>npm install node_module –save-dev</code> 自动更新 <code>devDependencies</code> 字段值</li>
<li><code>dependencies</code> 配置当前程序所依赖的其他</li>
<li><code>devDependencies</code> 配置当前程序所依赖的其他包，只会下载模块，而不下载这些模块的测试 和文档框架</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">&quot;dependencies&quot;: &#123;</span><br><span class="line">    &quot;ejs&quot;: &quot;^2.3.4&quot;,</span><br><span class="line">    &quot;express&quot;: &quot;^4.13.3&quot;,</span><br><span class="line">    &quot;formidable&quot;: &quot;^1.0.17&quot;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ul>
<li><code>^</code>表示第一位版本号不变，后面两位取最新的</li>
<li><code>~</code>表示前两位不变，最后一个取最新</li>
<li><code>*</code>表示全部取最新</li>
</ul>
<h2 id="4-3-安装淘宝镜像"><a href="#4-3-安装淘宝镜像" class="headerlink" title="4.3 安装淘宝镜像"></a>4.3 安装淘宝镜像</h2><ul>
<li><a target="_blank" rel="noopener" href="http://www.npmjs.org/">http://www.npmjs.org</a> npm 包官网</li>
<li><a target="_blank" rel="noopener" href="https://npm.taobao.org/">https://npm.taobao.org/</a> 淘宝 npm 镜像官网</li>
</ul>
<blockquote>
<p>淘宝 <code>NPM</code> 镜像是一个完整 <code>npmjs.org</code> 镜像，你可以用此代替官方版本(只读)，同步频 率目前为 10 分钟 一次以保证尽量与官方服务同步</p>
</blockquote>
<p>我们可以使用我们定制的 <code>cnpm</code> (<code>gzip</code> 压缩支持) 命令行工具代替默认的 <code>npm</code>:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm install -g cnpm --registry=https://registry.npm.taobao.org</span><br></pre></td></tr></table></figure>

<h1 id="五、fs模块"><a href="#五、fs模块" class="headerlink" title="五、fs模块"></a>五、fs模块</h1><h2 id="5-1-fs-stat-检测是文件还是目录"><a href="#5-1-fs-stat-检测是文件还是目录" class="headerlink" title="5.1 fs.stat 检测是文件还是目录"></a>5.1 fs.stat 检测是文件还是目录</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">const fs = require(&#x27;fs&#x27;)</span><br><span class="line"></span><br><span class="line">fs.stat(&#x27;hello.js&#x27;, (error, stats) = &gt;&#123;</span><br><span class="line">    if (error) &#123;</span><br><span class="line">        console.log(error)</span><br><span class="line">    &#125; else &#123;</span><br><span class="line">        console.log(stats) </span><br><span class="line">        </span><br><span class="line">        console.log(`文件: $ &#123;</span><br><span class="line">            stats.isFile()</span><br><span class="line">        &#125;`) </span><br><span class="line">        </span><br><span class="line">        console.log(`目录: $ &#123;</span><br><span class="line">            stats.isDirectory()</span><br><span class="line">        &#125;`)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>

<h2 id="5-2-fs-mkdir-创建目录"><a href="#5-2-fs-mkdir-创建目录" class="headerlink" title="5.2 fs.mkdir 创建目录"></a>5.2 fs.mkdir 创建目录</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">const fs = require(&#x27;fs&#x27;) </span><br><span class="line"></span><br><span class="line">fs.mkdir(&#x27;logs&#x27;, (error) = &gt;&#123;</span><br><span class="line">    if (error) &#123;</span><br><span class="line">        console.log(error)</span><br><span class="line">    &#125; else &#123;</span><br><span class="line">        console.log(&#x27;成功创 建目录:logs&#x27;)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>

<h2 id="5-3-fs-writeFile-创建写入文件"><a href="#5-3-fs-writeFile-创建写入文件" class="headerlink" title="5.3 fs.writeFile 创建写入文件"></a>5.3 fs.writeFile 创建写入文件</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">fs.writeFile(&#x27;logs/hello.log&#x27;, &#x27;您好 ~ \n&#x27;, (error) = &gt;&#123;</span><br><span class="line">    if (error) &#123;</span><br><span class="line">        console.log(error)</span><br><span class="line">    &#125; else &#123;</span><br><span class="line">        console.log(&#x27;成功写 入文件&#x27;)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>

<h2 id="5-4-fs-appendFile-追加文件"><a href="#5-4-fs-appendFile-追加文件" class="headerlink" title="5.4 fs.appendFile 追加文件"></a>5.4 fs.appendFile 追加文件</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">fs.appendFile(&#x27;logs/hello.log&#x27;, &#x27;hello ~ \n&#x27;, (error) = &gt;&#123;</span><br><span class="line">    if (error) &#123;</span><br><span class="line">        console.log(error)</span><br><span class="line">    &#125; else &#123;</span><br><span class="line">        console.log(&#x27;成功写 入文件&#x27;)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>

<h2 id="5-5-fs-readFile-读取文件"><a href="#5-5-fs-readFile-读取文件" class="headerlink" title="5.5 fs.readFile 读取文件"></a>5.5 fs.readFile 读取文件</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">const fs = require(&#x27;fs&#x27;) </span><br><span class="line"></span><br><span class="line">fs.readFile(&#x27;logs/hello.log&#x27;, &#x27;utf8&#x27;, (error, data) = &gt;&#123;</span><br><span class="line">    if (error) &#123;</span><br><span class="line">        console.log(error)</span><br><span class="line">    &#125; else &#123;</span><br><span class="line">        console.log(data)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>

<h2 id="5-6-fs-readdir-读取目录"><a href="#5-6-fs-readdir-读取目录" class="headerlink" title="5.6 fs.readdir 读取目录"></a>5.6 fs.readdir 读取目录</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">const fs = require(&#x27;fs&#x27;) </span><br><span class="line"></span><br><span class="line">fs.readdir(&#x27;logs&#x27;, (error, files) = &gt;&#123;</span><br><span class="line">    if (error) &#123;</span><br><span class="line">        console.log(error)</span><br><span class="line">    &#125; else &#123;</span><br><span class="line">        console.log(files)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>

<h2 id="5-7-fs-rename-重命名"><a href="#5-7-fs-rename-重命名" class="headerlink" title="5.7 fs.rename 重命名"></a>5.7 fs.rename 重命名</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">const fs = require(&#x27;fs&#x27;) </span><br><span class="line"></span><br><span class="line">fs.rename(&#x27;js/hello.log&#x27;, &#x27;js/greeting.log&#x27;, (error) = &gt;&#123;</span><br><span class="line">    if (error) &#123;</span><br><span class="line">        console.log(error)</span><br><span class="line">    &#125; else &#123;</span><br><span class="line">        console.log(&#x27; 重命名成功&#x27;)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>

<h2 id="5-8-fs-rmdir-删除目录"><a href="#5-8-fs-rmdir-删除目录" class="headerlink" title="5.8 fs.rmdir 删除目录"></a>5.8 fs.rmdir 删除目录</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">fs.rmdir(&#x27;logs&#x27;, (error) = &gt;&#123;</span><br><span class="line">    if (error) &#123;</span><br><span class="line">        console.log(error)</span><br><span class="line">    &#125; else &#123;</span><br><span class="line">        console.log(&#x27;成功的删除了目录:logs&#x27;)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>

<h2 id="5-9-fs-unlink-删除文件"><a href="#5-9-fs-unlink-删除文件" class="headerlink" title="5.9 fs.unlink 删除文件"></a>5.9 fs.unlink 删除文件</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">fs.unlink(`logs / $ &#123;</span><br><span class="line">    file</span><br><span class="line">&#125;`, (error) = &gt;&#123;</span><br><span class="line">    if (error) &#123;</span><br><span class="line">        console.log(error)</span><br><span class="line">    &#125; else &#123;</span><br><span class="line">        console.log(`成功的删除了文件: $ &#123;</span><br><span class="line">            file</span><br><span class="line">        &#125;`)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>

<h2 id="5-10-fs-createReadStream-从文件流中读取数据"><a href="#5-10-fs-createReadStream-从文件流中读取数据" class="headerlink" title="5.10 fs.createReadStream 从文件流中读取数据"></a>5.10 fs.createReadStream 从文件流中读取数据</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">const fs = require(&#x27;fs&#x27;) </span><br><span class="line"></span><br><span class="line">var fileReadStream = fs.createReadStream(&#x27;data.json&#x27;) </span><br><span class="line">let count = 0;</span><br><span class="line">var str = &#x27;&#x27;;</span><br><span class="line"></span><br><span class="line">fileReadStream.on(&#x27;data&#x27;, (chunk) = &gt;&#123;</span><br><span class="line">    console.log(`$ &#123;++count</span><br><span class="line">    &#125;接收到: $ &#123;</span><br><span class="line">        chunk.length</span><br><span class="line">    &#125;`);</span><br><span class="line">    str += chunk</span><br><span class="line">&#125;) </span><br><span class="line"></span><br><span class="line">fileReadStream.on(&#x27;end&#x27;, () = &gt;&#123;</span><br><span class="line">    console.log(&#x27;--- 结束 ---&#x27;);</span><br><span class="line">    console.log(coun t);</span><br><span class="line">    console.log(str);</span><br><span class="line">&#125;) </span><br><span class="line"></span><br><span class="line">fileReadStream.on(&#x27;error&#x27;, (error) = &gt;&#123;</span><br><span class="line">    console.log(error)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>

<h2 id="5-11-fs-createWriteStream-写入文件"><a href="#5-11-fs-createWriteStream-写入文件" class="headerlink" title="5.11 fs.createWriteStream 写入文件"></a>5.11 fs.createWriteStream 写入文件</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">var fs = require(&quot;fs&quot;);</span><br><span class="line">var data = &#x27;我是从数据库获取的数据，我要保存起来&#x27;;</span><br><span class="line">// 创建一个可以写入的流，写入到文件 output.txt 中</span><br><span class="line">var writerStream = fs.createWriteStream(&#x27;output.txt&#x27;); // 使用 utf8 编码写入数据</span><br><span class="line"></span><br><span class="line">writerStream.write(data, &#x27;UTF8&#x27;); // 标记文件末尾</span><br><span class="line">writerStream.end();</span><br><span class="line">// 处理流事件 --&gt; finish 事件</span><br><span class="line">writerStream.on(&#x27;finish&#x27;,</span><br><span class="line">function() &#123;</span><br><span class="line">    /*finish - 所有数据已被写入到底层系统时触发。*/</span><br><span class="line">    console.log(&quot;写入完 成。&quot;);</span><br><span class="line">&#125;);</span><br><span class="line">writerStream.on(&#x27;error&#x27;,</span><br><span class="line">function(err) &#123;</span><br><span class="line">    console.log(err.stack);</span><br><span class="line">&#125;);</span><br><span class="line">console.log(&quot;程序执 行完毕&quot;);</span><br></pre></td></tr></table></figure>

<h2 id="5-12-管道流"><a href="#5-12-管道流" class="headerlink" title="5.12 管道流"></a>5.12 管道流</h2><blockquote>
<p>管道提供了一个输出流到输入流的机制。通常我们用于从一个流中获取数据并将数据传递到另外一个流中。</p>
</blockquote>
<p><img src="https://poetries1.gitee.io/img-repo/2019/10/364.png" alt="img"></p>
<blockquote>
<p>如上面的图片所示，我们把文件比作装水的桶，而水就是文件里的内容 ，我们用一根管子(pipe )连接两个桶使得水从一个桶流入另一个桶，这样就慢慢的实现了大文件的复制过程。</p>
</blockquote>
<p>以下实例我们通过读取一个文件内容并将内容写入到另外一个文件中</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">var fs = require(&quot;fs&quot;);</span><br><span class="line">// 创建一个可读流</span><br><span class="line">var readerStream = fs.createReadStream(&#x27;input.txt&#x27;); // 创建一个可写流</span><br><span class="line">var writerStream = fs.createWriteStream(&#x27;output.txt&#x27;);</span><br><span class="line"></span><br><span class="line">// 管道读写操作</span><br><span class="line">// 读取 input.txt 文件内容，并将内容写入到 output.txt 文件中 </span><br><span class="line">readerStream.pipe(writerStream);</span><br><span class="line">console.log(&quot;程 序执行完毕&quot;);</span><br></pre></td></tr></table></figure>

<h1 id="六、创建一个-WEB-服务器"><a href="#六、创建一个-WEB-服务器" class="headerlink" title="六、创建一个 WEB 服务器"></a>六、创建一个 WEB 服务器</h1><blockquote>
<p>利用HTTP模块 URl模块 PATH模块 FS 模块创建一个 WEB 服务器</p>
</blockquote>
<p><strong>1. Node.js 创建的第一个应用</strong></p>
<blockquote>
<p>引入 http 模块</p>
</blockquote>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">var http = require(&quot;http&quot;);</span><br></pre></td></tr></table></figure>

<p><strong>2. 创建服务器</strong></p>
<blockquote>
<p>接下来我们使用 <code>http.createServer()</code> 方法创建服务器，并使用 <code>listen</code> 方法绑定 <code>8888</code> 端口。 函数通过 <code>request</code>, <code>response</code> 参数来接收和响应数据</p>
</blockquote>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">//1.引入 http 模块</span><br><span class="line">var http=require(&#x27;http&#x27;);</span><br><span class="line"></span><br><span class="line">//2.用 http 模块创建服务</span><br><span class="line">http.createServer(fun ction(req, res) &#123;</span><br><span class="line">    // 发送 HTTP 头部</span><br><span class="line">    // HTTP 状态值: 200 : OK</span><br><span class="line">    //设置 HTTP 头部，状态码是 200，文件类型是 html，字符集是 utf-8</span><br><span class="line">    res.writeHead(200, &#123;</span><br><span class="line">        &quot;Content-Type&quot;: &quot;text/html;charset=&#x27;utf-8&#x27;&quot;</span><br><span class="line">    &#125;);</span><br><span class="line">    res.write(&#x27;你好 nodejs&#x27;);</span><br><span class="line">    res.write(&#x27;我是第一个 nodejs 程序&#x27;);</span><br><span class="line">    res.end();</span><br><span class="line">    /*结束响应*/</span><br><span class="line">&#125;).listen(8001);</span><br></pre></td></tr></table></figure>

<p><strong>3. WEB 服务器介绍</strong></p>
<blockquote>
<p>Web 服务器一般指网站服务器，是指驻留于因特网上某种类型计算机的程序，可以向浏览 器等 Web 客户端提供文档，也可以放置网站文件，让全世界浏览;可以放置数据文件，让 全世界下载。目前最主流的三个 Web 服务器是 Apache Nginx IIS。</p>
</blockquote>
<h1 id="七、Nodejs-的非阻塞-I-x2F-O、异步、事件驱动"><a href="#七、Nodejs-的非阻塞-I-x2F-O、异步、事件驱动" class="headerlink" title="七、Nodejs 的非阻塞 I&#x2F;O、异步、事件驱动"></a>七、Nodejs 的非阻塞 I&#x2F;O、异步、事件驱动</h1><h2 id="7-1-Nodejs的单线程-非阻塞I-x2F-O事件驱动"><a href="#7-1-Nodejs的单线程-非阻塞I-x2F-O事件驱动" class="headerlink" title="7.1 Nodejs的单线程 非阻塞I&#x2F;O事件驱动"></a>7.1 Nodejs的单线程 非阻塞I&#x2F;O事件驱动</h2><ul>
<li>在 Java、PHP 或者.net 等服务器端语言中，会为每一个客户端连接创建一个新的线程。 而每个线程需要耗费大约 2MB 内存。也就是说，理论上，一个 8GB 内存的服务器可以同时 连接的最大用户数为 4000 个左右。要让 Web 应用程序支持更多的用户，就需要增加服务器 的数量，而 Web 应用程序的硬件成本当然就上升了</li>
<li>Node.js 不为每个客户连接创建一个新的线程，而仅仅使用一个线程。当有用户连接了， 就触发一个内部事件，通过非阻塞 I&#x2F;O、事件驱动机制，让 Node.js 程序宏观上也是并行的。 使用 Node.js，一个 8GB 内存的服务器，可以同时处理超过 4 万用户的连接。</li>
</ul>
<h2 id="7-2-Nodejs-回调处理异步"><a href="#7-2-Nodejs-回调处理异步" class="headerlink" title="7.2 Nodejs 回调处理异步"></a>7.2 Nodejs 回调处理异步</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">//错误的写法:</span><br><span class="line">function getData()&#123; </span><br><span class="line">    //模拟请求数据 </span><br><span class="line">    var result=&#x27;&#x27;;</span><br><span class="line">    setTimeout(functio n ()&#123; </span><br><span class="line">        result=&#x27;这是请求到的 数据&#x27;</span><br><span class="line">    &#125;,200);</span><br><span class="line">    </span><br><span class="line">    return result; </span><br><span class="line">&#125;</span><br><span class="line">console .log(getData());/*异步导致请求不到数据*/</span><br><span class="line">//正确的处理异步:</span><br><span class="line">function getData(callback) &#123; //模拟请求数据</span><br><span class="line">    var result = &#x27;&#x27;;</span><br><span class="line">    setTimeout(function() &#123;</span><br><span class="line">        result = &#x27;这是请求到的 数据&#x27;;</span><br><span class="line">        callback(result);</span><br><span class="line">    &#125;,</span><br><span class="line">    200);</span><br><span class="line">&#125;</span><br><span class="line">getData(function(data) &#123;</span><br><span class="line">    console.log(data);</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>

<h2 id="7-3-Nodejs-events-模块处理异步"><a href="#7-3-Nodejs-events-模块处理异步" class="headerlink" title="7.3 Nodejs events 模块处理异步"></a>7.3 Nodejs events 模块处理异步</h2><blockquote>
<p><code>Node.js</code> 有多个内置的事件，我们可以通过引入 <code>events</code> 模块，并通过实例化 <code>EventEmitter</code> 类来绑定和监听事件。</p>
</blockquote>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">// 引入 events 模块</span><br><span class="line">var events = require(&#x27;events&#x27;);</span><br><span class="line">var Even tEmitter =new event s .EventEmitter() ; /*实例化事件对象*/</span><br><span class="line">EventEmitter.on(&#x27;toparent&#x27;,function()&#123; console.log(&#x27;接收到了广播事件&#x27;);</span><br><span class="line">&#125;)</span><br><span class="line">setTimeout(function ()&#123;</span><br><span class="line">    console.log(&#x27;广播&#x27;);</span><br><span class="line">    EventEmitter.emit(&#x27;toparent&#x27; ); /*发送广播*/ </span><br><span class="line">&#125;,1000)</span><br></pre></td></tr></table></figure>

<h1 id="八、静态文件托管-GET-POST路由EJS模板引擎"><a href="#八、静态文件托管-GET-POST路由EJS模板引擎" class="headerlink" title="八、静态文件托管 GET POST路由EJS模板引擎"></a>八、静态文件托管 GET POST路由EJS模板引擎</h1><h2 id="8-1-路由"><a href="#8-1-路由" class="headerlink" title="8.1 路由"></a>8.1 路由</h2><blockquote>
<p>路由指的就是针对不同请求的 URL，处理不同的业务逻辑。</p>
</blockquote>
<p><img src="https://poetries1.gitee.io/img-repo/2019/10/365.png" alt="img"></p>
<h2 id="8-2-初识-EJS-模块引擎"><a href="#8-2-初识-EJS-模块引擎" class="headerlink" title="8.2 初识 EJS 模块引擎"></a>8.2 初识 EJS 模块引擎</h2><blockquote>
<p>我们学的 EJS 是后台模板，可以把我们数据库和文件读取的数据显示到 Html 页面上面。它 是一个第三方模块，需要通过 npm 安装</p>
</blockquote>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm install ejs –save / cnpm install ejs --save</span><br></pre></td></tr></table></figure>

<blockquote>
<p>Nodejs 中使用:</p>
</blockquote>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">ejs.renderFile(filename, data, options, function(err, str)&#123;</span><br><span class="line">// str =&gt; Rendered HTML string</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<p><strong>EJS 常用标签</strong></p>
<ul>
<li><code>&lt;%%&gt;</code>流程控制标签</li>
<li><code>&lt;%=%&gt;</code>输出标签(原文输出HTML标签)</li>
<li><code>&lt;%-%&gt;</code>输出标签(HTML会被浏览器解析)</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">&lt;a href=&quot;&lt;%= url %&gt;&quot;&gt;&lt;img src=&quot;&lt;%= imageURL %&gt;&quot; alt=&quot;&quot;&gt;&lt;/a&gt;&lt;ul&gt;</span><br><span class="line">&lt;html&gt;</span><br><span class="line"> &lt;head&gt;&lt;/head&gt;</span><br><span class="line"> &lt;body&gt;</span><br><span class="line">  &lt;ul&gt;</span><br><span class="line">    &amp;lt;% for(var i = 0 ; i &amp;lt; news.length ; i++)&#123; %&amp;gt; </span><br><span class="line">   &lt;li&gt;&amp;lt;%= news[i] %&amp;gt;&lt;/li&gt; &amp;lt;% &#125; %&amp;gt; </span><br><span class="line">  &lt;/ul&gt;</span><br><span class="line"> &lt;/body&gt;</span><br><span class="line">&lt;/html&gt;</span><br></pre></td></tr></table></figure>

<h2 id="8-3-Get、Post"><a href="#8-3-Get、Post" class="headerlink" title="8.3 Get、Post"></a>8.3 Get、Post</h2><ul>
<li>超文本传输协议(HTTP)的设计目的是保证客户端机器与服务器之间的通信</li>
<li>在客户端和服务器之间进行请求-响应时，两种最常被用到的方法是:GET 和 POST<ul>
<li>GET - 从指定的资源请求数据。(一般用于获取数据)</li>
<li>POST - 向指定的资源提交要被处理的数据。(一般用于提交数据)</li>
</ul>
</li>
</ul>
<p><strong>获取 GET 传值:</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">var urlinfo=url.parse(req.url,true); </span><br><span class="line">urlinfo.query();</span><br></pre></td></tr></table></figure>

<p><strong>获取 POST 传值:</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">var postData = &#x27;&#x27;; </span><br><span class="line"></span><br><span class="line">// 数据块接收中</span><br><span class="line">req.on(&#x27;data&#x27;,</span><br><span class="line">function(postDataChunk) &#123;</span><br><span class="line">    postData += postDataChunk;</span><br><span class="line">&#125;);</span><br><span class="line">// 数据接收完毕，执行回调函数</span><br><span class="line">req.on(&#x27;end&#x27;,</span><br><span class="line">function() &#123;</span><br><span class="line">    try &#123;</span><br><span class="line">        postData = JSON.parse(postData);</span><br><span class="line">    &#125; catch(e) &#123;&#125;</span><br><span class="line">    req.query = postData;</span><br><span class="line">    console.log(q uerystring.parse(postData));</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<h1 id="九、MongoDb-数据库介绍、安装、使用"><a href="#九、MongoDb-数据库介绍、安装、使用" class="headerlink" title="九、MongoDb 数据库介绍、安装、使用"></a>九、MongoDb 数据库介绍、安装、使用</h1><h2 id="9-1-数据库和文件的主要区别"><a href="#9-1-数据库和文件的主要区别" class="headerlink" title="9.1 数据库和文件的主要区别"></a>9.1 数据库和文件的主要区别</h2><ul>
<li>数据库有数据库表、行和列的概念，让我们存储操作数据更方便</li>
<li>数据库提供了非常方便的接口，可以让 <code>nodejs</code>、<code>php</code> <code>java</code> <code>.net</code> 很方便的实现增加修改删除功能</li>
</ul>
<h2 id="9-2-NoSql-介绍"><a href="#9-2-NoSql-介绍" class="headerlink" title="9.2 NoSql 介绍"></a>9.2 NoSql 介绍</h2><h3 id="9-2-1-NoSQL-介绍"><a href="#9-2-1-NoSQL-介绍" class="headerlink" title="9.2.1 NoSQL 介绍"></a>9.2.1 NoSQL 介绍</h3><ul>
<li>由于互联网的迅速发展，云计算与 Web2.0。这样大量的交互给数据库提出了更高的性能要<br>求，传统的数据库(本文泛指 SQL 数据库)，即关系数据库虽然具备良好的事物管理，<br>但在 处理大量数据 的应用 时很难 在性能 上满足 设计要 求。NoSQL 就是主要为了解决当下大量高并发高要求的数据 库应用 需求，关系数 据库 具有严 格的参 照性，一致性 ，可用 性，原子性 ，隔离 性等特 点</li>
<li>因此会产生一些例如表连接等操作，这样会大大降低系统的性能。而在当前很多应用场景下对性能的要求 远远强 于传统 数据库 关注的 点，<code>NoSQL</code>就是为了解决大规模数据与多样数 据种类 等问题，尤其是其中大数据的相关问题。</li>
<li><code>NoSQL</code>(<code>NoSQL = Not Only SQL</code> )，意即“不仅仅是 SQL”，它指的是非关系型的数据库，是以 <code>key-value</code><br>形式存储，和传统的关系型数据库不一样，不一定遵循传统数据库的一些基本要求，比如说遵循SQL 标准ACID 属性、表结构等等。<code>NoSQL</code> 最早被提出是在 20 世纪 80 年代，在当时更多是强调的是与关系数据库区 别对待 ，最近这些年被提及的更多是强调协助解决大数据等相关问题。<code>NoSQL</code> 在大数据时代有自己的意义</li>
</ul>
<h3 id="9-2-2-NoSQL-应用情况介绍"><a href="#9-2-2-NoSQL-应用情况介绍" class="headerlink" title="9.2.2 NoSQL 应用情况介绍"></a>9.2.2 NoSQL 应用情况介绍</h3><blockquote>
<p>国内的互联网蓬勃发展，不仅涌现出 BAT(百度，阿里巴巴，腾讯)之类的巨头，也带动了整个互联 网行业的发展，大量的创业型公司如春笋般的涌出，在国家层面也提出了“互联网+”和“万众创业”的口 号。更多传统的行业也开始拥抱互联网。但是无论是做所谓的生态平台还是 传统业务的转型，涉及到的业务是多种多样的。这个时候企业架构师对于应用系统的核心——数据库管理 不仅有传统的 SQL 选项也有了 NoSQL这种适合特定场景需求的选项</p>
</blockquote>
<p><strong>NoSQL 数据库在以下的这几种情况下比较适用</strong></p>
<ul>
<li>数据模型比较简单</li>
<li>需要灵活性更强的 IT 系统</li>
<li>对数据库性能要求较高</li>
<li>不需要高度的数据一致性</li>
<li>对于给定 key，比较容易映射复杂值的环境</li>
</ul>
<p><strong>NoSQL 发展现状</strong></p>
<ul>
<li>国外: Google 的 BigTable 和 Amazon 的 Dynamo 使用的就是 NoSQL 型数据库。</li>
<li>国内:百度、阿里、腾讯、新浪微博、视觉中国、优酷运营数据分析、飞信空间、豆瓣社区等</li>
</ul>
<h2 id="9-3-什么时候建议使用-NoSql"><a href="#9-3-什么时候建议使用-NoSql" class="headerlink" title="9.3 什么时候建议使用 NoSql"></a>9.3 什么时候建议使用 NoSql</h2><ul>
<li>对数据库高并发读写的需求</li>
<li>对海量数据的高效率存储和访问的需求</li>
<li>对数据库的高可扩展性和高可用性的需求</li>
</ul>
<h2 id="9-4-NoSql-和传统数据库简单对比"><a href="#9-4-NoSql-和传统数据库简单对比" class="headerlink" title="9.4 NoSql 和传统数据库简单对比"></a>9.4 NoSql 和传统数据库简单对比</h2><ul>
<li>非结构型数据库。没有行、列的概念。用 JSON 来存储数据。</li>
<li>集合就相当于“表 ”，文档就相当于“行”。</li>
</ul>
<p><img src="https://poetries1.gitee.io/img-repo/2019/10/366.png" alt="img"></p>
<h2 id="9-5-NoSql-种类"><a href="#9-5-NoSql-种类" class="headerlink" title="9.5 NoSql 种类"></a>9.5 NoSql 种类</h2><p><img src="https://poetries1.gitee.io/img-repo/2019/10/367.png" alt="img"></p>
<h2 id="9-6-MongoDb-介绍"><a href="#9-6-MongoDb-介绍" class="headerlink" title="9.6 MongoDb 介绍"></a>9.6 MongoDb 介绍</h2><blockquote>
<p>MongoDB 是一个介于关系数据库和非关系数据库之间的产品，是非关系数据库当中功能最丰富，最像 关系数据库的。他支持的数据结构非常松散，是类似 json 的 bson 格式，因此可以存储比较复杂的数据类 型。Mongo 最大的特点是他支持的查询语言非常强大，其语法有点类似于面向对象的查询语言，几乎可以 实现类似关系数据库单表查询的绝大部分功能，而且还支持对数据建立索引。它的特点是高 性能 、易部署 、 易使用 ，存储数据非常 方便</p>
</blockquote>
<h2 id="9-7-MongoDb-安装"><a href="#9-7-MongoDb-安装" class="headerlink" title="9.7 MongoDb 安装"></a>9.7 MongoDb 安装</h2><ul>
<li>官网:<a target="_blank" rel="noopener" href="https://www.mongodb.com/">https://www.mongodb.com/</a></li>
<li>手册:<a target="_blank" rel="noopener" href="https://docs.mongodb.org/manual/">https://docs.mongodb.org/manual/</a></li>
</ul>
<p><strong>1. 双击 MongoDB 软件下一步下一步安装</strong></p>
<p><img src="https://poetries1.gitee.io/img-repo/2019/10/368.png" alt="img"></p>
<p><strong>2. 安装完成配置环境变量 C:\Program Files\MongoDB\Server\3.0\bin 加入到系统的path 环境变量中</strong></p>
<p><strong>3. 打开 cmd 输入 :mongo命令看看是否成功。如果出来下图说明 mongodb配置成功。</strong></p>
<p><img src="https://poetries1.gitee.io/img-repo/2019/10/369.png" alt="img"></p>
<h2 id="9-8-使用-MongoDb"><a href="#9-8-使用-MongoDb" class="headerlink" title="9.8 使用 MongoDb"></a>9.8 使用 MongoDb</h2><ol>
<li>新建一个存放数据库的文件夹，注意:不能有中文和空格，建议不要放在 C 盘</li>
<li>启动 MongoDb 服务</li>
</ol>
<blockquote>
<p>服务端:<code>mongod</code> 开启数据库服务 <code>mongod --dbpath C:\mongodb</code></p>
</blockquote>
<p><strong>开启 MongoDb 服务命令:</strong></p>
<p><img src="https://poetries1.gitee.io/img-repo/2019/10/370.png" alt="img"></p>
<ul>
<li><code>--dbpath</code> 就是选择数据库文档所在的文件夹</li>
<li>也就是说，<code>mongoDB</code> 中，真的有物理文件，对应一个个数据库。U 盘可以拷走。</li>
<li>注意:一定要保持，开机这个 CMD 不能动了，不能关，不能 <code>ctrl+c</code>。 一旦这个 <code>cmd</code> 有问题了，数据库就自动关闭了</li>
</ul>
<ol>
<li>客户端输入 <code>mongo</code> 命令连接服务端</li>
</ol>
<blockquote>
<p>客户端:<code>mongo</code> 使用数据库</p>
</blockquote>
<p><img src="https://poetries1.gitee.io/img-repo/2019/10/371.png" alt="img"></p>
<blockquote>
<p>客户端:<code>mongo</code> 使用数据库 <code>ip</code> 地址:端口号</p>
</blockquote>
<p><img src="https://poetries1.gitee.io/img-repo/2019/10/372.png" alt="img"></p>
<h1 id="十、MongoDB-数据库创建删除、表（集合）创建删除、数据增删改查"><a href="#十、MongoDB-数据库创建删除、表（集合）创建删除、数据增删改查" class="headerlink" title="十、MongoDB 数据库创建删除、表（集合）创建删除、数据增删改查"></a>十、MongoDB 数据库创建删除、表（集合）创建删除、数据增删改查</h1><h2 id="10-1-数据库使用"><a href="#10-1-数据库使用" class="headerlink" title="10.1 数据库使用"></a>10.1 数据库使用</h2><blockquote>
<p>开启 <code>mongodb</code> 服务:要管理数据库，必须先开启服务，开启服务使用 <code>mongod --dbpath c:\mongodb</code></p>
</blockquote>
<p><img src="https://poetries1.gitee.io/img-repo/2019/10/373.png" alt="img"></p>
<blockquote>
<p>管理 <code>mongodb</code> 数据库:<code>mongo</code> (一定要在新的 <code>cmd</code> 中输入)</p>
</blockquote>
<p><img src="https://poetries1.gitee.io/img-repo/2019/10/374.png" alt="img"></p>
<blockquote>
<p>查看所有数据库列 表</p>
</blockquote>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">show dbs</span><br></pre></td></tr></table></figure>

<h2 id="10-2-创建数据库"><a href="#10-2-创建数据库" class="headerlink" title="10.2 创建数据库"></a>10.2 创建数据库</h2><p><img src="https://poetries1.gitee.io/img-repo/2019/10/375.png" alt="img"></p>
<p><strong>使用数据库、创建 数据库</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">use student</span><br></pre></td></tr></table></figure>

<ul>
<li>如果真的想把这个数据库创建成功，那么必须插入一个数据</li>
<li>数据库中不能直接插入数据，只能往集合(collectio ns)中插入数 据。不需要专门创建集合，只需要写点语法插入数据就会创建集合:</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">db.student.insert(&#123;“name”:”x iaom ing”&#125;);</span><br></pre></td></tr></table></figure>

<ul>
<li>db.student 系统发现 student 是一个陌生的集合名字，所以就自动创建了集合</li>
</ul>
<p><strong>显示当前的数据集合(mysql 中叫表)</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">show collections</span><br></pre></td></tr></table></figure>

<p><strong>删除数据库，删除当前所在的数据库</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">db.dropDatabase();</span><br></pre></td></tr></table></figure>

<p><strong>删除集合，删除指定的集合删除表</strong></p>
<blockquote>
<p>删除集合</p>
</blockquote>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">db.COLLECTION_NAME.drop()</span><br><span class="line"></span><br><span class="line">db.user.drop()</span><br></pre></td></tr></table></figure>

<h2 id="10-3-插入-增加-数据"><a href="#10-3-插入-增加-数据" class="headerlink" title="10.3 插入(增加)数据"></a>10.3 插入(增加)数据</h2><blockquote>
<p>插入数据，随着数据的插入，数据库创建成功了，集合也创建成功了。</p>
</blockquote>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">db.表名.insert(&#123;&quot;name&quot;:&quot;zhangsan&quot;&#125;);</span><br><span class="line"></span><br><span class="line">student 集合名称(表)</span><br></pre></td></tr></table></figure>

<h2 id="10-4-查找数据"><a href="#10-4-查找数据" class="headerlink" title="10.4 查找数据"></a>10.4 查找数据</h2><p><strong>1. 查询所有记 录</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">db.userInfo.find();</span><br></pre></td></tr></table></figure>

<blockquote>
<p>相当于:<code>select* from userInfo;</code></p>
</blockquote>
<p><strong>2. 查询去掉后 的当前聚集集合中的某列的重复数据</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">db.userInfo.distinct(&quot;name&quot;);</span><br></pre></td></tr></table></figure>

<ul>
<li>会过滤掉 <code>name</code> 中的相同数据</li>
<li>相当于:<code>select distict name from userInfo;</code></li>
</ul>
<p><strong>3. 查询 age &#x3D; 22 的记录</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">db.userInfo.find(&#123;&quot;age&quot;: 22&#125;);</span><br></pre></td></tr></table></figure>

<blockquote>
<p>相当于: <code>select * from userInfo where age = 22;</code></p>
</blockquote>
<p><strong>4. 查询 age &gt; 22 的记录</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">db.userInfo.find(&#123;age: &#123;$gt: 22&#125;&#125;);</span><br></pre></td></tr></table></figure>

<blockquote>
<p>相当于:<code>select * from userInfo where age &gt;22;</code></p>
</blockquote>
<p><strong>5. 查询 age &lt; 22 的记录</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">db.userInfo.find(&#123;age: &#123;$lt: 22&#125;&#125;);</span><br></pre></td></tr></table></figure>

<blockquote>
<p>相当于:<code>select * from userInfo where age &lt;22;</code></p>
</blockquote>
<p><strong>6. 查询 age &gt;&#x3D; 25 的记录</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">db.userInfo.find(&#123;age: &#123;$gte: 25&#125;&#125;);</span><br></pre></td></tr></table></figure>

<blockquote>
<p>相当于:<code>select * from userInfo where age &gt;= 25;</code></p>
</blockquote>
<p><strong>7. 查询 age &lt;&#x3D; 25 的记录</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">db.userInfo.find(&#123;age: &#123;$lte: 25&#125;&#125;);</span><br></pre></td></tr></table></figure>

<p><strong>8. 查询 age &gt;&#x3D; 23 并且 age &lt;&#x3D; 26</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">db.userInfo.find(&#123;age: &#123;$gte: 23, $lte: 26&#125;&#125;);</span><br></pre></td></tr></table></figure>

<p><strong>9. 查询name中包含 mongo的数据,模糊查询用于搜索</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">db.userInfo.find(&#123;name: /mongo/&#125;);</span><br><span class="line">//相当于%%</span><br><span class="line">select * from userInfo where name like ‘%mongo%’;</span><br></pre></td></tr></table></figure>

<p><strong>10. 查询 name 中以 mongo 开头的</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">db.userInfo.find(&#123;name: /^mongo/&#125;);</span><br></pre></td></tr></table></figure>

<blockquote>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">select * from userInfo where name like ‘mongo%’;</span><br></pre></td></tr></table></figure>
</blockquote>
<p><strong>11. 查询指定列 name、age 数据</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">db.userInfo.find(&#123;&#125;, &#123;name: 1, age: 1&#125;);</span><br></pre></td></tr></table></figure>

<blockquote>
<p>相当于:<code>select name, age from userInfo;</code></p>
</blockquote>
<blockquote>
<p>当然 <code>name</code> 也可以用 <code>true</code> 或 <code>false</code>,当用 <code>ture</code> 的情况下河 <code>name:1</code> 效果一样，如果用 <code>false</code> 就 是排除 <code>name</code>，显示 <code>name</code> 以外的列信息</p>
</blockquote>
<p><strong>12. 查询指定列 name、age 数据, age &gt; 25</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">db.userInfo.find(&#123;age: &#123;$gt: 25&#125;&#125;, &#123;name: 1, age: 1&#125;);</span><br></pre></td></tr></table></figure>

<blockquote>
<p>相当于:<code>select name, age from userInfo where age &gt;25;</code></p>
</blockquote>
<p><strong>13. 按照年龄排序 1 升序 -1 降序</strong></p>
<ul>
<li>升序:<code>db.userInfo.find().sort(&#123;age: 1&#125;);</code></li>
<li>降序:<code>db.userInfo.find().sort(&#123;age: -1&#125;);</code></li>
</ul>
<p><strong>14. 查询 name &#x3D; zhangsan, age &#x3D; 22 的数据</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">db.userInfo.find(&#123;name: &#x27;zhangsan&#x27;, age: 22&#125;);</span><br></pre></td></tr></table></figure>

<blockquote>
<p>相当于:<code>select * from userInfo where name = ‘zhangsan’ and age = ‘22’;</code></p>
</blockquote>
<p><strong>15. 查询前 5 条数据</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">db.userInfo.find().limit(5 );</span><br></pre></td></tr></table></figure>

<blockquote>
<p>相当于:<code>selecttop 5 * from userInfo;</code></p>
</blockquote>
<p><strong>16. 查询 10 条以后的数据</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">db.userInfo.find().skip(10);</span><br><span class="line">// 相当于:</span><br><span class="line">select * from userInfo where id not in ( </span><br><span class="line">    selecttop 10 * from userInfo</span><br><span class="line">);</span><br></pre></td></tr></table></figure>

<p><strong>17. 查询在 5-10 之间的数据</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">db.userInfo.find().limit (10).skip(5);</span><br></pre></td></tr></table></figure>

<blockquote>
<p>可用于分页，<code>limit</code> 是 <code>pageSize</code>，<code>skip</code> 是第几页<code>*pageSize</code></p>
</blockquote>
<p><strong>18. or与 查询</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">db.userInfo.find(&#123;$or: [&#123;age: 22&#125;, &#123;age: 25&#125;]&#125;);</span><br></pre></td></tr></table></figure>

<blockquote>
<p>相当于:<code>select * from userInfo where age = 22 or age = 25;</code></p>
</blockquote>
<p><strong>19. findOne 查询第一条数据</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">db.userInfo.findOne( );</span><br></pre></td></tr></table></figure>

<blockquote>
<p>相当于:<code>selecttop 1 * from userInfo;</code></p>
</blockquote>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">db.userInfo.find().limit(1 );</span><br></pre></td></tr></table></figure>

<p><strong>20. 查询某 个结果集的记录条数 统计数量</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">db.userInfo.find(&#123;age: &#123;$gte: 25&#125;&#125;).count();</span><br></pre></td></tr></table></figure>

<blockquote>
<p>相当于:<code>select count(*) from userInfo where age &gt;= 20;</code></p>
</blockquote>
<blockquote>
<p>如果要返回限制之后的记录数量，要使用 <code>count(true)</code>或者 <code>count</code>(非 <code>0</code>)</p>
</blockquote>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">db.users.find().skip(1 0).limit(5).count(true);</span><br></pre></td></tr></table></figure>

<h2 id="10-5-修改数据"><a href="#10-5-修改数据" class="headerlink" title="10.5 修改数据"></a>10.5 修改数据</h2><blockquote>
<p>修改里面还有查询条件。你要该谁，要告诉 <code>mongo</code></p>
</blockquote>
<p><strong>查找名字叫做小明的，把年龄更改为 16 岁</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">db.student.update(&#123;&quot;name&quot;:&quot;小明&quot;&#125;,&#123;$set:&#123;&quot;ag e&quot;:16&#125;&#125;);</span><br></pre></td></tr></table></figure>

<p><strong>查找数学成绩是 70，把年龄更改为 33 岁:</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">db.student.update(&#123;&quot;sc ore.shuxue&quot;:70&#125;,&#123;$set:&#123;&quot;ag e&quot;:33&#125;&#125;);</span><br></pre></td></tr></table></figure>

<p><strong>更改所有匹配项目</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">db.student.update(&#123;&quot;sex&quot;:&quot;男&quot;&#125;,&#123;$set:&#123;&quot;age&quot;:33&#125;&#125;,&#123;multi: true&#125;);</span><br></pre></td></tr></table></figure>

<p><strong>完整替换，不出现$set 关键字了: 注意</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">db.student.update(&#123;&quot;name&quot;:&quot;小明&quot;&#125;,&#123;&quot;name&quot;:&quot;大明&quot;,&quot;age&quot;:16&#125;);</span><br></pre></td></tr></table></figure>

<blockquote>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">db.users.update(&#123;name: &#x27;Lisi&#x27;&#125;, &#123;$inc: &#123;age: 50&#125;&#125;, false, true);` 相当于:`update users set age = age + 50 where name = ‘Lisi’;</span><br></pre></td></tr></table></figure>
</blockquote>
<blockquote>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">db.users.update(&#123;name: &#x27;Lisi&#x27;&#125;, &#123;$inc: &#123;age: 50&#125;, $set: &#123;name: &#x27;hoho&#x27;&#125;&#125;, false, true);` 相当于: `update users set age = age + 50, name = ‘hoho’ where name = ‘Lisi’;</span><br></pre></td></tr></table></figure>
</blockquote>
<h2 id="10-6-删除数据"><a href="#10-6-删除数据" class="headerlink" title="10.6 删除数据"></a>10.6 删除数据</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">db.collectionsNames.remove( &#123; &quot;borough&quot;: &quot;Manhattan&quot; &#125; )</span><br><span class="line"></span><br><span class="line">db.users.remove(&#123;age: 132&#125;);</span><br><span class="line"></span><br><span class="line">db.restaurants.remove( &#123; &quot;borough&quot;: &quot;Queens&quot; &#125;, &#123; justOne: true &#125; )</span><br></pre></td></tr></table></figure>

<h1 id="十一、MongoDB-索引-explain-分析查询速度"><a href="#十一、MongoDB-索引-explain-分析查询速度" class="headerlink" title="十一、MongoDB 索引 explain 分析查询速度"></a>十一、MongoDB 索引 explain 分析查询速度</h1><h2 id="11-1-索引基础"><a href="#11-1-索引基础" class="headerlink" title="11.1 索引基础"></a>11.1 索引基础</h2><blockquote>
<p>索引是对数据库表中一列或多列的值进行排序的一种结构，可以让我们查询数据库变得 更快。MongoDB 的索引几乎与传统的关系型数据库一模一样，这其中也包括一些基本的查 询优化技巧。</p>
</blockquote>
<p><strong>下面是创建索引的 命令</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">db.user.ensureIndex( &#123;&quot;username&quot;:1&#125;)</span><br></pre></td></tr></table></figure>

<p><strong>获取当前集合的索 引</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">db.user.getIndexes()</span><br></pre></td></tr></table></figure>

<p><strong>删除索引的命令是</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">db.user.dropIndex( &#123;&quot;username&quot;:1&#125;)</span><br></pre></td></tr></table></figure>

<ul>
<li>在 MongoDB 中，我们同样可以创建复合索引，如:</li>
<li>数字 <code>1</code> 表示 <code>username</code> 键的索引按升序存储，<code>-1</code> 表示 <code>age</code> 键的索引按照降序方式存储</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">db.user.ensureIndex(&#123;&quot;username&quot;:1, &quot;age&quot;:-1&#125;)</span><br></pre></td></tr></table></figure>

<blockquote>
<p>该索引被创建后，基于 username 和 age 的查询将会用到该索引，或者是基于 username 的查询也会用到该索引，但是只是基于 age 的查询将不会用到该复合索引。因此可以说，如果想用到复合索引，必须在查询条件中包含复合索引中的前 N个索引列。然而如果查询条件中的键值顺序和复合索引中的创建顺序不一致的话，MongoDB 可以智能的帮助我们调整该顺序，以便使复合索引可以为查询所用。如:</p>
</blockquote>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">db.user.find(&#123;&quot;age&quot;: 30, &quot;username&quot;: &quot;stephen&quot;&#125;)</span><br></pre></td></tr></table></figure>

<blockquote>
<p>对于上面示例中的查询条件，MongoDB 在检索之前将会动态的调整查询条件文档的顺 序，以使该查询可以用到刚刚创建的复合索引。</p>
</blockquote>
<blockquote>
<p>对于上面创建的索引，MongoDB 都会根据索引的 keyname 和索引方向为新创建的索引自动分配一个索引名，下面的命令可以在创建索引时为其指定索引名，如:</p>
</blockquote>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">db.user.ensureIndex( &#123;&quot;username&quot;:1&#125;,&#123;&quot;name&quot;:&quot;userindex&quot;&#125;)</span><br></pre></td></tr></table></figure>

<blockquote>
<p>随着集合的增长，需要针对查询中大量的排序做索引。如果没有对索引的键调用 <code>sort</code>， <code>MongoDB</code> 需要将所有数据提取到内存并排序。因此在做无索引排序时，如果数据量过大以 致无法在内存中进行排序，此时 <code>MongoDB</code> 将会报错</p>
</blockquote>
<h2 id="11-2-唯一索引"><a href="#11-2-唯一索引" class="headerlink" title="11.2 唯一索引"></a>11.2 唯一索引</h2><blockquote>
<p>在缺省情况下创建的索引均不是唯一索引。下面的示例将创建唯一索引，如</p>
</blockquote>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">db.user.ensureIndex( &#123;&quot;useri d&quot;:1&#125;,&#123;&quot;uniq ue&quot;:true&#125;)</span><br></pre></td></tr></table></figure>

<blockquote>
<p>如果再次插入 userid 重复的文档时，MongoDB 将报错，以提示插入重复键，如:</p>
</blockquote>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">db.user.insert(&#123;&quot;userid&quot;:5&#125;) </span><br><span class="line">db.user.insert(&#123;&quot;userid&quot;:5&#125;)</span><br><span class="line"></span><br><span class="line">// E11000 duplicate key error index: user.user.$userid_1 dup key: &#123; : 5.0 &#125;</span><br></pre></td></tr></table></figure>

<blockquote>
<p>如果插入的文档中不包含 userid 键，那么该文档中该键的值为 null，如果多次插入类似 的文档，MongoDB 将会报出同样的错误，如:</p>
</blockquote>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">db.user.insert(&#123;&quot;userid1&quot;:5&#125;) </span><br><span class="line">db.user.insert(&#123;&quot;userid1&quot;:5&#125;)</span><br><span class="line"></span><br><span class="line">// E11000 duplicate key error index: user.user.$userid_1 dup key: &#123; : null &#125;</span><br></pre></td></tr></table></figure>

<blockquote>
<p>如果在创建唯一索引时已经存在了重复项，我们可以通过下面的命令帮助我们在创建唯 一索引时消除重复文档，仅保留发现的第一个文档，如:</p>
</blockquote>
<p><strong>先删除刚刚创建的唯一索引</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">db.user.dropIndex( &#123;&quot; userid&quot; :1&#125; )</span><br></pre></td></tr></table></figure>

<p><strong>插入测试数据，以保证集合中有重复键存在。</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">db.user.remove() </span><br><span class="line">db.user.insert(&#123;&quot;userid&quot;:5&#125;)</span><br><span class="line">db.user.insert(&#123;&quot;userid&quot;:5&#125;)</span><br></pre></td></tr></table></figure>

<p><strong>重新创建唯一索引</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">db.user.ensureIndex(&#123;&quot;userid&quot;:1&#125;,&#123;&quot;unique&quot;:true &#125;)</span><br></pre></td></tr></table></figure>

<p><strong>我们同样可以创建 复合唯一索引，即保证复合键值唯一 即可。如:</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">db.user.ensureIndex( &#123;&quot;useri d&quot;:1,&quot;age&quot;:1&#125;,&#123;&quot;unique&quot;:true&#125;)</span><br></pre></td></tr></table></figure>

<h2 id="11-3-索引的一些参数"><a href="#11-3-索引的一些参数" class="headerlink" title="11.3 索引的一些参数"></a>11.3 索引的一些参数</h2><p><img src="https://upload-images.jianshu.io/upload_images/1480597-450216a694af3946.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="image.png"></p>
<blockquote>
<p>如果在为已有数据的文档创建索引时，可以执行下面的命令，以使 MongoDB 在后台创 建索引，这样的创建时就不会阻塞其他操作。但是相比而言，以阻 塞方式创建索引，会使整 个创建过程效率更高，但是在创建时 MongoDB 将无法接收其他的操作</p>
</blockquote>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">db.user.ensureIndex( &#123;&quot;username&quot;:1&#125;,&#123;&quot;backgroun d&quot;:true&#125;)</span><br></pre></td></tr></table></figure>

<h2 id="11-4-使用-explain"><a href="#11-4-使用-explain" class="headerlink" title="11.4 使用 explain"></a>11.4 使用 explain</h2><blockquote>
<p>explain 是非常有用的工具，会帮助你获得查询方面诸多有用的信息。只要对游标调用 该方法，就可以得到查询细节。explain 会返回一个文档，而不是游标本身。如</p>
</blockquote>
<p><img src="https://poetries1.gitee.io/img-repo/2019/10/376.png" alt="img"></p>
<blockquote>
<p><code>explain</code> 会返回查询使用的索引情况，耗时和扫描文档数的统计信息</p>
</blockquote>
<h2 id="11-5-explain-executionStats-查询具体的执行-时间"><a href="#11-5-explain-executionStats-查询具体的执行-时间" class="headerlink" title="11.5 explain executionStats 查询具体的执行 时间"></a>11.5 explain executionStats 查询具体的执行 时间</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">db.tablename.find().explain( &quot;executionStats&quot; )</span><br></pre></td></tr></table></figure>

<blockquote>
<p>关注输出的如下数值:<code>explain.executionStats.executionTimeMillis</code></p>
</blockquote>
<h1 id="十二、nodejs操作mongodb3-x数据库的方法"><a href="#十二、nodejs操作mongodb3-x数据库的方法" class="headerlink" title="十二、nodejs操作mongodb3.x数据库的方法"></a>十二、nodejs操作mongodb3.x数据库的方法</h1><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br></pre></td><td class="code"><pre><span class="line">//http://mongodb.github.io/node-mongodb-native/3.0/quick-start/quick-start/</span><br><span class="line"></span><br><span class="line">/*</span><br><span class="line">nodejs操作mongodb数据库</span><br><span class="line"></span><br><span class="line"> 1.安装mongodb、</span><br><span class="line"></span><br><span class="line">    cnpm install mongodb --save</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"> 2.引入mongodb下面的MongoClient</span><br><span class="line">    var MongoClient = require(&#x27;mongodb&#x27;).MongoClient;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"> 3.定义数据库连接的地址 以及配置数据库</span><br><span class="line">    qianfeng数据库的名称</span><br><span class="line"></span><br><span class="line">    var url = &#x27;mongodb://localhost:27017/&#x27;;</span><br><span class="line"></span><br><span class="line">    var dbName = &#x27;shop&#x27;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"> 4.nodejs连接数据库</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"> MongoClient.connect(url,function(err,client)&#123;</span><br><span class="line"></span><br><span class="line">        const db = client.db(dbName);  数据库db对象</span><br><span class="line"></span><br><span class="line"> &#125;)</span><br><span class="line"></span><br><span class="line">5.操作数据库</span><br><span class="line">    </span><br><span class="line"></span><br><span class="line"></span><br><span class="line">	 MongoClient.connect(url,function(err,client)&#123;</span><br><span class="line"></span><br><span class="line">			const db = client.db(dbName);  数据库db对象</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">			MongoClient.connect(url,function(err,db)&#123;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">				db.collection(&#x27;user&#x27;).insertOne(&#123;&quot;name&quot;:&quot;张三&quot;&#125;,function(err,result)&#123;</span><br><span class="line"></span><br><span class="line">					db.close() //关闭连接</span><br><span class="line">				&#125;)</span><br><span class="line"></span><br><span class="line">		     &#125;)</span><br><span class="line"></span><br><span class="line">	 &#125;)</span><br><span class="line">     </span><br><span class="line"></span><br><span class="line">*/</span><br><span class="line">var MongoClient = require(&#x27;mongodb&#x27;).MongoClient;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">//定义连接数据库的地址</span><br><span class="line"></span><br><span class="line">const  url = &#x27;mongodb://localhost:27017/&#x27;;</span><br><span class="line">var dbName = &#x27;shop&#x27;</span><br><span class="line"></span><br><span class="line">//连接数据库</span><br><span class="line">MongoClient.connect(url,(err,client)=&gt;&#123;</span><br><span class="line"></span><br><span class="line">    if(err)&#123;</span><br><span class="line">        console.log(&#x27;数据连接失败&#x27;);</span><br><span class="line">        return false;</span><br><span class="line">    &#125;</span><br><span class="line">    let db=client.db(dbName);   /*获取db对象*/</span><br><span class="line"></span><br><span class="line">    db.collection(&quot;admin&quot;).insertOne(&#123;&quot;name&quot;:&quot;mongodb3.0&quot;,&quot;age&quot;:10&#125;,function(err)&#123;</span><br><span class="line"></span><br><span class="line">        if(err)&#123;</span><br><span class="line">            console.log(&#x27;增加失败&#x27;);</span><br><span class="line">            return false;</span><br><span class="line">        &#125;</span><br><span class="line">        console.log(&#x27;增加成功&#x27;);</span><br><span class="line">        client.close();  /*关闭数据库*/</span><br><span class="line">    &#125;)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>

<h1 id="十三、NodeJs操作MongoDb数据库-数据的增加-修改-删除"><a href="#十三、NodeJs操作MongoDb数据库-数据的增加-修改-删除" class="headerlink" title="十三、NodeJs操作MongoDb数据库 数据的增加 修改 删除"></a>十三、NodeJs操作MongoDb数据库 数据的增加 修改 删除</h1><h2 id="13-1-在-Nodejs-中使用-Mongodb"><a href="#13-1-在-Nodejs-中使用-Mongodb" class="headerlink" title="13.1 在 Nodejs 中使用 Mongodb"></a>13.1 在 Nodejs 中使用 Mongodb</h2><blockquote>
<p>前面的课程我们讲了用命令操作 <code>MongoDB</code>，这里我们看下如何用 <code>nodejs</code> 来操作数据库</p>
</blockquote>
<p><strong>需要引包</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm install mongodb --save-dev / cnpm install mongodb --save-dev</span><br></pre></td></tr></table></figure>

<h2 id="13-2-Nodejs-连接-MongoDb-数据库"><a href="#13-2-Nodejs-连接-MongoDb-数据库" class="headerlink" title="13.2 Nodejs 连接 MongoDb 数据库"></a>13.2 Nodejs 连接 MongoDb 数据库</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line">var express = require(&quot;express&quot;); //数据库引用</span><br><span class="line"></span><br><span class="line">var MongoClient = require(&#x27;mongodb&#x27;).MongoClient;</span><br><span class="line">var app = express();</span><br><span class="line">//数据库连接的地址，最后的斜杠表示数据库名字</span><br><span class="line">var shujukuURL = &#x27;mongodb://localhost:27017/news&#x27;;</span><br><span class="line">app.get(&quot;/&quot;, fu nction(req, res) &#123; //连接数据库，这是一个异步的操作</span><br><span class="line">    MongoClient.connect(shujukuURL,</span><br><span class="line">    function(err, db) &#123;</span><br><span class="line">        res.writeHe ad(200, &#123;</span><br><span class="line">            &quot;Content-Type&quot;: &quot; text/html;charset =UTF8&quot;</span><br><span class="line">        &#125;);</span><br><span class="line">        if (err) &#123;</span><br><span class="line">            res.send(&quot;数据库连接失 败&quot;);</span><br><span class="line">            return;</span><br><span class="line">        &#125;</span><br><span class="line">        res.write(&quot;恭喜，数据库已经成功连接 \n&quot;);</span><br><span class="line">        db.collection(&quot;user&quot;).insertOne(&#123;</span><br><span class="line">            &quot;name&quot;: &quot;哈哈&quot;</span><br><span class="line">        &#125;,</span><br><span class="line">        functio n(err, result) &#123;</span><br><span class="line">            if (err) &#123;</span><br><span class="line">                res.send(&quot;数据库写入 失败&quot;);</span><br><span class="line">                return;</span><br><span class="line">            &#125;</span><br><span class="line">            res.write(&quot;恭喜，数据 已经成功插入&quot;);</span><br><span class="line">            res.end();</span><br><span class="line">            //关闭数据库</span><br><span class="line">            db.close();</span><br><span class="line">        &#125;);</span><br><span class="line">    &#125;);</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">app.listen(8020);</span><br></pre></td></tr></table></figure>

<h2 id="13-3-Nodejs-查找-MongoDb-数据库集合"><a href="#13-3-Nodejs-查找-MongoDb-数据库集合" class="headerlink" title="13.3 Nodejs 查找 MongoDb 数据库集合"></a>13.3 Nodejs 查找 MongoDb 数据库集合</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line">MongoClient.connect(dbUrl,</span><br><span class="line">function(err, db) &#123;</span><br><span class="line">    if (err) &#123;</span><br><span class="line">        /*数据库连接失败*/</span><br><span class="line">        console.log(&#x27;数据库连接失败&#x27;);</span><br><span class="line">        return;</span><br><span class="line">    &#125;</span><br><span class="line">    var result = [];</span><br><span class="line">    var userRel = db.collection(&#x27;user&#x27;).find();</span><br><span class="line">    //res.send(userRel);</span><br><span class="line">    userRel.each(function(err, doc) &#123;</span><br><span class="line">        if (err) &#123;</span><br><span class="line">            res.write(&quot;游标遍历错 误&quot;);</span><br><span class="line">            return;</span><br><span class="line">        &#125;</span><br><span class="line">        if (doc != null) &#123;</span><br><span class="line">            result.push(doc);</span><br><span class="line">        &#125; else &#123;</span><br><span class="line">            console.log(result); //遍历完毕</span><br><span class="line">            db.close();</span><br><span class="line">            res.render(&quot;index&quot;, &#123;</span><br><span class="line">                &quot;result&quot;: result</span><br><span class="line">            &#125;);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;);</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>

<h2 id="13-4-Nodejs-给-MongoDb-增加数据"><a href="#13-4-Nodejs-给-MongoDb-增加数据" class="headerlink" title="13.4 Nodejs 给 MongoDb 增加数据"></a>13.4 Nodejs 给 MongoDb 增加数据</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">MongoClient.connect(dbUrl,</span><br><span class="line">function(err, db) &#123;</span><br><span class="line">    if (err) &#123;</span><br><span class="line">        return</span><br><span class="line">    &#125;</span><br><span class="line">    db.collection(&#x27;user&#x27;).insertOne(&#123;</span><br><span class="line">        &quot;name&quot;: name,</span><br><span class="line">        &quot;age&quot;: age,</span><br><span class="line">        &quot;score&quot;: &#123;</span><br><span class="line">            &quot;shuxue&quot;: shuxuechengji,</span><br><span class="line">            &quot;yuwen&quot;: yuwenchengji</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;,</span><br><span class="line">    function(err, result) &#123;</span><br><span class="line">        if (err) &#123;</span><br><span class="line">            console.log(&#x27;写入数据失败&#x27;);</span><br><span class="line">        &#125;</span><br><span class="line">        //关闭数据库</span><br><span class="line">        db.close();</span><br><span class="line">        //res.redirect(&#x27;/add&#x27;); res.redirect(&#x27;/&#x27; ); /*路由跳转*/ res.end(); ////res.location(&#x27;/add&#x27;)</span><br><span class="line">    &#125;)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>

<h2 id="13-5-Nodejs-修改-MongoDb-数据"><a href="#13-5-Nodejs-修改-MongoDb-数据" class="headerlink" title="13.5 Nodejs 修改 MongoDb 数据"></a>13.5 Nodejs 修改 MongoDb 数据</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">MongoClient.connect(dbUrl,</span><br><span class="line">function(err, db) &#123;</span><br><span class="line">    if (err) &#123;</span><br><span class="line">        console.log(&#x27;数据库连接错误&#x27;);</span><br><span class="line">        return;</span><br><span class="line">    &#125;</span><br><span class="line">    db.collection(&#x27;user&#x27;).updateOne(&#123;</span><br><span class="line">        &quot;_id&quot;: ObjectID(id)</span><br><span class="line">    &#125;,</span><br><span class="line">    &#123;</span><br><span class="line">        &quot;name&quot;: name,</span><br><span class="line">        &quot;age&quot;: age,</span><br><span class="line">        &quot;score&quot;: &#123;</span><br><span class="line">            &quot;shuxue&quot;: shuxue,</span><br><span class="line">            &quot;yuwen&quot;: yuwen</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;,</span><br><span class="line">    function(err, results) &#123;</span><br><span class="line">        console.log(results);</span><br><span class="line">        db.close();</span><br><span class="line">        res.redirect(&#x27;/&#x27;);</span><br><span class="line">        /*路由跳转*/</span><br><span class="line">        res.end(&#x27;end&#x27;);</span><br><span class="line">    &#125;)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>

<h2 id="13-6-Nodejs-删除-MongoDb-数据"><a href="#13-6-Nodejs-删除-MongoDb-数据" class="headerlink" title="13.6 Nodejs 删除 MongoDb 数据"></a>13.6 Nodejs 删除 MongoDb 数据</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">MongoClient.connect(dbUrl,</span><br><span class="line">function(err, db) &#123;</span><br><span class="line">    if (err) &#123;</span><br><span class="line">        throw new Error(&quot;数据库连接失败&quot;);</span><br><span class="line">        return;</span><br><span class="line">    &#125;</span><br><span class="line">    db.collection(&#x27;user&#x27;).deleteOne(&#123;</span><br><span class="line">        &quot;_id&quot;: ObjectID(id)</span><br><span class="line">    &#125;,</span><br><span class="line">    func tion(error, result) &#123;</span><br><span class="line">        if (error) &#123;</span><br><span class="line">            throw new Error(&#x27;删除数据失败&#x27;);</span><br><span class="line">            return;</span><br><span class="line">        &#125;</span><br><span class="line">        db.close();</span><br><span class="line">        res.redirect(&#x27;/&#x27;);</span><br><span class="line">        /*路由跳转*/</span><br><span class="line">    &#125;)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>

<h1 id="十四、Express-安装和使用"><a href="#十四、Express-安装和使用" class="headerlink" title="十四、Express 安装和使用"></a>十四、Express 安装和使用</h1><h2 id="14-1-Express-简单介绍"><a href="#14-1-Express-简单介绍" class="headerlink" title="14.1 Express 简单介绍"></a>14.1 Express 简单介绍</h2><ul>
<li>Express 是一个基于 Node.js 平台，快速、开放、极简的 web 开发框架</li>
<li>Express 框架是后台的 Node 框架，所以和 jQuery、zepto、yui、bootstrap 都不一个东西。 Express 在后台的受欢迎的程度类似前端的 jQuery，就是企业的事实上的标准。</li>
</ul>
<p><strong>Express 特点</strong></p>
<ul>
<li><code>Express</code> 是一个基于 <code>Node.js</code> 平台的极简、灵活的 web 应用开发框架，它提供一<br>系列强大的特性，帮助你创建各种 <code>Web</code> 和移动设备应用</li>
<li>丰富的 HTTP 快捷方法和任意排列组合的 <code>Connect</code> 中间件，让你创建健壮、友好的 API 变得既快速又简单</li>
<li><code>Express</code> 不对 <code>Node.js</code> 已有的特性进行二次抽象，我们只是在它之上扩展了 Web应用所需的基本功能</li>
</ul>
<h2 id="14-2-Express-安装使用"><a href="#14-2-Express-安装使用" class="headerlink" title="14.2 Express 安装使用"></a>14.2 Express 安装使用</h2><p><strong>安装:</strong></p>
<blockquote>
<p>安装 Express 框架，就是使用 npm 的命令</p>
</blockquote>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm install express --save</span><br></pre></td></tr></table></figure>

<blockquote>
<p><code>--save</code> 参数，表示自动修改 <code>package.json</code> 文件，自动添加依赖项</p>
</blockquote>
<p><strong>简单使用</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">npm install express–save //1.引入</span><br><span class="line">var express = require(&#x27;express&#x27;);</span><br><span class="line">var app = express();</span><br><span class="line">//2.配置路由</span><br><span class="line">app.get(&#x27;/&#x27;,</span><br><span class="line">function(req, res) &#123;</span><br><span class="line">    res.send(&#x27;Hello World!&#x27;);</span><br><span class="line">&#125;); //3.监听端口</span><br><span class="line"></span><br><span class="line">app.listen(3000,&#x27;127.0.0.1&#x27;);</span><br></pre></td></tr></table></figure>

<p><strong>完整 Demo</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line">var express = require(&#x27;express&#x27;);</span><br><span class="line">/*引入 express*/</span><br><span class="line">var app = newexpress();</span><br><span class="line">/*实例化express 赋值给app*/</span><br><span class="line">//配置路由 匹配 URl 地址实现不同的功能</span><br><span class="line">app.get(&#x27;/&#x27;,</span><br><span class="line">function(req, res) &#123;</span><br><span class="line">    res.send(&#x27;首页&#x27;);</span><br><span class="line">&#125;) </span><br><span class="line"></span><br><span class="line">app.get(&#x27;/search&#x27;,</span><br><span class="line">function(req, res) &#123;</span><br><span class="line">    res.send(&#x27;搜索&#x27;); //?keyword=华为手机&amp;enc=utf-8&amp;suggest=1.his.0.0&amp;wq</span><br><span class="line">&#125;) </span><br><span class="line"></span><br><span class="line">app.get(&#x27;/login&#x27;,</span><br><span class="line">function(req, res) &#123;</span><br><span class="line">    res.send(&#x27;登录&#x27;);</span><br><span class="line">&#125;) </span><br><span class="line"></span><br><span class="line">app.get(&#x27;/register&#x27;,</span><br><span class="line">function(req, res) &#123;</span><br><span class="line">    res.send(&#x27;注册&#x27;);</span><br><span class="line">&#125;) </span><br><span class="line"></span><br><span class="line">app.listen(3000, &quot;127.0.0.1&quot;);</span><br></pre></td></tr></table></figure>

<h2 id="14-3-Express-框架中的路由"><a href="#14-3-Express-框架中的路由" class="headerlink" title="14.3 Express 框架中的路由"></a>14.3 Express 框架中的路由</h2><blockquote>
<p>路由(Routing)是由一个 URI(或者叫路径)和一个特定的 HTTP 方法(GET、POST 等) 组成的，涉及到应用如何响应客户端对某个网站节点的访问</p>
</blockquote>
<p><strong>简单的路由配置</strong></p>
<blockquote>
<p>当用 get 请求访问一个网址的时候，做什么事情</p>
</blockquote>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">app.get(&quot;网址&quot;,function(req,res)&#123;</span><br><span class="line"></span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<blockquote>
<p>当用 post 访问一个网址的时候，做什么事情:</p>
</blockquote>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">app.post(&quot;网址&quot;,function(req,res)&#123;</span><br><span class="line"></span><br><span class="line">&#125;);</span><br><span class="line">// user 节点接受 PUT 请求</span><br><span class="line"></span><br><span class="line">app.put(&#x27;/user&#x27;, function (req, res) &#123;</span><br><span class="line">    res.send(&#x27;Got a PUT request at /user&#x27;); </span><br><span class="line">&#125;);</span><br><span class="line">// user 节点接受 DELETE 请求</span><br><span class="line"></span><br><span class="line">app.delete(&#x27;/user&#x27;, function (req, res) &#123;</span><br><span class="line">    res.send(&#x27;Got a DELETE request at /user&#x27;); </span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<p><strong>动态路由配置:</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">app.get( ,function(req,res)&#123; </span><br><span class="line">    var id = req.params[&quot;id&quot;];</span><br><span class="line">    res.send(id); </span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<p><strong>路由的正则匹配:(了解)</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">app.get(&#x27;/ab*cd&#x27;, function(req, res) &#123; </span><br><span class="line">    res.send(&#x27;ab*cd&#x27;);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<p><strong>路由里面获取 Get 传值</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">// /news?id=2&amp;sex=nan</span><br><span class="line"></span><br><span class="line">app.get(&#x27;/news, function(req, res) &#123; </span><br><span class="line">    console.log(req.query);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<h2 id="14-4-Express-框架中-ejs-的安装使用"><a href="#14-4-Express-框架中-ejs-的安装使用" class="headerlink" title="14.4 Express 框架中 ejs 的安装使用"></a>14.4 Express 框架中 ejs 的安装使用</h2><p><strong>Express 中 ejs 的安装:</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">npm install ejs --save </span><br><span class="line"></span><br><span class="line">// 或者:</span><br><span class="line">npm install ejs --save-dev</span><br></pre></td></tr></table></figure>

<p><strong>Express 中 ejs 的使用</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">var express = require(&quot;express&quot;);</span><br><span class="line">var app = express();</span><br><span class="line">app.set(&quot;view engine&quot;, &quot;ejs&quot;);</span><br><span class="line"></span><br><span class="line">app.get(&quot;/&quot;,</span><br><span class="line">    function(req, res) &#123;&#125;);</span><br><span class="line">        res.render(&quot;news&quot;, &#123;</span><br><span class="line">            &quot;news&quot;: [&quot;我是小新闻啊&quot;, &quot;我也是啊&quot;, &quot;哈哈哈哈&quot;]</span><br><span class="line">&#125;);</span><br><span class="line">app.listen(3000);</span><br></pre></td></tr></table></figure>

<p><strong>指定模板位置 ，默认模板位置在 views</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">app.set(&#x27;views&#x27;, __dirname + &#x27;/views&#x27;);</span><br></pre></td></tr></table></figure>

<p><strong>Ejs 引入模板</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;%- include header.ejs %&gt;</span><br></pre></td></tr></table></figure>

<p><strong>Ejs 绑定数据</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;%=h%&gt;</span><br></pre></td></tr></table></figure>

<p><strong>Ejs 绑定 html 数据</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;%-h%&gt;</span><br></pre></td></tr></table></figure>

<p><strong>Ejs 模板判断语句</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">&lt;% if(true)&#123; %&gt; </span><br><span class="line">    &lt;div&gt;true&lt;/div&gt;</span><br><span class="line">    &lt;%&#125; </span><br><span class="line">  else&#123; %&gt; </span><br><span class="line">    &lt;div&gt;false&lt; /di v&gt;</span><br><span class="line">&lt;%&#125; %&gt;</span><br></pre></td></tr></table></figure>

<p><strong>Ejs 模板中循环数据</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&lt;%for(var i=0;i&lt;list.length;i++) &#123; %&gt;</span><br><span class="line">    &lt;li&gt;&lt;%=list[i] %&gt;&lt;/li&gt;</span><br><span class="line">&lt;%&#125;%&gt;</span><br></pre></td></tr></table></figure>

<p><strong>Ejs 后缀修改为 Html</strong></p>
<blockquote>
<p>这是一个小技巧，看着<code>.ejs</code> 的后缀总觉得不爽，使用如下方法，可以将模板文件的后缀换成我们习惯的<code>.html</code></p>
</blockquote>
<ol>
<li>在 <code>app.js</code> 的头上定义 <code>ejs</code>:,代码如下:</li>
</ol>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">var ejs = require(&#x27;ejs&#x27;);</span><br></pre></td></tr></table></figure>

<ol>
<li>注册 html 模板引擎代码如下:</li>
</ol>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">app.engine(&#x27;html&#x27;,ejs.__express);</span><br></pre></td></tr></table></figure>

<ol>
<li>将模板引擎换成 html代码如下:</li>
</ol>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">app.set(&#x27;view engine&#x27;, &#x27;html&#x27;);</span><br></pre></td></tr></table></figure>

<ol>
<li>修改模板文件的后缀为 <code>.html</code></li>
</ol>
<h2 id="14-5-利用-Express-static-托管静态文件"><a href="#14-5-利用-Express-static-托管静态文件" class="headerlink" title="14.5 利用 Express.static 托管静态文件"></a>14.5 利用 Express.static 托管静态文件</h2><ol>
<li>如果你的静态资源存放在多个目录下面，你可以多次调用 <code>express.static</code> 中间件:</li>
</ol>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">app.use(express.static(&#x27;public&#x27;));</span><br></pre></td></tr></table></figure>

<blockquote>
<p>现在，public 目录下面的文件就可以访问了</p>
</blockquote>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">http://localhost:3000/images/kitten.jpg</span><br><span class="line">http://localhost:3000/css/style.css </span><br><span class="line">http://localhost:3000/js/app.js</span><br><span class="line">http://localhost:3000/images/bg.png h</span><br><span class="line">ttp://localhost:3000/hello.html</span><br></pre></td></tr></table></figure>

<ol>
<li>如果你希望所有通过 <code>express.static</code> 访问的文件都存放在一个“虚拟(virtual)”目 录(即目录根本不存在)下面，可以通过为静态资源目录指定一个挂载路径的方式来实现，如下所示</li>
</ol>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">app.use(&#x27;/static&#x27;, express.static(&#x27;public&#x27;));</span><br></pre></td></tr></table></figure>

<blockquote>
<p>现在，你就爱可以通过带有 “&#x2F;static” 前缀的地址来访问 public 目录下 面的文件了</p>
</blockquote>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">http://localhost:3000/static/images/kitten.jpg</span><br><span class="line">http://localhost:3000/static/css/style.css http://localhost:3000/static/js/app.js http://localhost:3000/static/images/bg.png</span><br><span class="line">http://localhost:3000/static/hello.html</span><br></pre></td></tr></table></figure>

<h2 id="14-6-Express-中间件"><a href="#14-6-Express-中间件" class="headerlink" title="14.6 Express 中间件"></a>14.6 Express 中间件</h2><ul>
<li><code>Express</code> 是一个自身功能极简，完全是由路由和中间件构成一个的 web 开发框架:从<br>本质上来说，一个 <code>Express</code> 应用就是在调用各种中间件</li>
<li>中间件(<code>Middleware</code>) 是一个函数，它可以访问请求对象(request object (req)), 响 应对象(response object (res)), 和 web 应用中处理请求-响应循环流程中的中间件，一般 被命名为 next 的变量</li>
</ul>
<p><strong>中间件的功能包括</strong></p>
<ul>
<li>执行任何代码</li>
<li>修改请求和响应对象</li>
<li>终结请求-响应循环</li>
<li>调用堆栈中的下一个中间件</li>
</ul>
<blockquote>
<p>如果我的 <code>get</code>、<code>post</code> 回调函数中，没有 <code>next</code> 参数，那么就匹配上第一个路由，就不会往下匹 配了。如果想往下匹配的话，那么需要写 <code>next()</code></p>
</blockquote>
<p><strong>Express 应用可使用如下几种中间件</strong></p>
<ul>
<li>应用级中间件</li>
<li>路由级中间件</li>
<li>错误处理中间件</li>
<li>内置中间件</li>
<li>第三方中间件</li>
</ul>
<ol>
<li>应用级中间件</li>
</ol>
<p><img src="https://poetries1.gitee.io/img-repo/2019/10/377.png" alt="img"></p>
<ol>
<li>路由中间件</li>
</ol>
<p><img src="https://poetries1.gitee.io/img-repo/2019/10/378.png" alt="img"></p>
<ol>
<li>错误处理中间件</li>
</ol>
<p><img src="https://poetries1.gitee.io/img-repo/2019/10/379.png" alt="img"></p>
<ol>
<li>内置中间件</li>
</ol>
<p><img src="https://poetries1.gitee.io/img-repo/2019/10/380.png" alt="img"></p>
<ol>
<li>第三方中间件</li>
</ol>
<p><img src="https://poetries1.gitee.io/img-repo/2019/10/381.png" alt="img"><br><img src="https://poetries1.gitee.io/img-repo/2019/10/382.png" alt="img"></p>
<h2 id="14-7-获取-Get-Post-请求的参数"><a href="#14-7-获取-Get-Post-请求的参数" class="headerlink" title="14.7 获取 Get Post 请求的参数"></a>14.7 获取 Get Post 请求的参数</h2><ul>
<li><code>GET</code> 请求的参数在 <code>URL</code> 中，在原生 <code>Node</code> 中，需要使用 <code>url</code> 模块来识别参数字符串。在<code>Express</code> 中，不需要使用 <code>url</code> 模块了。可以直接使用 <code>req.query</code> 对象</li>
<li><code>POST</code> 请求在 <code>express</code> 中不能直接获得，可以使用 <code>body-parser</code> 模块。使用后，将可以用<code>req.body</code>得到参数。但是如果表单中含有文件上传，那么还是需要使用 <code>formidable</code> 模块</li>
</ul>
<p><strong>1. 安装</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm install body-parser</span><br></pre></td></tr></table></figure>

<p><strong>2. 使用 req.body 获取 post 过来的参数</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">var express = require(&#x27;express&#x27;) </span><br><span class="line">var bodyParser = require(&#x27;body-parser&#x27;) </span><br><span class="line">var app = express()</span><br><span class="line"></span><br><span class="line">// parse application/x-www-form-urlencoded</span><br><span class="line">app.use(bodyParser.urlencoded(&#123;</span><br><span class="line">    extended: false</span><br><span class="line">&#125;))</span><br><span class="line"></span><br><span class="line">// parse application/json</span><br><span class="line">app.use(bodyParser.json()) </span><br><span class="line"></span><br><span class="line">app.use(function(req, res) &#123;</span><br><span class="line">    res.setHeader(&#x27;Content-Type&#x27;, &#x27;text/plain&#x27;) res.write(&#x27;you posted:\n&#x27;) res.end(JSON.stringify(req.body, null, 2))</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>

<h1 id="十五、express中间件cookie的基本使用"><a href="#十五、express中间件cookie的基本使用" class="headerlink" title="十五、express中间件cookie的基本使用"></a>十五、express中间件cookie的基本使用</h1><h2 id="15-1-Cookie-简介"><a href="#15-1-Cookie-简介" class="headerlink" title="15.1 Cookie 简介"></a>15.1 Cookie 简介</h2><p><img src="https://poetries1.gitee.io/img-repo/2019/10/383.png" alt="img"></p>
<h2 id="15-2-Cookie-特点"><a href="#15-2-Cookie-特点" class="headerlink" title="15.2 Cookie 特点"></a>15.2 Cookie 特点</h2><ul>
<li><code>cookie</code> 保存在浏览器本地</li>
<li>正常设置的 <code>cookie</code> 是不加密的，用户可以自由看到;</li>
<li>用户可以删除 <code>cookie</code>，或者禁用它</li>
<li><code>cookie</code> 可以被篡改</li>
<li><code>cookie</code> 可以用于攻击</li>
<li><code>cookie</code> 存储量很小。未来实际上要被 <code>localStorage</code> 替代，但是后者 <code>IE9</code> 兼容</li>
</ul>
<h2 id="15-3-Cookie-的使用"><a href="#15-3-Cookie-的使用" class="headerlink" title="15.3 Cookie 的使用"></a>15.3 Cookie 的使用</h2><p><img src="https://poetries1.gitee.io/img-repo/2019/10/384.png" alt="img"><br><img src="https://poetries1.gitee.io/img-repo/2019/10/385.png" alt="img"><br><img src="https://poetries1.gitee.io/img-repo/2019/10/386.png" alt="img"></p>
<p><strong>设置 cookie</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">res.cookie(&#x27;rememberme&#x27;, &#x27;1&#x27;, &#123; maxAge: 900000, httpOnly: true &#125;)</span><br><span class="line"></span><br><span class="line">res.cookie(&#x27;name&#x27;, &#x27;tobi&#x27;, &#123; domain: &#x27;.example.com&#x27;, path: &#x27;/admin&#x27;, secure: true &#125;);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">res.cookie(&#x27;rememberme&#x27;, &#x27;1&#x27;, &#123; expires: new Date(Date.now() + 900000), httpOnly: true &#125;);</span><br></pre></td></tr></table></figure>

<p><strong>获取 cookie</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">req.cookies.name</span><br></pre></td></tr></table></figure>

<p><strong>删除 cookie</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">res.cookie(&#x27;rememberme&#x27;, &#x27;&#x27;, &#123; expires: new Date(0)&#125;);</span><br><span class="line"></span><br><span class="line">res.cookie(&#x27;username&#x27;,&#x27;zhangsan&#x27;,&#123;domain:&#x27;.ccc.com&#x27;,maxAge:0,httpOnly:true&#125;);</span><br></pre></td></tr></table></figure>

<h2 id="15-4-加密-Cookie"><a href="#15-4-加密-Cookie" class="headerlink" title="15.4 加密 Cookie"></a>15.4 加密 Cookie</h2><p><strong>1. 配置中间件的时候需要传参</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">var cookieParser = require(&#x27;cookie-parser&#x27;);</span><br><span class="line"></span><br><span class="line">app.use(cookieParser(&#x27;123456&#x27;));</span><br></pre></td></tr></table></figure>

<p><strong>2. 设置 cookie 的时候配置 signed 属性</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">res.c ookie(&#x27;userinfo&#x27;,&#x27;hahaha&#x27;,&#123;domain:&#x27;.c cc.c om&#x27;,maxAge :900000,httpOnly :true,signed :true&#125;)</span><br></pre></td></tr></table></figure>

<p><strong>3. signedCookies 调用设置的 cookie</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">console.log(req.signedCookies);</span><br></pre></td></tr></table></figure>

<h1 id="十六、express中间件express-session常见参数配置使用"><a href="#十六、express中间件express-session常见参数配置使用" class="headerlink" title="十六、express中间件express-session常见参数配置使用"></a>十六、express中间件express-session常见参数配置使用</h1><h2 id="16-1-Session-简单介绍"><a href="#16-1-Session-简单介绍" class="headerlink" title="16.1 Session 简单介绍"></a>16.1 Session 简单介绍</h2><blockquote>
<p><code>session</code> 是另一种记录客户状态的机制，不同的是 <code>Cookie</code>保存在客户端浏览器中，而 <code>session</code> 保存在服<br>务器上</p>
</blockquote>
<p><strong>Session 的用途</strong></p>
<ul>
<li><code>session</code> 运行在服务器端，当客户端第一次访问服务器时，可以将客户的登录信息保存</li>
<li>当客户访问其他页面时，可以判断客户的登录状态，做出提示，相当于登录拦截</li>
<li><code>session</code> 可以和 <code>Redis</code>或者数据库等结合做持久化操作，当服务器挂掉时也不会导致某些客户信息(购物车)<br>丢失。</li>
</ul>
<h2 id="16-2-Session-的工作流程"><a href="#16-2-Session-的工作流程" class="headerlink" title="16.2 Session 的工作流程"></a>16.2 Session 的工作流程</h2><blockquote>
<p>当浏览器访问服务器并发送第一次请求时，服务器端会创建一个 session 对象，生成一个类似于 key,value 的键值对，然后将 key(cookie)返回到浏览器(客户)端，浏览器下次再访问时，携带 key(cookie)， 找到对应的 session(value)。 客户的信息都保存在 session 中</p>
</blockquote>
<h2 id="16-3-express-session-的使用"><a href="#16-3-express-session-的使用" class="headerlink" title="16.3 express-session 的使用"></a>16.3 express-session 的使用</h2><p><strong>1. 安装 express-session</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cnpm install express-session --save</span><br></pre></td></tr></table></figure>

<p><strong>2. 引入 express-session</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">var session = require(&quot;express-session&quot;);</span><br></pre></td></tr></table></figure>

<p><strong>3. 设置官方文档提供的中间件</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">app.use(session(&#123;</span><br><span class="line">    secret: &#x27;keyboard cat&#x27;,</span><br><span class="line">    resave: true,</span><br><span class="line">    saveUninitialized: true</span><br><span class="line">&#125;))</span><br></pre></td></tr></table></figure>

<p><strong>4. 使用</strong></p>
<ul>
<li>设置值 <code>req.session.username = &quot;张三&quot;;</code></li>
<li>获取值 <code>req.session.username</code></li>
</ul>
<h2 id="16-4-express-session-的常用参数"><a href="#16-4-express-session-的常用参数" class="headerlink" title="16.4 express-session 的常用参数"></a>16.4 express-session 的常用参数</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">app.use(session(&#123;</span><br><span class="line">    secret: &#x27;12345&#x27;,</span><br><span class="line">    name: &#x27;name&#x27;,</span><br><span class="line">    cookie: &#123;</span><br><span class="line">        maxAge: 60000</span><br><span class="line">    &#125;,</span><br><span class="line">    resave: false,</span><br><span class="line">    saveUninitialized: true</span><br><span class="line">&#125;));</span><br></pre></td></tr></table></figure>

<p><strong>行加密的字符串.这个</strong></p>
<p><img src="https://poetries1.gitee.io/img-repo/2019/10/387.png" alt="img"><br><img src="https://poetries1.gitee.io/img-repo/2019/10/388.png" alt="img"></p>
<h2 id="16-5-express-session-的常用方法"><a href="#16-5-express-session-的常用方法" class="headerlink" title="16.5 express-session 的常用方法"></a>16.5 express-session 的常用方法</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">req.session.destroy(function(err) &#123;</span><br><span class="line">    /*销毁 session*/</span><br><span class="line">&#125;) </span><br><span class="line">req.session.username = &#x27;张三&#x27;; //设置 session req.session.username //获取 </span><br><span class="line"></span><br><span class="line">session req.session.cookie.maxAge=0; //重新设置 cookie 的过期时间</span><br></pre></td></tr></table></figure>

<h2 id="16-6-负载均衡配置-Session，把-Session-保存到数据库-里面"><a href="#16-6-负载均衡配置-Session，把-Session-保存到数据库-里面" class="headerlink" title="16.6 负载均衡配置 Session，把 Session 保存到数据库 里面"></a>16.6 负载均衡配置 Session，把 Session 保存到数据库 里面</h2><ol>
<li>需要安装<code>express-session</code> 和 <code>connect-mongo</code>模块</li>
<li>引入模块</li>
</ol>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">var session = require(&quot;express-session&quot;);</span><br><span class="line"></span><br><span class="line">const MongoStore = require(&#x27;connect-mongo&#x27;)(session);</span><br></pre></td></tr></table></figure>

<ol>
<li>配置中间件</li>
</ol>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">app.use(session(&#123;</span><br><span class="line">    secret: &#x27;keyboard cat&#x27;,</span><br><span class="line">    resave: false,</span><br><span class="line">    saveUninitialized: true,</span><br><span class="line">    rolling:true,</span><br><span class="line">    cookie:&#123;</span><br><span class="line">        maxAge:100000</span><br><span class="line">    &#125;,</span><br><span class="line">    store: new MongoStore(&#123;</span><br><span class="line">        url: &#x27;mongodb://127.0.0.1:27017/student&#x27;,</span><br><span class="line">        touchAfter: 24 * 3600 // time period in seconds</span><br><span class="line">    &#125;)</span><br><span class="line">&#125;))</span><br></pre></td></tr></table></figure>

<h2 id="16-7-Cookie-和-Session-区别"><a href="#16-7-Cookie-和-Session-区别" class="headerlink" title="16.7 Cookie 和 Session 区别"></a>16.7 Cookie 和 Session 区别</h2><ol>
<li><code>cookie</code> 数据存放在客户的浏览器上，<code>session</code> 数据放在服务器上</li>
<li><code>cookie</code> 不是很安全，别人可以分析存放在本地的 <code>COOKIE</code> 并进行 <code>COOKIE</code> 欺骗 考虑到安全应当使用 <code>session</code></li>
<li><code>session</code> 会在一定时间内保存在服务器上。当访问增多，会比较占用你服务器的性能 考虑到减轻服务器性能方面，应当使用 <code>COOKIE</code></li>
<li>单个 <code>cookie</code> 保存的数据不能超过 <code>4K</code>，很多浏览器都限制一个站点最多保存 <code>20</code> 个 <code>cookie</code></li>
</ol>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://example.com/2019/05/14/nodejs/node-%E5%9F%BA%E7%A1%80%E7%AF%87/" data-id="cl7icg76100qwugun9t0225sg" data-title="node-基础总结" class="article-share-link">Share</a>
      
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/nodejs/" rel="tag">nodejs</a></li></ul>

    </footer>
  </div>
  
</article>



  
    <article id="post-nodejs/node-入门" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2019/05/05/nodejs/node-%E5%85%A5%E9%97%A8/" class="article-date">
  <time class="dt-published" datetime="2019-05-05T10:22:19.000Z" itemprop="datePublished">2019-05-05</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/%E5%90%8E%E7%AB%AF/">后端</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/2019/05/05/nodejs/node-%E5%85%A5%E9%97%A8/">node-入门</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <h2 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h2><blockquote>
<p>nodejs是事件驱动、非阻塞I&#x2F;O模型</p>
</blockquote>
<ul>
<li>阻塞：i&#x2F;o时进程休眠等待完成后进行下一步</li>
<li>非阻塞：i&#x2F;o时函数立即返回，进程不等待i&#x2F;o返回</li>
</ul>
<blockquote>
<p>i&#x2F;o完成后通知主程序，如何告诉呢？通过事件驱动</p>
</blockquote>
<p><strong>事件驱动</strong></p>
<ul>
<li>i&#x2F;o等异步操作结束后通知</li>
<li>内部实现是观察者模式</li>
</ul>
<p><strong>CPU密集和I&#x2F;O密集</strong></p>
<ul>
<li><code>CPU</code>密集：压缩、解压、加密、解密</li>
<li><code>I/O</code>密集：文件操作、网络操作、数据库</li>
</ul>
<p><strong>web常见场景(web是一个I&#x2F;O密集)</strong></p>
<ul>
<li>静态资源读取</li>
<li>数据库操作</li>
<li>渲染页面</li>
</ul>
<p><strong>高并发应用之道</strong></p>
<ul>
<li>增加机器数</li>
<li>增加每台机器CPU数-多核</li>
</ul>
<p><img src="https://poetries1.gitee.io/img-repo/2019/10/347.png" alt="img"></p>
<p><strong>进程、线程</strong></p>
<ul>
<li>进程：一个运行的程序（进程包括线程，如何水分子里面还有分子原子）</li>
<li>线程：进程内一个独立的，可调度的执行单元</li>
<li>多线程：启动一个进程，在一个进程内启动多个线程，这样多个线程可以执行多个任务</li>
</ul>
<p><strong>Nodejs的单线程</strong></p>
<ul>
<li>单线程只是针对主进程，I&#x2F;O操作系统底层多线程调度</li>
<li>单线程并不是单进程</li>
</ul>
<p><strong>Nodejs原理</strong></p>
<ul>
<li>Node是单线程的，只开一个进程，一个进程也只开一个线程。一个CPU上只开一个进程，一个进程里面只有一个线程</li>
</ul>
<p><strong>nodejs高性能的前提</strong></p>
<ul>
<li>高并发</li>
<li><code>I/O</code>密集</li>
</ul>
<p><strong>常用场景</strong></p>
<ul>
<li><code>web Server</code></li>
<li>本地代码构建 (<code>webpack/grunt/gulp</code>)</li>
<li>使用工具的开发</li>
</ul>
<h2 id="二、nodejs与JavaScrip异同"><a href="#二、nodejs与JavaScrip异同" class="headerlink" title="二、nodejs与JavaScrip异同"></a>二、nodejs与JavaScrip异同</h2><ul>
<li><code>ECMAScript</code></li>
<li>语法</li>
<li>内置对象、方法</li>
</ul>
<p><strong>顶层对象</strong></p>
<ul>
<li><code>JavaScript</code>：<code>window</code></li>
<li><code>nodejs</code>: <code>global</code></li>
<li>在ECMA部分node和JavaScript是一样的，比如数据类型的定义，语法结构、内置对象</li>
</ul>
<h2 id="三、模块"><a href="#三、模块" class="headerlink" title="三、模块"></a>三、模块</h2><ul>
<li>在<code>node</code>中文件和模块是一一对应的，也就是一个文件一个模块。**file是每个模块下必有的一个属性，输出文件的绝对路径。<code>**dirname</code> 是文件夹名称绝对路径</li>
<li>每个模块都有自己的作用域</li>
<li>我们通过var声明的变量并非全局，而是该模块作用域下的</li>
</ul>
<p><strong>模块加载机制</strong></p>
<ul>
<li><code>require</code>加载模块</li>
<li>1、首先按照加载模块的文件名称进行查找</li>
<li>2、如果没有找到就会在文件模块文件名称后加载<code>.js</code>进行查找</li>
<li>3、如果还没有找到，就在文件名称后加载<code>.json</code>后缀，进行查找</li>
<li>4、如果还没找到，就会在文件名称后加上<code>.node</code>进行查找</li>
<li>查找流程：<strong>文件名称-&gt;.js -&gt; .json-&gt;.node</strong></li>
</ul>
<p><strong>exports、module</strong></p>
<ul>
<li>保存当前模块有关的一些信息</li>
<li><code>module.exports</code> 一般使用这个,把一个模块中的变量对外提供访问</li>
<li>在模块作用域，还有一个内置的模块对象，<code>exports</code>其实就是<code>module.exports</code>,他们两个都是指向同一个对象</li>
</ul>
<h2 id="四、node目录的配置"><a href="#四、node目录的配置" class="headerlink" title="四、node目录的配置"></a>四、node目录的配置</h2><ul>
<li><p>配置文件 :</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">package.json</span><br></pre></td></tr></table></figure>

<ul>
<li>dependencies : 当前项目所使用到的依赖模块</li>
<li>安装方式: <code>npm install</code> 自动读取<code>package.json</code>自动安装</li>
</ul>
</li>
<li><p><code>router</code>目录 用来存放路由文件</p>
</li>
<li><p><code>views</code>目录 用来存放<code>html</code>模板文件</p>
</li>
<li><p><code>module</code>目录 自己写的一些模块</p>
</li>
</ul>
<h2 id="五、第一个node服务器"><a href="#五、第一个node服务器" class="headerlink" title="五、第一个node服务器"></a>五、第一个node服务器</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">//   安装好node就有的一个模块</span><br><span class="line">//  用来创建http服务器的</span><br><span class="line">const http = require(`http`);</span><br><span class="line"></span><br><span class="line">http.createServer((request,response) =&gt; &#123;</span><br><span class="line">    //request 请求对象     浏览器 请求 服务器所有的内容保存在这个对象里</span><br><span class="line">    //response 响应对象     服务器响应浏览器 所有的方法</span><br><span class="line">    response.writeHead(200 , &#123; &#x27;Content-Type&#x27;:&#x27;text/html&#x27; &#125; );</span><br><span class="line">    //  .end() 结束响应 同时发送一个 Hello Word</span><br><span class="line">    response.end(&#x27;Hello Word&#x27;)</span><br><span class="line">&#125;).listen(233);</span><br><span class="line">//.listen(); 监听端口 233  自定义的端口号</span><br><span class="line">// 如果开启了node服务器  修改完之后的代码必须 重启才能生效</span><br></pre></td></tr></table></figure>


      
    </div>
    <footer class="article-footer">
      <a data-url="http://example.com/2019/05/05/nodejs/node-%E5%85%A5%E9%97%A8/" data-id="cl7icg6uk00oqugun6inq7sc3" data-title="node-入门" class="article-share-link">Share</a>
      
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/nodejs/" rel="tag">nodejs</a></li></ul>

    </footer>
  </div>
  
</article>



  
    <article id="post-数据库/MongoDB" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2019/04/07/%E6%95%B0%E6%8D%AE%E5%BA%93/MongoDB/" class="article-date">
  <time class="dt-published" datetime="2019-04-07T12:31:27.000Z" itemprop="datePublished">2019-04-07</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/%E6%95%B0%E6%8D%AE%E5%BA%93/">数据库</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/2019/04/07/%E6%95%B0%E6%8D%AE%E5%BA%93/MongoDB/">mongodb</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <h1 id="一、环境搭建"><a href="#一、环境搭建" class="headerlink" title="一、环境搭建"></a>一、环境搭建</h1><h2 id="1-1-mongodb简介"><a href="#1-1-mongodb简介" class="headerlink" title="1.1 mongodb简介"></a>1.1 mongodb简介</h2><ul>
<li><code>MongoDB</code>旨在为WEB应用提供可扩展的高性能数据存储解决方案</li>
<li><code>MongoDB</code> 将数据存储为一个文档，数据结构由键值(<code>key=&gt;value</code>)对组成。<code>MongoDB</code> 文档类似于 <code>JSON</code>对象。字段值可以包含其他文档，数组及文档数组</li>
</ul>
<p><img src="http://www.runoob.com/wp-content/uploads/2013/10/crud-annotated-document.png" alt="img"></p>
<p><strong>主要特点</strong></p>
<ul>
<li>高可扩展性</li>
<li>分布式存储</li>
<li>低成本</li>
<li>结构灵活</li>
</ul>
<h2 id="1-2-window下mongodb环境搭建"><a href="#1-2-window下mongodb环境搭建" class="headerlink" title="1.2 window下mongodb环境搭建"></a>1.2 window下mongodb环境搭建</h2><ul>
<li>下载安装包或压缩包</li>
<li>添加<code>db</code>存储和日志存储文件夹</li>
<li>添加服务、配置环境变量、启动<code>Mongo</code></li>
</ul>
<blockquote>
<p>配置演示</p>
</blockquote>
<ul>
<li>在任意目录创建几个文件夹</li>
</ul>
<p><img src="https://poetries1.gitee.io/img-repo/2019/12/182.png" alt="img"><br><img src="https://poetries1.gitee.io/img-repo/2019/12/183.png" alt="img"></p>
<p><strong>通过命令行启动服务</strong></p>
<blockquote>
<p>配置环境变量</p>
</blockquote>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">#  --dbpath指定数据存储位置</span><br><span class="line">C:\Program Files\MongoDB\Server\3.4\bin\mongod --dbpath d:\mongodb\data</span><br></pre></td></tr></table></figure>

<p><img src="https://poetries1.gitee.io/img-repo/2019/12/184.png" alt="img"></p>
<p><strong>通配置启动服务</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"># 配置d:\mongodb\etc\mongodb.conf</span><br><span class="line"></span><br><span class="line">#数据库路径</span><br><span class="line">dbpath=d:\mongodb\data\</span><br><span class="line"></span><br><span class="line">#日志输出文件路径</span><br><span class="line">logpath=d:\mongodb\logs\mongodb.log</span><br><span class="line"></span><br><span class="line">#错误日志采用追加模式，配置这个选项后mongodb的日志会追加到现有的日志文件，而不是从新创建一个新文件</span><br><span class="line">logappend=true</span><br><span class="line"></span><br><span class="line">#启用日志文件，默认启用</span><br><span class="line">journal=true</span><br><span class="line"></span><br><span class="line">#这个选项可以过滤掉一些无用的日志信息，若需要调试使用请设置为false</span><br><span class="line">quiet=true</span><br><span class="line"></span><br><span class="line">#端口号 默认为27017</span><br><span class="line">port=27017</span><br><span class="line"></span><br><span class="line">#指定存储引擎（默认先不加此引擎，如果报错了，大家在加进去）</span><br><span class="line">storageEngine=mmapv1</span><br><span class="line"></span><br><span class="line">#http配置 开启这个服务才可以在网页中访问 端口28017</span><br><span class="line">httpinterface=true</span><br></pre></td></tr></table></figure>

<ul>
<li>启动方式</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">C:\Program Files\MongoDB\Server\3.4\bin\mongod --config d:\mongodb\data</span><br></pre></td></tr></table></figure>

<p><img src="https://poetries1.gitee.io/img-repo/2019/10/349.png" alt="img"></p>
<p><strong>更加简洁的启动方式</strong></p>
<blockquote>
<p>安装到<code>window</code>的服务里面，打开Windows看一下</p>
</blockquote>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">C:\Program Files\MongoDB\Server\3.4\bin\mongod --config d:\mongodb\data --install --serviceName &quot;MongoDB&quot;</span><br></pre></td></tr></table></figure>

<p><img src="https://poetries1.gitee.io/img-repo/2019/10/350.png" alt="img"></p>
<p><strong>使用MongoVue连接数据库</strong></p>
<p><img src="https://poetries1.gitee.io/img-repo/2019/10/351.png" alt="img"><br><img src="https://poetries1.gitee.io/img-repo/2019/10/352.png" alt="img"></p>
<h2 id="1-3-linux下mongodb环境搭建"><a href="#1-3-linux下mongodb环境搭建" class="headerlink" title="1.3 linux下mongodb环境搭建"></a>1.3 linux下mongodb环境搭建</h2><ul>
<li>下载安装包或压缩包</li>
<li>添加<code>db</code>存储和日志存储文件夹</li>
<li>添加服务、配置环境变量、启动<code>Mongo</code></li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"># 远程登录服务器</span><br><span class="line">ssh root@123.142.25.365</span><br></pre></td></tr></table></figure>

<blockquote>
<p>上传本地的安装包</p>
</blockquote>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"># 上传文件夹，传文件不需要r</span><br><span class="line">scp /mongodb/... -r root@123.142.25.365:/home</span><br><span class="line"></span><br><span class="line"># 传到服务器的/home/</span><br><span class="line"># 在指定的目录创建启动需要的文件</span><br><span class="line"></span><br><span class="line">$ cd /home/</span><br><span class="line">$ mkdir etc logs data</span><br><span class="line">$ touch logs/mongodb.log etc/mongo.conf</span><br><span class="line"># /home/etc/mongo.conf配置</span><br><span class="line"></span><br><span class="line">dbpath=/home/mongodb/data</span><br><span class="line">logpath=/mongodb/logs/mongodb.log</span><br><span class="line">logappend=true</span><br><span class="line">journal=true</span><br><span class="line">quiet=true</span><br><span class="line">port=2701</span><br><span class="line"># 启动服务</span><br><span class="line">mongod -f /home/mongodb/etc/mongo.conf</span><br><span class="line"># 创建软连接</span><br><span class="line"></span><br><span class="line">ln -s /home/mongodb/bin/mongo /usr/local/bin/mongo</span><br><span class="line"></span><br><span class="line">ln -s /home/mongodb/bin/mongod /usr/local/bin/mongod</span><br></pre></td></tr></table></figure>

<h1 id="二、基本概念"><a href="#二、基本概念" class="headerlink" title="二、基本概念"></a>二、基本概念</h1><h2 id="2-1-数据库对比"><a href="#2-1-数据库对比" class="headerlink" title="2.1 数据库对比"></a>2.1 数据库对比</h2><table>
<thead>
<tr>
<th align="left">SQL术语&#x2F;概念</th>
<th align="left">MongoDB术语&#x2F;概念</th>
<th align="left">解析&#x2F;说明</th>
</tr>
</thead>
<tbody><tr>
<td align="left"><code>database</code></td>
<td align="left"><code>database</code></td>
<td align="left">数据库</td>
</tr>
<tr>
<td align="left"><code>table</code></td>
<td align="left"><code>collection</code></td>
<td align="left">数据表&#x2F;集合</td>
</tr>
<tr>
<td align="left"><code>row</code></td>
<td align="left"><code>document</code></td>
<td align="left">数据记录&#x2F;文档</td>
</tr>
<tr>
<td align="left"><code>column</code></td>
<td align="left"><code>field</code></td>
<td align="left">数据记录行&#x2F;文档</td>
</tr>
<tr>
<td align="left"><code>index</code></td>
<td align="left"><code>index</code></td>
<td align="left">索引</td>
</tr>
<tr>
<td align="left"><code>table</code></td>
<td align="left"><code>joins</code></td>
<td align="left">表连接，<code>MongoDB</code>不支持</td>
</tr>
<tr>
<td align="left"><code>primary key</code></td>
<td align="left"><code>primary key</code></td>
<td align="left">主键,<code>MongoDB</code>自动将<code>_id</code>字段设置为主键</td>
</tr>
</tbody></table>
<p><img src="http://www.runoob.com/wp-content/uploads/2013/10/Figure-1-Mapping-Table-to-Collection-1.png" alt="img"></p>
<h2 id="2-2-数据库"><a href="#2-2-数据库" class="headerlink" title="2.2 数据库"></a>2.2 数据库</h2><ul>
<li>一个<code>mongodb</code>中可以建立多个数据库</li>
<li><code>MongoDB</code>的默认数据库为”<code>db</code>“，该数据库存储在<code>data</code>目录中</li>
<li><code>&quot;show dbs&quot;</code> 命令可以显示所有数据的列表</li>
<li>执行 <code>&quot;db&quot;</code> 命令可以显示当前数据库对象或集合</li>
<li><code>&quot;use&quot;</code>命令，可以连接到一个指定的数据库</li>
</ul>
<h2 id="2-3-文档"><a href="#2-3-文档" class="headerlink" title="2.3 文档"></a>2.3 文档</h2><ul>
<li>文档是一组键值(<code>key-value</code>)对(即<code>BSON</code>)</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#123;&quot;site&quot;:&quot;www.runoob.com&quot;, &quot;name&quot;:&quot;菜鸟教程&quot;&#125;</span><br></pre></td></tr></table></figure>

<h2 id="2-4-插入文档"><a href="#2-4-插入文档" class="headerlink" title="2.4 插入文档"></a>2.4 插入文档</h2><ul>
<li><p>切换数据库</p>
<ul>
<li><code>use</code> 数据库名(没有就创建)</li>
</ul>
</li>
<li><p>&#96;&#96;&#96;<br>db.createCollection(“user”)</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">  - 创建集合相当于创建表名</span><br><span class="line">  - 或者这样创建</span><br><span class="line">    - `db.user.inert(&#123;id:123&#125;)`</span><br><span class="line"></span><br><span class="line">## 2.5 插入数据表</span><br><span class="line"></span><br><span class="line">**1. 手动插入**</span><br><span class="line"></span><br></pre></td></tr></table></figure></li>
</ul>
<h1 id="切换创建数据库"><a href="#切换创建数据库" class="headerlink" title="切换创建数据库"></a>切换创建数据库</h1><p>use demo </p>
<h1 id="goods相当于数据表"><a href="#goods相当于数据表" class="headerlink" title="goods相当于数据表"></a>goods相当于数据表</h1><p>db.goods.insert({“prodictId”:”10001”,”productName”:”aaa”,”slaePrice”:246,”productImage”:”1.jpg”})</p>
<h1 id="创建数据表，暂时不需插入数据"><a href="#创建数据表，暂时不需插入数据" class="headerlink" title="创建数据表，暂时不需插入数据"></a>创建数据表，暂时不需插入数据</h1><p>db.createCollection(“goods”)</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">**2. 客户端插入**</span><br><span class="line"></span><br><span class="line">&gt; 利用`mongodbVue`导入</span><br><span class="line"></span><br><span class="line"># 三、常用操作</span><br><span class="line"></span><br><span class="line">## 3.1 创建用户</span><br><span class="line"></span><br><span class="line">**1. 创建管理员**</span><br><span class="line"></span><br><span class="line">- 开启服务</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<h1 id="–auth进行授权，需要认证才可以"><a href="#–auth进行授权，需要认证才可以" class="headerlink" title="–auth进行授权，需要认证才可以"></a>–auth进行授权，需要认证才可以</h1><p>mongod -f d:&#x2F;mongodb&#x2F;etc&#x2F;mongodb.conf –auth</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">**2. 通过非授权的方式启动服务**</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<h1 id="创建admin数据库"><a href="#创建admin数据库" class="headerlink" title="创建admin数据库"></a>创建admin数据库</h1><p>use admin </p>
<h1 id="给admin数据库创建账号"><a href="#给admin数据库创建账号" class="headerlink" title="给admin数据库创建账号"></a>给admin数据库创建账号</h1><p>db.createUser({user:”admin”,pwd:”admin”,roles:[“root”]}) # 3.4<br>db.addUser # 2.x</p>
<h1 id="创建成功需要认证"><a href="#创建成功需要认证" class="headerlink" title="创建成功需要认证"></a>创建成功需要认证</h1><p>db.auth(“admin”,”admin”) # 账号、密码</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">![img](https://poetries1.gitee.io/img-repo/2019/10/353.png)</span><br><span class="line"></span><br><span class="line">**3. 给使用的数据库添加用户**</span><br><span class="line"></span><br><span class="line">1. 创建用户</span><br><span class="line"></span><br><span class="line">![img](https://poetries1.gitee.io/img-repo/2019/10/354.png)</span><br><span class="line"></span><br><span class="line">1. 然后在授权登录试一下</span><br><span class="line"></span><br><span class="line">## 3.2 MongoDB 创建数据库</span><br><span class="line"></span><br><span class="line">- `MongoDB` 创建数据库的语法格式如下</span><br><span class="line">- 如果数据库不存在，则创建数据库，否则切换到指定数据库</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>use DATABASE_NAME</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">- 查看所有数据库</span><br><span class="line">  - `show dbs`</span><br><span class="line">- 我们刚创建的数据库 runoob 并不在数据库的列表中， 要显示它，我们需要向 runoob 数据库插入一些数据</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<blockquote>
<p>db.runoob.insert({“name”:”poetries”})<br>WriteResult({ “nInserted” : 1 })<br>show dbs</p>
</blockquote>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">## 3.3 MongoDB 删除数据库</span><br><span class="line"></span><br><span class="line">- `MongoDB`删除数据库的语法格式如下</span><br><span class="line">- 删除当前数据库，默认为 `test`，你可以使用 `db` 命令查看当前数据库名</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>db.dropDatabase()</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">## 3.4 删除集合</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>db.collection.drop()</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">## 3.5 MongoDB 插入文档</span><br><span class="line"></span><br><span class="line">&gt; 文档的数据结构和`JSON`基本一样</span><br><span class="line"></span><br><span class="line">## 3.6 插入文档</span><br><span class="line"></span><br><span class="line">- `MongoDB` 使用 `insert()`或 `save()` 方法向集合中插入文档，语法如下</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>db.COLLECTION_NAME.insert(document)</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">- 以下文档可以存储在 `MongoDB` 的 `runoob`数据库 的 `col` 集合中</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<blockquote>
<p>db.col.insert({title: ‘MongoDB 学习’,<br>    description: ‘MongoDB 是一个 Nosql 数据库’,<br>    by: ‘poetries’,<br>    url: ‘<a target="_blank" rel="noopener" href="http://blog.poetries.top&/#39;">http://blog.poetries.top&#39;</a>,<br>    tags: [‘mongodb’, ‘database’, ‘NoSQL’],<br>    likes: 100<br>})</p>
</blockquote>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">- 以上实例中 `col` 是我们的集合名，如果该集合不在该数据库中， `MongoDB` 会自动创建该集合并插入文档。</span><br><span class="line">- 查看已插入文档</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<blockquote>
<p>db.col.find()<br>db.col.find().pretty() #格式化方式查看</p>
</blockquote>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">## 3.7 MongoDB 更新文档</span><br><span class="line"></span><br><span class="line">- `MongoDB` 使用 `update()` 和 `save()` 方法来更新集合中的文档</span><br><span class="line"></span><br><span class="line">## 3.7 update() 方法</span><br><span class="line"></span><br><span class="line">&gt; `update()` 方法用于更新已存在的文档。语法格式如下</span><br><span class="line"></span><br><span class="line">- 通过 `update()`方法来更新标题(`title`):</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>db.col.update({‘title’:’MongoDB 学习’},{$set:{‘title’:’MongoDB’}})</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"># 四、常用查询语句</span><br><span class="line"></span><br><span class="line">| mongo                                                       | sql                                                          | 说明                                 |</span><br><span class="line">| :---------------------------------------------------------- | :----------------------------------------------------------- | :----------------------------------- |</span><br><span class="line">| `db.users.find()`                                           | `select * from users`                                        | 从`user`表中查询所有数据             |</span><br><span class="line">| `db.users.find(&#123;“username” : “joe”, “age” : 27&#125;)`           | `select * from users where “username” = “joe” and age = 27`  | 查找`username = joe`且`age = 27`的人 |</span><br><span class="line">| `db.users.find(&#123;&#125;, &#123;“username” : 1, “email” : 1&#125;)`          | `select username, email from users`                          | 查找`username`,`email`这`2`个子项    |</span><br><span class="line">| `db.users.find(&#123;“age” : &#123;“$gt” : 18&#125;&#125;)`                     | `select * from users where age &gt;18`                          | 查找`age &gt; 18`的会员                 |</span><br><span class="line">| `db.users.find(&#123;“age” : &#123;“$gte” : 18&#125;&#125;)`                    | `select * from users where age &gt;=18`                         | 查找`age &gt;= 18`的人                  |</span><br><span class="line">| `db.users.find(&#123;“age” : &#123;“$lt” : 18&#125;&#125;)`                     | `select * from users where age &lt;18`                          | 查找`age &lt; 18`的人                   |</span><br><span class="line">| `db.users.find(&#123;“age” : &#123;“$lte” : 18&#125;&#125;)`                    | `select * from users where age &lt;=18`                         | 查找`age &lt;= 18`的人                  |</span><br><span class="line">| `db.users.find(&#123;“username” : &#123;“$ne” : “joe”&#125;&#125;)`             | `select * from users where username &lt;&gt; “joe”`                | 查找 `username != joe`的会员         |</span><br><span class="line">| `db.users.find(&#123;“ticket_no” : &#123;“$in” : [725, 542, 390]&#125;&#125;)`  | `select * from users where ticket_no in (725, 542, 390)`     | 符合`tickt_no`在此范围的结果         |</span><br><span class="line">| `db.users.find(&#123;“ticket_no” : &#123;“$nin” : [725, 542, 390]&#125;&#125;)` | `select * from users where ticket_no not in (725, 542, 390)` | 符合`tickt_no`不在此范围的结果       |</span><br><span class="line">| `db.users.find(&#123;“name” : /joey^/&#125;)`                         | `select * from users where name like “joey%”`                | 查找前`4`个字符为`joey`的人          |</span><br><span class="line"></span><br><span class="line"># 五、MongoDB链接</span><br><span class="line"></span><br><span class="line">## 5.1 MongoDB链接express</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>const express &#x3D; require(‘express’);<br>const mongoose &#x3D; require(‘mongoose’);<br>const app &#x3D; express();</p>
<p>&#x2F;&#x2F; 连接mongo 并且使用React这个集合，没有就会新建<br>const DB_URL &#x3D; ‘mongodb:&#x2F;&#x2F;127.0.0.1:27017&#x2F;react’;<br>mongoose.connect(DB_URL);<br>mongoose.connection.on(‘connected’,()&#x3D;&gt;{<br>    console.log(‘mongo connect success’);<br>})</p>
<p>&#x2F;&#x2F; 类似于MySQL的表 mongo里有文档、字段的概念</p>
<p>const User &#x3D; mongoose.model(‘user’,new mongoose.Schema({<br>    user:{type:String,require:true},<br>    age:{type:Number,require:true}<br>}))</p>
<p>&#x2F;&#x2F;新增数据<br>&#x2F;&#x2F; User.create({<br>&#x2F;&#x2F;     user:’小胡’,<br>&#x2F;&#x2F;     age:18<br>&#x2F;&#x2F; },(err,doc)&#x3D;&gt;{<br>&#x2F;&#x2F;     if(!err) {<br>&#x2F;&#x2F;         console.log(doc)<br>&#x2F;&#x2F;     } else {<br>&#x2F;&#x2F;         console.log(err)<br>&#x2F;&#x2F;     }<br>&#x2F;&#x2F; })</p>
<p>&#x2F;&#x2F; 删除数据 {}过滤对象<br>&#x2F;&#x2F; User.remove({age:22},(err,doc)&#x3D;&gt;{<br>&#x2F;&#x2F;     console.log(doc)<br>&#x2F;&#x2F; })<br>&#x2F;&#x2F; 更新<br>User.update({‘user’:’小明’},{‘$set’:{age:30}},(err,doc)&#x3D;&gt;{<br>    console.log(doc)<br>})<br>app.get(‘&#x2F;‘,(req,res)&#x3D;&gt;{<br>    res.send(‘<h1>Hello word!</h1>‘)<br>})<br>app.get(‘&#x2F;data’,(req,res)&#x3D;&gt;{<br>    &#x2F;&#x2F; findOne 只返回一条，返回对象直接使用，而不是返回数组<br>    User.findOne({‘user’:’小明’},(err,doc)&#x3D;&gt;{<br>        res.json(doc)<br>    })<br>})</p>
<p>app.listen(9000,()&#x3D;&gt;{<br>    console.log(‘Node app listen 9000’)<br>})<br>&#96;&#96;&#96;</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://example.com/2019/04/07/%E6%95%B0%E6%8D%AE%E5%BA%93/MongoDB/" data-id="cl7icg7bt00yhugun5ayk1mip" data-title="mongodb" class="article-share-link">Share</a>
      
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/mongodb/" rel="tag">mongodb</a></li></ul>

    </footer>
  </div>
  
</article>



  


  <nav id="page-nav">
    
    <a class="extend prev" rel="prev" href="/page/8/">&laquo; Prev</a><a class="page-number" href="/">1</a><span class="space">&hellip;</span><a class="page-number" href="/page/7/">7</a><a class="page-number" href="/page/8/">8</a><span class="page-number current">9</span><a class="page-number" href="/page/10/">10</a><a class="page-number" href="/page/11/">11</a><span class="space">&hellip;</span><a class="page-number" href="/page/20/">20</a><a class="extend next" rel="next" href="/page/10/">Next &raquo;</a>
  </nav>

</section>
        
          <aside id="sidebar">
  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Categories</h3>
    <div class="widget">
      <ul class="category-list"><li class="category-list-item"><a class="category-list-link" href="/categories/React/">React</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/http/">http</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/javascript/">javascript</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/liunx/">liunx</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/%E5%89%8D%E7%AB%AF/">前端</a><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/%E5%89%8D%E7%AB%AF/%E7%A7%BB%E5%8A%A8%E7%AB%AF/">移动端</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/%E5%89%8D%E7%AB%AF/%E9%97%AE%E9%A2%98/">问题</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/%E5%89%8D%E7%AB%AF/%E9%9F%B3%E8%A7%86%E9%A2%91/">音视频</a></li></ul></li><li class="category-list-item"><a class="category-list-link" href="/categories/%E5%89%8D%E7%AB%AF%E5%B7%A5%E7%A8%8B%E5%8C%96/">前端工程化</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/%E5%89%8D%E7%AB%AF%E6%80%A7%E8%83%BD%E4%BC%98%E5%8C%96/">前端性能优化</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/%E5%90%8E%E7%AB%AF/">后端</a><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/%E5%90%8E%E7%AB%AF/%E6%A1%86%E6%9E%B6/">框架</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/%E5%90%8E%E7%AB%AF/%E7%AE%97%E6%B3%95/">算法</a></li></ul></li><li class="category-list-item"><a class="category-list-link" href="/categories/%E5%B0%8F%E7%A8%8B%E5%BA%8F/">小程序</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/%E5%B7%A5%E5%85%B7/">工具</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F/">操作系统</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/%E6%95%B0%E6%8D%AE%E5%8F%AF%E8%A7%86%E5%8C%96/">数据可视化</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/%E6%95%B0%E6%8D%AE%E5%BA%93/">数据库</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/%E6%9E%B6%E6%9E%84%E6%A8%A1%E5%BC%8F/">架构模式</a><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/%E6%9E%B6%E6%9E%84%E6%A8%A1%E5%BC%8F/%E6%A1%86%E6%9E%B6/">框架</a></li></ul></li><li class="category-list-item"><a class="category-list-link" href="/categories/%E6%A1%86%E6%9E%B6/">框架</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/%E6%AD%A3%E5%88%99%E8%A1%A8%E8%BE%BE%E5%BC%8F/">正则表达式</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/%E6%B5%8F%E8%A7%88%E5%99%A8/">浏览器</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/%E7%AE%97%E6%B3%95/">算法</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/">设计模式</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Tags</h3>
    <div class="widget">
      <ul class="tag-list" itemprop="keywords"><li class="tag-list-item"><a class="tag-list-link" href="/tags/Mock/" rel="tag">Mock</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Promise/" rel="tag">Promise</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/RESTful/" rel="tag">RESTful</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/React/" rel="tag">React</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Redux/" rel="tag">Redux</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/async-await/" rel="tag">async&#x2F;await</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/css/" rel="tag">css</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/echart/" rel="tag">echart</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/es6/" rel="tag">es6</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/eslint/" rel="tag">eslint</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/git/" rel="tag">git</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/glup/" rel="tag">glup</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/hexo/" rel="tag">hexo</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/html/" rel="tag">html</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/http/" rel="tag">http</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/javascript/" rel="tag">javascript</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/mongodb/" rel="tag">mongodb</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/mysql/" rel="tag">mysql</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/nginx/" rel="tag">nginx</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/nodejs/" rel="tag">nodejs</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/python/" rel="tag">python</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/react/" rel="tag">react</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/typescript/" rel="tag">typescript</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/vs-code/" rel="tag">vs code</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/vue/" rel="tag">vue</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/vue3/" rel="tag">vue3</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/webpack/" rel="tag">webpack</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/xml/" rel="tag">xml</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E4%BC%98%E5%8C%96/" rel="tag">优化</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E5%89%8D%E7%AB%AF/" rel="tag">前端</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E5%B0%8F%E7%A8%8B%E5%BA%8F/" rel="tag">小程序</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F/" rel="tag">操作系统</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E6%AD%A3%E5%88%99%E8%A1%A8%E8%BE%BE%E5%BC%8F/" rel="tag">正则表达式</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E6%B5%8F%E8%A7%88%E5%99%A8/" rel="tag">浏览器</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E7%A7%BB%E5%8A%A8%E7%AB%AF/" rel="tag">移动端</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E7%AE%97%E6%B3%95/" rel="tag">算法</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/" rel="tag">设计模式</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Tag Cloud</h3>
    <div class="widget tagcloud">
      <a href="/tags/Mock/" style="font-size: 10px;">Mock</a> <a href="/tags/Promise/" style="font-size: 10px;">Promise</a> <a href="/tags/RESTful/" style="font-size: 10px;">RESTful</a> <a href="/tags/React/" style="font-size: 19.17px;">React</a> <a href="/tags/Redux/" style="font-size: 11.67px;">Redux</a> <a href="/tags/async-await/" style="font-size: 10px;">async/await</a> <a href="/tags/css/" style="font-size: 11.67px;">css</a> <a href="/tags/echart/" style="font-size: 10px;">echart</a> <a href="/tags/es6/" style="font-size: 15px;">es6</a> <a href="/tags/eslint/" style="font-size: 10px;">eslint</a> <a href="/tags/git/" style="font-size: 16.67px;">git</a> <a href="/tags/glup/" style="font-size: 10.83px;">glup</a> <a href="/tags/hexo/" style="font-size: 10px;">hexo</a> <a href="/tags/html/" style="font-size: 15px;">html</a> <a href="/tags/http/" style="font-size: 17.5px;">http</a> <a href="/tags/javascript/" style="font-size: 18.33px;">javascript</a> <a href="/tags/mongodb/" style="font-size: 10px;">mongodb</a> <a href="/tags/mysql/" style="font-size: 10px;">mysql</a> <a href="/tags/nginx/" style="font-size: 10.83px;">nginx</a> <a href="/tags/nodejs/" style="font-size: 13.33px;">nodejs</a> <a href="/tags/python/" style="font-size: 10.83px;">python</a> <a href="/tags/react/" style="font-size: 10px;">react</a> <a href="/tags/typescript/" style="font-size: 12.5px;">typescript</a> <a href="/tags/vs-code/" style="font-size: 11.67px;">vs code</a> <a href="/tags/vue/" style="font-size: 20px;">vue</a> <a href="/tags/vue3/" style="font-size: 10px;">vue3</a> <a href="/tags/webpack/" style="font-size: 19.17px;">webpack</a> <a href="/tags/xml/" style="font-size: 10px;">xml</a> <a href="/tags/%E4%BC%98%E5%8C%96/" style="font-size: 14.17px;">优化</a> <a href="/tags/%E5%89%8D%E7%AB%AF/" style="font-size: 10.83px;">前端</a> <a href="/tags/%E5%B0%8F%E7%A8%8B%E5%BA%8F/" style="font-size: 15.83px;">小程序</a> <a href="/tags/%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F/" style="font-size: 10px;">操作系统</a> <a href="/tags/%E6%AD%A3%E5%88%99%E8%A1%A8%E8%BE%BE%E5%BC%8F/" style="font-size: 10px;">正则表达式</a> <a href="/tags/%E6%B5%8F%E8%A7%88%E5%99%A8/" style="font-size: 13.33px;">浏览器</a> <a href="/tags/%E7%A7%BB%E5%8A%A8%E7%AB%AF/" style="font-size: 10.83px;">移动端</a> <a href="/tags/%E7%AE%97%E6%B3%95/" style="font-size: 10px;">算法</a> <a href="/tags/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/" style="font-size: 10.83px;">设计模式</a>
    </div>
  </div>

  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Archives</h3>
    <div class="widget">
      <ul class="archive-list"><li class="archive-list-item"><a class="archive-list-link" href="/archives/2022/08/">August 2022</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2022/01/">January 2022</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2021/10/">October 2021</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2021/09/">September 2021</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2021/08/">August 2021</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2021/07/">July 2021</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2021/06/">June 2021</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2021/05/">May 2021</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2021/04/">April 2021</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2021/03/">March 2021</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2021/02/">February 2021</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/12/">December 2020</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/11/">November 2020</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/10/">October 2020</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/09/">September 2020</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/07/">July 2020</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/06/">June 2020</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/05/">May 2020</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/04/">April 2020</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/03/">March 2020</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/02/">February 2020</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/01/">January 2020</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/12/">December 2019</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/11/">November 2019</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/10/">October 2019</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/09/">September 2019</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/08/">August 2019</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/07/">July 2019</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/06/">June 2019</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/05/">May 2019</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/04/">April 2019</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/03/">March 2019</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/02/">February 2019</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/01/">January 2019</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/12/">December 2018</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/11/">November 2018</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/10/">October 2018</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/09/">September 2018</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/08/">August 2018</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/07/">July 2018</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/06/">June 2018</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/05/">May 2018</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/04/">April 2018</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/03/">March 2018</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/02/">February 2018</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/01/">January 2018</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Recent Posts</h3>
    <div class="widget">
      <ul>
        
          <li>
            <a href="/2022/08/25/Js%E5%9F%BA%E6%9C%AC%E6%95%B0%E6%8D%AE%E7%B1%BB%E5%9E%8B/">变量类型</a>
          </li>
        
          <li>
            <a href="/2022/08/25/hello-world/">Hello World</a>
          </li>
        
          <li>
            <a href="/2022/01/18/React/React-%E6%8F%90%E9%AB%98%E7%BB%84%E4%BB%B6%E6%95%88%E7%8E%87%20%20%E9%81%BF%E5%85%8D%E4%B8%8D%E5%BF%85%E8%A6%81%E7%9A%84render/">React-提高组件效率  避免不必要的render</a>
          </li>
        
          <li>
            <a href="/2022/01/12/%E5%B7%A5%E5%85%B7/git-stach/">git-stach</a>
          </li>
        
          <li>
            <a href="/2021/10/16/Vue/vue3%E4%BC%98%E5%8C%96/">vue3优化</a>
          </li>
        
      </ul>
    </div>
  </div>

  
</aside>
        
      </div>
      <footer id="footer">
  
  <div class="outer">
    <div id="footer-info" class="inner">
      
      &copy; 2022 John Doe<br>
      Powered by <a href="https://hexo.io/" target="_blank">Hexo</a>
    </div>
  </div>
</footer>

    </div>
    <nav id="mobile-nav">
  
    <a href="/" class="mobile-nav-link">Home</a>
  
    <a href="/archives" class="mobile-nav-link">Archives</a>
  
</nav>
    


<script src="/js/jquery-3.4.1.min.js"></script>



  
<script src="/fancybox/jquery.fancybox.min.js"></script>




<script src="/js/script.js"></script>





  </div>
</body>
</html>
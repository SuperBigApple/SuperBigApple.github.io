<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
    <meta name="author" content="John Doe">
    
    
    
    
    
    
    <title>Hexo</title>
    <!-- inject:style -->
    <link href="/css/style.css" rel="stylesheet" type="text/css">
    <!-- endinject -->
    <style>
        .cube-loading {
            top: 0;
            position: fixed;
            width: 100%;
            height: 100%;
            background: url('/images/lg/loading.gif') no-repeat center center;
            background-color: rgba(0,0,0,.7);
        }

        .cube-loading.out {
            display: none;
        }

        .cube-loading:before {
            display: block;
            content: 'Loading';
            position: relative;
            width: 100%;
            top: 50%;
            right: -50%;
            color: #fff;
        }

        @media(max-width: 768px) {
            .cube-loading:before {
                font-size: 1.2em;
                transform: translate(-24px,20px);
                -webkit-transform: translate(-24px,20px);
                -o-transform: translate(-24px,20px);
                -ms-transform: translate(-24px,20px);
            }
        }

        @media(min-width: 768px) {
            .cube-loading:before {

            }
        }
    </style>
    
<meta name="generator" content="Hexo 6.2.0"></head>
<body>
<div class="cube-body">
    <nav id="cube-top-memu" class="cube-menu">
    <ul class="cube-menu-collapse">
        
        <li>
            <i class="cube-icon cube-icon-home" aria-hidden="true"></i>
            <a href="/">é¦–é¡µ</a>
        </li>
        
        <li>
            <i class="cube-icon cube-icon-archive" aria-hidden="true"></i>
            <a href="/archives">å½’æ¡£</a>
        </li>
        
        <li>
            <i class="cube-icon cube-icon-categories" aria-hidden="true"></i>
            <a href="/categories">åˆ†ç±»</a>
        </li>
        
        <li>
            <i class="cube-icon cube-icon-tags" aria-hidden="true"></i>
            <a href="/tags">æ ‡ç­¾</a>
        </li>
        
        <li>
            <i class="cube-icon cube-icon-about" aria-hidden="true"></i>
            <a href="/about-me">å…³äºæˆ‘</a>
        </li>
        
    </ul>
</nav>
<nav class="cube-side-menu" id="cube-side-menu">
    <ul class="cube-menu-list">
        
        <li>
            <a class="lrc-control">Open Lyrics</a>
        </li>
        
        <li>
            <a class="scroll-to-top">Top</a>
        </li>
    </ul>
</nav>
    <header class="cube-header" id="cube-header">
    <img src=" https://gimg2.baidu.com/image_search/src=http%3A%2F%2Fb-ssl.duitang.com%2Fuploads%2Fitem%2F201502%2F28%2F20150228220759_zaP3N.png&amp;refer=http%3A%2F%2Fb-ssl.duitang.com&amp;app=2002&amp;size=f9999,10000&amp;q=a80&amp;n=0&amp;g=0n&amp;fmt=auto?sec=1664943562&amp;t=f546331d7d5aee27ceb7af09c60899f2 " alt="å¤´éƒ¨èƒŒæ™¯å›¾ç‰‡">
    
    <div class="cube-type">
        <span class="cube-typed-title">ğŸçš„ä¸ªäººåšå®¢ ^_^</span>
        <span class="cube-typed-cursor">|</span>
    </div>
    
</header>

    <style>
        nav.cube-menu:before {
            content: '';
            visibility: hidden;
            position: absolute;
            left: 0;
            top: 0;
            width: 100%;
            height: 44px;
        
            filter: blur(5px);
            -webkit-filter: blur(5px);
        
            z-index: -1;
            background-image: url('https://gimg2.baidu.com/image_search/src=http%3A%2F%2Fb-ssl.duitang.com%2Fuploads%2Fitem%2F201502%2F28%2F20150228220759_zaP3N.png&amp;refer=http%3A%2F%2Fb-ssl.duitang.com&amp;app=2002&amp;size=f9999,10000&amp;q=a80&amp;n=0&amp;g=0n&amp;fmt=auto?sec=1664943562&amp;t=f546331d7d5aee27ceb7af09c60899f2');
            background-repeat: no-repeat;
            background-position: center -356px;
            background-size: cover;
            background-color: transparent;
        }

        header.cube-background.cube-header-background {
            visibility: hidden;
            background-image: url('https://gimg2.baidu.com/image_search/src=http%3A%2F%2Fb-ssl.duitang.com%2Fuploads%2Fitem%2F201502%2F28%2F20150228220759_zaP3N.png&amp;refer=http%3A%2F%2Fb-ssl.duitang.com&amp;app=2002&amp;size=f9999,10000&amp;q=a80&amp;n=0&amp;g=0n&amp;fmt=auto?sec=1664943562&amp;t=f546331d7d5aee27ceb7af09c60899f2');
            background-position: center -400px;
        }
    </style>
    <header class="cube-background cube-header-background">
        
        <div class="cube-type">
            <span class="cube-typed-title">ğŸçš„ä¸ªäººåšå®¢ ^_^</span>
            <span class="cube-typed-cursor">|</span>
        </div>
        
    </header>
    <div class="load-header-background"></div>
    <script>
        (function (window) {

            window.headerModule = {}
            window.headerModule.image = {
                width: '2000',
                height: '1414'
            }

        })(window)
    </script>
    
    <div class="cube-content">
        <div class="cube-left">
            
<div class="cube-excerpt" id="cube-excerpt-NginxåŸºç¡€é…ç½®">
    <header class="cube-excerpt-header">
        <h1><a href="/2019/09/24/%E9%83%A8%E7%BD%B2/Nginx%E5%9F%BA%E7%A1%80%E9%85%8D%E7%BD%AE/">NginxåŸºç¡€é…ç½®</a></h1>
        <div class="cube-excerpt-header-msg">
            <div class="cube-excerpt-date">
                <i class="cube-icon cube-icon-date" aria-hidden="true"></i>
                2019-09-24
            </div>
            <div class="cube-excerpt-tags">
                <i class="cube-icon cube-icon-tag" aria-hidden="true"></i>
                
                <a href="/tags/nginx/" class="cube-excerpt-tag-link">#nginx</a>
                
            </div>
        </div>
    </header>
    <article class="cube-excerpt-entry cube-markdown">
        
        
           <blockquote>
<p>Nginx é…ç½®æ–‡ä»¶åœ¨çº¿ç”Ÿæˆ: <a target="_blank" rel="noopener" href="https://nginxconfig.io/">https://nginxconfig.io/</a></p>
</blockquote>
<h3 id="Nginxçš„å¯åŠ¨ã€åœæ­¢ä¸é‡å¯"><a href="#Nginxçš„å¯åŠ¨ã€åœæ­¢ä¸é‡å¯" class="headerlink" title="Nginxçš„å¯åŠ¨ã€åœæ­¢ä¸é‡å¯"></a>Nginxçš„å¯åŠ¨ã€åœæ­¢ä¸é‡å¯</h3><ul>
<li>å»ºç«‹è½¯è¿æ¥<code>Nginx</code>åˆ°<code>/usr/bin</code>ç›®å½•ä¸‹ <code>ln -s /usr/sbin/nginx /usr/bin</code></li>
</ul>
<h4 id="å¯åŠ¨"><a href="#å¯åŠ¨" class="headerlink" title="å¯åŠ¨"></a>å¯åŠ¨</h4><ul>
<li>å¯åŠ¨ä»£ç æ ¼å¼ï¼š<code>nginx</code>å®‰è£…ç›®å½•åœ°å€ <code>-c nginx</code>é…ç½®æ–‡ä»¶åœ°å€</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[root@LinuxServer sbin]# /usr/local/nginx/sbin/nginx -c /usr/local/nginx/conf/nginx.conf</span><br></pre></td></tr></table></figure>

<h4 id="åœæ­¢"><a href="#åœæ­¢" class="headerlink" title="åœæ­¢"></a>åœæ­¢</h4><blockquote>
<p>nginxçš„åœæ­¢æœ‰ä¸‰ç§æ–¹å¼</p>
</blockquote>
<p><strong>ä»å®¹åœæ­¢</strong></p>
<ul>
<li>æŸ¥çœ‹è¿›ç¨‹å· <code>ps -ef|grep nginx</code></li>
</ul>
<p><img src="http://images2015.cnblogs.com/blog/848552/201601/848552-20160102182744854-1291053517.png" alt="img"></p>
<ul>
<li>æ€æ­»è¿›ç¨‹ kill -QUIT 2072</li>
</ul>
<p><img src="http://images2015.cnblogs.com/blog/848552/201601/848552-20160102182652354-960281274.png" alt="img"></p>
<p><strong>å¿«é€Ÿåœæ­¢</strong></p>
<ul>
<li>æŸ¥çœ‹è¿›ç¨‹å· <code>ps -ef|grep nginx</code></li>
</ul>
<p><img src="http://images2015.cnblogs.com/blog/848552/201601/848552-20160102183103651-1859453208.png" alt="img"></p>
<ul>
<li>æ€æ­»è¿›ç¨‹ <code>kill -TERM 2132</code> <code>kill -INT 2132</code></li>
</ul>
<p><img src="http://images2015.cnblogs.com/blog/848552/201601/848552-20160102183340010-2024212451.png" alt="img"></p>
<ul>
<li>å¼ºåˆ¶åœæ­¢ <code>pkill -9 nginx</code></li>
</ul>
<p><strong>é‡å¯</strong></p>
<blockquote>
<p>éªŒè¯<code>nginx</code>é…ç½®æ–‡ä»¶æ˜¯å¦æ­£ç¡®</p>
</blockquote>
<ul>
<li>æ–¹æ³•ä¸€ï¼šè¿›å…¥<code>nginx</code>å®‰è£…ç›®å½•<code>sbin</code>ä¸‹ï¼Œè¾“å…¥å‘½ä»¤<code>./nginx -t</code><br>çœ‹åˆ°å¦‚ä¸‹æ˜¾ç¤º<code>nginx.conf syntax is ok nginx.conf test is successful</code>è¯´æ˜é…ç½®æ–‡ä»¶æ­£ç¡®</li>
</ul>
<p><img src="http://images2015.cnblogs.com/blog/848552/201601/848552-20160102184633432-1268782338.png" alt="img"></p>
<ul>
<li>æ–¹æ³•äºŒï¼šåœ¨å¯åŠ¨å‘½ä»¤<code>-c</code>å‰åŠ <code>-t</code></li>
</ul>
<p><img src="http://images2015.cnblogs.com/blog/848552/201601/848552-20160102185023385-456612180.png" alt="img"></p>
<p><strong>é‡å¯NginxæœåŠ¡</strong></p>
<ul>
<li>æ–¹æ³•ä¸€ï¼šè¿›å…¥<code>nginx</code>å¯æ‰§è¡Œç›®å½•<code>sbin</code>ä¸‹ï¼Œè¾“å…¥å‘½ä»¤<code>./nginx -s reload</code>å³å¯</li>
</ul>
<p><img src="http://images2015.cnblogs.com/blog/848552/201601/848552-20160102185521057-1341380905.png" alt="img"></p>
<ul>
<li>æ–¹æ³•äºŒï¼šæŸ¥æ‰¾å½“å‰<code>nginx</code>è¿›ç¨‹å·ï¼Œç„¶åè¾“å…¥å‘½ä»¤ï¼š<code>kill -HUP</code> è¿›ç¨‹å· å®ç°é‡å¯<code>nginx</code>æœåŠ¡</li>
</ul>
<p><img src="http://images2015.cnblogs.com/blog/848552/201601/848552-20160102185838167-234856506.png" alt="img"></p>
<h3 id="NginxåŸºç¡€é…ç½®"><a href="#NginxåŸºç¡€é…ç½®" class="headerlink" title="NginxåŸºç¡€é…ç½®"></a>NginxåŸºç¡€é…ç½®</h3><ul>
<li>åœ¨<code>Nginx</code>ç›®å½•ä¸‹çš„<code>vhostæˆ–conf.d</code>ç›®å½•ä¸‹æ–°å»ºä¸€ä¸ªé…ç½®æ–‡ä»¶ï¼ˆå¦‚<code>poetries-80.conf</code>ï¼‰</li>
<li>æŠŠserverçš„å†…å®¹é…ç½®è¿›å»</li>
<li>åœ¨<code>Nginx.conf</code>ä¸­çš„<code>http</code>ä¸‹<code>include</code>é…ç½®æ–‡ä»¶</li>
<li>æ£€æµ‹é…ç½®æ–‡ä»¶æ˜¯å¦å‡ºé”™ <code>åˆ‡æ¢åˆ°/etc/nginxä¸‹ nginx -t</code></li>
<li>é‡æ–°åŠ è½½é…ç½®æ–‡ä»¶ <code>nginx -c /usr/local/etc/nginx/nginx.conf</code></li>
<li>åœ¨é‡å¯<code>Nginx</code> <code>nginx -s reload</code></li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line">user  root;  //Nginxéœ€è¦æœ‰æœ‰ä¸€ä¸ªç”¨æˆ·</span><br><span class="line">worker_processes  2; // Nginxè¿›ç¨‹æ•° æœ€å¤§1024</span><br><span class="line">pid        conf/nginx.pid; </span><br><span class="line">worker_rlimit_nofile 2048;</span><br><span class="line">events &#123;</span><br><span class="line">    use epoll;</span><br><span class="line">    worker_connections  2048;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">http &#123;</span><br><span class="line"> </span><br><span class="line"></span><br><span class="line">	server &#123;</span><br><span class="line">       listen       80;</span><br><span class="line">       server_name  119.29.145.252;</span><br><span class="line">	   </span><br><span class="line">       location / &#123;</span><br><span class="line">           root   /usr/local/nginx/html;</span><br><span class="line">           index  index.html index.htm;</span><br><span class="line">        &#125;</span><br><span class="line">   &#125;</span><br><span class="line">   server &#123;</span><br><span class="line">       listen       3001;</span><br><span class="line">       server_name  119.29.145.252;</span><br><span class="line">	   </span><br><span class="line">       location / &#123;</span><br><span class="line">           root   /usr/local/nginx/book;</span><br><span class="line">           index  index.html index.htm;</span><br><span class="line">        &#125;</span><br><span class="line">   &#125;</span><br><span class="line">   server &#123;</span><br><span class="line">       listen       9000;</span><br><span class="line">       server_name  119.29.145.252;</span><br><span class="line">	   </span><br><span class="line">       location / &#123;</span><br><span class="line">           root   /usr/local/nginx/vue;</span><br><span class="line">           index  index.html index.htm;</span><br><span class="line">        &#125;</span><br><span class="line">   &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="ä¸€äº›é”™è¯¯"><a href="#ä¸€äº›é”™è¯¯" class="headerlink" title="ä¸€äº›é”™è¯¯"></a>ä¸€äº›é”™è¯¯</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">nginx: [error] invalid PID number â€œâ€ in â€œ/usr/local/var/run/nginx/nginx.pidâ€</span><br></pre></td></tr></table></figure>

<ul>
<li>è§£å†³åŠæ³•ï¼š<code>nginx -c /usr/local/etc/nginx/nginx.conf</code></li>
<li><code>nginx -s reload</code></li>
</ul>
<p><strong>æƒé™é—®é¢˜å¯¼è‡´Nginx 403 Forbiddené”™è¯¯çš„è§£å†³æ–¹æ³•</strong></p>
<ul>
<li>åœ¨<code>nginx.conf</code>å¤´éƒ¨åŠ å…¥ä¸€è¡Œ <code>user root;</code></li>
<li>é‡å¯<code>nginx</code>å†è®¿é—®ï¼Œå°±å¯ä»¥æ­£å¸¸è®¿é—®äº†</li>
</ul>

        
    </article>
    <footer class="cube-excerpt-footer">
        <a class="cube-excerpt-more" href="/2019/09/24/%E9%83%A8%E7%BD%B2/Nginx%E5%9F%BA%E7%A1%80%E9%85%8D%E7%BD%AE/">Read More</a>
    </footer>
</div>

<div class="cube-excerpt" id="cube-excerpt-Nginxå­¦ä¹ ">
    <header class="cube-excerpt-header">
        <h1><a href="/2019/08/30/%E9%83%A8%E7%BD%B2/Nginx%E5%AD%A6%E4%B9%A0/">Nginxå­¦ä¹ </a></h1>
        <div class="cube-excerpt-header-msg">
            <div class="cube-excerpt-date">
                <i class="cube-icon cube-icon-date" aria-hidden="true"></i>
                2019-08-30
            </div>
            <div class="cube-excerpt-tags">
                <i class="cube-icon cube-icon-tag" aria-hidden="true"></i>
                
                <a href="/tags/nginx/" class="cube-excerpt-tag-link">#nginx</a>
                
            </div>
        </div>
    </header>
    <article class="cube-excerpt-entry cube-markdown">
        
        
           <blockquote>
<p>Nginx é…ç½®æ–‡ä»¶åœ¨çº¿ç”Ÿæˆ: <a target="_blank" rel="noopener" href="https://nginxconfig.io/">https://nginxconfig.io/</a></p>
</blockquote>
<blockquote>
<p><code>Nginx</code> æ˜¯ä¸€æ¬¾é¢å‘æ€§èƒ½è®¾è®¡çš„ <code>HTTP</code> æœåŠ¡å™¨ï¼Œèƒ½åå‘ä»£ç† <code>HTTP</code>ï¼Œ<code>HTTPS</code> å’Œé‚®ä»¶ç›¸å…³(<code>SMTP</code>ï¼Œ<code>POP3</code>ï¼Œ<code>IMAP</code>)çš„åè®®é“¾æ¥ã€‚å¹¶ä¸”æä¾›äº†è´Ÿè½½å‡è¡¡ä»¥åŠ <code>HTTP</code> ç¼“å­˜ã€‚å®ƒçš„è®¾è®¡å……åˆ†ä½¿ç”¨å¼‚æ­¥äº‹ä»¶æ¨¡å‹ï¼Œå‰Šå‡ä¸Šä¸‹æ–‡è°ƒåº¦çš„å¼€é”€ï¼Œæé«˜æœåŠ¡å™¨å¹¶å‘èƒ½åŠ›ã€‚é‡‡ç”¨äº†æ¨¡å—åŒ–è®¾è®¡ï¼Œæä¾›äº†ä¸°å¯Œæ¨¡å—çš„ç¬¬ä¸‰æ–¹æ¨¡å—ã€‚</p>
</blockquote>
<ul>
<li>æ‰€ä»¥å…³äº &#96;Nginxï¼Œæœ‰è¿™äº›æ ‡ç­¾ï¼šã€Œå¼‚æ­¥ã€ã€Œäº‹ä»¶ã€ã€Œæ¨¡å—åŒ–ã€ã€Œé«˜æ€§èƒ½ã€ã€Œé«˜å¹¶å‘ã€ã€Œåå‘ä»£ç†ã€ã€Œè´Ÿè½½å‡è¡¡ã€</li>
</ul>
<h2 id="ä¸€ã€å®‰è£…"><a href="#ä¸€ã€å®‰è£…" class="headerlink" title="ä¸€ã€å®‰è£…"></a>ä¸€ã€å®‰è£…</h2><h3 id="1-1-å®‰è£…ä¾èµ–"><a href="#1-1-å®‰è£…ä¾èµ–" class="headerlink" title="1.1 å®‰è£…ä¾èµ–"></a>1.1 å®‰è£…ä¾èµ–</h3><blockquote>
<p><code>prce</code>(é‡å®šå‘æ”¯æŒ)å’Œ<code>openssl</code>(<code>https</code>æ”¯æŒï¼Œå¦‚æœä¸éœ€è¦<code>https</code>å¯ä»¥ä¸å®‰è£…)</p>
</blockquote>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">yum install -y pcre-devel </span><br><span class="line">yum -y install gcc make gcc-c++ wget</span><br><span class="line">yum -y install openssl openssl-devel</span><br></pre></td></tr></table></figure>

<p><code>CentOS 6.5</code> æˆ‘å®‰è£…çš„æ—¶å€™æ˜¯é€‰æ‹©çš„â€œåŸºæœ¬æœåŠ¡å™¨â€ï¼Œé»˜è®¤è¿™ä¸¤ä¸ªåŒ…éƒ½æ²¡å®‰è£…å…¨ï¼Œæ‰€ä»¥è¿™ä¸¤ä¸ªéƒ½è¿è¡Œå®‰è£…å³å¯</p>
<h3 id="1-2-ä¸‹è½½"><a href="#1-2-ä¸‹è½½" class="headerlink" title="1.2 ä¸‹è½½"></a>1.2 ä¸‹è½½</h3><p><a target="_blank" rel="noopener" href="http://nginx.org/download/">nginxçš„æ‰€æœ‰ç‰ˆæœ¬åœ¨è¿™é‡Œ</a></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">wget http://nginx.org/download/nginx-1.13.3.tar.gz</span><br><span class="line">wget http://nginx.org/download/nginx-1.13.7.tar.gz</span><br><span class="line"></span><br><span class="line"># å¦‚æœæ²¡æœ‰å®‰è£…wget</span><br><span class="line"># ä¸‹è½½å·²ç¼–è¯‘ç‰ˆæœ¬</span><br><span class="line">$ yum install wget</span><br><span class="line"></span><br><span class="line"># è§£å‹å‹ç¼©åŒ…</span><br><span class="line">tar zxf nginx-1.13.3.tar.gz</span><br></pre></td></tr></table></figure>

<h3 id="1-3-ç¼–è¯‘å®‰è£…"><a href="#1-3-ç¼–è¯‘å®‰è£…" class="headerlink" title="1.3 ç¼–è¯‘å®‰è£…"></a>1.3 ç¼–è¯‘å®‰è£…</h3><p>ç„¶åè¿›å…¥ç›®å½•ç¼–è¯‘å®‰è£…ï¼Œ<a target="_blank" rel="noopener" href="http://blog.poetries.top/2018/02/25/nginx-study/#configure%E5%8F%82%E6%95%B0%E8%AF%B4%E6%98%8E">configureå‚æ•°è¯´æ˜</a></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">cd nginx-1.11.5</span><br><span class="line">./configure</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">....</span><br><span class="line">Configuration summary</span><br><span class="line">  + using system PCRE library</span><br><span class="line">  + OpenSSL library is not used</span><br><span class="line">  + using system zlib library</span><br><span class="line"></span><br><span class="line">  nginx path prefix: &quot;/usr/local/nginx&quot;</span><br><span class="line">  nginx binary file: &quot;/usr/local/nginx/sbin/nginx&quot;</span><br><span class="line">  nginx modules path: &quot;/usr/local/nginx/modules&quot;</span><br><span class="line">  nginx configuration prefix: &quot;/usr/local/nginx/conf&quot;</span><br><span class="line">  nginx configuration file: &quot;/usr/local/nginx/conf/nginx.conf&quot;</span><br><span class="line">  nginx pid file: &quot;/usr/local/nginx/logs/nginx.pid&quot;</span><br><span class="line">  nginx error log file: &quot;/usr/local/nginx/logs/error.log&quot;</span><br><span class="line">  nginx http access log file: &quot;/usr/local/nginx/logs/access.log&quot;</span><br><span class="line">  nginx http client request body temporary files: &quot;client_body_temp&quot;</span><br><span class="line">  nginx http proxy temporary files: &quot;proxy_temp&quot;</span><br><span class="line">  nginx http fastcgi temporary files: &quot;fastcgi_temp&quot;</span><br><span class="line">  nginx http uwsgi temporary files: &quot;uwsgi_temp&quot;</span><br><span class="line">  nginx http scgi temporary files: &quot;scgi_temp&quot;</span><br></pre></td></tr></table></figure>

<blockquote>
<p>å®‰è£…æŠ¥é”™è¯¯çš„è¯æ¯”å¦‚ï¼š<code>â€œC compiler cc is not foundâ€</code>ï¼Œè¿™ä¸ªå°±æ˜¯ç¼ºå°‘ç¼–è¯‘ç¯å¢ƒï¼Œå®‰è£…ä¸€ä¸‹å°±å¯ä»¥äº† <code>yum -y install gcc make gcc-c++ openssl-devel</code></p>
</blockquote>
<p>å¦‚æœæ²¡æœ‰<code>error</code>ä¿¡æ¯ï¼Œå°±å¯ä»¥æ‰§è¡Œä¸‹è¾¹çš„å®‰è£…äº†ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">make</span><br><span class="line">make install</span><br></pre></td></tr></table></figure>

<h3 id="1-4-nginxæµ‹è¯•"><a href="#1-4-nginxæµ‹è¯•" class="headerlink" title="1.4 nginxæµ‹è¯•"></a>1.4 nginxæµ‹è¯•</h3><ul>
<li>è¿è¡Œä¸‹é¢å‘½ä»¤ä¼šå‡ºç°ä¸¤ä¸ªç»“æœï¼Œä¸€èˆ¬æƒ…å†µ<code>nginx</code>ä¼šå®‰è£…åœ¨<code>/usr/local/nginx</code>ç›®å½•ä¸­</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">cd /usr/local/nginx/sbin/</span><br><span class="line">./nginx -t</span><br><span class="line"></span><br><span class="line"># nginx: the configuration file /usr/local/nginx/conf/nginx.conf syntax is ok</span><br><span class="line"># nginx: configuration file /usr/local/nginx/conf/nginx.conf test is successful</span><br></pre></td></tr></table></figure>

<h3 id="1-5-è®¾ç½®å…¨å±€nginxå‘½ä»¤"><a href="#1-5-è®¾ç½®å…¨å±€nginxå‘½ä»¤" class="headerlink" title="1.5 è®¾ç½®å…¨å±€nginxå‘½ä»¤"></a>1.5 è®¾ç½®å…¨å±€nginxå‘½ä»¤</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">vi ~/.bash_profile</span><br></pre></td></tr></table></figure>

<p>å°†ä¸‹é¢å†…å®¹æ·»åŠ åˆ° <code>~/.bash_profile</code> æ–‡ä»¶ä¸­</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">PATH=$PATH:$HOME/bin:/usr/local/nginx/sbin/</span><br><span class="line">export PATH</span><br></pre></td></tr></table></figure>

<p>è¿è¡Œå‘½ä»¤ <strong><code>source ~/.bash_profile</code></strong> è®©é…ç½®ç«‹å³ç”Ÿæ•ˆã€‚ä½ å°±å¯ä»¥å…¨å±€è¿è¡Œ <code>nginx</code> å‘½ä»¤äº†ã€‚</p>
<h2 id="äºŒã€å¼€æœºè‡ªå¯åŠ¨"><a href="#äºŒã€å¼€æœºè‡ªå¯åŠ¨" class="headerlink" title="äºŒã€å¼€æœºè‡ªå¯åŠ¨"></a>äºŒã€å¼€æœºè‡ªå¯åŠ¨</h2><p><strong>å¼€æœºè‡ªå¯åŠ¨æ–¹æ³•ä¸€</strong></p>
<ul>
<li>ç¼–è¾‘ <strong><code>vi /lib/systemd/system/nginx.service</code></strong> æ–‡ä»¶ï¼Œæ²¡æœ‰åˆ›å»ºä¸€ä¸ª <strong><code>touch nginx.service</code></strong> - ç„¶åå°†å¦‚ä¸‹å†…å®¹æ ¹æ®å…·ä½“æƒ…å†µè¿›è¡Œä¿®æ”¹åï¼Œæ·»åŠ åˆ°<code>nginx.service</code>æ–‡ä»¶ä¸­ï¼š</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line">[Unit]</span><br><span class="line">Description=nginx</span><br><span class="line">After=network.target remote-fs.target nss-lookup.target</span><br><span class="line"></span><br><span class="line">[Service]</span><br><span class="line"></span><br><span class="line">Type=forking</span><br><span class="line">PIDFile=/var/run/nginx.pid</span><br><span class="line">ExecStartPre=/usr/local/nginx/sbin/nginx -t -c /usr/local/nginx/conf/nginx.conf</span><br><span class="line">ExecStart=/usr/local/nginx/sbin/nginx -c /usr/local/nginx/conf/nginx.conf</span><br><span class="line">ExecReload=/bin/kill -s HUP $MAINPID</span><br><span class="line">ExecStop=/bin/kill -s QUIT $MAINPID</span><br><span class="line">PrivateTmp=true</span><br><span class="line"></span><br><span class="line">[Install]</span><br><span class="line">WantedBy=multi-user.target</span><br><span class="line">[Unit]:æœåŠ¡çš„è¯´æ˜  </span><br><span class="line">Description:æè¿°æœåŠ¡  </span><br><span class="line">After:æè¿°æœåŠ¡ç±»åˆ«  </span><br><span class="line">[Service]æœåŠ¡è¿è¡Œå‚æ•°çš„è®¾ç½®  </span><br><span class="line">Type=forkingæ˜¯åå°è¿è¡Œçš„å½¢å¼  </span><br><span class="line">ExecStartä¸ºæœåŠ¡çš„å…·ä½“è¿è¡Œå‘½ä»¤  </span><br><span class="line">ExecReloadä¸ºé‡å¯å‘½ä»¤  </span><br><span class="line">ExecStopä¸ºåœæ­¢å‘½ä»¤  </span><br><span class="line">PrivateTmp=Trueè¡¨ç¤ºç»™æœåŠ¡åˆ†é…ç‹¬ç«‹çš„ä¸´æ—¶ç©ºé—´  </span><br><span class="line">æ³¨æ„ï¼š[Service]çš„å¯åŠ¨ã€é‡å¯ã€åœæ­¢å‘½ä»¤å…¨éƒ¨è¦æ±‚ä½¿ç”¨ç»å¯¹è·¯å¾„  </span><br><span class="line">[Install]è¿è¡Œçº§åˆ«ä¸‹æœåŠ¡å®‰è£…çš„ç›¸å…³è®¾ç½®ï¼Œå¯è®¾ç½®ä¸ºå¤šç”¨æˆ·ï¼Œå³ç³»ç»Ÿè¿è¡Œçº§åˆ«ä¸º3</span><br></pre></td></tr></table></figure>

<p>ä¿å­˜é€€å‡ºã€‚</p>
<p>è®¾ç½®å¼€æœºå¯åŠ¨ï¼Œä½¿é…ç½®ç”Ÿæ•ˆï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">systemctl enable nginx.service</span><br><span class="line"># è¾“å‡ºä¸‹é¢å†…å®¹è¡¨ç¤ºæˆåŠŸäº†</span><br><span class="line">Created symlink from /etc/systemd/system/multi-user.target.wants/nginx.service to /usr/lib/systemd/system/nginx.service.</span><br></pre></td></tr></table></figure>

<p><strong>å¼€æœºè‡ªå¯åŠ¨æ–¹æ³•äºŒ</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">vi /etc/rc.local</span><br><span class="line"></span><br><span class="line"># åœ¨ rc.local æ–‡ä»¶ä¸­ï¼Œæ·»åŠ ä¸‹é¢è¿™æ¡å‘½ä»¤</span><br><span class="line">/usr/local/nginx/sbin/nginx start</span><br></pre></td></tr></table></figure>

<ul>
<li>å¦‚æœå¼€æœºåå‘ç°è‡ªå¯åŠ¨è„šæœ¬æ²¡æœ‰æ‰§è¡Œï¼Œä½ è¦å»ç¡®è®¤ä¸€ä¸‹<code>rc.local</code>è¿™ä¸ªæ–‡ä»¶çš„è®¿é—®æƒé™æ˜¯å¦æ˜¯å¯æ‰§è¡Œçš„ï¼Œå› ä¸º<code>rc.local</code>é»˜è®¤æ˜¯ä¸å¯æ‰§è¡Œçš„ã€‚ä¿®æ”¹<code>rc.local</code>è®¿é—®æƒé™ï¼Œå¢åŠ å¯æ‰§è¡Œæƒé™ï¼š</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">chmod +x /etc/rc.d/rc.local</span><br></pre></td></tr></table></figure>

<h2 id="ä¸‰ã€è¿ç»´"><a href="#ä¸‰ã€è¿ç»´" class="headerlink" title="ä¸‰ã€è¿ç»´"></a>ä¸‰ã€è¿ç»´</h2><h3 id="3-1-æœåŠ¡ç®¡ç†"><a href="#3-1-æœåŠ¡ç®¡ç†" class="headerlink" title="3.1 æœåŠ¡ç®¡ç†"></a>3.1 æœåŠ¡ç®¡ç†</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"># å¯åŠ¨</span><br><span class="line">/usr/local/nginx/sbin/nginx</span><br><span class="line"></span><br><span class="line"># é‡å¯</span><br><span class="line">/usr/local/nginx/sbin/nginx -s reload</span><br><span class="line"></span><br><span class="line"># å…³é—­è¿›ç¨‹</span><br><span class="line">/usr/local/nginx/sbin/nginx -s stop</span><br><span class="line"></span><br><span class="line"># å¹³æ»‘å…³é—­nginx</span><br><span class="line">/usr/local/nginx/sbin/nginx -s quit</span><br><span class="line"></span><br><span class="line"># æŸ¥çœ‹nginxçš„å®‰è£…çŠ¶æ€ï¼Œ</span><br><span class="line">/usr/local/nginx/sbin/nginx -V</span><br></pre></td></tr></table></figure>

<p><strong>å…³é—­é˜²ç«å¢™ï¼Œæˆ–è€…æ·»åŠ é˜²ç«å¢™è§„åˆ™å°±å¯ä»¥æµ‹è¯•äº†</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">service iptables stop</span><br></pre></td></tr></table></figure>

<p>æˆ–è€…ç¼–è¾‘é…ç½®æ–‡ä»¶ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">vi /etc/sysconfig/iptables</span><br></pre></td></tr></table></figure>

<p>æ·»åŠ è¿™æ ·ä¸€æ¡å¼€æ”¾80ç«¯å£çš„è§„åˆ™åä¿å­˜ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">-A INPUT -m state --state NEW -m tcp -p tcp --dport 80 -j ACCEPT</span><br></pre></td></tr></table></figure>

<p>é‡å¯æœåŠ¡å³å¯:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">service iptables restart</span><br><span class="line"># å‘½ä»¤è¿›è¡ŒæŸ¥çœ‹ç›®å‰nat</span><br><span class="line">iptables -t nat -L</span><br></pre></td></tr></table></figure>

<h3 id="3-2-é‡å¯æœåŠ¡é˜²ç«å¢™æŠ¥é”™è§£å†³"><a href="#3-2-é‡å¯æœåŠ¡é˜²ç«å¢™æŠ¥é”™è§£å†³" class="headerlink" title="3.2 é‡å¯æœåŠ¡é˜²ç«å¢™æŠ¥é”™è§£å†³"></a>3.2 é‡å¯æœåŠ¡é˜²ç«å¢™æŠ¥é”™è§£å†³</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">service iptables restart</span><br><span class="line"># Redirecting to /bin/systemctl restart  iptables.service</span><br><span class="line"># Failed to restart iptables.service: Unit iptables.service failed to load: No such file or directory.</span><br></pre></td></tr></table></figure>

<ul>
<li>åœ¨<code>CentOS 7</code>æˆ–<code>RHEL 7</code>æˆ–<code>Fedora</code>ä¸­é˜²ç«å¢™ç”± <strong><code>firewalld</code></strong> æ¥ç®¡ç†ï¼Œå½“ç„¶ä½ å¯ä»¥è¿˜åŸä¼ ç»Ÿçš„ç®¡ç†æ–¹å¼ã€‚æˆ–åˆ™ä½¿ç”¨æ–°çš„å‘½ä»¤è¿›è¡Œç®¡ç†ã€‚<br>å‡å¦‚é‡‡ç”¨ä¼ ç»Ÿè¯·æ‰§è¡Œä¸€ä¸‹å‘½ä»¤</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"># ä¼ ç»Ÿå‘½ä»¤</span><br><span class="line">systemctl stop firewalld</span><br><span class="line">systemctl mask firewalld</span><br><span class="line"># å®‰è£…å‘½ä»¤</span><br><span class="line">yum install iptables-services</span><br><span class="line"></span><br><span class="line">systemctl enable iptables </span><br><span class="line">service iptables restart</span><br></pre></td></tr></table></figure>

<h2 id="å››ã€nginxå¸è½½"><a href="#å››ã€nginxå¸è½½" class="headerlink" title="å››ã€nginxå¸è½½"></a>å››ã€nginxå¸è½½</h2><ul>
<li>å¦‚æœé€šè¿‡<code>yum</code>å®‰è£…ï¼Œä½¿ç”¨ä¸‹é¢å‘½ä»¤å®‰è£…ã€‚</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">yum remove nginx</span><br></pre></td></tr></table></figure>

<ul>
<li>ç¼–è¯‘å®‰è£…ï¼Œåˆ é™¤<code>/usr/local/nginx</code>ç›®å½•å³å¯</li>
<li>å¦‚æœé…ç½®äº†è‡ªå¯åŠ¨è„šæœ¬ï¼Œä¹Ÿéœ€è¦åˆ é™¤ã€‚</li>
</ul>
<h2 id="äº”ã€å‚æ•°è¯´æ˜"><a href="#äº”ã€å‚æ•°è¯´æ˜" class="headerlink" title="äº”ã€å‚æ•°è¯´æ˜"></a>äº”ã€å‚æ•°è¯´æ˜</h2><table>
<thead>
<tr>
<th align="left">å‚æ•°</th>
<th align="left">è¯´æ˜</th>
</tr>
</thead>
<tbody><tr>
<td align="left">â€“prefix&#x3D;&#96;&#96;</td>
<td align="left">Nginxå®‰è£…è·¯å¾„ã€‚å¦‚æœæ²¡æœ‰æŒ‡å®šï¼Œé»˜è®¤ä¸º &#x2F;usr&#x2F;local&#x2F;nginxã€‚</td>
</tr>
<tr>
<td align="left">â€“sbin-path&#x3D;&#96;&#96;</td>
<td align="left">Nginxå¯æ‰§è¡Œæ–‡ä»¶å®‰è£…è·¯å¾„ã€‚åªèƒ½å®‰è£…æ—¶æŒ‡å®šï¼Œå¦‚æœæ²¡æœ‰æŒ‡å®šï¼Œé»˜è®¤ä¸º&#96;&#96;&#x2F;sbin&#x2F;nginxã€‚</td>
</tr>
<tr>
<td align="left">â€“conf-path&#x3D;&#96;&#96;</td>
<td align="left">åœ¨æ²¡æœ‰ç»™å®š-cé€‰é¡¹ä¸‹é»˜è®¤çš„nginx.confçš„è·¯å¾„ã€‚å¦‚æœæ²¡æœ‰æŒ‡å®šï¼Œé»˜è®¤ä¸º&#96;&#96;&#x2F;conf&#x2F;nginx.confã€‚</td>
</tr>
<tr>
<td align="left">â€“pid-path&#x3D;&#96;&#96;</td>
<td align="left">åœ¨nginx.confä¸­æ²¡æœ‰æŒ‡å®špidæŒ‡ä»¤çš„æƒ…å†µä¸‹ï¼Œé»˜è®¤çš„nginx.pidçš„è·¯å¾„ã€‚å¦‚æœæ²¡æœ‰æŒ‡å®šï¼Œé»˜è®¤ä¸º &#96;&#96;&#x2F;logs&#x2F;nginx.pidã€‚</td>
</tr>
<tr>
<td align="left">â€“lock-path&#x3D;&#96;&#96;</td>
<td align="left">nginx.lockæ–‡ä»¶çš„è·¯å¾„ã€‚</td>
</tr>
<tr>
<td align="left">â€“error-log-path&#x3D;&#96;&#96;</td>
<td align="left">åœ¨nginx.confä¸­æ²¡æœ‰æŒ‡å®šerror_logæŒ‡ä»¤çš„æƒ…å†µä¸‹ï¼Œé»˜è®¤çš„é”™è¯¯æ—¥å¿—çš„è·¯å¾„ã€‚å¦‚æœæ²¡æœ‰æŒ‡å®šï¼Œé»˜è®¤ä¸º &#96;&#96;&#x2F;- logs&#x2F;error.logã€‚</td>
</tr>
<tr>
<td align="left">â€“http-log-path&#x3D;&#96;&#96;</td>
<td align="left">åœ¨nginx.confä¸­æ²¡æœ‰æŒ‡å®šaccess_logæŒ‡ä»¤çš„æƒ…å†µä¸‹ï¼Œé»˜è®¤çš„è®¿é—®æ—¥å¿—çš„è·¯å¾„ã€‚å¦‚æœæ²¡æœ‰æŒ‡å®šï¼Œé»˜è®¤ä¸º &#96;&#96;&#x2F;- logs&#x2F;access.logã€‚</td>
</tr>
<tr>
<td align="left">â€“user&#x3D;&#96;&#96;</td>
<td align="left">åœ¨nginx.confä¸­æ²¡æœ‰æŒ‡å®šuseræŒ‡ä»¤çš„æƒ…å†µä¸‹ï¼Œé»˜è®¤çš„nginxä½¿ç”¨çš„ç”¨æˆ·ã€‚å¦‚æœæ²¡æœ‰æŒ‡å®šï¼Œé»˜è®¤ä¸º nobodyã€‚</td>
</tr>
<tr>
<td align="left">â€“group&#x3D;&#96;&#96;</td>
<td align="left">åœ¨nginx.confä¸­æ²¡æœ‰æŒ‡å®šuseræŒ‡ä»¤çš„æƒ…å†µä¸‹ï¼Œé»˜è®¤çš„nginxä½¿ç”¨çš„ç»„ã€‚å¦‚æœæ²¡æœ‰æŒ‡å®šï¼Œé»˜è®¤ä¸º nobodyã€‚</td>
</tr>
<tr>
<td align="left">â€“builddir&#x3D;DIR</td>
<td align="left">æŒ‡å®šç¼–è¯‘çš„ç›®å½•</td>
</tr>
<tr>
<td align="left">â€“with-rtsig_module</td>
<td align="left">å¯ç”¨ rtsig æ¨¡å—</td>
</tr>
<tr>
<td align="left">â€“with-select_module â€“without-select_module</td>
<td align="left">å…è®¸æˆ–ä¸å…è®¸å¼€å¯SELECTæ¨¡å¼ï¼Œå¦‚æœ configure æ²¡æœ‰æ‰¾åˆ°æ›´åˆé€‚çš„æ¨¡å¼ï¼Œæ¯”å¦‚ï¼škqueue(sun os),epoll (linux kenel 2.6+), rtsig(- å®æ—¶ä¿¡å·)æˆ–è€…&#x2F;dev&#x2F;poll(ä¸€ç§ç±»ä¼¼selectçš„æ¨¡å¼ï¼Œåº•å±‚å®ç°ä¸SELECTåŸºæœ¬ç›¸ åŒï¼Œéƒ½æ˜¯é‡‡ç”¨è½®è®­æ–¹æ³•) SELECTæ¨¡å¼å°†æ˜¯é»˜è®¤å®‰è£…æ¨¡å¼</td>
</tr>
<tr>
<td align="left">â€“with-poll_module â€“without-poll_module</td>
<td align="left">Whether or not to enable the poll module. This module is enabled by, default if a more suitable method such as kqueue, epoll, rtsig or &#x2F;dev&#x2F;poll is not discovered by configure.</td>
</tr>
<tr>
<td align="left">â€“with-http_ssl_module</td>
<td align="left">Enable ngx_http_ssl_module. Enables SSL support and the ability to handle HTTPS requests. Requires OpenSSL. On Debian, this is libssl-dev. å¼€å¯HTTP SSLæ¨¡å—ï¼Œä½¿NGINXå¯ä»¥æ”¯æŒHTTPSè¯·æ±‚ã€‚è¿™ä¸ªæ¨¡å—éœ€è¦å·²ç»å®‰è£…äº†OPENSSLï¼Œåœ¨DEBIANä¸Šæ˜¯libssl</td>
</tr>
<tr>
<td align="left">â€“with-http_realip_module</td>
<td align="left">å¯ç”¨ ngx_http_realip_module</td>
</tr>
<tr>
<td align="left">â€“with-http_addition_module</td>
<td align="left">å¯ç”¨ ngx_http_addition_module</td>
</tr>
<tr>
<td align="left">â€“with-http_sub_module</td>
<td align="left">å¯ç”¨ ngx_http_sub_module</td>
</tr>
<tr>
<td align="left">â€“with-http_dav_module</td>
<td align="left">å¯ç”¨ ngx_http_dav_module</td>
</tr>
<tr>
<td align="left">â€“with-http_flv_module</td>
<td align="left">å¯ç”¨ ngx_http_flv_module</td>
</tr>
<tr>
<td align="left">â€“with-http_stub_status_module</td>
<td align="left">å¯ç”¨ â€œserver statusâ€ é¡µ</td>
</tr>
<tr>
<td align="left">â€“without-http_charset_module</td>
<td align="left">ç¦ç”¨ ngx_http_charset_module</td>
</tr>
<tr>
<td align="left">â€“without-http_gzip_module</td>
<td align="left">ç¦ç”¨ ngx_http_gzip_module. å¦‚æœå¯ç”¨ï¼Œéœ€è¦ zlib ã€‚</td>
</tr>
<tr>
<td align="left">â€“without-http_ssi_module</td>
<td align="left">ç¦ç”¨ ngx_http_ssi_module</td>
</tr>
<tr>
<td align="left">â€“without-http_userid_module</td>
<td align="left">ç¦ç”¨ ngx_http_userid_module</td>
</tr>
<tr>
<td align="left">â€“without-http_access_module</td>
<td align="left">ç¦ç”¨ ngx_http_access_module</td>
</tr>
<tr>
<td align="left">â€“without-http_auth_basic_module</td>
<td align="left">ç¦ç”¨ ngx_http_auth_basic_module</td>
</tr>
<tr>
<td align="left">â€“without-http_autoindex_module</td>
<td align="left">ç¦ç”¨ ngx_http_autoindex_module</td>
</tr>
<tr>
<td align="left">â€“without-http_geo_module</td>
<td align="left">ç¦ç”¨ ngx_http_geo_module</td>
</tr>
<tr>
<td align="left">â€“without-http_map_module</td>
<td align="left">ç¦ç”¨ ngx_http_map_module</td>
</tr>
<tr>
<td align="left">â€“without-http_referer_module</td>
<td align="left">ç¦ç”¨ ngx_http_referer_module</td>
</tr>
<tr>
<td align="left">â€“without-http_rewrite_module</td>
<td align="left">ç¦ç”¨ ngx_http_rewrite_module. å¦‚æœå¯ç”¨éœ€è¦ PCRE ã€‚</td>
</tr>
<tr>
<td align="left">â€“without-http_proxy_module</td>
<td align="left">ç¦ç”¨ ngx_http_proxy_module</td>
</tr>
<tr>
<td align="left">â€“without-http_fastcgi_module</td>
<td align="left">ç¦ç”¨ ngx_http_fastcgi_module</td>
</tr>
<tr>
<td align="left">â€“without-http_memcached_module</td>
<td align="left">ç¦ç”¨ ngx_http_memcached_module</td>
</tr>
<tr>
<td align="left">â€“without-http_limit_zone_module</td>
<td align="left">ç¦ç”¨ ngx_http_limit_zone_module</td>
</tr>
<tr>
<td align="left">â€“without-http_empty_gif_module</td>
<td align="left">ç¦ç”¨ ngx_http_empty_gif_module</td>
</tr>
<tr>
<td align="left">â€“without-http_browser_module</td>
<td align="left">ç¦ç”¨ ngx_http_browser_module</td>
</tr>
<tr>
<td align="left">â€“without-http_upstream_ip_hash_module</td>
<td align="left">ç¦ç”¨ ngx_http_upstream_ip_hash_module</td>
</tr>
<tr>
<td align="left">â€“with-http_perl_module</td>
<td align="left">å¯ç”¨ ngx_http_perl_module</td>
</tr>
<tr>
<td align="left">â€“with-perl_modules_path&#x3D;PATH</td>
<td align="left">æŒ‡å®š perl æ¨¡å—çš„è·¯å¾„</td>
</tr>
<tr>
<td align="left">â€“with-perl&#x3D;PATH</td>
<td align="left">æŒ‡å®š perl æ‰§è¡Œæ–‡ä»¶çš„è·¯å¾„</td>
</tr>
<tr>
<td align="left">â€“http-log-path&#x3D;PATH</td>
<td align="left">Set path to the http access log</td>
</tr>
<tr>
<td align="left">â€“http-client-body-temp-path&#x3D;PATH</td>
<td align="left">Set path to the http client request body temporary files</td>
</tr>
<tr>
<td align="left">â€“http-proxy-temp-path&#x3D;PATH</td>
<td align="left">Set path to the http proxy temporary files</td>
</tr>
<tr>
<td align="left">â€“http-fastcgi-temp-path&#x3D;PATH</td>
<td align="left">Set path to the http fastcgi temporary files</td>
</tr>
<tr>
<td align="left">â€“without-http</td>
<td align="left">ç¦ç”¨ HTTP server</td>
</tr>
<tr>
<td align="left">â€“with-mail</td>
<td align="left">å¯ç”¨ IMAP4&#x2F;POP3&#x2F;SMTP ä»£ç†æ¨¡å—</td>
</tr>
<tr>
<td align="left">â€“with-mail_ssl_module</td>
<td align="left">å¯ç”¨ ngx_mail_ssl_module</td>
</tr>
<tr>
<td align="left">â€“with-cc&#x3D;PATH</td>
<td align="left">æŒ‡å®š C ç¼–è¯‘å™¨çš„è·¯å¾„</td>
</tr>
<tr>
<td align="left">â€“with-cpp&#x3D;PATH</td>
<td align="left">æŒ‡å®š C é¢„å¤„ç†å™¨çš„è·¯å¾„</td>
</tr>
<tr>
<td align="left">â€“with-cc-opt&#x3D;OPTIONS</td>
<td align="left">Additional parameters which will be added to the variable CFLAGS. With the use of the system library PCRE in FreeBSD, it is necessary to indicate â€“with-cc-opt&#x3D;â€-I &#x2F;usr&#x2F;local&#x2F;includeâ€. If we are using select() and it is necessary to increase the number of file descriptors, then this also can be assigned here: â€“with-cc-opt&#x3D;â€-D FD_SETSIZE&#x3D;2048â€.</td>
</tr>
<tr>
<td align="left">â€“with-ld-opt&#x3D;OPTIONS</td>
<td align="left">Additional parameters passed to the linker. With the use of the system library PCRE in - FreeBSD, it is necessary to indicate â€“with-ld-opt&#x3D;â€-L &#x2F;usr&#x2F;local&#x2F;libâ€.</td>
</tr>
<tr>
<td align="left">â€“with-cpu-opt&#x3D;CPU</td>
<td align="left">ä¸ºç‰¹å®šçš„ CPU ç¼–è¯‘ï¼Œæœ‰æ•ˆçš„å€¼åŒ…æ‹¬ï¼špentium, pentiumpro, pentium3, pentium4, athlon, opteron, amd64, sparc32, sparc64, ppc64</td>
</tr>
<tr>
<td align="left">â€“without-pcre</td>
<td align="left">ç¦æ­¢ PCRE åº“çš„ä½¿ç”¨ã€‚åŒæ—¶ä¹Ÿä¼šç¦æ­¢ HTTP rewrite æ¨¡å—ã€‚åœ¨ â€œlocationâ€ é…ç½®æŒ‡ä»¤ä¸­çš„æ­£åˆ™è¡¨è¾¾å¼ä¹Ÿéœ€è¦ PCRE ã€‚</td>
</tr>
<tr>
<td align="left">â€“with-pcre&#x3D;DIR</td>
<td align="left">æŒ‡å®š PCRE åº“çš„æºä»£ç çš„è·¯å¾„ã€‚</td>
</tr>
<tr>
<td align="left">â€“with-pcre-opt&#x3D;OPTIONS</td>
<td align="left">Set additional options for PCRE building.</td>
</tr>
<tr>
<td align="left">â€“with-md5&#x3D;DIR</td>
<td align="left">Set path to md5 library sources.</td>
</tr>
<tr>
<td align="left">â€“with-md5-opt&#x3D;OPTIONS</td>
<td align="left">Set additional options for md5 building.</td>
</tr>
<tr>
<td align="left">â€“with-md5-asm</td>
<td align="left">Use md5 assembler sources.</td>
</tr>
<tr>
<td align="left">â€“with-sha1&#x3D;DIR</td>
<td align="left">Set path to sha1 library sources.</td>
</tr>
<tr>
<td align="left">â€“with-sha1-opt&#x3D;OPTIONS</td>
<td align="left">Set additional options for sha1 building.</td>
</tr>
<tr>
<td align="left">â€“with-sha1-asm</td>
<td align="left">Use sha1 assembler sources.</td>
</tr>
<tr>
<td align="left">â€“with-zlib&#x3D;DIR</td>
<td align="left">Set path to zlib library sources.</td>
</tr>
<tr>
<td align="left">â€“with-zlib-opt&#x3D;OPTIONS</td>
<td align="left">Set additional options for zlib building.</td>
</tr>
<tr>
<td align="left">â€“with-zlib-asm&#x3D;CPU</td>
<td align="left">Use zlib assembler sources optimized for specified CPU, valid values are: pentium, pentiumpro</td>
</tr>
<tr>
<td align="left">â€“with-openssl&#x3D;DIR</td>
<td align="left">Set path to OpenSSL library sources</td>
</tr>
<tr>
<td align="left">â€“with-openssl-opt&#x3D;OPTIONS</td>
<td align="left">Set additional options for OpenSSL building</td>
</tr>
<tr>
<td align="left">â€“with-debug</td>
<td align="left">å¯ç”¨è°ƒè¯•æ—¥å¿—</td>
</tr>
<tr>
<td align="left">â€“add-module&#x3D;PATH</td>
<td align="left">Add in a third-party module found in directory PATH</td>
</tr>
</tbody></table>
<h2 id="å…­ã€é…ç½®"><a href="#å…­ã€é…ç½®" class="headerlink" title="å…­ã€é…ç½®"></a>å…­ã€é…ç½®</h2><ul>
<li>åœ¨<code>Centos</code> é»˜è®¤é…ç½®æ–‡ä»¶åœ¨ <strong><code>/usr/local/nginx-1.5.1/conf/nginx.conf</code></strong> æˆ‘ä»¬è¦åœ¨è¿™é‡Œé…ç½®ä¸€äº›æ–‡ä»¶ã€‚<code>nginx.conf</code>æ˜¯ä¸»é…ç½®æ–‡ä»¶ï¼Œç”±è‹¥å¹²ä¸ªéƒ¨åˆ†ç»„æˆï¼Œæ¯ä¸ªå¤§æ‹¬å·<code>&#123;&#125;</code>è¡¨ç¤ºä¸€ä¸ªéƒ¨åˆ†ã€‚æ¯ä¸€è¡ŒæŒ‡ä»¤éƒ½ç”±åˆ†å·ç»“æŸ<code>;</code>ï¼Œæ ‡å¿—ç€ä¸€è¡Œçš„ç»“æŸã€‚</li>
</ul>
<h3 id="6-1-å¸¸ç”¨æ­£åˆ™"><a href="#6-1-å¸¸ç”¨æ­£åˆ™" class="headerlink" title="6.1 å¸¸ç”¨æ­£åˆ™"></a>6.1 å¸¸ç”¨æ­£åˆ™</h3><table>
<thead>
<tr>
<th align="left">æ­£åˆ™</th>
<th align="left">è¯´æ˜</th>
<th align="left">æ­£åˆ™</th>
<th align="left">è¯´æ˜</th>
</tr>
</thead>
<tbody><tr>
<td align="left"><code>.</code></td>
<td align="left">åŒ¹é…é™¤æ¢è¡Œç¬¦ä»¥å¤–çš„ä»»æ„å­—ç¬¦</td>
<td align="left"><code>$</code></td>
<td align="left">åŒ¹é…å­—ç¬¦ä¸²çš„ç»“æŸ</td>
</tr>
<tr>
<td align="left"><code>?</code></td>
<td align="left">é‡å¤0æ¬¡æˆ–1æ¬¡</td>
<td align="left"><code>&#123;n&#125;</code></td>
<td align="left">é‡å¤næ¬¡</td>
</tr>
<tr>
<td align="left"><code>+</code></td>
<td align="left">é‡å¤1æ¬¡æˆ–æ›´å¤šæ¬¡</td>
<td align="left"><code>&#123;n,&#125;</code></td>
<td align="left">é‡å¤næ¬¡æˆ–æ›´å¤šæ¬¡</td>
</tr>
<tr>
<td align="left"><code>*</code></td>
<td align="left">é‡å¤0æ¬¡æˆ–æ›´å¤šæ¬¡</td>
<td align="left"><code>[c]</code></td>
<td align="left">åŒ¹é…å•ä¸ªå­—ç¬¦c</td>
</tr>
<tr>
<td align="left"><code>\d</code></td>
<td align="left">åŒ¹é…æ•°å­—</td>
<td align="left"><code>[a-z]</code></td>
<td align="left">åŒ¹é…a-zå°å†™å­—æ¯çš„ä»»æ„ä¸€ä¸ª</td>
</tr>
<tr>
<td align="left"><code>^</code></td>
<td align="left">åŒ¹é…å­—ç¬¦ä¸²çš„å¼€å§‹</td>
<td align="left">-</td>
<td align="left">-</td>
</tr>
</tbody></table>
<h3 id="6-2-å…¨å±€å˜é‡"><a href="#6-2-å…¨å±€å˜é‡" class="headerlink" title="6.2 å…¨å±€å˜é‡"></a>6.2 å…¨å±€å˜é‡</h3><table>
<thead>
<tr>
<th align="left">å˜é‡</th>
<th align="left">è¯´æ˜</th>
<th align="left">å˜é‡</th>
<th align="left">è¯´æ˜</th>
</tr>
</thead>
<tbody><tr>
<td align="left"><code>$args</code></td>
<td align="left">è¿™ä¸ªå˜é‡ç­‰äºè¯·æ±‚è¡Œä¸­çš„å‚æ•°ï¼ŒåŒ<code>$query_string</code></td>
<td align="left"><code>$remote_port</code></td>
<td align="left">å®¢æˆ·ç«¯çš„ç«¯å£ã€‚</td>
</tr>
<tr>
<td align="left"><code>$content_length</code></td>
<td align="left">è¯·æ±‚å¤´ä¸­çš„<code>Content-length</code>å­—æ®µã€‚</td>
<td align="left"><code>$remote_user</code></td>
<td align="left">å·²ç»ç»è¿‡<code>Auth Basic Module</code>éªŒè¯çš„ç”¨æˆ·åã€‚</td>
</tr>
<tr>
<td align="left"><code>$content_type</code></td>
<td align="left">è¯·æ±‚å¤´ä¸­çš„<code>Content-Type</code>å­—æ®µã€‚</td>
<td align="left"><code>$request_filename</code></td>
<td align="left">å½“å‰è¯·æ±‚çš„æ–‡ä»¶è·¯å¾„ï¼Œç”±<code>root</code>æˆ–<code>alias</code>æŒ‡ä»¤ä¸<code>URI</code>è¯·æ±‚ç”Ÿæˆã€‚</td>
</tr>
<tr>
<td align="left"><code>$document_root</code></td>
<td align="left">å½“å‰è¯·æ±‚åœ¨<code>root</code>æŒ‡ä»¤ä¸­æŒ‡å®šçš„å€¼ã€‚</td>
<td align="left"><code>$scheme</code></td>
<td align="left"><code>HTTP</code>æ–¹æ³•ï¼ˆå¦‚<code>http</code>ï¼Œ<code>https</code>ï¼‰ã€‚</td>
</tr>
<tr>
<td align="left"><code>$host</code></td>
<td align="left">è¯·æ±‚ä¸»æœºå¤´å­—æ®µï¼Œå¦åˆ™ä¸ºæœåŠ¡å™¨åç§°ã€‚</td>
<td align="left"><code>$server_protocol</code></td>
<td align="left">è¯·æ±‚ä½¿ç”¨çš„åè®®ï¼Œé€šå¸¸æ˜¯<code>HTTP/1.0</code>æˆ–<code>HTTP/1.1</code>ã€‚</td>
</tr>
<tr>
<td align="left"><code>$http_user_agent</code></td>
<td align="left">å®¢æˆ·ç«¯<code>agent</code>ä¿¡æ¯</td>
<td align="left"><code>$server_addr</code></td>
<td align="left">æœåŠ¡å™¨åœ°å€ï¼Œåœ¨å®Œæˆä¸€æ¬¡ç³»ç»Ÿè°ƒç”¨åå¯ä»¥ç¡®å®šè¿™ä¸ªå€¼ã€‚</td>
</tr>
<tr>
<td align="left"><code>$http_cookie</code></td>
<td align="left">å®¢æˆ·ç«¯<code>cookie</code>ä¿¡æ¯</td>
<td align="left"><code>$server_name</code></td>
<td align="left">æœåŠ¡å™¨åç§°ã€‚</td>
</tr>
<tr>
<td align="left"><code>$limit_rate</code></td>
<td align="left">è¿™ä¸ªå˜é‡å¯ä»¥é™åˆ¶è¿æ¥é€Ÿç‡ã€‚</td>
<td align="left"><code>$server_port</code></td>
<td align="left">è¯·æ±‚åˆ°è¾¾æœåŠ¡å™¨çš„ç«¯å£å·ã€‚</td>
</tr>
<tr>
<td align="left"><code>$request_method</code></td>
<td align="left">å®¢æˆ·ç«¯è¯·æ±‚çš„åŠ¨ä½œï¼Œé€šå¸¸ä¸º<code>GET</code>æˆ–<code>POST</code>ã€‚</td>
<td align="left"><code>$request_uri</code></td>
<td align="left">åŒ…å«è¯·æ±‚å‚æ•°çš„åŸå§‹<code>URI</code>ï¼Œä¸åŒ…å«ä¸»æœºåï¼Œå¦‚ï¼š<code>/foo/bar.php?arg=baz</code>ã€‚</td>
</tr>
<tr>
<td align="left"><code>$remote_addr</code></td>
<td align="left">å®¢æˆ·ç«¯çš„IPåœ°å€ã€‚</td>
<td align="left"><code>$uri</code></td>
<td align="left">ä¸å¸¦è¯·æ±‚å‚æ•°çš„å½“å‰<code>URI</code>ï¼Œ<code>$uri</code>ä¸åŒ…å«ä¸»æœºåï¼Œå¦‚<code>/foo/bar.html</code>ã€‚</td>
</tr>
<tr>
<td align="left"><code>$document_uri</code></td>
<td align="left">ä¸<code>$uri</code>ç›¸åŒã€‚</td>
<td align="left">-</td>
<td align="left">-</td>
</tr>
</tbody></table>
<p>ä¾‹å¦‚è¯·æ±‚ï¼š<code>http://localhost:3000/test1/test2/test.php</code></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">$hostï¼šlocalhost  </span><br><span class="line">$server_portï¼š3000  </span><br><span class="line">$request_uriï¼š/test1/test2/test.php  </span><br><span class="line">$document_uriï¼š/test1/test2/test.php  </span><br><span class="line">$document_rootï¼š/var/www/html  </span><br><span class="line">$request_filenameï¼š/var/www/html/test1/test2/test.php</span><br></pre></td></tr></table></figure>

<h3 id="6-3-ç¬¦å·å‚è€ƒ"><a href="#6-3-ç¬¦å·å‚è€ƒ" class="headerlink" title="6.3 ç¬¦å·å‚è€ƒ"></a>6.3 ç¬¦å·å‚è€ƒ</h3><table>
<thead>
<tr>
<th align="left">ç¬¦å·</th>
<th align="left">è¯´æ˜</th>
<th align="left">ç¬¦å·</th>
<th align="left">è¯´æ˜</th>
<th align="left">ç¬¦å·</th>
<th align="left">è¯´æ˜</th>
</tr>
</thead>
<tbody><tr>
<td align="left"><code>k</code>,<code>K</code></td>
<td align="left">åƒå­—èŠ‚</td>
<td align="left"><code>m</code>,<code>M</code></td>
<td align="left">å…†å­—èŠ‚</td>
<td align="left"><code>ms</code></td>
<td align="left">æ¯«ç§’</td>
</tr>
<tr>
<td align="left"><code>s</code></td>
<td align="left">ç§’</td>
<td align="left"><code>m</code></td>
<td align="left">åˆ†é’Ÿ</td>
<td align="left"><code>h</code></td>
<td align="left">å°æ—¶</td>
</tr>
<tr>
<td align="left"><code>d</code></td>
<td align="left">æ—¥</td>
<td align="left"><code>w</code></td>
<td align="left">å‘¨</td>
<td align="left"><code>M</code></td>
<td align="left">ä¸€ä¸ªæœˆ, <code>30</code>å¤©</td>
</tr>
</tbody></table>
<ul>
<li>ä¾‹å¦‚ï¼Œâ€8kâ€ï¼Œâ€1mâ€ ä»£è¡¨å­—èŠ‚æ•°è®¡é‡ã€‚</li>
<li>ä¾‹å¦‚ï¼Œâ€1h 30mâ€ï¼Œâ€1y 6Mâ€ã€‚ä»£è¡¨ â€œ1å°æ—¶ 30åˆ†â€ï¼Œâ€1å¹´é›¶6ä¸ªæœˆâ€ã€‚</li>
</ul>
<h3 id="6-4-é…ç½®æ–‡ä»¶"><a href="#6-4-é…ç½®æ–‡ä»¶" class="headerlink" title="6.4 é…ç½®æ–‡ä»¶"></a>6.4 é…ç½®æ–‡ä»¶</h3><ul>
<li><code>nginx</code> çš„é…ç½®ç³»ç»Ÿç”±ä¸€ä¸ªä¸»é…ç½®æ–‡ä»¶å’Œå…¶ä»–ä¸€äº›è¾…åŠ©çš„é…ç½®æ–‡ä»¶æ„æˆã€‚è¿™äº›é…ç½®æ–‡ä»¶å‡æ˜¯çº¯æ–‡æœ¬æ–‡ä»¶ï¼Œå…¨éƒ¨ä½äº <code>nginx</code> å®‰è£…ç›®å½•ä¸‹çš„ <code>conf</code> ç›®å½•ä¸‹ã€‚</li>
<li>æŒ‡ä»¤ç”± <code>nginx</code> çš„å„ä¸ªæ¨¡å—æä¾›ï¼Œä¸åŒçš„æ¨¡å—ä¼šæä¾›ä¸åŒçš„æŒ‡ä»¤æ¥å®ç°é…ç½®ã€‚<br>æŒ‡ä»¤é™¤äº† <code>Key-Value</code> çš„å½¢å¼ï¼Œè¿˜æœ‰ä½œç”¨åŸŸæŒ‡ä»¤ã€‚</li>
<li><code>nginx.conf</code> ä¸­çš„é…ç½®ä¿¡æ¯ï¼Œæ ¹æ®å…¶é€»è¾‘ä¸Šçš„æ„ä¹‰ï¼Œå¯¹å®ƒä»¬è¿›è¡Œäº†åˆ†ç±»ï¼Œä¹Ÿå°±æ˜¯åˆ†æˆäº†å¤šä¸ªä½œç”¨åŸŸï¼Œæˆ–è€…ç§°ä¹‹ä¸ºé…ç½®æŒ‡ä»¤ä¸Šä¸‹æ–‡ã€‚ä¸åŒçš„ä½œç”¨åŸŸå«æœ‰ä¸€ä¸ªæˆ–è€…å¤šä¸ªé…ç½®é¡¹ã€‚</li>
</ul>
<blockquote>
<p>ä¸‹é¢çš„è¿™äº›ä¸Šä¸‹æ–‡æŒ‡ä»¤æ˜¯ç”¨çš„æ¯”è¾ƒå¤šï¼š</p>
</blockquote>
<table>
<thead>
<tr>
<th align="left"><code>Directive</code></th>
<th align="left"><code>Description</code></th>
<th align="left"><code>Contains Directive</code></th>
</tr>
</thead>
<tbody><tr>
<td align="left"><code>main</code></td>
<td align="left"><code>nginx</code> åœ¨è¿è¡Œæ—¶ä¸å…·ä½“ä¸šåŠ¡åŠŸèƒ½ï¼ˆæ¯”å¦‚ <code>http</code> æœåŠ¡æˆ–è€… <code>email</code>æœåŠ¡ä»£ç†ï¼‰æ— å…³çš„ä¸€äº›å‚æ•°ï¼Œæ¯”å¦‚å·¥ä½œè¿›ç¨‹æ•°ï¼Œè¿è¡Œçš„èº«ä»½ç­‰ã€‚</td>
<td align="left"><code>user</code>, <code>worker_processes</code>, <code>error_log</code>, <code>events</code>, <code>http</code>, <code>mail</code></td>
</tr>
<tr>
<td align="left"><code>http</code></td>
<td align="left">ä¸æä¾› <code>http</code> æœåŠ¡ç›¸å…³çš„ä¸€äº›é…ç½®å‚æ•°ã€‚ä¾‹å¦‚ï¼šæ˜¯å¦ä½¿ç”¨ <code>keepalive</code>å•Šï¼Œæ˜¯å¦ä½¿ç”¨<code>gzip</code> è¿›è¡Œå‹ç¼©ç­‰ã€‚</td>
<td align="left"><code>server</code></td>
</tr>
<tr>
<td align="left"><code>server</code></td>
<td align="left"><code>http</code> æœåŠ¡ä¸Šæ”¯æŒè‹¥å¹²è™šæ‹Ÿä¸»æœºã€‚æ¯ä¸ªè™šæ‹Ÿä¸»æœºä¸€ä¸ªå¯¹åº”çš„ <code>server</code> é…ç½®é¡¹ï¼Œé…ç½®é¡¹é‡Œé¢åŒ…å«è¯¥è™šæ‹Ÿä¸»æœºç›¸å…³çš„é…ç½®ã€‚åœ¨æä¾› <code>mail</code> æœåŠ¡çš„ä»£ç†æ—¶ï¼Œä¹Ÿå¯ä»¥å»ºç«‹è‹¥å¹² <code>server.</code> æ¯ä¸ª <code>server</code> é€šè¿‡ç›‘å¬çš„åœ°å€æ¥åŒºåˆ†ã€‚</td>
<td align="left"><code>listen</code>, <code>server_name</code>,<code>access_log</code>, <code>location</code>, <code>protocol</code>, <code>proxy</code>, <code>smtp_auth</code>, <code>xclient</code></td>
</tr>
<tr>
<td align="left"><code>location</code></td>
<td align="left"><code>http</code> æœåŠ¡ä¸­ï¼ŒæŸäº›ç‰¹å®šçš„ <code>URL</code> å¯¹åº”çš„ä¸€ç³»åˆ—é…ç½®é¡¹ã€‚</td>
<td align="left"><code>index</code>, <code>root</code></td>
</tr>
<tr>
<td align="left"><code>mail</code></td>
<td align="left">å®ç°<code>email</code>ç›¸å…³çš„ <code>SMTP/IMAP/POP3</code> ä»£ç†æ—¶ï¼Œå…±äº«çš„ä¸€äº›é…ç½®é¡¹ï¼ˆå› ä¸ºå¯èƒ½å®ç°å¤šä¸ªä»£ç†ï¼Œå·¥ä½œåœ¨å¤šä¸ªç›‘å¬åœ°å€ä¸Šï¼‰ã€‚</td>
<td align="left"><code>server</code>,<code>http</code>, <code>imap_capabilities</code></td>
</tr>
<tr>
<td align="left"><code>include</code></td>
<td align="left">ä»¥ä¾¿å¢å¼ºé…ç½®æ–‡ä»¶çš„å¯è¯»æ€§ï¼Œä½¿å¾—éƒ¨åˆ†é…ç½®æ–‡ä»¶å¯ä»¥é‡æ–°ä½¿ç”¨ã€‚</td>
<td align="left">-</td>
</tr>
<tr>
<td align="left"><code>valid_referers</code></td>
<td align="left">ç”¨æ¥æ ¡éªŒ<code>Http</code>è¯·æ±‚å¤´<code>Referer</code>æ˜¯å¦æœ‰æ•ˆã€‚</td>
<td align="left">-</td>
</tr>
<tr>
<td align="left"><code>try_files</code></td>
<td align="left">ç”¨åœ¨<code>server</code>éƒ¨åˆ†ï¼Œä¸è¿‡æœ€å¸¸è§çš„è¿˜æ˜¯ç”¨åœ¨<code>location</code>éƒ¨åˆ†ï¼Œå®ƒä¼šæŒ‰ç…§ç»™å®šçš„å‚æ•°é¡ºåºè¿›è¡Œå°è¯•ï¼Œç¬¬ä¸€ä¸ªè¢«åŒ¹é…åˆ°çš„å°†ä¼šè¢«ä½¿ç”¨ã€‚</td>
<td align="left">-</td>
</tr>
<tr>
<td align="left"><code>if</code></td>
<td align="left">å½“åœ¨<code>location</code>å—ä¸­ä½¿ç”¨<code>if</code>æŒ‡ä»¤ï¼Œåœ¨æŸäº›æƒ…å†µä¸‹å®ƒå¹¶ä¸æŒ‰ç…§é¢„æœŸè¿è¡Œï¼Œä¸€èˆ¬æ¥è¯´é¿å…ä½¿ç”¨<code>if</code>æŒ‡ä»¤ã€‚</td>
<td align="left">-</td>
</tr>
</tbody></table>
<ul>
<li>ä¾‹å¦‚æˆ‘ä»¬å† <strong><code>nginx.conf</code></strong> é‡Œé¢å¼•ç”¨ä¸¤ä¸ªé…ç½® <code>vhost/example.com.conf</code>å’Œ <code>vhost/gitlab.com.conf</code> å®ƒä»¬éƒ½è¢«æ”¾åœ¨ä¸€ä¸ªæˆ‘è‡ªå·±æ–°å»ºçš„ç›®å½• <code>vhost</code>ä¸‹é¢ã€‚<code>nginx.conf</code> é…ç½®å¦‚ä¸‹ï¼š</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line">worker_processes  1;</span><br><span class="line">events &#123;</span><br><span class="line">    worker_connections  1024;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">http &#123;</span><br><span class="line">    include       mime.types;</span><br><span class="line">    default_type  application/octet-stream;</span><br><span class="line"></span><br><span class="line">    #log_format  main  &#x27;$remote_addr - $remote_user [$time_local] &quot;$request&quot; &#x27;</span><br><span class="line">    #                  &#x27;$status $body_bytes_sent &quot;$http_referer&quot; &#x27;</span><br><span class="line">    #                  &#x27;&quot;$http_user_agent&quot; &quot;$http_x_forwarded_for&quot;&#x27;;</span><br><span class="line"></span><br><span class="line">    #access_log  logs/access.log  main;</span><br><span class="line"></span><br><span class="line">    sendfile        on;</span><br><span class="line">    #tcp_nopush     on;</span><br><span class="line"></span><br><span class="line">    #keepalive_timeout  0;</span><br><span class="line">    keepalive_timeout  65;</span><br><span class="line"></span><br><span class="line">    #gzip  on;</span><br><span class="line">    server &#123;</span><br><span class="line">        listen       80;</span><br><span class="line">        server_name  localhost;</span><br><span class="line">        location / &#123;</span><br><span class="line">            root   html;</span><br><span class="line">            index  index.html index.htm;</span><br><span class="line">        &#125;</span><br><span class="line">        error_page   500 502 503 504  /50x.html;</span><br><span class="line">        location = /50x.html &#123;</span><br><span class="line">            root   html;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    include  vhost/example.com.conf;</span><br><span class="line">    include  vhost/gitlab.com.conf;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ul>
<li>ç®€å•çš„é…ç½®: <code>example.com.conf</code></li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">server &#123;</span><br><span class="line">    #ä¾¦å¬çš„80ç«¯å£</span><br><span class="line">    listen       80;</span><br><span class="line">    server_name  baidu.com app.baidu.com; # è¿™é‡ŒæŒ‡å®šåŸŸå</span><br><span class="line">    index        index.html index.htm;    # è¿™é‡ŒæŒ‡å®šé»˜è®¤å…¥å£é¡µé¢</span><br><span class="line">    root /home/www/app.baidu.com;         # è¿™é‡ŒæŒ‡å®šç›®å½•</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="6-5-å†…ç½®é¢„å®šä¹‰å˜é‡"><a href="#6-5-å†…ç½®é¢„å®šä¹‰å˜é‡" class="headerlink" title="6.5 å†…ç½®é¢„å®šä¹‰å˜é‡"></a>6.5 å†…ç½®é¢„å®šä¹‰å˜é‡</h3><ul>
<li><code>Nginx</code>æä¾›äº†è®¸å¤šé¢„å®šä¹‰çš„å˜é‡ï¼Œä¹Ÿå¯ä»¥é€šè¿‡ä½¿ç”¨<code>set</code>æ¥è®¾ç½®å˜é‡ã€‚ä½ å¯ä»¥åœ¨<code>if</code>ä¸­ä½¿ç”¨é¢„å®šä¹‰å˜é‡ï¼Œä¹Ÿå¯ä»¥å°†å®ƒä»¬ä¼ é€’ç»™ä»£ç†æœåŠ¡å™¨ã€‚ä»¥ä¸‹æ˜¯ä¸€äº›å¸¸è§çš„é¢„å®šä¹‰å˜é‡ï¼Œ<a target="_blank" rel="noopener" href="http://nginx.org/en/docs/varindex.html">æ›´å¤šè¯¦è§</a></li>
</ul>
<table>
<thead>
<tr>
<th align="left">å˜é‡åç§°</th>
<th align="left">å€¼</th>
</tr>
</thead>
<tbody><tr>
<td align="left"><code>$args_name</code></td>
<td align="left">åœ¨è¯·æ±‚ä¸­çš„<code>name</code>å‚æ•°</td>
</tr>
<tr>
<td align="left"><code>$args</code> &#96;</td>
<td align="left">æ‰€æœ‰è¯·æ±‚å‚æ•°</td>
</tr>
<tr>
<td align="left"><code>$query_string</code></td>
<td align="left"><code>$args</code>çš„åˆ«å</td>
</tr>
<tr>
<td align="left"><code>$content_length</code></td>
<td align="left">è¯·æ±‚å¤´<code>Content-Length</code>çš„å€¼</td>
</tr>
<tr>
<td align="left"><code>$content_type</code></td>
<td align="left">è¯·æ±‚å¤´<code>Content-Type</code>çš„å€¼</td>
</tr>
<tr>
<td align="left"><code>$host</code></td>
<td align="left">å¦‚æœå½“å‰æœ‰<code>Host</code>ï¼Œåˆ™ä¸ºè¯·æ±‚å¤´<code>Host</code>çš„å€¼ï¼›å¦‚æœæ²¡æœ‰è¿™ä¸ªå¤´ï¼Œé‚£ä¹ˆè¯¥å€¼ç­‰äºåŒ¹é…è¯¥è¯·æ±‚çš„<code>server_name</code>çš„å€¼</td>
</tr>
<tr>
<td align="left"><code>$remote_addr</code></td>
<td align="left">å®¢æˆ·ç«¯çš„<code>IP</code>åœ°å€</td>
</tr>
<tr>
<td align="left"><code>$request</code></td>
<td align="left">å®Œæ•´çš„è¯·æ±‚ï¼Œä»å®¢æˆ·ç«¯æ”¶åˆ°ï¼ŒåŒ…æ‹¬<code>Http</code>è¯·æ±‚æ–¹æ³•ã€<code>URI</code>ã€<code>Http</code>åè®®ã€å¤´ã€è¯·æ±‚ä½“</td>
</tr>
<tr>
<td align="left"><code>$request_uri</code></td>
<td align="left">å®Œæ•´è¯·æ±‚çš„<code>URI</code>ï¼Œä»å®¢æˆ·ç«¯æ¥çš„è¯·æ±‚ï¼ŒåŒ…æ‹¬å‚æ•°</td>
</tr>
<tr>
<td align="left"><code>$scheme</code></td>
<td align="left">å½“å‰è¯·æ±‚çš„åè®®</td>
</tr>
<tr>
<td align="left"><code>$uri</code></td>
<td align="left">å½“å‰è¯·æ±‚çš„æ ‡å‡†åŒ–<code>URI</code></td>
</tr>
</tbody></table>
<h3 id="6-6-åå‘ä»£ç†"><a href="#6-6-åå‘ä»£ç†" class="headerlink" title="6.6 åå‘ä»£ç†"></a>6.6 åå‘ä»£ç†</h3><ul>
<li>åå‘ä»£ç†æ˜¯ä¸€ä¸ª<code>Web</code>æœåŠ¡å™¨ï¼Œå®ƒæ¥å—å®¢æˆ·ç«¯çš„è¿æ¥è¯·æ±‚ï¼Œç„¶åå°†è¯·æ±‚è½¬å‘ç»™ä¸Šæ¸¸æœåŠ¡å™¨ï¼Œå¹¶å°†ä»æœåŠ¡å™¨å¾—åˆ°çš„ç»“æœè¿”å›ç»™è¿æ¥çš„å®¢æˆ·ç«¯ã€‚ä¸‹é¢ç®€å•çš„åå‘ä»£ç†çš„ä¾‹å­ï¼š</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">server &#123;  </span><br><span class="line">  listen       80;                                                        </span><br><span class="line">  server_name  localhost;                                              </span><br><span class="line">  client_max_body_size 1024M;  # å…è®¸å®¢æˆ·ç«¯è¯·æ±‚çš„æœ€å¤§å•æ–‡ä»¶å­—èŠ‚æ•°</span><br><span class="line"></span><br><span class="line">  location / &#123;</span><br><span class="line">    proxy_pass                         http://localhost:8080;</span><br><span class="line">    proxy_set_header Host              $host:$server_port;</span><br><span class="line">    proxy_set_header X-Forwarded-For   $remote_addr; # HTTPçš„è¯·æ±‚ç«¯çœŸå®çš„IP</span><br><span class="line">    proxy_set_header X-Forwarded-Proto $scheme;      # ä¸ºäº†æ­£ç¡®åœ°è¯†åˆ«å®é™…ç”¨æˆ·å‘å‡ºçš„åè®®æ˜¯ http è¿˜æ˜¯ https</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ul>
<li>å¤æ‚çš„é…ç½®: <code>gitlab.com.conf</code>ã€‚</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">server &#123;</span><br><span class="line">    #ä¾¦å¬çš„80ç«¯å£</span><br><span class="line">    listen       80;</span><br><span class="line">    server_name  git.example.cn;</span><br><span class="line">    location / &#123;</span><br><span class="line">        proxy_pass   http://localhost:3000;</span><br><span class="line">        #ä»¥ä¸‹æ˜¯ä¸€äº›åå‘ä»£ç†çš„é…ç½®å¯åˆ é™¤</span><br><span class="line">        proxy_redirect             off;</span><br><span class="line">        #åç«¯çš„WebæœåŠ¡å™¨å¯ä»¥é€šè¿‡X-Forwarded-Forè·å–ç”¨æˆ·çœŸå®IP</span><br><span class="line">        proxy_set_header           Host $host;</span><br><span class="line">        client_max_body_size       10m; #å…è®¸å®¢æˆ·ç«¯è¯·æ±‚çš„æœ€å¤§å•æ–‡ä»¶å­—èŠ‚æ•°</span><br><span class="line">        client_body_buffer_size    128k; #ç¼“å†²åŒºä»£ç†ç¼“å†²ç”¨æˆ·ç«¯è¯·æ±‚çš„æœ€å¤§å­—èŠ‚æ•°</span><br><span class="line">        proxy_connect_timeout      300; #nginxè·Ÿåç«¯æœåŠ¡å™¨è¿æ¥è¶…æ—¶æ—¶é—´(ä»£ç†è¿æ¥è¶…æ—¶)</span><br><span class="line">        proxy_send_timeout         300; #åç«¯æœåŠ¡å™¨æ•°æ®å›ä¼ æ—¶é—´(ä»£ç†å‘é€è¶…æ—¶)</span><br><span class="line">        proxy_read_timeout         300; #è¿æ¥æˆåŠŸåï¼Œåç«¯æœåŠ¡å™¨å“åº”æ—¶é—´(ä»£ç†æ¥æ”¶è¶…æ—¶)</span><br><span class="line">        proxy_buffer_size          4k; #è®¾ç½®ä»£ç†æœåŠ¡å™¨ï¼ˆnginxï¼‰ä¿å­˜ç”¨æˆ·å¤´ä¿¡æ¯çš„ç¼“å†²åŒºå¤§å°</span><br><span class="line">        proxy_buffers              4 32k; #proxy_buffersç¼“å†²åŒºï¼Œç½‘é¡µå¹³å‡åœ¨32kä»¥ä¸‹çš„è¯ï¼Œè¿™æ ·è®¾ç½®</span><br><span class="line">        proxy_busy_buffers_size    64k; #é«˜è´Ÿè·ä¸‹ç¼“å†²å¤§å°ï¼ˆproxy_buffers*2ï¼‰</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ul>
<li>ä»£ç†åˆ°ä¸Šæ¸¸æœåŠ¡å™¨çš„é…ç½®ä¸­ï¼Œæœ€é‡è¦çš„æ˜¯<code>proxy_pass</code>æŒ‡ä»¤ã€‚ä»¥ä¸‹æ˜¯ä»£ç†æ¨¡å—ä¸­çš„ä¸€äº›å¸¸ç”¨æŒ‡ä»¤ï¼š</li>
</ul>
<table>
<thead>
<tr>
<th align="left">æŒ‡ä»¤</th>
<th align="left">è¯´æ˜</th>
</tr>
</thead>
<tbody><tr>
<td align="left"><code>proxy_connect_timeout</code></td>
<td align="left"><code>Nginx</code>ä»æ¥å—è¯·æ±‚è‡³è¿æ¥åˆ°ä¸Šæ¸¸æœåŠ¡å™¨çš„æœ€é•¿ç­‰å¾…æ—¶é—´</td>
</tr>
<tr>
<td align="left"><code>proxy_send_timeout</code></td>
<td align="left">åç«¯æœåŠ¡å™¨æ•°æ®å›ä¼ æ—¶é—´(ä»£ç†å‘é€è¶…æ—¶)</td>
</tr>
<tr>
<td align="left"><code>proxy_read_timeout</code></td>
<td align="left">è¿æ¥æˆåŠŸåï¼Œåç«¯æœåŠ¡å™¨å“åº”æ—¶é—´(ä»£ç†æ¥æ”¶è¶…æ—¶)</td>
</tr>
<tr>
<td align="left"><code>proxy_cookie_domain</code></td>
<td align="left">æ›¿ä»£ä»ä¸Šæ¸¸æœåŠ¡å™¨æ¥çš„<code>Set-Cookie</code>å¤´çš„<code>domain</code>å±æ€§</td>
</tr>
<tr>
<td align="left"><code>proxy_cookie_path</code></td>
<td align="left">æ›¿ä»£ä»ä¸Šæ¸¸æœåŠ¡å™¨æ¥çš„<code>Set-Cookie</code>å¤´çš„<code>path</code>å±æ€§</td>
</tr>
<tr>
<td align="left"><code>proxy_buffer_size</code></td>
<td align="left">è®¾ç½®ä»£ç†æœåŠ¡å™¨ï¼ˆ<code>nginx</code>ï¼‰ä¿å­˜ç”¨æˆ·å¤´ä¿¡æ¯çš„ç¼“å†²åŒºå¤§å°</td>
</tr>
<tr>
<td align="left"><code>proxy_buffers</code></td>
<td align="left"><code>proxy_buffers</code>ç¼“å†²åŒºï¼Œç½‘é¡µå¹³å‡åœ¨å¤šå°‘kä»¥ä¸‹</td>
</tr>
<tr>
<td align="left"><code>proxy_set_header</code></td>
<td align="left">é‡å†™å‘é€åˆ°ä¸Šæ¸¸æœåŠ¡å™¨å¤´çš„å†…å®¹ï¼Œä¹Ÿå¯ä»¥é€šè¿‡å°†æŸä¸ªå¤´éƒ¨çš„å€¼è®¾ç½®ä¸ºç©ºå­—ç¬¦ä¸²ï¼Œè€Œä¸å‘é€æŸä¸ªå¤´éƒ¨çš„æ–¹æ³•å®ç°</td>
</tr>
<tr>
<td align="left"><code>proxy_ignore_headers</code></td>
<td align="left">è¿™ä¸ªæŒ‡ä»¤ç¦æ­¢å¤„ç†æ¥è‡ªä»£ç†æœåŠ¡å™¨çš„åº”ç­”ã€‚</td>
</tr>
<tr>
<td align="left"><code>proxy_intercept_errors</code></td>
<td align="left">ä½¿<code>nginx</code>é˜»æ­¢<code>HTTP</code>åº”ç­”ä»£ç ä¸º<code>400</code>æˆ–è€…æ›´é«˜çš„åº”ç­”ã€‚</td>
</tr>
</tbody></table>
<h3 id="6-7-è´Ÿè½½å‡è¡¡"><a href="#6-7-è´Ÿè½½å‡è¡¡" class="headerlink" title="6.7 è´Ÿè½½å‡è¡¡"></a>6.7 è´Ÿè½½å‡è¡¡</h3><ul>
<li><code>upstream</code>æŒ‡ä»¤å¯ç”¨ä¸€ä¸ªæ–°çš„é…ç½®åŒºæ®µï¼Œåœ¨è¯¥åŒºæ®µå®šä¹‰ä¸€ç»„ä¸Šæ¸¸æœåŠ¡å™¨ã€‚è¿™äº›æœåŠ¡å™¨å¯èƒ½è¢«è®¾ç½®ä¸åŒçš„æƒé‡ï¼Œä¹Ÿå¯èƒ½å‡ºäºå¯¹æœåŠ¡å™¨è¿›è¡Œç»´æŠ¤ï¼Œæ ‡è®°ä¸º<code>down</code>ã€‚</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line">upstream gitlab &#123;</span><br><span class="line">    ip_hash;</span><br><span class="line">    # upstreamçš„è´Ÿè½½å‡è¡¡ï¼Œweightæ˜¯æƒé‡ï¼Œå¯ä»¥æ ¹æ®æœºå™¨é…ç½®å®šä¹‰æƒé‡ã€‚weigthå‚æ•°è¡¨ç¤ºæƒå€¼ï¼Œæƒå€¼è¶Šé«˜è¢«åˆ†é…åˆ°çš„å‡ ç‡è¶Šå¤§ã€‚</span><br><span class="line">    server 192.168.122.11:8081 ;</span><br><span class="line">    server 127.0.0.1:82 weight=3;</span><br><span class="line">    server 127.0.0.1:83 weight=3 down;</span><br><span class="line">    server 127.0.0.1:84 weight=3; max_fails=3  fail_timeout=20s;</span><br><span class="line">    server 127.0.0.1:85 weight=4;;</span><br><span class="line">    keepalive 32;</span><br><span class="line">&#125;</span><br><span class="line">server &#123;</span><br><span class="line">    #ä¾¦å¬çš„80ç«¯å£</span><br><span class="line">    listen       80;</span><br><span class="line">    server_name  git.example.cn;</span><br><span class="line">    location / &#123;</span><br><span class="line">        proxy_pass   http://gitlab;    #åœ¨è¿™é‡Œè®¾ç½®ä¸€ä¸ªä»£ç†ï¼Œå’Œupstreamçš„åå­—ä¸€æ ·</span><br><span class="line">        #ä»¥ä¸‹æ˜¯ä¸€äº›åå‘ä»£ç†çš„é…ç½®å¯åˆ é™¤</span><br><span class="line">        proxy_redirect             off;</span><br><span class="line">        #åç«¯çš„WebæœåŠ¡å™¨å¯ä»¥é€šè¿‡X-Forwarded-Forè·å–ç”¨æˆ·çœŸå®IP</span><br><span class="line">        proxy_set_header           Host $host;</span><br><span class="line">        proxy_set_header           X-Real-IP $remote_addr;</span><br><span class="line">        proxy_set_header           X-Forwarded-For $proxy_add_x_forwarded_for;</span><br><span class="line">        client_max_body_size       10m;  #å…è®¸å®¢æˆ·ç«¯è¯·æ±‚çš„æœ€å¤§å•æ–‡ä»¶å­—èŠ‚æ•°</span><br><span class="line">        client_body_buffer_size    128k; #ç¼“å†²åŒºä»£ç†ç¼“å†²ç”¨æˆ·ç«¯è¯·æ±‚çš„æœ€å¤§å­—èŠ‚æ•°</span><br><span class="line">        proxy_connect_timeout      300;  #nginxè·Ÿåç«¯æœåŠ¡å™¨è¿æ¥è¶…æ—¶æ—¶é—´(ä»£ç†è¿æ¥è¶…æ—¶)</span><br><span class="line">        proxy_send_timeout         300;  #åç«¯æœåŠ¡å™¨æ•°æ®å›ä¼ æ—¶é—´(ä»£ç†å‘é€è¶…æ—¶)</span><br><span class="line">        proxy_read_timeout         300;  #è¿æ¥æˆåŠŸåï¼Œåç«¯æœåŠ¡å™¨å“åº”æ—¶é—´(ä»£ç†æ¥æ”¶è¶…æ—¶)</span><br><span class="line">        proxy_buffer_size          4k; #è®¾ç½®ä»£ç†æœåŠ¡å™¨ï¼ˆnginxï¼‰ä¿å­˜ç”¨æˆ·å¤´ä¿¡æ¯çš„ç¼“å†²åŒºå¤§å°</span><br><span class="line">        proxy_buffers              4 32k;# ç¼“å†²åŒºï¼Œç½‘é¡µå¹³å‡åœ¨32kä»¥ä¸‹çš„è¯ï¼Œè¿™æ ·è®¾ç½®</span><br><span class="line">        proxy_busy_buffers_size    64k; #é«˜è´Ÿè·ä¸‹ç¼“å†²å¤§å°ï¼ˆproxy_buffers*2ï¼‰</span><br><span class="line">        proxy_temp_file_write_size 64k; #è®¾å®šç¼“å­˜æ–‡ä»¶å¤¹å¤§å°ï¼Œå¤§äºè¿™ä¸ªå€¼ï¼Œå°†ä»upstreamæœåŠ¡å™¨ä¼ </span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ul>
<li>æ¯ä¸ªè¯·æ±‚æŒ‰æ—¶é—´é¡ºåºé€ä¸€åˆ†é…åˆ°ä¸åŒçš„åç«¯æœåŠ¡å™¨ï¼Œå¦‚æœåç«¯æœåŠ¡å™¨<code>down</code>æ‰ï¼Œèƒ½è‡ªåŠ¨å‰”é™¤ã€‚</li>
</ul>
<p><strong>è´Ÿè½½å‡è¡¡ï¼š</strong></p>
<ul>
<li><code>upstream</code>æ¨¡å—èƒ½å¤Ÿä½¿ç”¨3ç§è´Ÿè½½å‡è¡¡ç®—æ³•ï¼šè½®è¯¢ã€IPå“ˆå¸Œã€æœ€å°‘è¿æ¥æ•°ã€‚</li>
</ul>
<p><strong>è½®è¯¢ï¼š</strong></p>
<ul>
<li>é»˜è®¤æƒ…å†µä¸‹ä½¿ç”¨è½®è¯¢ç®—æ³•ï¼Œä¸éœ€è¦é…ç½®æŒ‡ä»¤æ¥æ¿€æ´»å®ƒï¼Œå®ƒæ˜¯åŸºäºåœ¨é˜Ÿåˆ—ä¸­è°æ˜¯ä¸‹ä¸€ä¸ªçš„åŸç†ç¡®ä¿è®¿é—®å‡åŒ€åœ°åˆ†å¸ƒåˆ°æ¯ä¸ªä¸Šæ¸¸æœåŠ¡å™¨ï¼›</li>
</ul>
<p><strong>IPå“ˆå¸Œï¼š</strong></p>
<ul>
<li>é€šè¿‡<code>ip_hash</code>æŒ‡ä»¤æ¥æ¿€æ´»ï¼ŒNginxé€šè¿‡IPv4åœ°å€çš„å‰3ä¸ªå­—èŠ‚æˆ–è€…æ•´ä¸ªIPv6åœ°å€ä½œä¸ºå“ˆå¸Œé”®æ¥å®ç°ï¼ŒåŒä¸€ä¸ªIPåœ°å€æ€»æ˜¯èƒ½è¢«æ˜ å°„åˆ°åŒä¸€ä¸ªä¸Šæ¸¸æœåŠ¡å™¨ï¼›</li>
</ul>
<p><strong>æœ€å°‘è¿æ¥æ•°ï¼š</strong></p>
<ul>
<li>é€šè¿‡<code>least_conn</code>æŒ‡ä»¤æ¥æ¿€æ´»ï¼Œè¯¥ç®—æ³•é€šè¿‡é€‰æ‹©ä¸€ä¸ªæ´»è·ƒæ•°æœ€å°‘çš„ä¸Šæ¸¸æœåŠ¡å™¨è¿›è¡Œè¿æ¥ã€‚å¦‚æœä¸Šæ¸¸æœåŠ¡å™¨å¤„ç†èƒ½åŠ›ä¸åŒï¼Œå¯ä»¥é€šè¿‡ç»™<code>server</code>é…ç½®<code>weight</code>æƒé‡æ¥è¯´æ˜ï¼Œè¯¥ç®—æ³•å°†è€ƒè™‘åˆ°ä¸åŒæœåŠ¡å™¨çš„åŠ æƒæœ€å°‘è¿æ¥æ•°ã€‚</li>
</ul>
<h4 id="6-7-1-RR"><a href="#6-7-1-RR" class="headerlink" title="6.7.1 RR"></a>6.7.1 RR</h4><p><strong>ç®€å•é…ç½®</strong></p>
<blockquote>
<p>è¿™é‡Œæˆ‘é…ç½®äº†2å°æœåŠ¡å™¨ï¼Œå½“ç„¶å®é™…ä¸Šæ˜¯ä¸€å°ï¼Œåªæ˜¯ç«¯å£ä¸ä¸€æ ·è€Œå·²ï¼Œè€Œ8081çš„æœåŠ¡å™¨æ˜¯ä¸å­˜åœ¨çš„ï¼Œä¹Ÿå°±æ˜¯è¯´è®¿é—®ä¸åˆ°ï¼Œä½†æ˜¯æˆ‘ä»¬è®¿é—® <code>http://localhost</code> çš„æ—¶å€™ï¼Œä¹Ÿä¸ä¼šæœ‰é—®é¢˜ï¼Œä¼šé»˜è®¤è·³è½¬åˆ°<code>http://localhost:8080</code>å…·ä½“æ˜¯å› ä¸ºNginxä¼šè‡ªåŠ¨åˆ¤æ–­æœåŠ¡å™¨çš„çŠ¶æ€ï¼Œå¦‚æœæœåŠ¡å™¨å¤„äºä¸èƒ½è®¿é—®ï¼ˆæœåŠ¡å™¨æŒ‚äº†ï¼‰ï¼Œå°±ä¸ä¼šè·³è½¬åˆ°è¿™å°æœåŠ¡å™¨ï¼Œæ‰€ä»¥ä¹Ÿé¿å…äº†ä¸€å°æœåŠ¡å™¨æŒ‚äº†å½±å“ä½¿ç”¨çš„æƒ…å†µï¼Œç”±äºNginxé»˜è®¤æ˜¯RRç­–ç•¥ï¼Œæ‰€ä»¥æˆ‘ä»¬ä¸éœ€è¦å…¶ä»–æ›´å¤šçš„è®¾ç½®</p>
</blockquote>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">upstream test &#123;</span><br><span class="line">    server localhost:8080;</span><br><span class="line">    server localhost:8081;</span><br><span class="line">&#125;</span><br><span class="line">server &#123;</span><br><span class="line">    listen       81;</span><br><span class="line">    server_name  localhost;</span><br><span class="line">    client_max_body_size 1024M;</span><br><span class="line"> </span><br><span class="line">    location / &#123;</span><br><span class="line">        proxy_pass http://test;</span><br><span class="line">        proxy_set_header Host $host:$server_port;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>è´Ÿè½½å‡è¡¡çš„æ ¸å¿ƒä»£ç ä¸º</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">upstream test &#123;</span><br><span class="line">    server localhost:8080;</span><br><span class="line">    server localhost:8081;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="6-7-2-æƒé‡"><a href="#6-7-2-æƒé‡" class="headerlink" title="6.7.2 æƒé‡"></a>6.7.2 æƒé‡</h4><ul>
<li>æŒ‡å®šè½®è¯¢å‡ ç‡ï¼Œ<code>weight</code>å’Œè®¿é—®æ¯”ç‡æˆæ­£æ¯”ï¼Œç”¨äºåç«¯æœåŠ¡å™¨æ€§èƒ½ä¸å‡çš„æƒ…å†µã€‚ ä¾‹å¦‚</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">upstream test &#123;</span><br><span class="line">    server localhost:8080 weight=9;</span><br><span class="line">    server localhost:8081 weight=1;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ul>
<li>é‚£ä¹ˆ10æ¬¡ä¸€èˆ¬åªä¼šæœ‰<code>1</code>æ¬¡ä¼šè®¿é—®åˆ°<code>8081</code>ï¼Œè€Œæœ‰<code>9</code>æ¬¡ä¼šè®¿é—®åˆ°<code>8080</code></li>
</ul>
<h4 id="6-7-3-ip-hash"><a href="#6-7-3-ip-hash" class="headerlink" title="6.7.3 ip_hash"></a>6.7.3 ip_hash</h4><blockquote>
<p>ä¸Šé¢çš„2ç§æ–¹å¼éƒ½æœ‰ä¸€ä¸ªé—®é¢˜ï¼Œé‚£å°±æ˜¯ä¸‹ä¸€ä¸ªè¯·æ±‚æ¥çš„æ—¶å€™è¯·æ±‚å¯èƒ½åˆ†å‘åˆ°å¦å¤–ä¸€ä¸ªæœåŠ¡å™¨ï¼Œå½“æˆ‘ä»¬çš„ç¨‹åºä¸æ˜¯æ— çŠ¶æ€çš„æ—¶å€™ï¼ˆé‡‡ç”¨äº†<code>session</code>ä¿å­˜æ•°æ®ï¼‰ï¼Œè¿™æ—¶å€™å°±æœ‰ä¸€ä¸ªå¾ˆå¤§çš„å¾ˆé—®é¢˜äº†ï¼Œæ¯”å¦‚æŠŠç™»å½•ä¿¡æ¯ä¿å­˜åˆ°äº†<code>session</code>ä¸­ï¼Œé‚£ä¹ˆè·³è½¬åˆ°å¦å¤–ä¸€å°æœåŠ¡å™¨çš„æ—¶å€™å°±éœ€è¦é‡æ–°ç™»å½•äº†ï¼Œæ‰€ä»¥å¾ˆå¤šæ—¶å€™æˆ‘ä»¬éœ€è¦ä¸€ä¸ªå®¢æˆ·åªè®¿é—®ä¸€ä¸ªæœåŠ¡å™¨ï¼Œé‚£ä¹ˆå°±éœ€è¦ç”¨<code>iphash</code>äº†ï¼Œ<code>iphash</code>çš„æ¯ä¸ªè¯·æ±‚æŒ‰è®¿é—®<code>ip</code>çš„<code>hash</code>ç»“æœåˆ†é…ï¼Œè¿™æ ·æ¯ä¸ªè®¿å®¢å›ºå®šè®¿é—®ä¸€ä¸ªåç«¯æœåŠ¡å™¨ï¼Œå¯ä»¥è§£å†³<code>session</code>çš„é—®é¢˜ã€‚</p>
</blockquote>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">upstream test &#123;</span><br><span class="line">    ip_hash;</span><br><span class="line">    server localhost:8080;</span><br><span class="line">    server localhost:8081;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="6-7-4-fair"><a href="#6-7-4-fair" class="headerlink" title="6.7.4 fair"></a>6.7.4 fair</h4><ul>
<li>è¿™æ˜¯ä¸ªç¬¬ä¸‰æ–¹æ¨¡å—ï¼ŒæŒ‰åç«¯æœåŠ¡å™¨çš„å“åº”æ—¶é—´æ¥åˆ†é…è¯·æ±‚ï¼Œå“åº”æ—¶é—´çŸ­çš„ä¼˜å…ˆåˆ†é…ã€‚</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">upstream backend &#123;</span><br><span class="line">    fair;</span><br><span class="line">    server localhost:8080;</span><br><span class="line">    server localhost:8081;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="6-7-5-url-hash"><a href="#6-7-5-url-hash" class="headerlink" title="6.7.5 url_hash"></a>6.7.5 url_hash</h4><blockquote>
<p>è¿™æ˜¯ä¸ªç¬¬ä¸‰æ–¹æ¨¡å—ï¼ŒæŒ‰è®¿é—®<code>url</code>çš„<code>hash</code>ç»“æœæ¥åˆ†é…è¯·æ±‚ï¼Œä½¿æ¯ä¸ª<code>url</code>å®šå‘åˆ°åŒä¸€ä¸ªåç«¯æœåŠ¡å™¨ï¼Œåç«¯æœåŠ¡å™¨ä¸ºç¼“å­˜æ—¶æ¯”è¾ƒæœ‰æ•ˆã€‚ åœ¨<code>upstream</code>ä¸­åŠ å…¥<code>hash</code>è¯­å¥ï¼Œ<code>server</code>è¯­å¥ä¸­ä¸èƒ½å†™å…¥<code>weight</code>ç­‰å…¶ä»–çš„å‚æ•°ï¼Œ<code>hash_method</code>æ˜¯ä½¿ç”¨çš„<code>hash</code>ç®—æ³•</p>
</blockquote>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">upstream backend &#123;</span><br><span class="line">    hash $request_uri;</span><br><span class="line">    hash_method crc32;</span><br><span class="line">    server localhost:8080;</span><br><span class="line">    server localhost:8081;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ul>
<li>ä»¥ä¸Š<code>5</code>ç§è´Ÿè½½å‡è¡¡å„è‡ªé€‚ç”¨ä¸åŒæƒ…å†µä¸‹ä½¿ç”¨ï¼Œæ‰€ä»¥å¯ä»¥æ ¹æ®å®é™…æƒ…å†µé€‰æ‹©ä½¿ç”¨å“ªç§ç­–ç•¥æ¨¡å¼ï¼Œä¸è¿‡<code>fair</code>å’Œ<code>url_hash</code>éœ€è¦å®‰è£…ç¬¬ä¸‰æ–¹æ¨¡å—æ‰èƒ½ä½¿ç”¨</li>
</ul>
<p><strong>serveræŒ‡ä»¤å¯é€‰å‚æ•°ï¼š</strong></p>
<ul>
<li><code>weight</code>ï¼šè®¾ç½®ä¸€ä¸ªæœåŠ¡å™¨çš„è®¿é—®æƒé‡ï¼Œæ•°å€¼è¶Šé«˜ï¼Œæ”¶åˆ°çš„è¯·æ±‚ä¹Ÿè¶Šå¤šï¼›</li>
<li><code>fail_timeout</code>ï¼šåœ¨è¿™ä¸ªæŒ‡å®šçš„æ—¶é—´å†…æœåŠ¡å™¨å¿…é¡»æä¾›å“åº”ï¼Œå¦‚æœåœ¨è¿™ä¸ªæ—¶é—´å†…æ²¡æœ‰æ”¶åˆ°å“åº”ï¼Œé‚£ä¹ˆæœåŠ¡å™¨å°†ä¼šè¢«æ ‡è®°ä¸º<code>down</code>çŠ¶æ€ï¼›</li>
<li><code>max_fails</code>ï¼šè®¾ç½®åœ¨<code>fail_timeout</code>æ—¶é—´ä¹‹å†…å°è¯•å¯¹ä¸€ä¸ªæœåŠ¡å™¨è¿æ¥çš„æœ€å¤§æ¬¡æ•°ï¼Œå¦‚æœè¶…è¿‡è¿™ä¸ªæ¬¡æ•°ï¼Œé‚£ä¹ˆæœåŠ¡å™¨å°†ä¼šè¢«æ ‡è®°ä¸º<code>down</code>;</li>
<li><code>down</code>ï¼šæ ‡è®°ä¸€ä¸ªæœåŠ¡å™¨ä¸å†æ¥å—ä»»ä½•è¯·æ±‚ï¼›</li>
<li><code>backup</code>ï¼šä¸€æ—¦å…¶ä»–æœåŠ¡å™¨å®•æœºï¼Œé‚£ä¹ˆæœ‰è¯¥æ ‡è®°çš„æœºå™¨å°†ä¼šæ¥æ”¶è¯·æ±‚ã€‚</li>
</ul>
<p><strong>keepaliveæŒ‡ä»¤ï¼š</strong></p>
<ul>
<li><code>Nginx</code>æœåŠ¡å™¨å°†ä¼šä¸ºæ¯ä¸€ä¸ª<code>worker</code>è¿›è¡Œä¿æŒåŒä¸Šæ¸¸æœåŠ¡å™¨çš„è¿æ¥ã€‚</li>
</ul>
<h3 id="6-8-å±è”½ip"><a href="#6-8-å±è”½ip" class="headerlink" title="6.8 å±è”½ip"></a>6.8 å±è”½ip</h3><ul>
<li>åœ¨<code>nginx</code>çš„é…ç½®æ–‡ä»¶<code>nginx.conf</code>ä¸­åŠ å…¥å¦‚ä¸‹é…ç½®ï¼Œå¯ä»¥æ”¾åˆ°<code>http</code>, <code>server</code>, <code>location</code>, <code>limit_except</code>è¯­å¥å—ï¼Œéœ€è¦æ³¨æ„ç›¸å¯¹è·¯å¾„ï¼Œæœ¬ä¾‹å½“ä¸­<code>nginx.conf</code>ï¼Œ<code>blocksip.conf</code>åœ¨åŒä¸€ä¸ªç›®å½•ä¸­ã€‚</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">include blockip.conf;</span><br></pre></td></tr></table></figure>

<ul>
<li>åœ¨<code>blockip.conf</code>é‡Œé¢è¾“å…¥å†…å®¹ï¼Œå¦‚ï¼š</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">deny 165.91.122.67;</span><br><span class="line"></span><br><span class="line">deny IP;   # å±è”½å•ä¸ªipè®¿é—®</span><br><span class="line">allow IP;  # å…è®¸å•ä¸ªipè®¿é—®</span><br><span class="line">deny all;  # å±è”½æ‰€æœ‰ipè®¿é—®</span><br><span class="line">allow all; # å…è®¸æ‰€æœ‰ipè®¿é—®</span><br><span class="line">deny 123.0.0.0/8   # å±è”½æ•´ä¸ªæ®µå³ä»123.0.0.1åˆ°123.255.255.254è®¿é—®çš„å‘½ä»¤</span><br><span class="line">deny 124.45.0.0/16 # å±è”½IPæ®µå³ä»123.45.0.1åˆ°123.45.255.254è®¿é—®çš„å‘½ä»¤</span><br><span class="line">deny 123.45.6.0/24 # å±è”½IPæ®µå³ä»123.45.6.1åˆ°123.45.6.254è®¿é—®çš„å‘½ä»¤</span><br><span class="line"></span><br><span class="line"># å¦‚æœä½ æƒ³å®ç°è¿™æ ·çš„åº”ç”¨ï¼Œé™¤äº†å‡ ä¸ªIPå¤–ï¼Œå…¶ä»–å…¨éƒ¨æ‹’ç»</span><br><span class="line">allow 1.1.1.1; </span><br><span class="line">allow 1.1.1.2;</span><br><span class="line">deny all;</span><br></pre></td></tr></table></figure>

<h2 id="ä¸ƒã€ç¬¬ä¸‰æ–¹æ¨¡å—å®‰è£…æ–¹æ³•"><a href="#ä¸ƒã€ç¬¬ä¸‰æ–¹æ¨¡å—å®‰è£…æ–¹æ³•" class="headerlink" title="ä¸ƒã€ç¬¬ä¸‰æ–¹æ¨¡å—å®‰è£…æ–¹æ³•"></a>ä¸ƒã€ç¬¬ä¸‰æ–¹æ¨¡å—å®‰è£…æ–¹æ³•</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">./configure --prefix=/ä½ çš„å®‰è£…ç›®å½•  --add-module=/ç¬¬ä¸‰æ–¹æ¨¡å—ç›®å½•</span><br></pre></td></tr></table></figure>

<h2 id="å…«ã€é‡å®šå‘"><a href="#å…«ã€é‡å®šå‘" class="headerlink" title="å…«ã€é‡å®šå‘"></a>å…«ã€é‡å®šå‘</h2><ul>
<li><code>permanent</code> æ°¸ä¹…æ€§é‡å®šå‘ã€‚è¯·æ±‚æ—¥å¿—ä¸­çš„çŠ¶æ€ç ä¸º301</li>
<li><code>redirect</code> ä¸´æ—¶é‡å®šå‘ã€‚è¯·æ±‚æ—¥å¿—ä¸­çš„çŠ¶æ€ç ä¸º302</li>
</ul>
<h3 id="8-1-é‡å®šå‘æ•´ä¸ªç½‘ç«™"><a href="#8-1-é‡å®šå‘æ•´ä¸ªç½‘ç«™" class="headerlink" title="8.1 é‡å®šå‘æ•´ä¸ªç½‘ç«™"></a>8.1 é‡å®šå‘æ•´ä¸ªç½‘ç«™</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">server &#123;</span><br><span class="line">    server_name old-site.com</span><br><span class="line">    return 301 $scheme://new-site.com$request_uri;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="8-2-é‡å®šå‘å•é¡µ"><a href="#8-2-é‡å®šå‘å•é¡µ" class="headerlink" title="8.2 é‡å®šå‘å•é¡µ"></a>8.2 é‡å®šå‘å•é¡µ</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">server &#123;</span><br><span class="line">    location = /oldpage.html &#123;</span><br><span class="line">        return 301 http://example.org/newpage.html;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="8-3-é‡å®šå‘æ•´ä¸ªå­è·¯å¾„"><a href="#8-3-é‡å®šå‘æ•´ä¸ªå­è·¯å¾„" class="headerlink" title="8.3 é‡å®šå‘æ•´ä¸ªå­è·¯å¾„"></a>8.3 é‡å®šå‘æ•´ä¸ªå­è·¯å¾„</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">location /old-site &#123;</span><br><span class="line">    rewrite ^/old-site/(.*) http://example.org/new-site/$1 permanent;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="ä¹ã€æ€§èƒ½"><a href="#ä¹ã€æ€§èƒ½" class="headerlink" title="ä¹ã€æ€§èƒ½"></a>ä¹ã€æ€§èƒ½</h2><h3 id="9-1-å†…å®¹ç¼“å­˜"><a href="#9-1-å†…å®¹ç¼“å­˜" class="headerlink" title="9.1 å†…å®¹ç¼“å­˜"></a>9.1 å†…å®¹ç¼“å­˜</h3><ul>
<li>å…è®¸æµè§ˆå™¨åŸºæœ¬ä¸Šæ°¸ä¹…åœ°ç¼“å­˜é™æ€å†…å®¹ã€‚ <code>Nginx</code>å°†ä¸ºæ‚¨è®¾ç½®<code>Expires</code>å’Œ<code>Cache-Control</code>å¤´ä¿¡æ¯ã€‚</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">location /static &#123;</span><br><span class="line">    root /data;</span><br><span class="line">    expires max;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ul>
<li>å¦‚æœè¦æ±‚æµè§ˆå™¨æ°¸è¿œä¸ä¼šç¼“å­˜å“åº”ï¼ˆä¾‹å¦‚ç”¨äºè·Ÿè¸ªè¯·æ±‚ï¼‰ï¼Œè¯·ä½¿ç”¨<code>-1</code>ã€‚</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">location = /empty.gif &#123;</span><br><span class="line">    empty_gif;</span><br><span class="line">    expires -1;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="9-2-Gzipå‹ç¼©"><a href="#9-2-Gzipå‹ç¼©" class="headerlink" title="9.2 Gzipå‹ç¼©"></a>9.2 Gzipå‹ç¼©</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">gzip  on;</span><br><span class="line">gzip_buffers 16 8k;</span><br><span class="line">gzip_comp_level 6;</span><br><span class="line">gzip_http_version 1.1;</span><br><span class="line">gzip_min_length 256;</span><br><span class="line">gzip_proxied any;</span><br><span class="line">gzip_vary on;</span><br><span class="line">gzip_types</span><br><span class="line">    text/xml application/xml application/atom+xml application/rss+xml application/xhtml+xml image/svg+xml</span><br><span class="line">    text/javascript application/javascript application/x-javascript</span><br><span class="line">    text/x-json application/json application/x-web-app-manifest+json</span><br><span class="line">    text/css text/plain text/x-component</span><br><span class="line">    font/opentype application/x-font-ttf application/vnd.ms-fontobject</span><br><span class="line">    image/x-icon;</span><br><span class="line">gzip_disable  &quot;msie6&quot;;</span><br></pre></td></tr></table></figure>

<h3 id="9-3-æ‰“å¼€æ–‡ä»¶ç¼“å­˜"><a href="#9-3-æ‰“å¼€æ–‡ä»¶ç¼“å­˜" class="headerlink" title="9.3 æ‰“å¼€æ–‡ä»¶ç¼“å­˜"></a>9.3 æ‰“å¼€æ–‡ä»¶ç¼“å­˜</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">open_file_cache max=1000 inactive=20s;</span><br><span class="line">open_file_cache_valid 30s;</span><br><span class="line">open_file_cache_min_uses 2;</span><br><span class="line">open_file_cache_errors on;</span><br></pre></td></tr></table></figure>

<h3 id="9-4-SSLç¼“å­˜"><a href="#9-4-SSLç¼“å­˜" class="headerlink" title="9.4 SSLç¼“å­˜"></a>9.4 SSLç¼“å­˜</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">ssl_session_cache shared:SSL:10m;</span><br><span class="line">ssl_session_timeout 10m;</span><br></pre></td></tr></table></figure>

<h3 id="9-5-ä¸Šæ¸¸Keepalive"><a href="#9-5-ä¸Šæ¸¸Keepalive" class="headerlink" title="9.5 ä¸Šæ¸¸Keepalive"></a>9.5 ä¸Šæ¸¸Keepalive</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">upstream backend &#123;</span><br><span class="line">    server 127.0.0.1:8080;</span><br><span class="line">    keepalive 32;</span><br><span class="line">&#125;</span><br><span class="line">server &#123;</span><br><span class="line">    ...</span><br><span class="line">    location /api/ &#123;</span><br><span class="line">        proxy_pass http://backend;</span><br><span class="line">        proxy_http_version 1.1;</span><br><span class="line">        proxy_set_header Connection &quot;&quot;;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="9-6-ç›‘æ§"><a href="#9-6-ç›‘æ§" class="headerlink" title="9.6 ç›‘æ§"></a>9.6 ç›‘æ§</h3><ul>
<li>ä½¿ç”¨<code>ngxtop</code>å®æ—¶è§£æ<code>nginx</code>è®¿é—®æ—¥å¿—ï¼Œå¹¶ä¸”å°†å¤„ç†ç»“æœè¾“å‡ºåˆ°ç»ˆç«¯ï¼ŒåŠŸèƒ½ç±»ä¼¼äºç³»ç»Ÿå‘½ä»¤<code>top</code>ã€‚æ‰€æœ‰ç¤ºä¾‹éƒ½è¯»å–<code>nginx</code>é…ç½®æ–‡ä»¶çš„è®¿é—®æ—¥å¿—ä½ç½®å’Œæ ¼å¼ã€‚å¦‚æœè¦æŒ‡å®šè®¿é—®æ—¥å¿—æ–‡ä»¶å’Œ&#x2F;æˆ–æ—¥å¿—æ ¼å¼ï¼Œè¯·ä½¿ç”¨-få’Œ-aé€‰é¡¹ã€‚</li>
<li>æ³¨æ„ï¼šåœ¨<code>nginx</code>é…ç½®ä¸­<code>/usr/local/nginx/conf/nginx.conf</code>æ—¥å¿—æ–‡ä»¶å¿…é¡»æ˜¯ç»å¯¹è·¯å¾„ã€‚</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"># å®‰è£… ngxtop</span><br><span class="line">pip install ngxtop</span><br><span class="line"></span><br><span class="line"># å®æ—¶çŠ¶æ€</span><br><span class="line">ngxtop</span><br><span class="line"># çŠ¶æ€ä¸º404çš„å‰10ä¸ªè¯·æ±‚çš„è·¯å¾„ï¼š</span><br><span class="line">ngxtop top request_path --filter &#x27;status == 404&#x27;</span><br><span class="line"></span><br><span class="line"># å‘é€æ€»å­—èŠ‚æ•°æœ€å¤šçš„å‰10ä¸ªè¯·æ±‚</span><br><span class="line">ngxtop --order-by &#x27;avg(bytes_sent) * count&#x27;</span><br><span class="line"></span><br><span class="line"># æ’åå‰åä½çš„IPï¼Œä¾‹å¦‚ï¼Œè°æ”»å‡»ä½ æœ€å¤š</span><br><span class="line">ngxtop --group-by remote_addr</span><br><span class="line"></span><br><span class="line"># æ‰“å°å…·æœ‰4xxæˆ–5xxçŠ¶æ€çš„è¯·æ±‚ï¼Œä»¥åŠstatuså’Œhttp referer</span><br><span class="line">ngxtop -i &#x27;status &gt;= 400&#x27; print request status http_referer</span><br><span class="line"></span><br><span class="line"># ç”±200ä¸ªè¯·æ±‚è·¯å¾„å“åº”å‘é€çš„å¹³å‡æ­£æ–‡å­—èŠ‚ä»¥&#x27;foo&#x27;å¼€å§‹ï¼š</span><br><span class="line">ngxtop avg bytes_sent --filter &#x27;status == 200 and request_path.startswith(&quot;foo&quot;)&#x27;</span><br><span class="line"></span><br><span class="line"># ä½¿ç”¨â€œcommonâ€æ—¥å¿—æ ¼å¼ä»è¿œç¨‹æœºå™¨åˆ†æapacheè®¿é—®æ—¥å¿—</span><br><span class="line">ssh remote tail -f /var/log/apache2/access.log | ngxtop -f common</span><br></pre></td></tr></table></figure>

<h2 id="åã€å¸¸è§ä½¿ç”¨åœºæ™¯"><a href="#åã€å¸¸è§ä½¿ç”¨åœºæ™¯" class="headerlink" title="åã€å¸¸è§ä½¿ç”¨åœºæ™¯"></a>åã€å¸¸è§ä½¿ç”¨åœºæ™¯</h2><h3 id="10-1-è·¨åŸŸé—®é¢˜"><a href="#10-1-è·¨åŸŸé—®é¢˜" class="headerlink" title="10.1 è·¨åŸŸé—®é¢˜"></a>10.1 è·¨åŸŸé—®é¢˜</h3><ul>
<li>åœ¨å·¥ä½œä¸­ï¼Œæœ‰æ—¶å€™ä¼šé‡åˆ°ä¸€äº›æ¥å£ä¸æ”¯æŒè·¨åŸŸï¼Œè¿™æ—¶å€™å¯ä»¥ç®€å•çš„æ·»åŠ <code>add_headers</code>æ¥æ”¯æŒ<code>cors</code>è·¨åŸŸã€‚é…ç½®å¦‚ä¸‹ï¼š</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">server &#123;</span><br><span class="line">  listen 80;</span><br><span class="line">  server_name api.xxx.com;</span><br><span class="line">    </span><br><span class="line">  add_header &#x27;Access-Control-Allow-Origin&#x27; &#x27;*&#x27;;</span><br><span class="line">  add_header &#x27;Access-Control-Allow-Credentials&#x27; &#x27;true&#x27;;</span><br><span class="line">  add_header &#x27;Access-Control-Allow-Methods&#x27; &#x27;GET,POST,HEAD&#x27;;</span><br><span class="line"></span><br><span class="line">  location / &#123;</span><br><span class="line">    proxy_pass http://127.0.0.1:3000;</span><br><span class="line">    proxy_set_header X-Real-IP $remote_addr;</span><br><span class="line">    proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;</span><br><span class="line">    proxy_set_header Host  $http_host;    </span><br><span class="line">  &#125; </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ul>
<li>ä¸Šé¢æ›´æ”¹å¤´ä¿¡æ¯ï¼Œè¿˜æœ‰ä¸€ç§ï¼Œä½¿ç”¨ <a target="_blank" rel="noopener" href="http://nginx.org/en/docs/http/ngx_http_rewrite_module.html">rewrite</a> æŒ‡ä»¤é‡å®šå‘URIæ¥è§£å†³è·¨åŸŸé—®é¢˜ã€‚</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line">upstream test &#123;</span><br><span class="line">  server 127.0.0.1:8080;</span><br><span class="line">  server localhost:8081;</span><br><span class="line">&#125;</span><br><span class="line">server &#123;</span><br><span class="line">  listen 80;</span><br><span class="line">  server_name api.xxx.com;</span><br><span class="line">  location / &#123; </span><br><span class="line">    root  html;                   #å»è¯·æ±‚../htmlæ–‡ä»¶å¤¹é‡Œçš„æ–‡ä»¶</span><br><span class="line">    index  index.html index.htm;  #é¦–é¡µå“åº”åœ°å€</span><br><span class="line">  &#125;</span><br><span class="line">  # ç”¨äºæ‹¦æˆªè¯·æ±‚ï¼ŒåŒ¹é…ä»»ä½•ä»¥ /api/å¼€å¤´çš„åœ°å€ï¼Œ</span><br><span class="line">  # åŒ¹é…ç¬¦åˆä»¥åï¼Œåœæ­¢å¾€ä¸‹æœç´¢æ­£åˆ™ã€‚</span><br><span class="line">  location ^~/api/&#123; </span><br><span class="line">    # ä»£è¡¨é‡å†™æ‹¦æˆªè¿›æ¥çš„è¯·æ±‚ï¼Œå¹¶ä¸”åªèƒ½å¯¹åŸŸååè¾¹çš„é™¤å»ä¼ é€’çš„å‚æ•°å¤–çš„å­—ç¬¦ä¸²èµ·ä½œç”¨ï¼Œ</span><br><span class="line">    # ä¾‹å¦‚www.a.com/proxy/api/msg?meth=1&amp;par=2é‡å†™ï¼Œåªå¯¹/proxy/api/msgé‡å†™ã€‚</span><br><span class="line">    # rewriteåé¢çš„å‚æ•°æ˜¯ä¸€ä¸ªç®€å•çš„æ­£åˆ™ ^/api/(.*)$ï¼Œ</span><br><span class="line">    # $1ä»£è¡¨æ­£åˆ™ä¸­çš„ç¬¬ä¸€ä¸ª()ï¼Œ$2ä»£è¡¨ç¬¬äºŒä¸ª()çš„å€¼ï¼Œä»¥æ­¤ç±»æ¨ã€‚</span><br><span class="line">    rewrite ^/api/(.*)$ /$1 break;</span><br><span class="line">    </span><br><span class="line">    # æŠŠè¯·æ±‚ä»£ç†åˆ°å…¶ä»–ä¸»æœº </span><br><span class="line">    # å…¶ä¸­ http://www.b.com/ å†™æ³•å’Œ http://www.b.comå†™æ³•çš„åŒºåˆ«å¦‚ä¸‹</span><br><span class="line">    # å¦‚æœä½ çš„è¯·æ±‚åœ°å€æ˜¯ä»– http://server/html/test.jsp</span><br><span class="line">    # é…ç½®ä¸€ï¼š http://www.b.com/ åé¢æœ‰â€œ/â€ </span><br><span class="line">    #         å°†åå‘ä»£ç†æˆ http://www.b.com/html/test.jsp è®¿é—®</span><br><span class="line">    # é…ç½®ä¸€ï¼š http://www.b.com åé¢æ²¡æœ‰æœ‰â€œ/â€ </span><br><span class="line">    #         å°†åå‘ä»£ç†æˆ http://www.b.com/test.jsp è®¿é—®</span><br><span class="line">    proxy_pass http://test;</span><br><span class="line"></span><br><span class="line">    # å¦‚æœ proxy_pass  URL æ˜¯ http://a.xx.com/platform/ è¿™ç§æƒ…å†µ</span><br><span class="line">    # proxy_cookie_pathåº”è¯¥è®¾ç½®æˆ /platform/ / (æ³¨æ„ä¸¤ä¸ªæ–œæ ä¹‹é—´æœ‰ç©ºæ ¼)ã€‚</span><br><span class="line">    proxy_cookie_path /platfrom/ /;</span><br><span class="line"></span><br><span class="line">    # http://nginx.org/en/docs/http/ngx_http_proxy_module.html#proxy_pass_header</span><br><span class="line">    # è®¾ç½® Cookie å¤´é€šè¿‡</span><br><span class="line">    proxy_pass_header Set-Cookie;</span><br><span class="line">  &#125; </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="10-2-è·³è½¬åˆ°å¸¦wwwçš„åŸŸä¸Šé¢"><a href="#10-2-è·³è½¬åˆ°å¸¦wwwçš„åŸŸä¸Šé¢" class="headerlink" title="10.2 è·³è½¬åˆ°å¸¦wwwçš„åŸŸä¸Šé¢"></a>10.2 è·³è½¬åˆ°å¸¦wwwçš„åŸŸä¸Šé¢</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">server &#123;</span><br><span class="line">    listen 80;</span><br><span class="line">    # é…ç½®æ­£å¸¸çš„å¸¦wwwçš„åŸŸå</span><br><span class="line">    server_name www.wangchujiang.com;</span><br><span class="line">    root /home/www/wabg/download;</span><br><span class="line">    location / &#123;</span><br><span class="line">        try_files $uri $uri/ /index.html =404;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">server &#123;</span><br><span class="line">    # è¿™ä¸ªè¦æ”¾åˆ°ä¸‹é¢ï¼Œ</span><br><span class="line">    # å°†ä¸å¸¦wwwçš„ wangchujiang.com æ°¸ä¹…æ€§é‡å®šå‘åˆ°  https://www.wangchujiang.com</span><br><span class="line">    server_name wangchujiang.com;</span><br><span class="line">    rewrite ^(.*) https://www.wangchujiang.com$1 permanent;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="10-3-ä»£ç†è½¬å‘"><a href="#10-3-ä»£ç†è½¬å‘" class="headerlink" title="10.3 ä»£ç†è½¬å‘"></a>10.3 ä»£ç†è½¬å‘</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line">upstream server-api&#123;</span><br><span class="line">    # api ä»£ç†æœåŠ¡åœ°å€</span><br><span class="line">    server 127.0.0.1:3110;    </span><br><span class="line">&#125;</span><br><span class="line">upstream server-resource&#123;</span><br><span class="line">    # é™æ€èµ„æº ä»£ç†æœåŠ¡åœ°å€</span><br><span class="line">    server 127.0.0.1:3120;</span><br><span class="line">&#125;</span><br><span class="line">server &#123;</span><br><span class="line">    listen       3111;</span><br><span class="line">    server_name  localhost;      # è¿™é‡ŒæŒ‡å®šåŸŸå</span><br><span class="line">    root /home/www/server-statics;</span><br><span class="line">    # åŒ¹é… api è·¯ç”±çš„åå‘ä»£ç†åˆ°APIæœåŠ¡</span><br><span class="line">    location ^~/api/ &#123;</span><br><span class="line">        rewrite ^/(.*)$ /$1 break;</span><br><span class="line">        proxy_pass http://server-api;</span><br><span class="line">    &#125;</span><br><span class="line">    # å‡è®¾è¿™é‡ŒéªŒè¯ç ä¹Ÿåœ¨APIæœåŠ¡ä¸­</span><br><span class="line">    location ^~/captcha &#123;</span><br><span class="line">        rewrite ^/(.*)$ /$1 break;</span><br><span class="line">        proxy_pass http://server-api;</span><br><span class="line">    &#125;</span><br><span class="line">    # å‡è®¾ä½ çš„å›¾ç‰‡èµ„æºå…¨éƒ¨åœ¨å¦å¤–ä¸€ä¸ªæœåŠ¡ä¸Šé¢</span><br><span class="line">    location ^~/img/ &#123;</span><br><span class="line">        rewrite ^/(.*)$ /$1 break;</span><br><span class="line">        proxy_pass http://server-resource;</span><br><span class="line">    &#125;</span><br><span class="line">    # è·¯ç”±åœ¨å‰ç«¯ï¼Œåç«¯æ²¡æœ‰çœŸå®è·¯ç”±ï¼Œåœ¨è·¯ç”±ä¸å­˜åœ¨çš„ 404çŠ¶æ€çš„é¡µé¢è¿”å› /index.html</span><br><span class="line">    # è¿™ä¸ªæ–¹å¼ä½¿ç”¨åœºæ™¯ï¼Œä½ åœ¨å†™Reactæˆ–è€…Vueé¡¹ç›®çš„æ—¶å€™ï¼Œæ²¡æœ‰çœŸå®è·¯ç”±</span><br><span class="line">    location / &#123;</span><br><span class="line">        try_files $uri $uri/ /index.html =404;</span><br><span class="line">        #                               ^ ç©ºæ ¼å¾ˆé‡è¦</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="10-4-ä»£ç†è½¬å‘è¿æ¥æ›¿æ¢"><a href="#10-4-ä»£ç†è½¬å‘è¿æ¥æ›¿æ¢" class="headerlink" title="10.4 ä»£ç†è½¬å‘è¿æ¥æ›¿æ¢"></a>10.4 ä»£ç†è½¬å‘è¿æ¥æ›¿æ¢</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">location ^~/api/upload &#123;</span><br><span class="line">    rewrite ^/(.*)$ /wfs/v1/upload break;</span><br><span class="line">    proxy_pass http://wfs-api;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="10-5-sslé…ç½®"><a href="#10-5-sslé…ç½®" class="headerlink" title="10.5 sslé…ç½®"></a>10.5 sslé…ç½®</h3><ul>
<li><p>è¶…æ–‡æœ¬ä¼ è¾“å®‰å…¨åè®®ï¼ˆç¼©å†™ï¼šHTTPSï¼Œè‹±è¯­ï¼šHypertext Transfer Protocol Secureï¼‰æ˜¯è¶…æ–‡æœ¬ä¼ è¾“åè®®å’ŒSSL&#x2F;TLSçš„ç»„åˆï¼Œç”¨ä»¥æä¾›åŠ å¯†é€šè®¯åŠå¯¹ç½‘ç»œæœåŠ¡å™¨èº«ä»½çš„é‰´å®šã€‚HTTPSè¿æ¥ç»å¸¸è¢«ç”¨äºä¸‡ç»´ç½‘ä¸Šçš„äº¤æ˜“æ”¯ä»˜å’Œä¼ä¸šä¿¡æ¯ç³»ç»Ÿä¸­æ•æ„Ÿä¿¡æ¯çš„ä¼ è¾“ã€‚HTTPSä¸åº”ä¸åœ¨RFC 2660ä¸­å®šä¹‰çš„å®‰å…¨è¶…æ–‡æœ¬ä¼ è¾“åè®®ï¼ˆS-HTTPï¼‰ç›¸æ··ã€‚HTTPS ç›®å‰å·²ç»æ˜¯æ‰€æœ‰æ³¨é‡éšç§å’Œå®‰å…¨çš„ç½‘ç«™çš„é¦–é€‰ï¼Œéšç€æŠ€æœ¯çš„ä¸æ–­å‘å±•ï¼ŒHTTPS ç½‘ç«™å·²ä¸å†æ˜¯å¤§å‹ç½‘ç«™çš„ä¸“åˆ©ï¼Œæ‰€æœ‰æ™®é€šçš„ä¸ªäººç«™é•¿å’Œåšå®¢å‡å¯ä»¥è‡ªå·±åŠ¨æ‰‹æ­å»ºä¸€ä¸ªå®‰å…¨çš„åŠ å¯†çš„ç½‘ç«™ã€‚</p>
</li>
<li><p>åˆ›å»º<code>SSL</code>è¯ä¹¦ï¼Œå¦‚æœä½ è´­ä¹°çš„è¯ä¹¦ï¼Œå°±å¯ä»¥ç›´æ¥ä¸‹è½½</p>
</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">sudo mkdir /etc/nginx/ssl</span><br><span class="line"># åˆ›å»ºäº†æœ‰æ•ˆæœŸ100å¹´ï¼ŒåŠ å¯†å¼ºåº¦ä¸ºRSA2048çš„SSLå¯†é’¥keyå’ŒX509è¯ä¹¦æ–‡ä»¶ã€‚</span><br><span class="line">sudo openssl req -x509 -nodes -days 36500 -newkey rsa:2048 -keyout /etc/nginx/ssl/nginx.key -out /etc/nginx/ssl/nginx.crt</span><br><span class="line"># ä¸Šé¢å‘½ä»¤ï¼Œä¼šæœ‰ä¸‹é¢éœ€è¦å¡«å†™å†…å®¹</span><br><span class="line">Country Name (2 letter code) [AU]:US</span><br><span class="line">State or Province Name (full name) [Some-State]:New York</span><br><span class="line">Locality Name (eg, city) []:New York City</span><br><span class="line">Organization Name (eg, company) [Internet Widgits Pty Ltd]:Bouncy Castles, Inc.</span><br><span class="line">Organizational Unit Name (eg, section) []:Ministry of Water Slides</span><br><span class="line">Common Name (e.g. server FQDN or YOUR name) []:your_domain.com</span><br><span class="line">Email Address []:admin@your_domain.com</span><br></pre></td></tr></table></figure>

<ul>
<li>åˆ›å»ºè‡ªç­¾è¯ä¹¦</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">é¦–å…ˆï¼Œåˆ›å»ºè¯ä¹¦å’Œç§é’¥çš„ç›®å½•</span><br><span class="line"># mkdir -p /etc/nginx/cert</span><br><span class="line"># cd /etc/nginx/cert</span><br><span class="line">åˆ›å»ºæœåŠ¡å™¨ç§é’¥ï¼Œå‘½ä»¤ä¼šè®©ä½ è¾“å…¥ä¸€ä¸ªå£ä»¤ï¼š</span><br><span class="line"># openssl genrsa -des3 -out nginx.key 2048</span><br><span class="line">åˆ›å»ºç­¾åè¯·æ±‚çš„è¯ä¹¦ï¼ˆCSRï¼‰ï¼š</span><br><span class="line"># openssl req -new -key nginx.key -out nginx.csr</span><br><span class="line">åœ¨åŠ è½½SSLæ”¯æŒçš„Nginxå¹¶ä½¿ç”¨ä¸Šè¿°ç§é’¥æ—¶é™¤å»å¿…é¡»çš„å£ä»¤ï¼š</span><br><span class="line"># cp nginx.key nginx.key.org</span><br><span class="line"># openssl rsa -in nginx.key.org -out nginx.key</span><br><span class="line">æœ€åæ ‡è®°è¯ä¹¦ä½¿ç”¨ä¸Šè¿°ç§é’¥å’ŒCSRï¼š</span><br><span class="line"># openssl x509 -req -days 365 -in nginx.csr -signkey nginx.key -out nginx.crt</span><br></pre></td></tr></table></figure>

<p>æŸ¥çœ‹ç›®å‰nginxç¼–è¯‘é€‰é¡¹</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sbin/nginx -V</span><br></pre></td></tr></table></figure>

<p>è¾“å‡ºä¸‹é¢å†…å®¹</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">nginx version: nginx/1.7.8</span><br><span class="line">built by gcc 4.4.7 20120313 (Red Hat 4.4.7-4) (GCC)</span><br><span class="line">TLS SNI support enabled</span><br><span class="line">configure arguments: --prefix=/usr/local/nginx-1.7.8 --with-http_ssl_module --with-http_spdy_module --with-http_stub_status_module --with-pcre</span><br></pre></td></tr></table></figure>

<p>å¦‚æœä¾èµ–çš„æ¨¡å—ä¸å­˜åœ¨ï¼Œå¯ä»¥è¿›å…¥å®‰è£…ç›®å½•ï¼Œè¾“å…¥ä¸‹é¢å‘½ä»¤é‡æ–°ç¼–è¯‘å®‰è£…ã€‚</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">./configure --prefix=/usr/local/nginx --with-http_stub_status_module --with-http_ssl_module</span><br></pre></td></tr></table></figure>

<p>è¿è¡Œå®Œæˆä¹‹åè¿˜éœ€è¦<code>make</code> (ä¸ç”¨make install)</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"># å¤‡ä»½nginxçš„äºŒè¿›åˆ¶æ–‡ä»¶</span><br><span class="line">cp -rf /usr/local/nginx/sbin/nginxã€€ /usr/local/nginx/sbin/nginx.bak</span><br><span class="line"># è¦†ç›–nginxçš„äºŒè¿›åˆ¶æ–‡ä»¶</span><br><span class="line">cp -rf objs/nginx   /usr/local/nginx/sbin/</span><br></pre></td></tr></table></figure>

<p>HTTPS server</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line">server &#123;</span><br><span class="line">    listen       443 ssl;</span><br><span class="line">    server_name  localhost;</span><br><span class="line"></span><br><span class="line">    ssl_certificate /etc/nginx/ssl/nginx.crt;</span><br><span class="line">    ssl_certificate_key /etc/nginx/ssl/nginx.key;</span><br><span class="line">    # ç¦æ­¢åœ¨headerä¸­å‡ºç°æœåŠ¡å™¨ç‰ˆæœ¬ï¼Œé˜²æ­¢é»‘å®¢åˆ©ç”¨ç‰ˆæœ¬æ¼æ´æ”»å‡»</span><br><span class="line">    server_tokens off;</span><br><span class="line">    # è®¾ç½®ssl/tlsä¼šè¯ç¼“å­˜çš„ç±»å‹å’Œå¤§å°ã€‚å¦‚æœè®¾ç½®äº†è¿™ä¸ªå‚æ•°ä¸€èˆ¬æ˜¯sharedï¼Œbuildinå¯èƒ½ä¼šå‚æ•°å†…å­˜ç¢ç‰‡ï¼Œé»˜è®¤æ˜¯noneï¼Œå’Œoffå·®ä¸å¤šï¼Œåœç”¨ç¼“å­˜ã€‚å¦‚shared:SSL:10mè¡¨ç¤ºæˆ‘æ‰€æœ‰çš„nginxå·¥ä½œè¿›ç¨‹å…±äº«sslä¼šè¯ç¼“å­˜ï¼Œå®˜ç½‘ä»‹ç»è¯´1Må¯ä»¥å­˜æ”¾çº¦4000ä¸ªsessionsã€‚ </span><br><span class="line">    ssl_session_cache    shared:SSL:1m; </span><br><span class="line"></span><br><span class="line">    # å®¢æˆ·ç«¯å¯ä»¥é‡ç”¨ä¼šè¯ç¼“å­˜ä¸­sslå‚æ•°çš„è¿‡æœŸæ—¶é—´ï¼Œå†…ç½‘ç³»ç»Ÿé»˜è®¤5åˆ†é’Ÿå¤ªçŸ­äº†ï¼Œå¯ä»¥è®¾æˆ30må³30åˆ†é’Ÿç”šè‡³4hã€‚</span><br><span class="line">    ssl_session_timeout  5m; </span><br><span class="line"></span><br><span class="line">    # é€‰æ‹©åŠ å¯†å¥—ä»¶ï¼Œä¸åŒçš„æµè§ˆå™¨æ‰€æ”¯æŒçš„å¥—ä»¶ï¼ˆå’Œé¡ºåºï¼‰å¯èƒ½ä¼šä¸åŒã€‚</span><br><span class="line">    # è¿™é‡ŒæŒ‡å®šçš„æ˜¯OpenSSLåº“èƒ½å¤Ÿè¯†åˆ«çš„å†™æ³•ï¼Œä½ å¯ä»¥é€šè¿‡ openssl -v cipher &#x27;RC4:HIGH:!aNULL:!MD5&#x27;ï¼ˆåé¢æ˜¯ä½ æ‰€æŒ‡å®šçš„å¥—ä»¶åŠ å¯†ç®—æ³•ï¼‰ æ¥çœ‹æ‰€æ”¯æŒç®—æ³•ã€‚</span><br><span class="line">    ssl_ciphers  HIGH:!aNULL:!MD5;</span><br><span class="line"></span><br><span class="line">    # è®¾ç½®åå•†åŠ å¯†ç®—æ³•æ—¶ï¼Œä¼˜å…ˆä½¿ç”¨æˆ‘ä»¬æœåŠ¡ç«¯çš„åŠ å¯†å¥—ä»¶ï¼Œè€Œä¸æ˜¯å®¢æˆ·ç«¯æµè§ˆå™¨çš„åŠ å¯†å¥—ä»¶ã€‚</span><br><span class="line">    ssl_prefer_server_ciphers  on;</span><br><span class="line"></span><br><span class="line">    location / &#123;</span><br><span class="line">        root   html;</span><br><span class="line">        index  index.html index.htm;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="10-6-å¼ºåˆ¶å°†httpé‡å®šå‘åˆ°https"><a href="#10-6-å¼ºåˆ¶å°†httpé‡å®šå‘åˆ°https" class="headerlink" title="10.6 å¼ºåˆ¶å°†httpé‡å®šå‘åˆ°https"></a>10.6 å¼ºåˆ¶å°†httpé‡å®šå‘åˆ°https</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">server &#123;</span><br><span class="line">    listen       80;</span><br><span class="line">    server_name  example.com;</span><br><span class="line">    rewrite ^ https://$http_host$request_uri? permanent;    # å¼ºåˆ¶å°†httpé‡å®šå‘åˆ°https</span><br><span class="line">    # åœ¨é”™è¯¯é¡µé¢å’Œâ€œæœåŠ¡å™¨â€å“åº”å¤´å­—æ®µä¸­å¯ç”¨æˆ–ç¦ç”¨å‘å°„nginxç‰ˆæœ¬ã€‚ é˜²æ­¢é»‘å®¢åˆ©ç”¨ç‰ˆæœ¬æ¼æ´æ”»å‡»</span><br><span class="line">    server_tokens off;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="10-7-ä¸¤ä¸ªè™šæ‹Ÿä¸»æœº"><a href="#10-7-ä¸¤ä¸ªè™šæ‹Ÿä¸»æœº" class="headerlink" title="10.7 ä¸¤ä¸ªè™šæ‹Ÿä¸»æœº"></a>10.7 ä¸¤ä¸ªè™šæ‹Ÿä¸»æœº</h3><ul>
<li>çº¯é™æ€<code>-html</code> æ”¯æŒ</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">http &#123;</span><br><span class="line">    server &#123;</span><br><span class="line">        listen          80;</span><br><span class="line">        server_name     www.domain1.com;</span><br><span class="line">        access_log      logs/domain1.access.log main;</span><br><span class="line">        location / &#123;</span><br><span class="line">            index index.html;</span><br><span class="line">            root  /var/www/domain1.com/htdocs;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    server &#123;</span><br><span class="line">        listen          80;</span><br><span class="line">        server_name     www.domain2.com;</span><br><span class="line">        access_log      logs/domain2.access.log main;</span><br><span class="line">        location / &#123;</span><br><span class="line">            index index.html;</span><br><span class="line">            root  /var/www/domain2.com/htdocs;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="10-8-è™šæ‹Ÿä¸»æœºæ ‡å‡†é…ç½®"><a href="#10-8-è™šæ‹Ÿä¸»æœºæ ‡å‡†é…ç½®" class="headerlink" title="10.8 è™šæ‹Ÿä¸»æœºæ ‡å‡†é…ç½®"></a>10.8 è™šæ‹Ÿä¸»æœºæ ‡å‡†é…ç½®</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">http &#123;</span><br><span class="line">  server &#123;</span><br><span class="line">    listen          80 default;</span><br><span class="line">    server_name     _ *;</span><br><span class="line">    access_log      logs/default.access.log main;</span><br><span class="line">    location / &#123;</span><br><span class="line">       index index.html;</span><br><span class="line">       root  /var/www/default/htdocs;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="10-9-é˜²ç›—é“¾"><a href="#10-9-é˜²ç›—é“¾" class="headerlink" title="10.9 é˜²ç›—é“¾"></a>10.9 é˜²ç›—é“¾</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">location ~* \.(gif|jpg|png|swf|flv)$ &#123;</span><br><span class="line">   root html</span><br><span class="line">   valid_referers none blocked *.nginxcn.com;</span><br><span class="line">   if ($invalid_referer) &#123;</span><br><span class="line">     rewrite ^/ www.nginx.cn</span><br><span class="line">     #return 404;</span><br><span class="line">   &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="10-10è™šæ‹Ÿç›®å½•é…ç½®"><a href="#10-10è™šæ‹Ÿç›®å½•é…ç½®" class="headerlink" title="10.10è™šæ‹Ÿç›®å½•é…ç½®"></a>10.10è™šæ‹Ÿç›®å½•é…ç½®</h3><p>aliasæŒ‡å®šçš„ç›®å½•æ˜¯å‡†ç¡®çš„ï¼Œrootæ˜¯æŒ‡å®šç›®å½•çš„ä¸Šçº§ç›®å½•ï¼Œå¹¶ä¸”è¯¥ä¸Šçº§ç›®å½•è¦å«æœ‰locationæŒ‡å®šåç§°çš„åŒåç›®å½•ã€‚</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">location /img/ &#123;</span><br><span class="line">    alias /var/www/image/;</span><br><span class="line">&#125;</span><br><span class="line"># è®¿é—®/img/ç›®å½•é‡Œé¢çš„æ–‡ä»¶æ—¶ï¼Œningxä¼šè‡ªåŠ¨å»/var/www/image/ç›®å½•æ‰¾æ–‡ä»¶</span><br><span class="line">location /img/ &#123;</span><br><span class="line">    root /var/www/image;</span><br><span class="line">&#125;</span><br><span class="line"># è®¿é—®/img/ç›®å½•ä¸‹çš„æ–‡ä»¶æ—¶ï¼Œnginxä¼šå»/var/www/image/img/ç›®å½•ä¸‹æ‰¾æ–‡ä»¶ã€‚]</span><br></pre></td></tr></table></figure>

<h3 id="10-11-é˜²ç›—å›¾é…ç½®"><a href="#10-11-é˜²ç›—å›¾é…ç½®" class="headerlink" title="10.11 é˜²ç›—å›¾é…ç½®"></a>10.11 é˜²ç›—å›¾é…ç½®</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">location ~ \/public\/(css|js|img)\/.*\.(js|css|gif|jpg|jpeg|png|bmp|swf) &#123;</span><br><span class="line">    valid_referers none blocked *.jslite.io;</span><br><span class="line">    if ($invalid_referer) &#123;</span><br><span class="line">        rewrite ^/  http://wangchujiang.com/piratesp.png;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="10-12-å±è”½-gitç­‰æ–‡ä»¶"><a href="#10-12-å±è”½-gitç­‰æ–‡ä»¶" class="headerlink" title="10.12 å±è”½.gitç­‰æ–‡ä»¶"></a>10.12 å±è”½.gitç­‰æ–‡ä»¶</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">location ~ (.git|.gitattributes|.gitignore|.svn) &#123;</span><br><span class="line">    deny all;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="åŸŸåè·¯å¾„åŠ ä¸åŠ éœ€è¦éƒ½èƒ½æ­£å¸¸è®¿é—®"><a href="#åŸŸåè·¯å¾„åŠ ä¸åŠ éœ€è¦éƒ½èƒ½æ­£å¸¸è®¿é—®" class="headerlink" title="åŸŸåè·¯å¾„åŠ ä¸åŠ éœ€è¦éƒ½èƒ½æ­£å¸¸è®¿é—®"></a>åŸŸåè·¯å¾„åŠ ä¸åŠ éœ€è¦éƒ½èƒ½æ­£å¸¸è®¿é—®</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">http://wangchujiang.com/api/index.php?a=1&amp;name=wcj</span><br><span class="line">                                  ^ æœ‰åç¼€</span><br><span class="line"></span><br><span class="line">http://wangchujiang.com/api/index?a=1&amp;name=wcj</span><br><span class="line">                                 ^ æ²¡æœ‰åç¼€</span><br></pre></td></tr></table></figure>

<ul>
<li><code>nginx rewrite</code>è§„åˆ™å¦‚ä¸‹ï¼š</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">rewrite ^/(.*)/$ /index.php?/$1 permanent;</span><br><span class="line">if (!-d $request_filename)&#123;</span><br><span class="line">        set $rule_1 1$rule_1;</span><br><span class="line">&#125;</span><br><span class="line">if (!-f $request_filename)&#123;</span><br><span class="line">        set $rule_1 2$rule_1;</span><br><span class="line">&#125;</span><br><span class="line">if ($rule_1 = &quot;21&quot;)&#123;</span><br><span class="line">        rewrite ^/ /index.php last;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="åä¸€ã€é”™è¯¯é—®é¢˜"><a href="#åä¸€ã€é”™è¯¯é—®é¢˜" class="headerlink" title="åä¸€ã€é”™è¯¯é—®é¢˜"></a>åä¸€ã€é”™è¯¯é—®é¢˜</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">The plain HTTP request was sent to HTTPS port</span><br></pre></td></tr></table></figure>

<ul>
<li>è§£å†³åŠæ³•ï¼Œ<code>fastcgi_param HTTPS $https if_not_empty</code> æ·»åŠ è¿™æ¡è§„åˆ™ï¼Œ</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">server &#123;</span><br><span class="line">    listen 443 ssl; # æ³¨æ„è¿™æ¡è§„åˆ™</span><br><span class="line">    server_name  my.domain.com;</span><br><span class="line">    </span><br><span class="line">    fastcgi_param HTTPS $https if_not_empty;</span><br><span class="line">    fastcgi_param HTTPS on;</span><br><span class="line"></span><br><span class="line">    ssl_certificate /etc/ssl/certs/your.pem;</span><br><span class="line">    ssl_certificate_key /etc/ssl/private/your.key;</span><br><span class="line"></span><br><span class="line">    location / &#123;</span><br><span class="line">        # Your config here...</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="åäºŒã€ç²¾å“æ–‡ç« å‚è€ƒ"><a href="#åäºŒã€ç²¾å“æ–‡ç« å‚è€ƒ" class="headerlink" title="åäºŒã€ç²¾å“æ–‡ç« å‚è€ƒ"></a>åäºŒã€ç²¾å“æ–‡ç« å‚è€ƒ</h2><ul>
<li><a target="_blank" rel="noopener" href="https://my.oschina.net/u/3341316/blog/877206">è´Ÿè½½å‡è¡¡åŸç†çš„è§£æ</a></li>
<li><a target="_blank" rel="noopener" href="http://blog.githuber.cn/posts/73">Nginxæ³›åŸŸåè§£æï¼Œå®ç°å¤šä¸ªäºŒçº§åŸŸå</a></li>
<li><a target="_blank" rel="noopener" href="https://www.nginx.com/blog/inside-nginx-how-we-designed-for-performance-scale/">æ·±å…¥ NGINX: æˆ‘ä»¬å¦‚ä½•è®¾è®¡æ€§èƒ½å’Œæ‰©å±•</a></li>
<li><a target="_blank" rel="noopener" href="https://www.nginx.com/blog/inside-nginx-how-we-designed-for-performance-scale/">Inside NGINX: How We Designed for Performance &amp; Scale</a></li>
<li><a target="_blank" rel="noopener" href="http://tengine.taobao.org/book/index.html">Nginxå¼€å‘ä»å…¥é—¨åˆ°ç²¾é€š</a></li>
<li><a target="_blank" rel="noopener" href="http://os.51cto.com/art/201703/535326.htm#topx">Nginxçš„ä¼˜åŒ–ä¸é˜²ç›—é“¾</a></li>
<li><a target="_blank" rel="noopener" href="https://segmentfault.com/a/1190000009769143">å®æˆ˜å¼€å‘ä¸€ä¸ªNginxæ‰©å±• (Nginx Module)</a></li>
<li><a target="_blank" rel="noopener" href="https://my.oschina.net/xshuai/blog/917097">Nginx+Keepalived(åŒæœºçƒ­å¤‡)æ­å»ºé«˜å¯ç”¨è´Ÿè½½å‡è¡¡ç¯å¢ƒ(HA)</a></li>
<li><a target="_blank" rel="noopener" href="http://www.huxd.org/articles/2017/07/24/1500890692329.html">Nginx å¹³æ»‘å‡çº§</a></li>
<li><a target="_blank" rel="noopener" href="https://mp.weixin.qq.com/s?__biz=MzIxNzg5ODE0OA==&mid=2247483708&idx=1&sn=90b0b1dccd9c337922a0588245277666&chksm=97f38cf7a08405e1928e0b46d923d630e529e7db8ac7ca2a91310a075986f8bcb2cee5b4953d#rd">Nginxæœ€æ–°æ¨¡å—â€”ngx_http_mirror_moduleåˆ†æå¯ä»¥åšç‰ˆæœ¬å‘å¸ƒå‰çš„é¢„å…ˆéªŒè¯ï¼Œè¿›è¡Œæµé‡æ”¾å¤§åçš„å‹æµ‹ç­‰ç­‰</a></li>
</ul>

        
    </article>
    <footer class="cube-excerpt-footer">
        <a class="cube-excerpt-more" href="/2019/08/30/%E9%83%A8%E7%BD%B2/Nginx%E5%AD%A6%E4%B9%A0/">Read More</a>
    </footer>
</div>

<div class="cube-excerpt" id="cube-excerpt-node-koa2æ€»ç»“">
    <header class="cube-excerpt-header">
        <h1><a href="/2019/06/27/nodejs/nodejs-koa2/">node-koa2æ€»ç»“</a></h1>
        <div class="cube-excerpt-header-msg">
            <div class="cube-excerpt-date">
                <i class="cube-icon cube-icon-date" aria-hidden="true"></i>
                2019-06-27
            </div>
            <div class="cube-excerpt-tags">
                <i class="cube-icon cube-icon-tag" aria-hidden="true"></i>
                
                <a href="/tags/nodejs/" class="cube-excerpt-tag-link">#nodejs</a>
                
            </div>
        </div>
    </header>
    <article class="cube-excerpt-entry cube-markdown">
        
        
           <h1 id="ä¸€ã€Koaæ¡†æ¶ä»‹ç»ä»¥åŠKoaç¯å¢ƒæ­å»º"><a href="#ä¸€ã€Koaæ¡†æ¶ä»‹ç»ä»¥åŠKoaç¯å¢ƒæ­å»º" class="headerlink" title="ä¸€ã€Koaæ¡†æ¶ä»‹ç»ä»¥åŠKoaç¯å¢ƒæ­å»º"></a>ä¸€ã€Koaæ¡†æ¶ä»‹ç»ä»¥åŠKoaç¯å¢ƒæ­å»º</h1><h2 id="1-1-Koa-æ¡†æ¶ä»‹ç»"><a href="#1-1-Koa-æ¡†æ¶ä»‹ç»" class="headerlink" title="1.1 Koa æ¡†æ¶ä»‹ç»"></a>1.1 Koa æ¡†æ¶ä»‹ç»</h2><blockquote>
<p><code>Node.js</code> æ˜¯ä¸€ä¸ªå¼‚æ­¥çš„ä¸–ç•Œï¼Œå®˜æ–¹ <code>API</code> æ”¯æŒçš„éƒ½æ˜¯ <code>callback</code> å½¢å¼çš„å¼‚æ­¥ç¼–ç¨‹æ¨¡å‹ï¼Œè¿™ ä¼šå¸¦æ¥è®¸å¤šé—®é¢˜ï¼Œä¾‹å¦‚:</p>
</blockquote>
<ol>
<li><code>callback</code> åµŒå¥—é—®é¢˜</li>
<li>å¼‚æ­¥å‡½æ•°ä¸­å¯èƒ½åŒæ­¥è°ƒç”¨ callback è¿”å› æ•°æ®ï¼Œå¸¦æ¥ä¸ä¸€è‡´æ€§ã€‚ä¸ºäº†è§£å†³ä»¥ä¸Šé—®é¢˜ <code>Koa</code> å‡ºç°äº†</li>
</ol>
<p><strong>Koa â€“ åŸºäº Node.js å¹³å°çš„ä¸‹ä¸€ä»£ web å¼€å‘æ¡†æ¶</strong></p>
<blockquote>
<p><code>koa</code> æ˜¯ç”± <code>Express</code> åŸç­äººé©¬æ‰“é€ çš„ï¼Œè‡´åŠ›äºæˆä¸ºä¸€ä¸ªæ›´å°ã€æ›´å¯Œæœ‰è¡¨ç°åŠ›ã€æ›´å¥å£®çš„ Web æ¡†æ¶ã€‚ ä½¿ç”¨ <code>koa</code> ç¼–å†™ <code>web</code> åº”ç”¨ï¼Œå¯ä»¥å…é™¤é‡å¤ç¹ççš„å›è°ƒå‡½æ•°åµŒå¥—ï¼Œ å¹¶æå¤§åœ°æ å‡é”™è¯¯å¤„ç†çš„æ•ˆç‡ã€‚<code>koa</code>ä¸åœ¨å†…æ ¸æ–¹æ³•ä¸­ç»‘å®šä»»ä½•ä¸­é—´ä»¶ï¼Œ å®ƒä»…ä»…æä¾›äº†ä¸€ä¸ªè½»é‡ä¼˜é›…çš„ å‡½æ•°åº“ï¼Œä½¿å¾—ç¼–å†™ Web åº”ç”¨å˜å¾—å¾—å¿ƒåº”æ‰‹ã€‚å¼€å‘æ€è·¯å’Œ express å·®ä¸å¤šï¼Œæœ€å¤§çš„ç‰¹ç‚¹å°±æ˜¯ å¯ä»¥é¿å…å¼‚æ­¥åµŒå¥—</p>
</blockquote>
<h2 id="1-2-Koa2-x-æ¡†æ¶çš„å®‰è£…ä½¿ç”¨"><a href="#1-2-Koa2-x-æ¡†æ¶çš„å®‰è£…ä½¿ç”¨" class="headerlink" title="1.2 Koa2.x æ¡†æ¶çš„å®‰è£…ä½¿ç”¨"></a>1.2 Koa2.x æ¡†æ¶çš„å®‰è£…ä½¿ç”¨</h2><p><strong>1. å®‰è£… Node.js 8.x ä»¥ä¸Šçš„ç‰ˆæœ¬</strong></p>
<blockquote>
<p>å¼€å‘ <code>Koa2</code> ä¹‹å‰ï¼Œ<code>Node.js</code> æ˜¯æœ‰è¦æ±‚çš„ï¼Œå®ƒè¦æ±‚ <code>Node.js</code> ç‰ˆæœ¬é«˜äº <code>V7.6</code>ã€‚å› ä¸º <code>node.js 7.6</code>ç‰ˆæœ¬ å¼€å§‹å®Œå…¨æ”¯æŒ <code>async/await</code>ï¼Œæ‰€ä»¥æ‰èƒ½å®Œå…¨ä½ æ”¯æŒæˆ‘ä»¬çš„ Koa2&#96;</p>
</blockquote>
<p><strong>2. å®‰è£… Koa</strong></p>
<blockquote>
<p>å®‰è£… <code>Koa</code> æ¡†æ¶å’Œæˆ‘ä»¬ä»¥å‰å®‰è£…å…¶ä»–æ¨¡å—æ˜¯ä¸€æ ·çš„</p>
</blockquote>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm install --save koa / cnpm install --save koa</span><br></pre></td></tr></table></figure>

<blockquote>
<p><code>--save</code> å‚æ•°ï¼Œè¡¨ç¤ºè‡ªåŠ¨ä¿®æ”¹ <code>package.json</code> æ–‡ä»¶ï¼Œè‡ªåŠ¨æ·»åŠ ä¾èµ–é¡¹</p>
</blockquote>
<p><strong>ç®€å•ä½¿ç”¨</strong></p>
<p><img src="https://poetries1.gitee.io/img-repo/2019/10/494.png" alt="img"></p>
<h1 id="äºŒã€koa-è·¯ç”±-getä¼ å€¼ã€åŠ¨æ€è·¯ç”±"><a href="#äºŒã€koa-è·¯ç”±-getä¼ å€¼ã€åŠ¨æ€è·¯ç”±" class="headerlink" title="äºŒã€koa è·¯ç”± getä¼ å€¼ã€åŠ¨æ€è·¯ç”±"></a>äºŒã€koa è·¯ç”± getä¼ å€¼ã€åŠ¨æ€è·¯ç”±</h1><h2 id="2-1-Koa-è·¯ç”±"><a href="#2-1-Koa-è·¯ç”±" class="headerlink" title="2.1 Koa è·¯ç”±"></a>2.1 Koa è·¯ç”±</h2><ul>
<li>è·¯ç”±(<code>Routing</code>)æ˜¯ç”±ä¸€ä¸ª <code>URI</code>(æˆ–è€…å«è·¯å¾„)å’Œä¸€ä¸ªç‰¹å®šçš„ <code>HTTP</code> æ–¹æ³•(<code>GET</code>ã€<code>POST</code>ç­‰)<br>ç»„æˆçš„ï¼Œæ¶‰åŠåˆ°åº”ç”¨å¦‚ä½•å“åº”å®¢æˆ·ç«¯å¯¹æŸä¸ªç½‘ç«™èŠ‚ç‚¹çš„è®¿é—®</li>
<li>é€šä¿—çš„è®²:è·¯ç”±å°±æ˜¯æ ¹æ®ä¸åŒçš„ <code>URL</code> åœ°å€ï¼ŒåŠ è½½ä¸åŒçš„é¡µé¢å®ç°ä¸åŒçš„åŠŸèƒ½</li>
<li><code>Koa</code> ä¸­çš„è·¯ç”±å’Œ <code>Express</code> æœ‰æ‰€ä¸åŒï¼Œåœ¨ <code>Express</code> ä¸­ç›´æ¥å¼•å…¥ <code>Express</code> å°±å¯ä»¥é…ç½®è·¯ç”±ï¼Œä½†æ˜¯åœ¨ <code>Koa</code>ä¸­æˆ‘ä»¬éœ€è¦å®‰è£…å¯¹åº”çš„ <code>koa-router</code> è·¯ç”±æ¨¡å—æ¥å®ç°</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm install --save koa-router</span><br></pre></td></tr></table></figure>

<p><img src="https://poetries1.gitee.io/img-repo/2019/10/495.png" alt="img"></p>
<h2 id="2-2-Koa-è·¯ç”±-get-ä¼ å€¼"><a href="#2-2-Koa-è·¯ç”±-get-ä¼ å€¼" class="headerlink" title="2.2 Koa è·¯ç”± get ä¼ å€¼"></a>2.2 Koa è·¯ç”± get ä¼ å€¼</h2><blockquote>
<p>åœ¨ <code>koa2</code> ä¸­ <code>GET</code> ä¼ å€¼é€šè¿‡ <code>request</code> æ¥æ”¶ï¼Œä½†æ˜¯æ¥æ”¶çš„æ–¹æ³•æœ‰ä¸¤ç§:<code>query</code> å’Œ <code>querystring</code></p>
</blockquote>
<ul>
<li><code>query</code>:è¿”å›çš„æ˜¯æ ¼å¼åŒ–å¥½çš„å‚æ•°å¯¹è±¡ã€‚</li>
<li><code>querystring</code>:è¿”å›çš„æ˜¯è¯·æ±‚å­—ç¬¦ä¸²</li>
</ul>
<p><img src="https://poetries1.gitee.io/img-repo/2019/10/496.png" alt="img"></p>
<h2 id="2-3-Koa-åŠ¨æ€è·¯ç”±"><a href="#2-3-Koa-åŠ¨æ€è·¯ç”±" class="headerlink" title="2.3 Koa åŠ¨æ€è·¯ç”±"></a>2.3 Koa åŠ¨æ€è·¯ç”±</h2><p><img src="https://poetries1.gitee.io/img-repo/2019/10/497.png" alt="img"></p>
<h1 id="ä¸‰ã€koa-ä¸­é—´ä»¶åŠæ‰§è¡Œæµç¨‹"><a href="#ä¸‰ã€koa-ä¸­é—´ä»¶åŠæ‰§è¡Œæµç¨‹" class="headerlink" title="ä¸‰ã€koa ä¸­é—´ä»¶åŠæ‰§è¡Œæµç¨‹"></a>ä¸‰ã€koa ä¸­é—´ä»¶åŠæ‰§è¡Œæµç¨‹</h1><h2 id="3-1-koaä¸­é—´ä»¶çš„æ´‹è‘±å›¾æ‰§è¡Œæµç¨‹"><a href="#3-1-koaä¸­é—´ä»¶çš„æ´‹è‘±å›¾æ‰§è¡Œæµç¨‹" class="headerlink" title="3.1 koaä¸­é—´ä»¶çš„æ´‹è‘±å›¾æ‰§è¡Œæµç¨‹"></a>3.1 koaä¸­é—´ä»¶çš„æ´‹è‘±å›¾æ‰§è¡Œæµç¨‹</h2><p><img src="https://poetries1.gitee.io/img-repo/2019/10/498.gif" alt="img"></p>
<h2 id="3-2-koa-ä¸­é—´ä»¶"><a href="#3-2-koa-ä¸­é—´ä»¶" class="headerlink" title="3.2 koa ä¸­é—´ä»¶"></a>3.2 koa ä¸­é—´ä»¶</h2><h3 id="3-2-1-ä»€ä¹ˆæ˜¯-Koa-çš„ä¸­é—´ä»¶"><a href="#3-2-1-ä»€ä¹ˆæ˜¯-Koa-çš„ä¸­é—´ä»¶" class="headerlink" title="3.2.1 ä»€ä¹ˆæ˜¯ Koa çš„ä¸­é—´ä»¶"></a>3.2.1 ä»€ä¹ˆæ˜¯ Koa çš„ä¸­é—´ä»¶</h3><ul>
<li>é€šä¿—çš„è®²:ä¸­é—´ä»¶å°±æ˜¯åŒ¹é…è·¯ç”±ä¹‹å‰æˆ–è€…åŒ¹é…è·¯ç”±å®Œæˆåšçš„ä¸€ç³»åˆ—çš„æ“ä½œï¼Œæˆ‘ä»¬å°±å¯ä»¥<br>æŠŠå®ƒå«åšä¸­é—´ä»¶</li>
<li>åœ¨<code>express</code>ä¸­é—´ä»¶(<code>Middleware</code>)æ˜¯ä¸€ä¸ªå‡½æ•°ï¼Œå®ƒå¯ä»¥è®¿é—®è¯·æ±‚å¯¹è±¡(request object (req)), å“åº”å¯¹è±¡(<code>response object (res)</code>), å’Œ <code>web</code> åº”ç”¨ä¸­å¤„ç†è¯·æ±‚-å“åº”å¾ªç¯æµç¨‹ä¸­çš„ä¸­é—´ä»¶ï¼Œä¸€ èˆ¬è¢«å‘½åä¸º next çš„å˜é‡ã€‚åœ¨ <code>Koa</code> ä¸­ä¸­é—´ä»¶å’Œ <code>express</code> æœ‰ç‚¹ç±»ä¼¼ã€‚</li>
</ul>
<p><strong>ä¸­é—´ä»¶çš„åŠŸèƒ½åŒ…æ‹¬</strong></p>
<ul>
<li>æ‰§è¡Œä»»ä½•ä»£ç </li>
<li>ä¿®æ”¹è¯·æ±‚å’Œå“åº”å¯¹è±¡</li>
<li>ç»ˆç»“è¯·æ±‚-å“åº”å¾ªç¯</li>
<li>è°ƒç”¨å †æ ˆä¸­çš„ä¸‹ä¸€ä¸ªä¸­é—´ä»¶</li>
</ul>
<blockquote>
<p>å¦‚æœæˆ‘çš„ <code>get</code>ã€<code>post</code> å›è°ƒå‡½æ•°ä¸­ï¼Œæ²¡æœ‰ <code>next</code> å‚æ•°ï¼Œé‚£ä¹ˆå°±åŒ¹é…ä¸Šç¬¬ä¸€ä¸ªè·¯ç”±ï¼Œå°±ä¸ä¼šå¾€ä¸‹åŒ¹ é…äº†ã€‚å¦‚æœæƒ³å¾€ä¸‹åŒ¹é…çš„è¯ï¼Œé‚£ä¹ˆéœ€è¦å†™ <code>next()</code></p>
</blockquote>
<h3 id="3-2-2-Koa-åº”ç”¨å¯ä½¿ç”¨å¦‚ä¸‹å‡ ç§ä¸­é—´ä»¶"><a href="#3-2-2-Koa-åº”ç”¨å¯ä½¿ç”¨å¦‚ä¸‹å‡ ç§ä¸­é—´ä»¶" class="headerlink" title="3.2.2 Koa åº”ç”¨å¯ä½¿ç”¨å¦‚ä¸‹å‡ ç§ä¸­é—´ä»¶"></a>3.2.2 Koa åº”ç”¨å¯ä½¿ç”¨å¦‚ä¸‹å‡ ç§ä¸­é—´ä»¶</h3><p><strong>1. åº”ç”¨çº§ä¸­é—´ä»¶</strong></p>
<p><img src="https://poetries1.gitee.io/img-repo/2019/10/499.png" alt="img"></p>
<p><strong>2. è·¯ç”±ä¸­é—´ä»¶</strong></p>
<p><img src="https://poetries1.gitee.io/img-repo/2019/10/500.png" alt="img"></p>
<p><strong>3. é”™è¯¯å¤„ç†ä¸­é—´ä»¶</strong></p>
<p><img src="https://poetries1.gitee.io/img-repo/2019/10/501.png" alt="img"></p>
<p><strong>4. ç¬¬ä¸‰æ–¹ä¸­é—´ä»¶</strong></p>
<p><img src="https://poetries1.gitee.io/img-repo/2019/10/502.png" alt="img"></p>
<h3 id="3-2-3-Koa-ä¸­é—´ä»¶çš„æ‰§è¡Œé¡ºåº"><a href="#3-2-3-Koa-ä¸­é—´ä»¶çš„æ‰§è¡Œé¡ºåº" class="headerlink" title="3.2.3 Koa ä¸­é—´ä»¶çš„æ‰§è¡Œé¡ºåº"></a>3.2.3 Koa ä¸­é—´ä»¶çš„æ‰§è¡Œé¡ºåº</h3><blockquote>
<p><code>Koa</code> çš„ä¸­é—´ä»¶å’Œ <code>Express</code> ä¸åŒï¼Œ<code>Koa</code> é€‰æ‹©äº†æ´‹è‘±åœˆæ¨¡å‹</p>
</blockquote>
<p><img src="https://poetries1.gitee.io/img-repo/2019/10/503.png" alt="img"></p>
<h1 id="å››ã€koa-ejsæ¨¡æ¿å¼•æ“ä½¿ç”¨-ä»¥åŠejsé…ç½®å…¨å±€æ•°æ®"><a href="#å››ã€koa-ejsæ¨¡æ¿å¼•æ“ä½¿ç”¨-ä»¥åŠejsé…ç½®å…¨å±€æ•°æ®" class="headerlink" title="å››ã€koa ejsæ¨¡æ¿å¼•æ“ä½¿ç”¨ ä»¥åŠejsé…ç½®å…¨å±€æ•°æ®"></a>å››ã€koa ejsæ¨¡æ¿å¼•æ“ä½¿ç”¨ ä»¥åŠejsé…ç½®å…¨å±€æ•°æ®</h1><p><strong>1. å®‰è£… koa-views å’Œ ejs</strong></p>
<ul>
<li>å®‰è£… <code>koa-views npm install --save koa-views / cnpm install --save koa-views</code></li>
<li>å®‰è£… <code>ejs npm install ejs --save / cnpm install ejs --save</code></li>
</ul>
<p><strong>2. å¼•å…¥ koa-views é…ç½®ä¸­é—´ä»¶</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">const views = require(&#x27;koa-views&#x27;);</span><br><span class="line"></span><br><span class="line">app.use(views(&#x27;views&#x27;, &#123; map: &#123;html: &#x27;ejs&#x27; &#125;&#125;));</span><br></pre></td></tr></table></figure>

<p><strong>3. Koa ä¸­ä½¿ç”¨ ejs</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">router.get(&#x27;/add&#x27;,async (ctx)=&gt;&#123; </span><br><span class="line">    let title = &#x27;hello koa2&#x27; </span><br><span class="line">    </span><br><span class="line">    await ctx.render(index&#x27;,&#123; title &#125;)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>

<p><strong>4. Ejs å¼•å…¥æ¨¡æ¿</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;%- include header.ejs %&gt;</span><br></pre></td></tr></table></figure>

<p><strong>5. Ejs ç»‘å®šæ•°æ®</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;%=h%&gt;</span><br></pre></td></tr></table></figure>

<p><strong>6. Ejs ç»‘å®š html æ•°æ®</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;%-h%&gt;</span><br></pre></td></tr></table></figure>

<p><strong>7. Ejs æ¨¡æ¿åˆ¤æ–­è¯­å¥</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&lt;% if(true)&#123; %&gt;</span><br><span class="line">    &lt;div&gt;true&lt;/div&gt;</span><br><span class="line">&lt;%&#125; else&#123; %&gt;</span><br><span class="line">    &lt;div&gt;false&lt;/div&gt;</span><br><span class="line">&lt;%&#125; %&gt;</span><br></pre></td></tr></table></figure>

<p><strong>8. Ejs æ¨¡æ¿ä¸­å¾ªç¯æ•°æ®</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&lt;%for(var i=0;i&lt;list.length;i++) &#123; %&gt;</span><br><span class="line">    &lt;li&gt;&lt;%=list[i] %&gt;&lt;/li&gt;</span><br><span class="line">&lt;%&#125;%&gt;</span><br></pre></td></tr></table></figure>

<h1 id="äº”ã€koa-post-æäº¤æ•°æ®-koa-bodyparser-ä¸­é—´ä»¶çš„ä½¿ç”¨"><a href="#äº”ã€koa-post-æäº¤æ•°æ®-koa-bodyparser-ä¸­é—´ä»¶çš„ä½¿ç”¨" class="headerlink" title="äº”ã€koa post æäº¤æ•°æ® koa-bodyparser ä¸­é—´ä»¶çš„ä½¿ç”¨"></a>äº”ã€koa post æäº¤æ•°æ® koa-bodyparser ä¸­é—´ä»¶çš„ä½¿ç”¨</h1><h2 id="5-1-åŸç”Ÿ-Nodejs-è·å–-post-æäº¤æ•°æ®"><a href="#5-1-åŸç”Ÿ-Nodejs-è·å–-post-æäº¤æ•°æ®" class="headerlink" title="5.1 åŸç”Ÿ Nodejs è·å– post æäº¤æ•°æ®"></a>5.1 åŸç”Ÿ Nodejs è·å– post æäº¤æ•°æ®</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">function parsePostData(ctx)&#123;</span><br><span class="line">    return new Promise((resolve,reject)=&gt;&#123;</span><br><span class="line">        try&#123;</span><br><span class="line">            let postdata=&quot;&quot;;</span><br><span class="line">            ctx.req.on(&#x27;data&#x27;,(data)=&gt;&#123;</span><br><span class="line">                postdata += data</span><br><span class="line">            &#125;)</span><br><span class="line">            ctx.req.on(&quot;end&quot;,function()&#123;</span><br><span class="line">                resolve(postdata);</span><br><span class="line">            &#125;)</span><br><span class="line">        &#125;catch(error)&#123;</span><br><span class="line">            reject(error);</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="5-2-Koa-ä¸­-koa-bodyparser-ä¸­é—´ä»¶çš„ä½¿ç”¨"><a href="#5-2-Koa-ä¸­-koa-bodyparser-ä¸­é—´ä»¶çš„ä½¿ç”¨" class="headerlink" title="5.2 Koa ä¸­ koa-bodyparser ä¸­é—´ä»¶çš„ä½¿ç”¨"></a>5.2 Koa ä¸­ koa-bodyparser ä¸­é—´ä»¶çš„ä½¿ç”¨</h2><p><strong>1. å®‰è£… koa-bodyparser</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm install --save koa-bodyparser</span><br></pre></td></tr></table></figure>

<p><strong>2. å®‰è£… å¼•å…¥é…ç½®ä¸­é—´ä»¶</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">var Koa = require(&#x27;koa&#x27;);</span><br><span class="line">var bodyParser = require(&#x27;koa-bodyparser&#x27;);</span><br><span class="line"></span><br><span class="line">var app = new Koa();</span><br><span class="line"></span><br><span class="line">app.use(bodyParser());</span><br><span class="line">app.use(async ctx =&gt; &#123;</span><br><span class="line">    ctx.body = ctx.request.body;</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>

<p><strong>3. ä½¿ç”¨</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ctx.request.body // è·å– post æäº¤çš„æ•°æ®</span><br></pre></td></tr></table></figure>

<h1 id="å…­ã€koa-staticé™æ€èµ„æºä¸­é—´ä»¶"><a href="#å…­ã€koa-staticé™æ€èµ„æºä¸­é—´ä»¶" class="headerlink" title="å…­ã€koa-staticé™æ€èµ„æºä¸­é—´ä»¶"></a>å…­ã€koa-staticé™æ€èµ„æºä¸­é—´ä»¶</h1><p><strong>1. å®‰è£… koa-static</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm install --save koa-static</span><br></pre></td></tr></table></figure>

<p><strong>2. å¼•å…¥é…ç½®ä¸­é—´ä»¶</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">const static = require(&#x27;koa-static&#x27;);</span><br><span class="line"></span><br><span class="line">app.use(static(</span><br><span class="line">    path.join( __dirname, &#x27;public&#x27;)</span><br><span class="line">))</span><br></pre></td></tr></table></figure>

<h1 id="ä¸ƒã€koa-art-templateé«˜æ€§èƒ½æ¨¡æ¿å¼•æ“çš„ä½¿ç”¨"><a href="#ä¸ƒã€koa-art-templateé«˜æ€§èƒ½æ¨¡æ¿å¼•æ“çš„ä½¿ç”¨" class="headerlink" title="ä¸ƒã€koa art-templateé«˜æ€§èƒ½æ¨¡æ¿å¼•æ“çš„ä½¿ç”¨"></a>ä¸ƒã€koa art-templateé«˜æ€§èƒ½æ¨¡æ¿å¼•æ“çš„ä½¿ç”¨</h1><h2 id="7-1-å¸¸è§æ¨¡æ¿å¼•æ“çš„æ€§èƒ½å¯¹æ¯”"><a href="#7-1-å¸¸è§æ¨¡æ¿å¼•æ“çš„æ€§èƒ½å¯¹æ¯”" class="headerlink" title="7.1 å¸¸è§æ¨¡æ¿å¼•æ“çš„æ€§èƒ½å¯¹æ¯”"></a>7.1 å¸¸è§æ¨¡æ¿å¼•æ“çš„æ€§èƒ½å¯¹æ¯”</h2><blockquote>
<p>é€‚ç”¨äº <code>koa</code> çš„æ¨¡æ¿å¼•æ“é€‰æ‹©éå¸¸å¤šï¼Œæ¯”å¦‚ <code>jade</code>ã€<code>ejs</code>ã€<code>nunjucks</code>ã€<code>art-template</code> ç­‰</p>
</blockquote>
<ul>
<li><code>art-template</code> æ˜¯ä¸€ä¸ªç®€çº¦ã€è¶…å¿«çš„æ¨¡æ¿å¼•æ“</li>
<li>å®ƒé‡‡ç”¨ä½œç”¨åŸŸé¢„å£°æ˜çš„æŠ€æœ¯æ¥ä¼˜åŒ–æ¨¡æ¿æ¸²æŸ“é€Ÿåº¦ï¼Œä»è€Œè·å¾—æ¥è¿‘ JavaScript æé™çš„è¿è¡Œ æ€§èƒ½ï¼Œå¹¶ä¸”åŒæ—¶æ”¯æŒ NodeJS å’Œæµè§ˆå™¨ã€‚</li>
<li><code>art-template</code> æ”¯æŒ <code>ejs</code> çš„è¯­æ³•ï¼Œä¹Ÿå¯ä»¥ç”¨è‡ªå·±çš„ç±»ä¼¼ <code>angular</code> æ•°æ®ç»‘å®šçš„è¯­æ³•</li>
<li>ä¸­æ–‡æ–‡æ¡£: <a target="_blank" rel="noopener" href="http://aui.github.io/art-template/zh-cn/docs">http://aui.github.io/art-template/zh-cn/docs</a></li>
</ul>
<p><img src="https://poetries1.gitee.io/img-repo/2019/10/504.png" alt="img"></p>
<p><img src="https://poetries1.gitee.io/img-repo/2019/10/505.png" alt="img"></p>
<h2 id="7-2-åœ¨-Koa-ä¸­ä½¿ç”¨-art-template-æ¨¡æ¿å¼•æ“"><a href="#7-2-åœ¨-Koa-ä¸­ä½¿ç”¨-art-template-æ¨¡æ¿å¼•æ“" class="headerlink" title="7.2 åœ¨ Koa ä¸­ä½¿ç”¨ art-template æ¨¡æ¿å¼•æ“"></a>7.2 åœ¨ Koa ä¸­ä½¿ç”¨ art-template æ¨¡æ¿å¼•æ“</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">npm install --save art-template </span><br><span class="line">npm install --save koa-art-template</span><br><span class="line">const Koa = require(&#x27;koa&#x27;);</span><br><span class="line">const render = require(&#x27;koa-art-template&#x27;);</span><br><span class="line"></span><br><span class="line">const app = new Koa();</span><br><span class="line"></span><br><span class="line">render(app, &#123;</span><br><span class="line">    root: path.join(__dirname, &#x27;view&#x27;),</span><br><span class="line">    extname: &#x27;.art&#x27;,</span><br><span class="line">    debug: process.env.NODE_ENV !== &#x27;production&#x27;</span><br><span class="line">&#125;);</span><br><span class="line">app.use(async function (ctx) &#123;</span><br><span class="line">    await ctx.render(&#x27;user&#x27;);</span><br><span class="line">&#125;);</span><br><span class="line">app.listen(8080);</span><br></pre></td></tr></table></figure>

<h2 id="7-3-art-template-æ¨¡æ¿å¼•æ“è¯­æ³•"><a href="#7-3-art-template-æ¨¡æ¿å¼•æ“è¯­æ³•" class="headerlink" title="7.3 art-template æ¨¡æ¿å¼•æ“è¯­æ³•"></a>7.3 art-template æ¨¡æ¿å¼•æ“è¯­æ³•</h2><blockquote>
<p>å‚è€ƒ:<a target="_blank" rel="noopener" href="http://aui.github.io/art-template/zh-cn/docs/syntax.html">http://aui.github.io/art-template/zh-cn/docs/syntax.html</a></p>
</blockquote>
<h1 id="å…«ã€koa-Cookieçš„ä½¿ç”¨"><a href="#å…«ã€koa-Cookieçš„ä½¿ç”¨" class="headerlink" title="å…«ã€koa Cookieçš„ä½¿ç”¨"></a>å…«ã€koa Cookieçš„ä½¿ç”¨</h1><h2 id="8-1-Koa-Cookie-çš„ä½¿ç”¨"><a href="#8-1-Koa-Cookie-çš„ä½¿ç”¨" class="headerlink" title="8.1 Koa Cookie çš„ä½¿ç”¨"></a>8.1 Koa Cookie çš„ä½¿ç”¨</h2><p><strong>1. Koa ä¸­è®¾ç½® Cookie çš„å€¼</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ctx.cookies.set(name, value, [options])</span><br></pre></td></tr></table></figure>

<blockquote>
<p>é€šè¿‡ <code>options</code> è®¾ç½® <code>cookie name</code> çš„ <code>value</code></p>
</blockquote>
<p><img src="https://poetries1.gitee.io/img-repo/2019/10/506.png" alt="img"></p>
<p><strong>2. Koa ä¸­è·å– Cookie çš„å€¼</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ctx.cookies.get(&#x27;name&#x27;);</span><br></pre></td></tr></table></figure>

<h2 id="8-2-Koa-ä¸­è®¾ç½®ä¸­æ–‡-Cookie"><a href="#8-2-Koa-ä¸­è®¾ç½®ä¸­æ–‡-Cookie" class="headerlink" title="8.2 Koa ä¸­è®¾ç½®ä¸­æ–‡ Cookie"></a>8.2 Koa ä¸­è®¾ç½®ä¸­æ–‡ Cookie</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">console.log(new Buffer(&#x27;hello, world!&#x27;).toString(&#x27;base64&#x27;));// è½¬æ¢æˆ base64 å­—ç¬¦ ä¸²:aGVsbG8sIHdvcmxkIQ==</span><br><span class="line"></span><br><span class="line">console.log(new Buffer(&#x27;aGVsbG8sIHdvcmxkIQ==&#x27;, &#x27;base64&#x27;).toString());// è¿˜åŸ base 64 å­—ç¬¦ä¸²:hello, world!</span><br></pre></td></tr></table></figure>

<h1 id="ä¹ã€koa-Session-çš„ä½¿ç”¨"><a href="#ä¹ã€koa-Session-çš„ä½¿ç”¨" class="headerlink" title="ä¹ã€koa Session çš„ä½¿ç”¨"></a>ä¹ã€koa Session çš„ä½¿ç”¨</h1><h2 id="9-1-Session-ç®€å•ä»‹ç»"><a href="#9-1-Session-ç®€å•ä»‹ç»" class="headerlink" title="9.1 Session ç®€å•ä»‹ç»"></a>9.1 Session ç®€å•ä»‹ç»</h2><blockquote>
<p><code>session</code> æ˜¯å¦ä¸€ç§è®°å½•å®¢æˆ·çŠ¶æ€çš„æœºåˆ¶ï¼Œä¸åŒçš„æ˜¯ <code>Cookie</code> ä¿å­˜åœ¨å®¢æˆ·ç«¯æµè§ˆå™¨ä¸­ï¼Œè€Œ <code>session</code> ä¿å­˜åœ¨æœåŠ¡å™¨ä¸Š</p>
</blockquote>
<h2 id="9-2-Session-çš„å·¥ä½œæµç¨‹"><a href="#9-2-Session-çš„å·¥ä½œæµç¨‹" class="headerlink" title="9.2 Session çš„å·¥ä½œæµç¨‹"></a>9.2 Session çš„å·¥ä½œæµç¨‹</h2><blockquote>
<p>å½“æµè§ˆå™¨è®¿é—®æœåŠ¡å™¨å¹¶å‘é€ç¬¬ä¸€æ¬¡è¯·æ±‚æ—¶ï¼ŒæœåŠ¡å™¨ç«¯ä¼šåˆ›å»ºä¸€ä¸ª <code>session</code> å¯¹è±¡ï¼Œç”Ÿ æˆä¸€ä¸ªç±»ä¼¼äº <code>key</code>,<code>value</code> çš„é”®å€¼å¯¹ï¼Œ ç„¶åå°†<code>key(cookie)</code>è¿”å›åˆ°æµè§ˆå™¨(å®¢æˆ·)ç«¯ï¼Œæµè§ˆ å™¨ä¸‹æ¬¡å†è®¿é—®æ—¶ï¼Œæºå¸¦ <code>key(cookie)</code>ï¼Œæ‰¾åˆ°å¯¹åº”çš„ <code>session(value)</code>ã€‚ å®¢æˆ·çš„ä¿¡æ¯éƒ½ä¿å­˜ åœ¨ <code>session</code> ä¸­</p>
</blockquote>
<h2 id="9-3-koa-session-çš„ä½¿ç”¨"><a href="#9-3-koa-session-çš„ä½¿ç”¨" class="headerlink" title="9.3 koa-session çš„ä½¿ç”¨"></a>9.3 koa-session çš„ä½¿ç”¨</h2><p><strong>1. å®‰è£… express-session</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm install koa-session --save</span><br></pre></td></tr></table></figure>

<p><strong>2. å¼•å…¥ express-session</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">const session = require(&#x27;koa-session&#x27;);</span><br></pre></td></tr></table></figure>

<p><strong>3. è®¾ç½®å®˜æ–¹æ–‡æ¡£æä¾›çš„ä¸­é—´ä»¶</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">app.keys = [&#x27;some secret hurr&#x27;];</span><br><span class="line">const CONFIG = &#123;</span><br><span class="line">    key: &#x27;koa:sess&#x27;, //cookie key (default is koa:sess)</span><br><span class="line">    maxAge: 86400000, // cookie çš„è¿‡æœŸæ—¶é—´ maxAge in ms (default is 1 days)</span><br><span class="line">    overwrite: true, //æ˜¯å¦å¯ä»¥ overwrite (é»˜è®¤ default true)</span><br><span class="line">    httpOnly: true, //cookie æ˜¯å¦åªæœ‰æœåŠ¡å™¨ç«¯å¯ä»¥è®¿é—® httpOnly or not (default true)</span><br><span class="line">    signed: true, //ç­¾åé»˜è®¤ true</span><br><span class="line">    rolling:false, //åœ¨æ¯æ¬¡è¯·æ±‚æ—¶å¼ºè¡Œè®¾ç½®cookieï¼Œè¿™å°†é‡ç½®cookieè¿‡æœŸæ—¶é—´(é»˜è®¤:false)</span><br><span class="line">    renew: false, //(boolean) renew session when session is nearly expired</span><br><span class="line">&#125;</span><br><span class="line">app.use(session(CONFIG, app));</span><br></pre></td></tr></table></figure>

<p><strong>4. ä½¿ç”¨</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">//è®¾ç½®å€¼ </span><br><span class="line">ctx.session.username = &quot;å¼ ä¸‰&quot;;</span><br><span class="line"></span><br><span class="line">// è·å–å€¼ </span><br><span class="line">ctx.session.username</span><br></pre></td></tr></table></figure>

<h2 id="9-4-Cookie-å’Œ-Session-åŒºåˆ«"><a href="#9-4-Cookie-å’Œ-Session-åŒºåˆ«" class="headerlink" title="9.4 Cookie å’Œ Session åŒºåˆ«"></a>9.4 Cookie å’Œ Session åŒºåˆ«</h2><ul>
<li><code>cookie</code> æ•°æ®å­˜æ”¾åœ¨å®¢æˆ·çš„æµè§ˆå™¨ä¸Šï¼Œ<code>session</code> æ•°æ®æ”¾åœ¨æœåŠ¡å™¨ä¸Š</li>
<li><code>cookie</code> ä¸æ˜¯å¾ˆå®‰å…¨ï¼Œåˆ«äººå¯ä»¥åˆ†æå­˜æ”¾åœ¨æœ¬åœ°çš„ <code>COOKIE</code> å¹¶è¿›è¡Œ <code>COOKIE</code> æ¬ºéª— è€ƒè™‘åˆ°å®‰å…¨åº”å½“ä½¿ç”¨ <code>session</code></li>
<li><code>session</code>ä¼šåœ¨ä¸€å®šæ—¶é—´å†…ä¿å­˜åœ¨æœåŠ¡å™¨ä¸Šã€‚å½“è®¿é—®å¢å¤šï¼Œä¼šæ¯”è¾ƒå ç”¨ä½ æœåŠ¡å™¨çš„æ€§èƒ½ è€ƒè™‘åˆ°å‡è½»æœåŠ¡å™¨æ€§èƒ½æ–¹é¢ï¼Œåº”å½“ä½¿ç”¨ <code>COOKIE</code></li>
<li>å•ä¸ª <code>cookie</code> ä¿å­˜çš„æ•°æ®ä¸èƒ½è¶…è¿‡ <code>4K</code>ï¼Œå¾ˆå¤šæµè§ˆå™¨éƒ½é™åˆ¶ä¸€ä¸ªç«™ç‚¹æœ€å¤šä¿å­˜ <code>20</code> ä¸ª <code>cookie</code></li>
</ul>
<h1 id="åã€Koa-æ“ä½œ-Mongodb-æ•°æ®åº“"><a href="#åã€Koa-æ“ä½œ-Mongodb-æ•°æ®åº“" class="headerlink" title="åã€Koa æ“ä½œ Mongodb æ•°æ®åº“"></a>åã€Koa æ“ä½œ Mongodb æ•°æ®åº“</h1><blockquote>
<p>å®˜æ–¹æ–‡æ¡£:<a target="_blank" rel="noopener" href="http://mongodb.github.io/node-mongodb-native/">http://mongodb.github.io/node-mongodb-native/</a></p>
</blockquote>
<h1 id="åä¸€ã€Koa-åº”ç”¨ç”Ÿæˆå™¨ä»¥åŠ-Koa-è·¯ç”±æ¨¡-å—åŒ–"><a href="#åä¸€ã€Koa-åº”ç”¨ç”Ÿæˆå™¨ä»¥åŠ-Koa-è·¯ç”±æ¨¡-å—åŒ–" class="headerlink" title="åä¸€ã€Koa åº”ç”¨ç”Ÿæˆå™¨ä»¥åŠ Koa è·¯ç”±æ¨¡ å—åŒ–"></a>åä¸€ã€Koa åº”ç”¨ç”Ÿæˆå™¨ä»¥åŠ Koa è·¯ç”±æ¨¡ å—åŒ–</h1><h2 id="11-1-koa-åº”ç”¨ç”Ÿæˆå™¨"><a href="#11-1-koa-åº”ç”¨ç”Ÿæˆå™¨" class="headerlink" title="11.1 koa åº”ç”¨ç”Ÿæˆå™¨"></a>11.1 koa åº”ç”¨ç”Ÿæˆå™¨</h2><blockquote>
<p>é€šè¿‡åº”ç”¨ <code>koa</code> è„šæ‰‹æ¶ç”Ÿæˆå·¥å…· å¯ä»¥å¿«é€Ÿåˆ›å»ºä¸€ä¸ªåŸºäº <code>koa2</code> çš„åº”ç”¨çš„éª¨æ¶</p>
</blockquote>
<p><strong>1. å…¨å±€å®‰è£…</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm install koa-generator -g</span><br></pre></td></tr></table></figure>

<p><strong>2. åˆ›å»ºé¡¹ç›®</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">koa koa_demo</span><br></pre></td></tr></table></figure>

<p><strong>3. å®‰è£…ä¾èµ–</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">cd koa_demo</span><br><span class="line"></span><br><span class="line">npm install</span><br></pre></td></tr></table></figure>

<p><strong>4. å¯åŠ¨é¡¹ç›®</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm start</span><br></pre></td></tr></table></figure>

<h2 id="11-2-koa-æ­å»ºæ¨¡å—åŒ–è·¯ç”±-x2F-å±‚çº§è·¯ç”±"><a href="#11-2-koa-æ­å»ºæ¨¡å—åŒ–è·¯ç”±-x2F-å±‚çº§è·¯ç”±" class="headerlink" title="11.2 koa æ­å»ºæ¨¡å—åŒ–è·¯ç”±&#x2F;å±‚çº§è·¯ç”±"></a>11.2 koa æ­å»ºæ¨¡å—åŒ–è·¯ç”±&#x2F;å±‚çº§è·¯ç”±</h2><ol>
<li>åœ¨ç›®å½•ä¸‹é¢æ–°å»ºä¸€ä¸ªæ–‡ä»¶å¤¹ <code>routes</code></li>
<li>åœ¨ <code>routes</code> é‡Œé¢é…ç½®å¯¹åº”çš„å­é¡µé¢</li>
<li>æ¯”å¦‚åœ¨ <code>routes</code> æ–°å»º <code>index.js</code></li>
</ol>
<p><img src="https://poetries1.gitee.io/img-repo/2019/10/507.png" alt="img"></p>
<ol>
<li>ç„¶ååœ¨ä¸»åº”ç”¨ä¸­åŠ è½½å­è·¯ç”±æ¨¡å—:</li>
</ol>
<p><img src="https://poetries1.gitee.io/img-repo/2019/10/508.png" alt="img"></p>

        
    </article>
    <footer class="cube-excerpt-footer">
        <a class="cube-excerpt-more" href="/2019/06/27/nodejs/nodejs-koa2/">Read More</a>
    </footer>
</div>

<div class="cube-excerpt" id="cube-excerpt-node-expressæ¡†æ¶æ€»ç»“">
    <header class="cube-excerpt-header">
        <h1><a href="/2019/06/07/nodejs/express/">node-expressæ¡†æ¶æ€»ç»“</a></h1>
        <div class="cube-excerpt-header-msg">
            <div class="cube-excerpt-date">
                <i class="cube-icon cube-icon-date" aria-hidden="true"></i>
                2019-06-07
            </div>
            <div class="cube-excerpt-tags">
                <i class="cube-icon cube-icon-tag" aria-hidden="true"></i>
                
                <a href="/tags/nodejs/" class="cube-excerpt-tag-link">#nodejs</a>
                
            </div>
        </div>
    </header>
    <article class="cube-excerpt-entry cube-markdown">
        
        
           <h2 id="ä¸€ã€æ¦‚è¿°"><a href="#ä¸€ã€æ¦‚è¿°" class="headerlink" title="ä¸€ã€æ¦‚è¿°"></a>ä¸€ã€æ¦‚è¿°</h2><blockquote>
<p>å®˜ç½‘ <a target="_blank" rel="noopener" href="http://expressjs.com/zh-cn/">http://expressjs.com/zh-cn/</a></p>
</blockquote>
<blockquote>
<p><code>Express</code>æ˜¯ç›®å‰æœ€æµè¡Œçš„åŸºäºNode.jsçš„Webå¼€å‘æ¡†æ¶ï¼Œå¯ä»¥å¿«é€Ÿåœ°æ­å»ºä¸€ä¸ªå®Œæ•´åŠŸèƒ½çš„ç½‘ç«™</p>
</blockquote>
<p><strong>ç¯å¢ƒæ­å»º</strong></p>
<blockquote>
<p><a target="_blank" rel="noopener" href="http://www.expressjs.com.cn/starter/generator.html">http://www.expressjs.com.cn/starter/generator.html</a></p>
</blockquote>
<blockquote>
<p>é€šè¿‡åº”ç”¨ç”Ÿæˆå™¨å·¥å…· <code>express-generator</code>å¯ä»¥å¿«é€Ÿåˆ›å»ºä¸€ä¸ªåº”ç”¨çš„éª¨æ¶</p>
</blockquote>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ npm install express-generator -g</span><br></pre></td></tr></table></figure>

<h2 id="äºŒã€è¿è¡ŒåŸç†"><a href="#äºŒã€è¿è¡ŒåŸç†" class="headerlink" title="äºŒã€è¿è¡ŒåŸç†"></a>äºŒã€è¿è¡ŒåŸç†</h2><p><strong>åº•å±‚ï¼šhttpæ¨¡å—</strong></p>
<blockquote>
<p>Expressæ¡†æ¶å»ºç«‹åœ¨node.jså†…ç½®çš„httpæ¨¡å—ä¸Šã€‚httpæ¨¡å—ç”ŸæˆæœåŠ¡å™¨çš„åŸå§‹ä»£ç å¦‚ä¸‹</p>
</blockquote>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">var http = require(&quot;http&quot;);</span><br><span class="line"></span><br><span class="line">var app = http.createServer(function(request, response) &#123;</span><br><span class="line">  response.writeHead(200, &#123;&quot;Content-Type&quot;: &quot;text/plain&quot;&#125;);</span><br><span class="line">  response.end(&quot;Hello world!&quot;);</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">app.listen(3000, &quot;localhost&quot;);</span><br></pre></td></tr></table></figure>

<blockquote>
<p>Expressæ¡†æ¶çš„æ ¸å¿ƒæ˜¯å¯¹httpæ¨¡å—çš„å†åŒ…è£…ã€‚ä¸Šé¢çš„ä»£ç ç”¨Expressæ”¹å†™å¦‚ä¸‹</p>
</blockquote>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">var express = require(&#x27;express&#x27;);</span><br><span class="line">var app = express();</span><br><span class="line"></span><br><span class="line">app.get(&#x27;/&#x27;, function (req, res) &#123;</span><br><span class="line">  res.send(&#x27;Hello world!&#x27;);</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">app.listen(3000);</span><br></pre></td></tr></table></figure>

<blockquote>
<p>Expressæ¡†æ¶ç­‰äºåœ¨httpæ¨¡å—ä¹‹ä¸Šï¼ŒåŠ äº†ä¸€ä¸ªä¸­é—´å±‚</p>
</blockquote>
<p><strong>ä»€ä¹ˆæ˜¯ä¸­é—´ä»¶</strong></p>
<blockquote>
<ul>
<li>ç®€å•è¯´ï¼Œä¸­é—´ä»¶ï¼ˆmiddlewareï¼‰å°±æ˜¯å¤„ç†HTTPè¯·æ±‚çš„å‡½æ•°ã€‚å®ƒæœ€å¤§çš„ç‰¹ç‚¹å°±æ˜¯ï¼Œä¸€ä¸ªä¸­é—´ä»¶å¤„ç†å®Œï¼Œå†ä¼ é€’ç»™ä¸‹ä¸€ä¸ªä¸­é—´ä»¶ã€‚Appå®ä¾‹åœ¨è¿è¡Œè¿‡ç¨‹ä¸­ï¼Œä¼šè°ƒç”¨ä¸€ç³»åˆ—çš„ä¸­é—´ä»¶</li>
<li>æ¯ä¸ªä¸­é—´ä»¶å¯ä»¥ä»Appå®ä¾‹ï¼Œæ¥æ”¶ä¸‰ä¸ªå‚æ•°ï¼Œä¾æ¬¡ä¸ºrequestå¯¹è±¡ï¼ˆä»£è¡¨HTTPè¯·æ±‚ï¼‰ã€responseå¯¹è±¡ï¼ˆä»£è¡¨HTTPå›åº”ï¼‰ï¼Œnextå›è°ƒå‡½æ•°ï¼ˆä»£è¡¨ä¸‹ä¸€ä¸ªä¸­é—´ä»¶ï¼‰ã€‚æ¯ä¸ªä¸­é—´ä»¶éƒ½å¯ä»¥å¯¹HTTPè¯·æ±‚ï¼ˆrequestå¯¹è±¡ï¼‰è¿›è¡ŒåŠ å·¥ï¼Œå¹¶ä¸”å†³å®šæ˜¯å¦è°ƒç”¨nextæ–¹æ³•ï¼Œå°†requestå¯¹è±¡å†ä¼ ç»™ä¸‹ä¸€ä¸ªä¸­é—´ä»¶ã€‚</li>
</ul>
</blockquote>
<ul>
<li>ä¸€ä¸ªä¸è¿›è¡Œä»»ä½•æ“ä½œã€åªä¼ é€’<code>request</code>å¯¹è±¡çš„ä¸­é—´ä»¶ï¼Œå°±æ˜¯ä¸‹é¢è¿™æ ·</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">function uselessMiddleware(req, res, next) &#123;</span><br><span class="line">  next();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ul>
<li>ä¸Šé¢ä»£ç çš„nextå°±æ˜¯ä¸‹ä¸€ä¸ªä¸­é—´ä»¶ã€‚å¦‚æœå®ƒå¸¦æœ‰å‚æ•°ï¼Œåˆ™ä»£è¡¨æŠ›å‡ºä¸€ä¸ªé”™è¯¯ï¼Œå‚æ•°ä¸ºé”™è¯¯æ–‡æœ¬</li>
<li>æŠ›å‡ºé”™è¯¯ä»¥åï¼Œåé¢çš„ä¸­é—´ä»¶å°†ä¸å†æ‰§è¡Œï¼Œç›´åˆ°å‘ç°ä¸€ä¸ªé”™è¯¯å¤„ç†å‡½æ•°ä¸ºæ­¢</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">function uselessMiddleware(req, res, next) &#123;</span><br><span class="line">  next(&#x27;å‡ºé”™äº†ï¼&#x27;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="ä¸‰ã€useæ–¹æ³•"><a href="#ä¸‰ã€useæ–¹æ³•" class="headerlink" title="ä¸‰ã€useæ–¹æ³•"></a>ä¸‰ã€useæ–¹æ³•</h2><blockquote>
<p>useæ˜¯expressæ³¨å†Œä¸­é—´ä»¶çš„æ–¹æ³•ï¼Œå®ƒè¿”å›ä¸€ä¸ªå‡½æ•°ã€‚ä¸‹é¢æ˜¯ä¸€ä¸ªè¿ç»­è°ƒç”¨ä¸¤ä¸ªä¸­é—´ä»¶çš„ä¾‹å­</p>
</blockquote>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">var express = require(&quot;express&quot;);</span><br><span class="line">var http = require(&quot;http&quot;);</span><br><span class="line"></span><br><span class="line">var app = express();</span><br><span class="line"></span><br><span class="line">app.use(function(request, response, next) &#123;</span><br><span class="line">  console.log(&quot;In comes a &quot; + request.method + &quot; to &quot; + request.url);</span><br><span class="line">  next();</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">app.use(function(request, response) &#123;</span><br><span class="line">  response.writeHead(200, &#123; &quot;Content-Type&quot;: &quot;text/plain&quot; &#125;);</span><br><span class="line">  response.end(&quot;Hello world!\n&quot;);</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">http.createServer(app).listen(1337);</span><br></pre></td></tr></table></figure>

<blockquote>
<p>ä¸Šé¢ä»£ç ä½¿ç”¨app.useæ–¹æ³•ï¼Œæ³¨å†Œäº†ä¸¤ä¸ªä¸­é—´ä»¶ã€‚æ”¶åˆ°HTTPè¯·æ±‚åï¼Œå…ˆè°ƒç”¨ç¬¬ä¸€ä¸ªä¸­é—´ä»¶ï¼Œåœ¨æ§åˆ¶å°è¾“å‡ºä¸€è¡Œä¿¡æ¯ï¼Œç„¶åé€šè¿‡nextæ–¹æ³•ï¼Œå°†æ‰§è¡Œæƒä¼ ç»™ç¬¬äºŒä¸ªä¸­é—´ä»¶ï¼Œè¾“å‡ºHTTPå›åº”ã€‚ç”±äºç¬¬äºŒä¸ªä¸­é—´ä»¶æ²¡æœ‰è°ƒç”¨nextæ–¹æ³•ï¼Œæ‰€ä»¥requestå¯¹è±¡å°±ä¸å†å‘åä¼ é€’äº†</p>
</blockquote>
<ul>
<li>useæ–¹æ³•å†…éƒ¨å¯ä»¥å¯¹è®¿é—®è·¯å¾„è¿›è¡Œåˆ¤æ–­ï¼Œæ®æ­¤å°±èƒ½å®ç°ç®€å•çš„è·¯ç”±ï¼Œæ ¹æ®ä¸åŒçš„è¯·æ±‚ç½‘å€ï¼Œè¿”å›ä¸åŒçš„ç½‘é¡µå†…å®¹</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line">var express = require(&quot;express&quot;);</span><br><span class="line">var http = require(&quot;http&quot;);</span><br><span class="line"></span><br><span class="line">var app = express();</span><br><span class="line"></span><br><span class="line">app.use(function(request, response, next) &#123;</span><br><span class="line">  if (request.url == &quot;/&quot;) &#123;</span><br><span class="line">    response.writeHead(200, &#123; &quot;Content-Type&quot;: &quot;text/plain&quot; &#125;);</span><br><span class="line">    response.end(&quot;Welcome to the homepage!\n&quot;);</span><br><span class="line">  &#125; else &#123;</span><br><span class="line">    next();</span><br><span class="line">  &#125;</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">app.use(function(request, response, next) &#123;</span><br><span class="line">  if (request.url == &quot;/about&quot;) &#123;</span><br><span class="line">    response.writeHead(200, &#123; &quot;Content-Type&quot;: &quot;text/plain&quot; &#125;);</span><br><span class="line">  &#125; else &#123;</span><br><span class="line">    next();</span><br><span class="line">  &#125;</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">app.use(function(request, response) &#123;</span><br><span class="line">  response.writeHead(404, &#123; &quot;Content-Type&quot;: &quot;text/plain&quot; &#125;);</span><br><span class="line">  response.end(&quot;404 error!\n&quot;);</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">http.createServer(app).listen(1337);</span><br></pre></td></tr></table></figure>

<blockquote>
<p>ä¸Šé¢ä»£ç é€šè¿‡<code>request.url</code>å±æ€§ï¼Œåˆ¤æ–­è¯·æ±‚çš„ç½‘å€ï¼Œä»è€Œè¿”å›ä¸åŒçš„å†…å®¹ã€‚æ³¨æ„ï¼Œ<code>app.use</code>æ–¹æ³•ä¸€å…±ç™»è®°äº†ä¸‰ä¸ªä¸­é—´ä»¶ï¼Œåªè¦è¯·æ±‚è·¯å¾„åŒ¹é…ï¼Œå°±ä¸ä¼šå°†æ‰§è¡Œæƒäº¤ç»™ä¸‹ä¸€ä¸ªä¸­é—´ä»¶ã€‚å› æ­¤ï¼Œæœ€åä¸€ä¸ªä¸­é—´ä»¶ä¼šè¿”å›<code>404</code>é”™è¯¯ï¼Œå³å‰é¢çš„ä¸­é—´ä»¶éƒ½æ²¡åŒ¹é…è¯·æ±‚è·¯å¾„ï¼Œæ‰¾ä¸åˆ°æ‰€è¦è¯·æ±‚çš„èµ„æº</p>
</blockquote>
<ul>
<li>é™¤äº†åœ¨å›è°ƒå‡½æ•°å†…éƒ¨åˆ¤æ–­è¯·æ±‚çš„ç½‘å€ï¼Œ<code>use</code>æ–¹æ³•ä¹Ÿå…è®¸å°†è¯·æ±‚ç½‘å€å†™åœ¨ç¬¬ä¸€ä¸ªå‚æ•°ã€‚è¿™ä»£è¡¨ï¼Œåªæœ‰è¯·æ±‚è·¯å¾„åŒ¹é…è¿™ä¸ªå‚æ•°ï¼Œåé¢çš„ä¸­é—´ä»¶æ‰ä¼šç”Ÿæ•ˆã€‚æ— ç–‘ï¼Œè¿™æ ·å†™æ›´åŠ æ¸…æ™°å’Œæ–¹ä¾¿</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">// åªå¯¹æ ¹ç›®å½•çš„è¯·æ±‚ï¼Œè°ƒç”¨æŸä¸ªä¸­é—´ä»¶</span><br><span class="line">app.use(&#x27;/path&#x27;, someMiddleware);</span><br></pre></td></tr></table></figure>

<ul>
<li>å› æ­¤ï¼Œä¸Šé¢çš„ä»£ç å¯ä»¥å†™æˆä¸‹é¢çš„æ ·å­</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">ar express = require(&quot;express&quot;);</span><br><span class="line">var http = require(&quot;http&quot;);</span><br><span class="line"></span><br><span class="line">var app = express();</span><br><span class="line"></span><br><span class="line">app.use(&quot;/home&quot;, function(request, response, next) &#123;</span><br><span class="line">  response.writeHead(200, &#123; &quot;Content-Type&quot;: &quot;text/plain&quot; &#125;);</span><br><span class="line">  response.end(&quot;Welcome to the homepage!\n&quot;);</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">app.use(&quot;/about&quot;, function(request, response, next) &#123;</span><br><span class="line">  response.writeHead(200, &#123; &quot;Content-Type&quot;: &quot;text/plain&quot; &#125;);</span><br><span class="line">  response.end(&quot;Welcome to the about page!\n&quot;);</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">app.use(function(request, response) &#123;</span><br><span class="line">  response.writeHead(404, &#123; &quot;Content-Type&quot;: &quot;text/plain&quot; &#125;);</span><br><span class="line">  response.end(&quot;404 error!\n&quot;);</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">http.createServer(app).listen(1337)</span><br></pre></td></tr></table></figure>

<h2 id="å››ã€Expressçš„æ–¹æ³•"><a href="#å››ã€Expressçš„æ–¹æ³•" class="headerlink" title="å››ã€Expressçš„æ–¹æ³•"></a>å››ã€Expressçš„æ–¹æ³•</h2><p><strong>allæ–¹æ³•å’ŒHTTPåŠ¨è¯æ–¹æ³•</strong></p>
<blockquote>
<p>é’ˆå¯¹ä¸åŒçš„è¯·æ±‚ï¼ŒExpressæä¾›äº†useæ–¹æ³•çš„ä¸€äº›åˆ«åã€‚æ¯”å¦‚ï¼Œä¸Šé¢ä»£ç ä¹Ÿå¯ä»¥ç”¨åˆ«åçš„å½¢å¼æ¥å†™</p>
</blockquote>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">var express = require(&quot;express&quot;);</span><br><span class="line">var http = require(&quot;http&quot;);</span><br><span class="line">var app = express();</span><br><span class="line"></span><br><span class="line">app.all(&quot;*&quot;, function(request, response, next) &#123;</span><br><span class="line">  response.writeHead(200, &#123; &quot;Content-Type&quot;: &quot;text/plain&quot; &#125;);</span><br><span class="line">  next();</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">app.get(&quot;/&quot;, function(request, response) &#123;</span><br><span class="line">  response.end(&quot;Welcome to the homepage!&quot;);</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">app.get(&quot;/about&quot;, function(request, response) &#123;</span><br><span class="line">  response.end(&quot;Welcome to the about page!&quot;);</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">app.get(&quot;*&quot;, function(request, response) &#123;</span><br><span class="line">  response.end(&quot;404!&quot;);</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">http.createServer(app).listen(1337);</span><br></pre></td></tr></table></figure>

<blockquote>
<ul>
<li>ä¸Šé¢ä»£ç çš„allæ–¹æ³•è¡¨ç¤ºï¼Œæ‰€æœ‰è¯·æ±‚éƒ½å¿…é¡»é€šè¿‡è¯¥ä¸­é—´ä»¶ï¼Œå‚æ•°ä¸­çš„â€œ*â€è¡¨ç¤ºå¯¹æ‰€æœ‰è·¯å¾„æœ‰æ•ˆã€‚getæ–¹æ³•åˆ™æ˜¯åªæœ‰GETåŠ¨è¯çš„HTTPè¯·æ±‚é€šè¿‡è¯¥ä¸­é—´ä»¶ï¼Œå®ƒçš„ç¬¬ä¸€ä¸ªå‚æ•°æ˜¯è¯·æ±‚çš„è·¯å¾„ã€‚ç”±äºgetæ–¹æ³•çš„å›è°ƒå‡½æ•°æ²¡æœ‰è°ƒç”¨nextæ–¹æ³•ï¼Œæ‰€ä»¥åªè¦æœ‰ä¸€ä¸ªä¸­é—´ä»¶è¢«è°ƒç”¨äº†ï¼Œåé¢çš„ä¸­é—´ä»¶å°±ä¸ä¼šå†è¢«è°ƒç”¨äº†</li>
<li>é™¤äº†getæ–¹æ³•ä»¥å¤–ï¼ŒExpressè¿˜æä¾›postã€putã€deleteæ–¹æ³•ï¼Œå³HTTPåŠ¨è¯éƒ½æ˜¯Expressçš„æ–¹æ³•</li>
</ul>
</blockquote>
<ul>
<li>é™¤äº†getæ–¹æ³•ä»¥å¤–ï¼ŒExpressè¿˜æä¾›postã€putã€deleteæ–¹æ³•ï¼Œå³HTTPåŠ¨è¯éƒ½æ˜¯Expressçš„æ–¹æ³•</li>
<li>è¿™äº›æ–¹æ³•çš„ç¬¬ä¸€ä¸ªå‚æ•°ï¼Œéƒ½æ˜¯è¯·æ±‚çš„è·¯å¾„ã€‚é™¤äº†ç»å¯¹åŒ¹é…ä»¥å¤–ï¼ŒExpresså…è®¸æ¨¡å¼åŒ¹é…</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">app.get(&quot;/hello/:who&quot;, function(req, res) &#123;</span><br><span class="line">  res.end(&quot;Hello, &quot; + req.params.who + &quot;.&quot;);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<h2 id="äº”ã€setæ–¹æ³•"><a href="#äº”ã€setæ–¹æ³•" class="headerlink" title="äº”ã€setæ–¹æ³•"></a>äº”ã€setæ–¹æ³•</h2><blockquote>
<p>setæ–¹æ³•ç”¨äºæŒ‡å®šå˜é‡çš„å€¼</p>
</blockquote>
<ul>
<li><p>ä½¿ç”¨setæ–¹æ³•ï¼Œä¸ºç³»ç»Ÿå˜é‡â€œviewsâ€å’Œâ€œview engineâ€æŒ‡å®šå€¼</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">app.set(&quot;views&quot;, __dirname + &quot;/views&quot;);</span><br><span class="line"></span><br><span class="line">app.set(&quot;view engine&quot;, &quot;jade&quot;);</span><br></pre></td></tr></table></figure></li>
</ul>
<h2 id="å…­ã€responseå¯¹è±¡"><a href="#å…­ã€responseå¯¹è±¡" class="headerlink" title="å…­ã€responseå¯¹è±¡"></a>å…­ã€responseå¯¹è±¡</h2><p><strong>ï¼ˆ1ï¼‰response.redirectæ–¹æ³•</strong></p>
<blockquote>
<p>response.redirectæ–¹æ³•å…è®¸ç½‘å€çš„é‡å®šå‘</p>
</blockquote>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">response.redirect(&quot;/hello/anime&quot;);</span><br><span class="line">response.redirect(&quot;http://www.example.com&quot;);</span><br><span class="line">response.redirect(301, &quot;http://www.example.com&quot;);</span><br></pre></td></tr></table></figure>

<p><strong>ï¼ˆ2ï¼‰response.sendFileæ–¹æ³•</strong></p>
<blockquote>
<p>response.sendFileæ–¹æ³•ç”¨äºå‘é€æ–‡ä»¶</p>
</blockquote>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">response.sendFile(&quot;/path/to/anime.mp4&quot;);</span><br></pre></td></tr></table></figure>

<p><strong>ï¼ˆ3ï¼‰response.renderæ–¹æ³•</strong></p>
<blockquote>
<p>response.renderæ–¹æ³•ç”¨äºæ¸²æŸ“ç½‘é¡µæ¨¡æ¿ã€‚</p>
</blockquote>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">//  ä½¿ç”¨renderæ–¹æ³•ï¼Œå°†messageå˜é‡ä¼ å…¥indexæ¨¡æ¿ï¼Œæ¸²æŸ“æˆHTMLç½‘é¡µ</span><br><span class="line">app.get(&quot;/&quot;, function(request, response) &#123;</span><br><span class="line">  response.render(&quot;index&quot;, &#123; message: &quot;Hello World&quot; &#125;);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<h2 id="ä¸ƒã€requstå¯¹è±¡"><a href="#ä¸ƒã€requstå¯¹è±¡" class="headerlink" title="ä¸ƒã€requstå¯¹è±¡"></a>ä¸ƒã€requstå¯¹è±¡</h2><p><strong>ï¼ˆ1ï¼‰request.ip</strong></p>
<blockquote>
<p>request.ipå±æ€§ç”¨äºè·å¾—HTTPè¯·æ±‚çš„IPåœ°å€</p>
</blockquote>
<p><strong>ï¼ˆ2ï¼‰request.files</strong></p>
<blockquote>
<p>request.filesç”¨äºè·å–ä¸Šä¼ çš„æ–‡ä»¶</p>
</blockquote>
<h2 id="å…«ã€æ­å»ºHTTPsæœåŠ¡å™¨"><a href="#å…«ã€æ­å»ºHTTPsæœåŠ¡å™¨" class="headerlink" title="å…«ã€æ­å»ºHTTPsæœåŠ¡å™¨"></a>å…«ã€æ­å»ºHTTPsæœåŠ¡å™¨</h2><blockquote>
<p>ä½¿ç”¨Expressæ­å»ºHTTPsåŠ å¯†æœåŠ¡å™¨ï¼Œä¹Ÿå¾ˆç®€å•</p>
</blockquote>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">var fs = require(&#x27;fs&#x27;);</span><br><span class="line">var options = &#123;</span><br><span class="line">  key: fs.readFileSync(&#x27;E:/ssl/myserver.key&#x27;),</span><br><span class="line">  cert: fs.readFileSync(&#x27;E:/ssl/myserver.crt&#x27;),</span><br><span class="line">  passphrase: &#x27;1234&#x27;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">var https = require(&#x27;https&#x27;);</span><br><span class="line">var express = require(&#x27;express&#x27;);</span><br><span class="line">var app = express();</span><br><span class="line"></span><br><span class="line">app.get(&#x27;/&#x27;, function(req, res)&#123;</span><br><span class="line">  res.send(&#x27;Hello World Expressjs&#x27;);</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">var server = https.createServer(options, app);</span><br><span class="line">server.listen(8084);</span><br><span class="line">console.log(&#x27;Server is running on port 8084&#x27;);</span><br></pre></td></tr></table></figure>

<h2 id="ä¹ã€é™æ€ç½‘é¡µæ¨¡æ¿"><a href="#ä¹ã€é™æ€ç½‘é¡µæ¨¡æ¿" class="headerlink" title="ä¹ã€é™æ€ç½‘é¡µæ¨¡æ¿"></a>ä¹ã€é™æ€ç½‘é¡µæ¨¡æ¿</h2><blockquote>
<ul>
<li>åœ¨é¡¹ç›®ç›®å½•ä¹‹ä¸­ï¼Œå»ºç«‹ä¸€ä¸ªå­ç›®å½•viewsï¼Œç”¨äºå­˜æ”¾ç½‘é¡µæ¨¡æ¿</li>
<li>å‡å®šè¿™ä¸ªé¡¹ç›®æœ‰ä¸‰ä¸ªè·¯å¾„ï¼šæ ¹è·¯å¾„ï¼ˆ&#x2F;ï¼‰ã€è‡ªæˆ‘ä»‹ç»ï¼ˆ&#x2F;aboutï¼‰å’Œæ–‡ç« ï¼ˆ&#x2F;articleï¼‰ã€‚é‚£ä¹ˆï¼Œapp.jså¯ä»¥è¿™æ ·å†™</li>
</ul>
</blockquote>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">// å‘æœåŠ¡å™¨å‘é€ä¿¡æ¯çš„æ–¹æ³•ï¼Œä»sendå˜æˆäº†sendfileï¼Œåè€…ä¸“é—¨ç”¨äºå‘é€æ–‡ä»¶</span><br><span class="line">var express = require(&#x27;express&#x27;);</span><br><span class="line">var app = express();</span><br><span class="line"> </span><br><span class="line">app.get(&#x27;/&#x27;, function(req, res) &#123;</span><br><span class="line">   res.sendfile(&#x27;./views/index.html&#x27;);</span><br><span class="line">&#125;);</span><br><span class="line"> </span><br><span class="line">app.get(&#x27;/about&#x27;, function(req, res) &#123;</span><br><span class="line">   res.sendfile(&#x27;./views/about.html&#x27;);</span><br><span class="line">&#125;);</span><br><span class="line"> </span><br><span class="line">app.get(&#x27;/article&#x27;, function(req, res) &#123;</span><br><span class="line">   res.sendfile(&#x27;./views/article.html&#x27;);</span><br><span class="line">&#125;);</span><br><span class="line"> </span><br><span class="line">app.listen(3000);</span><br></pre></td></tr></table></figure>

<h2 id="åã€åŠ¨æ€ç½‘é¡µæ¨¡æ¿"><a href="#åã€åŠ¨æ€ç½‘é¡µæ¨¡æ¿" class="headerlink" title="åã€åŠ¨æ€ç½‘é¡µæ¨¡æ¿"></a>åã€åŠ¨æ€ç½‘é¡µæ¨¡æ¿</h2><p><strong>å®‰è£…æ¨¡æ¿å¼•æ“</strong></p>
<blockquote>
<p>Expressæ”¯æŒå¤šç§æ¨¡æ¿å¼•æ“ï¼Œè¿™é‡Œé‡‡ç”¨Handlebarsæ¨¡æ¿å¼•æ“çš„æœåŠ¡å™¨ç«¯ç‰ˆæœ¬hbsæ¨¡æ¿å¼•æ“</p>
</blockquote>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm install hbs --save-dev</span><br></pre></td></tr></table></figure>

<ul>
<li>å®‰è£…æ¨¡æ¿å¼•æ“ä¹‹åï¼Œå°±è¦æ”¹å†™app.js</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">// app.jsæ–‡ä»¶</span><br><span class="line"></span><br><span class="line">var express = require(&#x27;express&#x27;);</span><br><span class="line">var app = express();</span><br><span class="line"></span><br><span class="line">// åŠ è½½hbsæ¨¡å—</span><br><span class="line">var hbs = require(&#x27;hbs&#x27;);</span><br><span class="line"></span><br><span class="line">// æŒ‡å®šæ¨¡æ¿æ–‡ä»¶çš„åç¼€åä¸ºhtml</span><br><span class="line">app.set(&#x27;view engine&#x27;, &#x27;html&#x27;);</span><br><span class="line"></span><br><span class="line">// è¿è¡Œhbsæ¨¡å—</span><br><span class="line">app.engine(&#x27;html&#x27;, hbs.__express);</span><br><span class="line"></span><br><span class="line">app.get(&#x27;/&#x27;, function (req, res)&#123;</span><br><span class="line">	res.render(&#x27;index&#x27;);</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">app.get(&#x27;/about&#x27;, function(req, res) &#123;</span><br><span class="line">	res.render(&#x27;about&#x27;);</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">app.get(&#x27;/article&#x27;, function(req, res) &#123;</span><br><span class="line">	res.render(&#x27;article&#x27;);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<blockquote>
<p>ä¸Šé¢ä»£ç æ”¹ç”¨renderæ–¹æ³•ï¼Œå¯¹ç½‘é¡µæ¨¡æ¿è¿›è¡Œæ¸²æŸ“ã€‚renderæ–¹æ³•çš„å‚æ•°å°±æ˜¯æ¨¡æ¿çš„æ–‡ä»¶åï¼Œé»˜è®¤æ”¾åœ¨å­ç›®å½•viewsä¹‹ä¸­ï¼Œåç¼€åå·²ç»åœ¨å‰é¢æŒ‡å®šä¸ºhtmlï¼Œè¿™é‡Œå¯ä»¥çœç•¥ã€‚æ‰€ä»¥ï¼Œres.render(â€˜indexâ€™) å°±æ˜¯æŒ‡ï¼ŒæŠŠå­ç›®å½•viewsä¸‹é¢çš„index.htmlæ–‡ä»¶ï¼Œäº¤ç»™æ¨¡æ¿å¼•æ“hbsæ¸²æŸ“</p>
</blockquote>
<h2 id="åä¸€ã€æ–°å»ºæ•°æ®è„šæœ¬"><a href="#åä¸€ã€æ–°å»ºæ•°æ®è„šæœ¬" class="headerlink" title="åä¸€ã€æ–°å»ºæ•°æ®è„šæœ¬"></a>åä¸€ã€æ–°å»ºæ•°æ®è„šæœ¬</h2><blockquote>
<ul>
<li>æ¸²æŸ“æ˜¯æŒ‡å°†æ•°æ®ä»£å…¥æ¨¡æ¿çš„è¿‡ç¨‹ã€‚å®é™…è¿ç”¨ä¸­ï¼Œæ•°æ®éƒ½æ˜¯ä¿å­˜åœ¨æ•°æ®åº“ä¹‹ä¸­çš„ï¼Œè¿™é‡Œä¸ºäº†ç®€åŒ–é—®é¢˜ï¼Œå‡å®šæ•°æ®ä¿å­˜åœ¨ä¸€ä¸ªè„šæœ¬æ–‡ä»¶ä¸­</li>
<li>åœ¨é¡¹ç›®ç›®å½•ä¸­ï¼Œæ–°å»ºä¸€ä¸ªæ–‡ä»¶blog.jsï¼Œç”¨äºå­˜æ”¾æ•°æ®ã€‚blog.jsçš„å†™æ³•ç¬¦åˆCommonJSè§„èŒƒï¼Œä½¿å¾—å®ƒå¯ä»¥è¢«requireè¯­å¥åŠ è½½</li>
</ul>
</blockquote>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">// blog.jsæ–‡ä»¶</span><br><span class="line"></span><br><span class="line">var entries = [</span><br><span class="line">	&#123;&quot;id&quot;:1, &quot;title&quot;:&quot;ç¬¬ä¸€ç¯‡&quot;, &quot;body&quot;:&quot;æ­£æ–‡&quot;, &quot;published&quot;:&quot;6/2/2013&quot;&#125;,</span><br><span class="line">	&#123;&quot;id&quot;:2, &quot;title&quot;:&quot;ç¬¬äºŒç¯‡&quot;, &quot;body&quot;:&quot;æ­£æ–‡&quot;, &quot;published&quot;:&quot;6/3/2013&quot;&#125;,</span><br><span class="line">	&#123;&quot;id&quot;:3, &quot;title&quot;:&quot;ç¬¬ä¸‰ç¯‡&quot;, &quot;body&quot;:&quot;æ­£æ–‡&quot;, &quot;published&quot;:&quot;6/4/2013&quot;&#125;,</span><br><span class="line">	&#123;&quot;id&quot;:4, &quot;title&quot;:&quot;ç¬¬å››ç¯‡&quot;, &quot;body&quot;:&quot;æ­£æ–‡&quot;, &quot;published&quot;:&quot;6/5/2013&quot;&#125;,</span><br><span class="line">	&#123;&quot;id&quot;:5, &quot;title&quot;:&quot;ç¬¬äº”ç¯‡&quot;, &quot;body&quot;:&quot;æ­£æ–‡&quot;, &quot;published&quot;:&quot;6/10/2013&quot;&#125;,</span><br><span class="line">	&#123;&quot;id&quot;:6, &quot;title&quot;:&quot;ç¬¬å…­ç¯‡&quot;, &quot;body&quot;:&quot;æ­£æ–‡&quot;, &quot;published&quot;:&quot;6/12/2013&quot;&#125;</span><br><span class="line">];</span><br><span class="line"></span><br><span class="line">exports.getBlogEntries = function ()&#123;</span><br><span class="line">   return entries;</span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line">exports.getBlogEntry = function (id)&#123;</span><br><span class="line">   for(var i=0; i &lt; entries.length; i++)&#123;</span><br><span class="line">      if(entries[i].id == id) return entries[i];</span><br><span class="line">   &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="åäºŒã€æ–°å»ºç½‘é¡µæ¨¡æ¿"><a href="#åäºŒã€æ–°å»ºç½‘é¡µæ¨¡æ¿" class="headerlink" title="åäºŒã€æ–°å»ºç½‘é¡µæ¨¡æ¿"></a>åäºŒã€æ–°å»ºç½‘é¡µæ¨¡æ¿</h2><blockquote>
<p>æ¥ç€ï¼Œæ–°å»ºæ¨¡æ¿æ–‡ä»¶<code>index.html</code></p>
</blockquote>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">&lt;!-- views/index.htmlæ–‡ä»¶ --&gt;</span><br><span class="line"></span><br><span class="line">&lt;h1&gt;æ–‡ç« åˆ—è¡¨&lt;/h1&gt;</span><br><span class="line"> </span><br><span class="line">&#123;&#123;#each entries&#125;&#125;</span><br><span class="line">   &lt;p&gt;</span><br><span class="line">      &lt;a href=&quot;/article/&#123;&#123;id&#125;&#125;&quot;&gt;&#123;&#123;title&#125;&#125;&lt;/a&gt;&lt;br/&gt;</span><br><span class="line">      Published: &#123;&#123;published&#125;&#125;</span><br><span class="line">   &lt;/p&gt;</span><br><span class="line">&#123;&#123;/each&#125;&#125;</span><br><span class="line">&lt;!-- views/about.htmlæ–‡ä»¶ --&gt;</span><br><span class="line"></span><br><span class="line">&lt;h1&gt;è‡ªæˆ‘ä»‹ç»&lt;/h1&gt;</span><br><span class="line"> </span><br><span class="line">&lt;p&gt;æ­£æ–‡&lt;/p&gt;</span><br><span class="line">&lt;!-- views/article.htmlæ–‡ä»¶ --&gt;</span><br><span class="line"></span><br><span class="line">&lt;h1&gt;&#123;&#123;blog.title&#125;&#125;&lt;/h1&gt;</span><br><span class="line">Published: &#123;&#123;blog.published&#125;&#125;</span><br><span class="line"> </span><br><span class="line">&lt;p/&gt;</span><br><span class="line"> </span><br><span class="line">&#123;&#123;blog.body&#125;&#125;</span><br></pre></td></tr></table></figure>

<blockquote>
<p>å¯ä»¥çœ‹åˆ°ï¼Œä¸Šé¢ä¸‰ä¸ªæ¨¡æ¿æ–‡ä»¶éƒ½åªæœ‰ç½‘é¡µä¸»ä½“ã€‚å› ä¸ºç½‘é¡µå¸ƒå±€æ˜¯å…±äº«çš„ï¼Œæ‰€ä»¥å¸ƒå±€çš„éƒ¨åˆ†å¯ä»¥å•ç‹¬æ–°å»ºä¸€ä¸ªæ–‡ä»¶<code>layout.html</code></p>
</blockquote>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">&lt;!-- views/layout.htmlæ–‡ä»¶ --&gt;</span><br><span class="line"></span><br><span class="line">&lt;html&gt;</span><br><span class="line"> </span><br><span class="line">&lt;head&gt;</span><br><span class="line">   &lt;title&gt;&#123;&#123;title&#125;&#125;&lt;/title&gt;</span><br><span class="line">&lt;/head&gt;</span><br><span class="line"> </span><br><span class="line">&lt;body&gt;</span><br><span class="line"> </span><br><span class="line">	&#123;&#123;&#123;body&#125;&#125;&#125;</span><br><span class="line"> </span><br><span class="line">   &lt;footer&gt;</span><br><span class="line">      &lt;p&gt;</span><br><span class="line">         &lt;a href=&quot;/&quot;&gt;é¦–é¡µ&lt;/a&gt; - &lt;a href=&quot;/about&quot;&gt;è‡ªæˆ‘ä»‹ç»&lt;/a&gt;</span><br><span class="line">      &lt;/p&gt;</span><br><span class="line">   &lt;/footer&gt;</span><br><span class="line">    </span><br><span class="line">&lt;/body&gt;</span><br><span class="line">&lt;/html&gt;</span><br></pre></td></tr></table></figure>

<h2 id="åä¸‰ã€æ¸²æŸ“æ¨¡æ¿"><a href="#åä¸‰ã€æ¸²æŸ“æ¨¡æ¿" class="headerlink" title="åä¸‰ã€æ¸²æŸ“æ¨¡æ¿"></a>åä¸‰ã€æ¸²æŸ“æ¨¡æ¿</h2><blockquote>
<p>æœ€åï¼Œæ”¹å†™app.jsæ–‡ä»¶</p>
</blockquote>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line">// app.jsæ–‡ä»¶</span><br><span class="line"></span><br><span class="line">var express = require(&#x27;express&#x27;);</span><br><span class="line">var app = express();</span><br><span class="line"> </span><br><span class="line">var hbs = require(&#x27;hbs&#x27;);</span><br><span class="line"></span><br><span class="line">// åŠ è½½æ•°æ®æ¨¡å—</span><br><span class="line">var blogEngine = require(&#x27;./blog&#x27;);</span><br><span class="line"> </span><br><span class="line">app.set(&#x27;view engine&#x27;, &#x27;html&#x27;);</span><br><span class="line">app.engine(&#x27;html&#x27;, hbs.__express);</span><br><span class="line">app.use(express.bodyParser());</span><br><span class="line"> </span><br><span class="line">app.get(&#x27;/&#x27;, function(req, res) &#123;</span><br><span class="line">   res.render(&#x27;index&#x27;,&#123;title:&quot;æœ€è¿‘æ–‡ç« &quot;, entries:blogEngine.getBlogEntries()&#125;);</span><br><span class="line">&#125;);</span><br><span class="line"> </span><br><span class="line">app.get(&#x27;/about&#x27;, function(req, res) &#123;</span><br><span class="line">   res.render(&#x27;about&#x27;, &#123;title:&quot;è‡ªæˆ‘ä»‹ç»&quot;&#125;);</span><br><span class="line">&#125;);</span><br><span class="line"> </span><br><span class="line">app.get(&#x27;/article/:id&#x27;, function(req, res) &#123;</span><br><span class="line">   var entry = blogEngine.getBlogEntry(req.params.id);</span><br><span class="line">   res.render(&#x27;article&#x27;,&#123;title:entry.title, blog:entry&#125;);</span><br><span class="line">&#125;);</span><br><span class="line"> </span><br><span class="line">app.listen(3000);</span><br></pre></td></tr></table></figure>

<ul>
<li>ä¸Šé¢ä»£ç ä¸­çš„renderæ–¹æ³•ï¼Œç°åœ¨åŠ å…¥äº†ç¬¬äºŒä¸ªå‚æ•°ï¼Œè¡¨ç¤ºæ¨¡æ¿å˜é‡ç»‘å®šçš„æ•°æ®</li>
</ul>
<h2 id="åå››ã€æŒ‡å®šé™æ€æ–‡ä»¶ç›®å½•"><a href="#åå››ã€æŒ‡å®šé™æ€æ–‡ä»¶ç›®å½•" class="headerlink" title="åå››ã€æŒ‡å®šé™æ€æ–‡ä»¶ç›®å½•"></a>åå››ã€æŒ‡å®šé™æ€æ–‡ä»¶ç›®å½•</h2><blockquote>
<p>æ¨¡æ¿æ–‡ä»¶é»˜è®¤å­˜æ”¾åœ¨viewså­ç›®å½•ã€‚è¿™æ—¶ï¼Œå¦‚æœè¦åœ¨ç½‘é¡µä¸­åŠ è½½é™æ€æ–‡ä»¶ï¼ˆæ¯”å¦‚æ ·å¼è¡¨ã€å›¾ç‰‡ç­‰ï¼‰ï¼Œå°±éœ€è¦å¦å¤–æŒ‡å®šä¸€ä¸ªå­˜æ”¾é™æ€æ–‡ä»¶çš„ç›®å½•</p>
</blockquote>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">app.use(express.static(&#x27;public&#x27;));</span><br></pre></td></tr></table></figure>

<blockquote>
<p>ä¸Šé¢ä»£ç åœ¨æ–‡ä»¶app.jsä¹‹ä¸­ï¼ŒæŒ‡å®šé™æ€æ–‡ä»¶å­˜æ”¾çš„ç›®å½•æ˜¯publicã€‚äºæ˜¯ï¼Œå½“æµè§ˆå™¨å‘å‡ºéHTMLæ–‡ä»¶è¯·æ±‚æ—¶ï¼ŒæœåŠ¡å™¨ç«¯å°±åˆ°publicç›®å½•å¯»æ‰¾è¿™ä¸ªæ–‡ä»¶ã€‚æ¯”å¦‚ï¼Œæµè§ˆå™¨å‘å‡ºå¦‚ä¸‹çš„æ ·å¼è¡¨è¯·æ±‚ï¼š</p>
</blockquote>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;link href=&quot;/bootstrap/css/bootstrap.css&quot; rel=&quot;stylesheet&quot;&gt;</span><br></pre></td></tr></table></figure>

<ul>
<li>æœåŠ¡å™¨ç«¯å°±åˆ°<code>public/bootstrap/css/</code>ç›®å½•ä¸­å¯»æ‰¾<code>bootstrap.css</code>æ–‡ä»¶</li>
</ul>
<h2 id="åäº”ã€Express-Routerç”¨æ³•"><a href="#åäº”ã€Express-Routerç”¨æ³•" class="headerlink" title="åäº”ã€Express.Routerç”¨æ³•"></a>åäº”ã€Express.Routerç”¨æ³•</h2><blockquote>
<p>ä»<code>Express 4.0</code>å¼€å§‹ï¼Œè·¯ç”±å™¨åŠŸèƒ½æˆäº†ä¸€ä¸ªå•ç‹¬çš„ç»„ä»¶<code>Express.Router</code>ã€‚å®ƒå¥½åƒå°å‹çš„<code>express</code>åº”ç”¨ç¨‹åºä¸€æ ·ï¼Œæœ‰è‡ªå·±çš„<code>use</code>ã€<code>get</code>ã€<code>param</code>å’Œ<code>route</code>æ–¹æ³•</p>
</blockquote>
<p><strong>åŸºæœ¬ç”¨æ³•</strong></p>
<blockquote>
<p>é¦–å…ˆï¼ŒExpress.Routeræ˜¯ä¸€ä¸ªæ„é€ å‡½æ•°ï¼Œè°ƒç”¨åè¿”å›ä¸€ä¸ªè·¯ç”±å™¨å®ä¾‹ã€‚ç„¶åï¼Œä½¿ç”¨è¯¥å®ä¾‹çš„HTTPåŠ¨è¯æ–¹æ³•ï¼Œä¸ºä¸åŒçš„è®¿é—®è·¯å¾„ï¼ŒæŒ‡å®šå›è°ƒå‡½æ•°ï¼›æœ€åï¼ŒæŒ‚è½½åˆ°æŸä¸ªè·¯å¾„ã€‚</p>
</blockquote>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">var router = express.Router();</span><br><span class="line"></span><br><span class="line">router.get(&#x27;/&#x27;, function(req, res) &#123;</span><br><span class="line">  res.send(&#x27;é¦–é¡µ&#x27;);</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">router.get(&#x27;/about&#x27;, function(req, res) &#123;</span><br><span class="line">  res.send(&#x27;å…³äº&#x27;);</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">app.use(&#x27;/&#x27;, router);</span><br></pre></td></tr></table></figure>

<blockquote>
<ul>
<li>ä¸Šé¢ä»£ç å…ˆå®šä¹‰äº†ä¸¤ä¸ªè®¿é—®è·¯å¾„ï¼Œç„¶åå°†å®ƒä»¬æŒ‚è½½åˆ°æ ¹ç›®å½•</li>
<li>è¿™ç§è·¯ç”±å™¨å¯ä»¥è‡ªç”±æŒ‚è½½çš„åšæ³•ï¼Œä¸ºç¨‹åºå¸¦æ¥äº†æ›´å¤§çš„çµæ´»æ€§ï¼Œæ—¢å¯ä»¥å®šä¹‰å¤šä¸ªè·¯ç”±å™¨å®ä¾‹ï¼Œä¹Ÿå¯ä»¥ä¸ºå°†åŒä¸€ä¸ªè·¯ç”±å™¨å®ä¾‹æŒ‚è½½åˆ°å¤šä¸ªè·¯å¾„ã€‚</li>
</ul>
</blockquote>
<h2 id="åå…­ã€router-routeæ–¹æ³•"><a href="#åå…­ã€router-routeæ–¹æ³•" class="headerlink" title="åå…­ã€router.routeæ–¹æ³•"></a>åå…­ã€router.routeæ–¹æ³•</h2><blockquote>
<p>routerå®ä¾‹å¯¹è±¡çš„routeæ–¹æ³•ï¼Œå¯ä»¥æ¥å—è®¿é—®è·¯å¾„ä½œä¸ºå‚æ•°</p>
</blockquote>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">var router = express.Router();</span><br><span class="line"></span><br><span class="line">router.route(&#x27;/api&#x27;)</span><br><span class="line">	.post(function(req, res) &#123;</span><br><span class="line">		// ...</span><br><span class="line">	&#125;)</span><br><span class="line">	.get(function(req, res) &#123;</span><br><span class="line">		Bear.find(function(err, bears) &#123;</span><br><span class="line">			if (err) res.send(err);</span><br><span class="line">			res.json(bears);</span><br><span class="line">		&#125;);</span><br><span class="line">	&#125;);</span><br><span class="line"></span><br><span class="line">app.use(&#x27;/&#x27;, router);</span><br></pre></td></tr></table></figure>

<h2 id="åä¸ƒã€routerä¸­é—´ä»¶"><a href="#åä¸ƒã€routerä¸­é—´ä»¶" class="headerlink" title="åä¸ƒã€routerä¸­é—´ä»¶"></a>åä¸ƒã€routerä¸­é—´ä»¶</h2><blockquote>
<p>useæ–¹æ³•ä¸ºrouterå¯¹è±¡æŒ‡å®šä¸­é—´ä»¶ï¼Œå³åœ¨æ•°æ®æ­£å¼å‘ç»™ç”¨æˆ·ä¹‹å‰ï¼Œå¯¹æ•°æ®è¿›è¡Œå¤„ç†ã€‚ä¸‹é¢å°±æ˜¯ä¸€ä¸ªä¸­é—´ä»¶çš„ä¾‹å­</p>
</blockquote>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">router.use(function(req, res, next) &#123;</span><br><span class="line">	console.log(req.method, req.url);</span><br><span class="line">	next();	</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<ul>
<li>ä¸Šé¢ä»£ç ä¸­ï¼Œå›è°ƒå‡½æ•°çš„nextå‚æ•°ï¼Œè¡¨ç¤ºæ¥å—å…¶ä»–ä¸­é—´ä»¶çš„è°ƒç”¨ã€‚å‡½æ•°ä½“ä¸­çš„next()ï¼Œè¡¨ç¤ºå°†æ•°æ®ä¼ é€’ç»™ä¸‹ä¸€ä¸ªä¸­é—´ä»¶</li>
<li>æ³¨æ„ï¼Œä¸­é—´ä»¶çš„æ”¾ç½®é¡ºåºå¾ˆé‡è¦ï¼Œç­‰åŒäºæ‰§è¡Œé¡ºåºã€‚è€Œä¸”ï¼Œä¸­é—´ä»¶å¿…é¡»æ”¾åœ¨HTTPåŠ¨è¯æ–¹æ³•ä¹‹å‰ï¼Œå¦åˆ™ä¸ä¼šæ‰§è¡Œ</li>
</ul>
<h2 id="åå…«ã€å¯¹è·¯å¾„å‚æ•°çš„å¤„ç†"><a href="#åå…«ã€å¯¹è·¯å¾„å‚æ•°çš„å¤„ç†" class="headerlink" title="åå…«ã€å¯¹è·¯å¾„å‚æ•°çš„å¤„ç†"></a>åå…«ã€å¯¹è·¯å¾„å‚æ•°çš„å¤„ç†</h2><blockquote>
<p>routerå¯¹è±¡çš„paramæ–¹æ³•ç”¨äºè·¯å¾„å‚æ•°çš„å¤„ç†ï¼Œå¯ä»¥</p>
</blockquote>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">router.param(&#x27;name&#x27;, function(req, res, next, name) &#123;</span><br><span class="line">	// å¯¹nameè¿›è¡ŒéªŒè¯æˆ–å…¶ä»–å¤„ç†â€¦â€¦</span><br><span class="line">	console.log(name);</span><br><span class="line">	req.name = name;</span><br><span class="line">	next();	</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">router.get(&#x27;/hello/:name&#x27;, function(req, res) &#123;</span><br><span class="line">	res.send(&#x27;hello &#x27; + req.name + &#x27;!&#x27;);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<blockquote>
<p>ä¸Šé¢ä»£ç ä¸­ï¼Œgetæ–¹æ³•ä¸ºè®¿é—®è·¯å¾„æŒ‡å®šäº†nameå‚æ•°ï¼Œparamæ–¹æ³•åˆ™æ˜¯å¯¹nameå‚æ•°è¿›è¡Œå¤„ç†ã€‚æ³¨æ„ï¼Œparamæ–¹æ³•å¿…é¡»æ”¾åœ¨HTTPåŠ¨è¯æ–¹æ³•ä¹‹å‰</p>
</blockquote>
<h2 id="åä¹ã€app-route"><a href="#åä¹ã€app-route" class="headerlink" title="åä¹ã€app.route"></a>åä¹ã€app.route</h2><blockquote>
<ul>
<li>å‡å®šappæ˜¯Expressçš„å®ä¾‹å¯¹è±¡ï¼ŒExpress 4.0ä¸ºè¯¥å¯¹è±¡æä¾›äº†ä¸€ä¸ªrouteå±æ€§ã€‚app.routeå®é™…ä¸Šæ˜¯express.Router()çš„ç¼©å†™å½¢å¼ï¼Œç›´æ¥æŒ‚è½½åˆ°æ ¹è·¯å¾„</li>
<li>å› æ­¤ï¼Œå¯¹åŒä¸€ä¸ªè·¯å¾„æŒ‡å®šgetå’Œpostæ–¹æ³•çš„å›è°ƒå‡½æ•°ï¼Œå¯ä»¥å†™æˆé“¾å¼å½¢å¼</li>
</ul>
</blockquote>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">app.route(&#x27;/login&#x27;)</span><br><span class="line">	.get(function(req, res) &#123;</span><br><span class="line">		res.send(&#x27;this is the login form&#x27;);</span><br><span class="line">	&#125;)</span><br><span class="line">	.post(function(req, res) &#123;</span><br><span class="line">		console.log(&#x27;processing&#x27;);</span><br><span class="line">		res.send(&#x27;processing the login form!&#x27;);</span><br><span class="line">	&#125;);</span><br></pre></td></tr></table></figure>

<h2 id="äºŒåã€ä¸Šä¼ æ–‡ä»¶"><a href="#äºŒåã€ä¸Šä¼ æ–‡ä»¶" class="headerlink" title="äºŒåã€ä¸Šä¼ æ–‡ä»¶"></a>äºŒåã€ä¸Šä¼ æ–‡ä»¶</h2><ul>
<li>é¦–å…ˆï¼Œåœ¨ç½‘é¡µæ’å…¥ä¸Šä¼ æ–‡ä»¶çš„è¡¨å•</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&lt;form action=&quot;/pictures/upload&quot; method=&quot;POST&quot; enctype=&quot;multipart/form-data&quot;&gt;</span><br><span class="line">  Select an image to upload:</span><br><span class="line">  &lt;input type=&quot;file&quot; name=&quot;image&quot;&gt;</span><br><span class="line">  &lt;input type=&quot;submit&quot; value=&quot;Upload Image&quot;&gt;</span><br><span class="line">&lt;/form&gt;</span><br></pre></td></tr></table></figure>

<blockquote>
<p>ç„¶åï¼ŒæœåŠ¡å™¨è„šæœ¬å»ºç«‹æŒ‡å‘&#x2F;uploadç›®å½•çš„è·¯ç”±ã€‚è¿™æ—¶å¯ä»¥å®‰è£…multeræ¨¡å—ï¼Œå®ƒæä¾›äº†ä¸Šä¼ æ–‡ä»¶çš„è®¸å¤šåŠŸèƒ½</p>
</blockquote>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">var express = require(&#x27;express&#x27;);</span><br><span class="line">var router = express.Router();</span><br><span class="line">var multer = require(&#x27;multer&#x27;);</span><br><span class="line"></span><br><span class="line">var uploading = multer(&#123;</span><br><span class="line">  dest: __dirname + &#x27;../public/uploads/&#x27;,</span><br><span class="line">  // è®¾å®šé™åˆ¶ï¼Œæ¯æ¬¡æœ€å¤šä¸Šä¼ 1ä¸ªæ–‡ä»¶ï¼Œæ–‡ä»¶å¤§å°ä¸è¶…è¿‡1MB</span><br><span class="line">  limits: &#123;fileSize: 1000000, files:1&#125;,</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line">router.post(&#x27;/upload&#x27;, uploading, function(req, res) &#123;</span><br><span class="line"></span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line">module.exports = router</span><br></pre></td></tr></table></figure>
        
    </article>
    <footer class="cube-excerpt-footer">
        <a class="cube-excerpt-more" href="/2019/06/07/nodejs/express/">Read More</a>
    </footer>
</div>

<div class="cube-excerpt" id="cube-excerpt-nodejs-websockerä¸socket.ioçš„åŒºåˆ«">
    <header class="cube-excerpt-header">
        <h1><a href="/2019/05/26/nodejs/nodejs-websocker%E4%B8%8Esocket.io%E7%9A%84%E5%8C%BA%E5%88%AB/">nodejs-websockerä¸socket.ioçš„åŒºåˆ«</a></h1>
        <div class="cube-excerpt-header-msg">
            <div class="cube-excerpt-date">
                <i class="cube-icon cube-icon-date" aria-hidden="true"></i>
                2019-05-26
            </div>
            <div class="cube-excerpt-tags">
                <i class="cube-icon cube-icon-tag" aria-hidden="true"></i>
                
                <a href="/tags/nodejs/" class="cube-excerpt-tag-link">#nodejs</a>
                
            </div>
        </div>
    </header>
    <article class="cube-excerpt-entry cube-markdown">
        
        
           <h1 id="ç¬¬ä¸€éƒ¨åˆ†-WebSocket"><a href="#ç¬¬ä¸€éƒ¨åˆ†-WebSocket" class="headerlink" title="ç¬¬ä¸€éƒ¨åˆ† WebSocket"></a>ç¬¬ä¸€éƒ¨åˆ† WebSocket</h1><h2 id="ä¸€ã€WebSocket-è§£å†³äº†ä»€ä¹ˆé—®é¢˜"><a href="#ä¸€ã€WebSocket-è§£å†³äº†ä»€ä¹ˆé—®é¢˜" class="headerlink" title="ä¸€ã€WebSocket è§£å†³äº†ä»€ä¹ˆé—®é¢˜"></a>ä¸€ã€WebSocket è§£å†³äº†ä»€ä¹ˆé—®é¢˜</h2><ul>
<li>å®¢æˆ·ç«¯(æµè§ˆå™¨)å’ŒæœåŠ¡å™¨ç«¯è¿›è¡Œé€šä¿¡ï¼Œåªèƒ½ç”±å®¢æˆ·ç«¯å‘èµ·<code>ajax</code>è¯·æ±‚ï¼Œæ‰èƒ½è¿›è¡Œé€šä¿¡ï¼ŒæœåŠ¡å™¨ç«¯æ— æ³•ä¸»åŠ¨å‘å®¢æˆ·ç«¯æ¨é€ä¿¡æ¯</li>
<li>å½“å‡ºç°ç±»ä¼¼ä½“è‚²èµ›äº‹ã€èŠå¤©å®¤ã€å®æ—¶ä½ç½®ä¹‹ç±»çš„åœºæ™¯æ—¶ï¼Œå®¢æˆ·ç«¯è¦è·å–æœåŠ¡å™¨ç«¯çš„å˜åŒ–ï¼Œå°±åªèƒ½é€šè¿‡è½®è¯¢(å®šæ—¶è¯·æ±‚)æ¥äº†è§£æœåŠ¡å™¨ç«¯æœ‰æ²¡æœ‰æ–°çš„ä¿¡æ¯å˜åŒ–</li>
</ul>
<p>è½®è¯¢æ•ˆç‡ä½ï¼Œéå¸¸æµªè´¹èµ„æº(éœ€è¦ä¸æ–­å‘é€è¯·æ±‚ï¼Œä¸åœé“¾æ¥æœåŠ¡å™¨)</p>
<blockquote>
<p><code>WebSocket</code>çš„å‡ºç°ï¼Œè®©æœåŠ¡å™¨ç«¯å¯ä»¥ä¸»åŠ¨å‘æœåŠ¡å™¨ç«¯å‘é€ä¿¡æ¯ï¼Œä½¿å¾—æµè§ˆå™¨å…·å¤‡äº†å®æ—¶åŒå‘é€šä¿¡çš„èƒ½åŠ›,è¿™å°±æ˜¯<code>WebSocket</code>è§£å†³çš„é—®é¢˜</p>
</blockquote>
<p><strong>ä¸€ä¸ªè¶…ç®€å•ä¾‹å­</strong></p>
<blockquote>
<p>æ–°å»ºä¸€ä¸ª<code>html</code>æ–‡ä»¶ï¼Œå°†æœ¬æ —å­æ‰¾ä¸ªåœ°æ–¹è·‘ä¸€ä¸‹è¯•è¯•ï¼Œå³å¯è½»æ¾å…¥é—¨<code>WebSocket</code></p>
</blockquote>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">function socketConnect(url) &#123;</span><br><span class="line">    // å®¢æˆ·ç«¯ä¸æœåŠ¡å™¨è¿›è¡Œè¿æ¥</span><br><span class="line">    let ws = new WebSocket(url); // è¿”å›`WebSocket`å¯¹è±¡ï¼Œèµ‹å€¼ç»™å˜é‡ws</span><br><span class="line">    // è¿æ¥æˆåŠŸå›è°ƒ</span><br><span class="line">    ws.onopen = e =&gt; &#123;</span><br><span class="line">        console.log(&#x27;è¿æ¥æˆåŠŸ&#x27;, e)</span><br><span class="line">        ws.send(&#x27;æˆ‘å‘é€æ¶ˆæ¯ç»™æœåŠ¡ç«¯&#x27;); // å®¢æˆ·ç«¯ä¸æœåŠ¡å™¨ç«¯é€šä¿¡</span><br><span class="line">    &#125;</span><br><span class="line">    // ç›‘å¬æœåŠ¡å™¨ç«¯è¿”å›çš„ä¿¡æ¯</span><br><span class="line">    ws.onmessage = e =&gt; &#123;</span><br><span class="line">        console.log(&#x27;æœåŠ¡å™¨ç«¯è¿”å›ï¼š&#x27;, e.data)</span><br><span class="line">        // do something</span><br><span class="line">    &#125;</span><br><span class="line">    return ws; // è¿”å›websocketå¯¹è±¡</span><br><span class="line">&#125;</span><br><span class="line">let wsValue = socketConnect(&#x27;ws://121.40.165.18:8800&#x27;); // websocketå¯¹è±¡</span><br></pre></td></tr></table></figure>

<blockquote>
<p>ä¸Šè¿°æ —å­ä¸­<code>WebSocket</code>çš„æ¥å£åœ°å€å‡ºè‡ªï¼š<code>WebSocket</code> åœ¨çº¿æµ‹è¯•ï¼Œåœ¨å¼€å‘çš„æ—¶å€™ä¹Ÿå¯ä»¥ç”¨äºæµ‹è¯•åç«¯ç»™çš„åœ°å€æ˜¯å¦å¯ç”¨</p>
</blockquote>
<p><img src="https://poetries1.gitee.io/img-repo/2019/10/389.png" alt="img"></p>
<h2 id="äºŒã€webSocketçš„classç±»"><a href="#äºŒã€webSocketçš„classç±»" class="headerlink" title="äºŒã€webSocketçš„classç±»"></a>äºŒã€webSocketçš„classç±»</h2><blockquote>
<p>å½“é¡¹ç›®ä¸­å¾ˆå¤šåœ°æ–¹ä½¿ç”¨<code>WebSocket</code>ï¼ŒæŠŠå®ƒå°æˆä¸€ä¸ª<code>class</code>ç±»ï¼Œæ˜¯æ›´å¥½çš„é€‰æ‹©</p>
</blockquote>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br></pre></td><td class="code"><pre><span class="line">class WebSocketClass &#123;</span><br><span class="line">    /**</span><br><span class="line">     * @description: åˆå§‹åŒ–å®ä¾‹å±æ€§ï¼Œä¿å­˜å‚æ•°</span><br><span class="line">     * @param &#123;String&#125; url wsçš„æ¥å£</span><br><span class="line">     * @param &#123;Function&#125; msgCallback æœåŠ¡å™¨ä¿¡æ¯çš„å›è°ƒä¼ æ•°æ®ç»™å‡½æ•°</span><br><span class="line">     * @param &#123;String&#125; name å¯é€‰å€¼ ç”¨äºåŒºåˆ†wsï¼Œç”¨äºdebugger</span><br><span class="line">     */</span><br><span class="line">    constructor(url, msgCallback, name = &#x27;default&#x27;) &#123;</span><br><span class="line">        this.url = url;</span><br><span class="line">        this.msgCallback = msgCallback;</span><br><span class="line">        this.name = name;</span><br><span class="line">        this.ws = null;  // websocketå¯¹è±¡</span><br><span class="line">        this.status = null; // websocketæ˜¯å¦å…³é—­</span><br><span class="line">    &#125;</span><br><span class="line">    /**</span><br><span class="line">     * @description: åˆå§‹åŒ– è¿æ¥websocketæˆ–é‡è¿webSocketæ—¶è°ƒç”¨</span><br><span class="line">     * @param &#123;*&#125; å¯é€‰å€¼ è¦ä¼ çš„æ•°æ®</span><br><span class="line">     */</span><br><span class="line">    connect(data) &#123;</span><br><span class="line">        // æ–°å»º WebSocket å®ä¾‹</span><br><span class="line">        this.ws = new WebSocket(this.url);</span><br><span class="line">        this.ws.onopen = e =&gt; &#123;</span><br><span class="line">            // è¿æ¥wsæˆåŠŸå›è°ƒ</span><br><span class="line">            this.status = &#x27;open&#x27;;</span><br><span class="line">            console.log(`$&#123;this.name&#125;è¿æ¥æˆåŠŸ`, e)</span><br><span class="line">            // this.heartCheck();</span><br><span class="line">            if (data !== undefined) &#123;</span><br><span class="line">                // æœ‰è¦ä¼ çš„æ•°æ®,å°±å‘ç»™åç«¯</span><br><span class="line">                return this.ws.send(data);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        // ç›‘å¬æœåŠ¡å™¨ç«¯è¿”å›çš„ä¿¡æ¯</span><br><span class="line">        this.ws.onmessage = e =&gt; &#123;</span><br><span class="line">            // æŠŠæ•°æ®ä¼ ç»™å›è°ƒå‡½æ•°ï¼Œå¹¶æ‰§è¡Œå›è°ƒ</span><br><span class="line">            // if (e.data === &#x27;pong&#x27;) &#123;</span><br><span class="line">            //     this.pingPong = &#x27;pong&#x27;; // æœåŠ¡å™¨ç«¯è¿”å›pong,ä¿®æ”¹pingPongçš„çŠ¶æ€</span><br><span class="line">            // &#125;</span><br><span class="line">            return this.msgCallback(e.data);</span><br><span class="line">        &#125;</span><br><span class="line">        // wså…³é—­å›è°ƒ</span><br><span class="line">        this.ws.onclose = e =&gt; &#123;</span><br><span class="line">            this.closeHandle(e); // åˆ¤æ–­æ˜¯å¦å…³é—­</span><br><span class="line">        &#125;</span><br><span class="line">        // wså‡ºé”™å›è°ƒ</span><br><span class="line">        this.onerror = e =&gt; &#123;</span><br><span class="line">            this.closeHandle(e); // åˆ¤æ–­æ˜¯å¦å…³é—­</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    // heartCheck() &#123;</span><br><span class="line">    //     // å¿ƒè·³æœºåˆ¶çš„æ—¶é—´å¯ä»¥è‡ªå·±ä¸åç«¯çº¦å®š</span><br><span class="line">    //     this.pingPong = &#x27;ping&#x27;; // wsçš„å¿ƒè·³æœºåˆ¶çŠ¶æ€å€¼</span><br><span class="line">    //     this.pingInterval = setInterval(() =&gt; &#123;</span><br><span class="line">    //         if (this.ws.readyState === 1) &#123;</span><br><span class="line">    //             // æ£€æŸ¥wsä¸ºé“¾æ¥çŠ¶æ€ æ‰å¯å‘é€</span><br><span class="line">    //             this.ws.send(&#x27;ping&#x27;); // å®¢æˆ·ç«¯å‘é€ping</span><br><span class="line">    //         &#125;</span><br><span class="line">    //     &#125;, 10000)</span><br><span class="line">    //     this.pongInterval = setInterval(() =&gt; &#123;</span><br><span class="line">    //         this.pingPong = false;</span><br><span class="line">    //         if (this.pingPong === &#x27;ping&#x27;) &#123;</span><br><span class="line">    //             this.closeHandle(&#x27;pingPongæ²¡æœ‰æ”¹å˜ä¸ºpong&#x27;); // æ²¡æœ‰è¿”å›pong é‡å¯webSocket</span><br><span class="line">    //         &#125;</span><br><span class="line">    //         // é‡ç½®ä¸ºping è‹¥ä¸‹ä¸€æ¬¡ ping å‘é€å¤±è´¥ æˆ–è€…pongè¿”å›å¤±è´¥(pingPongä¸ä¼šæ”¹æˆpong)ï¼Œå°†é‡å¯</span><br><span class="line">    //         console.log(&#x27;è¿”å›pong&#x27;)</span><br><span class="line">    //         this.pingPong = &#x27;ping&#x27;</span><br><span class="line">    //     &#125;, 20000)</span><br><span class="line">    // &#125;</span><br><span class="line">    // å‘é€ä¿¡æ¯ç»™æœåŠ¡å™¨</span><br><span class="line">    sendHandle(data) &#123;</span><br><span class="line">        console.log(`$&#123;this.name&#125;å‘é€æ¶ˆæ¯ç»™æœåŠ¡å™¨:`, data)</span><br><span class="line">        return this.ws.send(data);</span><br><span class="line">    &#125;</span><br><span class="line">    closeHandle(e = &#x27;err&#x27;) &#123;</span><br><span class="line">        // å› ä¸ºwebSocketå¹¶ä¸ç¨³å®šï¼Œè§„å®šåªèƒ½æ‰‹åŠ¨å…³é—­(è°ƒcloseMyselfæ–¹æ³•)ï¼Œå¦åˆ™å°±é‡è¿</span><br><span class="line">        if (this.status !== &#x27;close&#x27;) &#123;</span><br><span class="line">            console.log(`$&#123;this.name&#125;æ–­å¼€ï¼Œé‡è¿websocket`, e)</span><br><span class="line">            // if (this.pingInterval !== undefined &amp;&amp; this.pongInterval !== undefined) &#123;</span><br><span class="line">            //     // æ¸…é™¤å®šæ—¶å™¨</span><br><span class="line">            //     clearInterval(this.pingInterval);</span><br><span class="line">            //     clearInterval(this.pongInterval);</span><br><span class="line">            // &#125;</span><br><span class="line">            this.connect(); // é‡è¿</span><br><span class="line">        &#125; else &#123;</span><br><span class="line">            console.log(`$&#123;this.name&#125;websocketæ‰‹åŠ¨å…³é—­`)</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    // æ‰‹åŠ¨å…³é—­WebSocket</span><br><span class="line">    closeMyself() &#123;</span><br><span class="line">        console.log(`å…³é—­$&#123;this.name&#125;`)</span><br><span class="line">        this.status = &#x27;close&#x27;;</span><br><span class="line">        return this.ws.close();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">function someFn(data) &#123;</span><br><span class="line">    console.log(&#x27;æ¥æ”¶æœåŠ¡å™¨æ¶ˆæ¯çš„å›è°ƒï¼š&#x27;, data);</span><br><span class="line">&#125;</span><br><span class="line">// const wsValue = new WebSocketClass(&#x27;ws://121.40.165.18:8800&#x27;, someFn, &#x27;wsName&#x27;); // è¿™ä¸ªé“¾æ¥ä¸€å¤©åªèƒ½å‘é€æ¶ˆæ¯50æ¬¡</span><br><span class="line">const wsValue = new WebSocketClass(&#x27;wss://echo.websocket.org&#x27;, someFn, &#x27;wsName&#x27;); // é˜®ä¸€å³°è€å¸ˆæ•™ç¨‹é“¾æ¥</span><br><span class="line">wsValue.connect(&#x27;ç«‹å³ä¸æœåŠ¡å™¨é€šä¿¡&#x27;); // è¿æ¥æœåŠ¡å™¨</span><br><span class="line">// setTimeout(() =&gt; &#123;</span><br><span class="line">//     wsValue.sendHandle(&#x27;ä¼ æ¶ˆæ¯ç»™æœåŠ¡å™¨&#x27;)</span><br><span class="line">// &#125;, 1000);</span><br><span class="line">// setTimeout(() =&gt; &#123;</span><br><span class="line">//     wsValue.closeMyself(); // å…³é—­ws</span><br><span class="line">// &#125;, 10000)</span><br></pre></td></tr></table></figure>

<blockquote>
<p>å¯ä»¥æŠŠ<code>class</code>æ”¾åœ¨ä¸€ä¸ªjsæ–‡ä»¶é‡Œé¢,<code>export</code>å‡ºå»ï¼Œç„¶ååœ¨éœ€è¦ç”¨çš„åœ°æ–¹å†<code>import</code>è¿›æ¥ï¼ŒæŠŠå‚æ•°ä¼ è¿›å»å°±å¯ä»¥ç”¨äº†</p>
</blockquote>
<h2 id="ä¸‰ã€WebSocketä¸ç¨³å®š"><a href="#ä¸‰ã€WebSocketä¸ç¨³å®š" class="headerlink" title="ä¸‰ã€WebSocketä¸ç¨³å®š"></a>ä¸‰ã€WebSocketä¸ç¨³å®š</h2><blockquote>
<p><code>WebSocket</code>å¹¶ä¸ç¨³å®šï¼Œåœ¨ä½¿ç”¨ä¸€æ®µæ—¶é—´åï¼Œå¯èƒ½ä¼šæ–­å¼€è¿æ¥ï¼Œè²Œä¼¼è‡³ä»Šæ²¡æœ‰ä¸€ä¸ªä¸ºä½•ä¼šæ–­å¼€è¿æ¥çš„å…¬è®ºï¼Œæ‰€ä»¥æˆ‘ä»¬éœ€è¦è®©<code>WebSocket</code>ä¿æŒè¿æ¥çŠ¶æ€ï¼Œè¿™é‡Œæ¨èä¸¤ç§æ–¹æ³•</p>
</blockquote>
<h3 id="3-1-WebSocketè®¾ç½®å˜é‡ï¼Œåˆ¤æ–­æ˜¯å¦æ‰‹åŠ¨å…³é—­è¿æ¥"><a href="#3-1-WebSocketè®¾ç½®å˜é‡ï¼Œåˆ¤æ–­æ˜¯å¦æ‰‹åŠ¨å…³é—­è¿æ¥" class="headerlink" title="3.1 WebSocketè®¾ç½®å˜é‡ï¼Œåˆ¤æ–­æ˜¯å¦æ‰‹åŠ¨å…³é—­è¿æ¥"></a>3.1 WebSocketè®¾ç½®å˜é‡ï¼Œåˆ¤æ–­æ˜¯å¦æ‰‹åŠ¨å…³é—­è¿æ¥</h3><blockquote>
<p><code>class</code>ç±»ä¸­å°±æ˜¯ç”¨çš„è¿™ç§æ–¹å¼:è®¾ç½®ä¸€ä¸ªå˜é‡ï¼Œåœ¨<code>webSocket</code>å…³é—­&#x2F;æŠ¥é”™çš„å›è°ƒä¸­ï¼Œåˆ¤æ–­æ˜¯ä¸æ˜¯æ‰‹åŠ¨å…³é—­çš„ï¼Œå¦‚æœä¸æ˜¯çš„è¯ï¼Œå°±é‡æ–°è¿æ¥ï¼Œè¿™æ ·åšçš„ä¼˜ç¼ºç‚¹å¦‚ä¸‹</p>
</blockquote>
<ul>
<li>ä¼˜ç‚¹ï¼šè¯·æ±‚è¾ƒå°‘(ç›¸å¯¹äºå¿ƒè·³è¿æ¥)ï¼Œæ˜“è®¾ç½®ã€‚</li>
<li>ç¼ºç‚¹ï¼šå¯èƒ½ä¼šå¯¼è‡´ä¸¢å¤±æ•°æ®,åœ¨æ–­å¼€é‡è¿çš„è¿™æ®µæ—¶é—´ä¸­ï¼Œæ°å¥½åŒæ–¹æ­£åœ¨é€šä¿¡</li>
</ul>
<h3 id="3-2-WebSocketå¿ƒè·³æœºåˆ¶"><a href="#3-2-WebSocketå¿ƒè·³æœºåˆ¶" class="headerlink" title="3.2 WebSocketå¿ƒè·³æœºåˆ¶"></a>3.2 WebSocketå¿ƒè·³æœºåˆ¶</h3><blockquote>
<p>å› ä¸ºç¬¬ä¸€ç§æ–¹æ¡ˆçš„ç¼ºç‚¹ï¼Œå¹¶ä¸”å¯èƒ½ä¼šæœ‰å…¶ä»–ä¸€äº›æœªçŸ¥æƒ…å†µå¯¼è‡´æ–­å¼€è¿æ¥è€Œæ²¡æœ‰è§¦å‘Erroræˆ–Closeäº‹ä»¶ã€‚è¿™æ ·å°±å¯¼è‡´å®é™…è¿æ¥å·²ç»æ–­å¼€äº†ï¼Œè€Œå®¢æˆ·ç«¯å’ŒæœåŠ¡ç«¯å´ä¸çŸ¥é“ï¼Œè¿˜åœ¨å‚»å‚»çš„ç­‰ç€æ¶ˆæ¯æ¥</p>
</blockquote>
<ul>
<li>æƒ³å‡ºäº†ä¸€ç§å«åšå¿ƒè·³æœºåˆ¶çš„è§£å†³æ–¹æ³•ï¼š</li>
<li>å®¢æˆ·ç«¯å°±åƒå¿ƒè·³ä¸€æ ·æ¯éš”å›ºå®šçš„æ—¶é—´å‘é€ä¸€æ¬¡pingï¼Œæ¥å‘Šè¯‰æœåŠ¡å™¨ï¼Œæˆ‘è¿˜æ´»ç€ï¼Œè€ŒæœåŠ¡å™¨ä¹Ÿä¼šè¿”å›pongï¼Œæ¥å‘Šè¯‰å®¢æˆ·ç«¯ï¼ŒæœåŠ¡å™¨è¿˜æ´»ç€ã€‚</li>
<li>å…·ä½“çš„å®ç°æ–¹æ³•ï¼Œåœ¨ä¸Šé¢<code>class</code>çš„æ³¨é‡Šä¸­ï¼Œå°†å…¶æ‰“å¼€ï¼Œå³å¯çœ‹åˆ°æ•ˆæœ</li>
</ul>
<h2 id="å››ã€å…³äºWebSocket"><a href="#å››ã€å…³äºWebSocket" class="headerlink" title="å››ã€å…³äºWebSocket"></a>å››ã€å…³äºWebSocket</h2><h3 id="4-1-WebSocketçš„å½“å‰çŠ¶æ€-WebSocket-readyState"><a href="#4-1-WebSocketçš„å½“å‰çŠ¶æ€-WebSocket-readyState" class="headerlink" title="4.1 WebSocketçš„å½“å‰çŠ¶æ€:WebSocket.readyState"></a>4.1 WebSocketçš„å½“å‰çŠ¶æ€:<code>WebSocket.readyState</code></h3><p><strong>ä¸‹é¢æ˜¯WebSocket.readyStateçš„å››ä¸ªå€¼(å››ç§çŠ¶æ€)ï¼š</strong></p>
<ul>
<li><code>0</code>: è¡¨ç¤ºæ­£åœ¨è¿æ¥</li>
<li><code>1</code>: è¡¨ç¤ºè¿æ¥æˆåŠŸï¼Œå¯ä»¥é€šä¿¡äº†</li>
<li><code>2</code>: è¡¨ç¤ºè¿æ¥æ­£åœ¨å…³é—­</li>
<li><code>3</code>: è¡¨ç¤ºè¿æ¥å·²ç»å…³é—­ï¼Œæˆ–è€…æ‰“å¼€è¿æ¥å¤±è´¥</li>
</ul>
<blockquote>
<p>æˆ‘ä»¬å¯ä»¥åˆ©ç”¨å½“å‰çŠ¶æ€æ¥åšä¸€äº›äº‹æƒ…ï¼Œæ¯”å¦‚ä¸Šé¢æ —å­ä¸­å½“<code>WebSocket</code>é“¾æ¥æˆåŠŸåï¼Œæ‰å…è®¸å®¢æˆ·ç«¯å‘<code>é€ping</code></p>
</blockquote>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">if (this.ws.readyState === 1) &#123;</span><br><span class="line">    // æ£€æŸ¥wsä¸ºé“¾æ¥çŠ¶æ€ æ‰å¯å‘é€</span><br><span class="line">    this.ws.send(&#x27;ping&#x27;); // å®¢æˆ·ç«¯å‘é€ping</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="4-2-WebSocketè¿˜å¯ä»¥å‘é€-x2F-æ¥æ”¶-äºŒè¿›åˆ¶æ•°æ®"><a href="#4-2-WebSocketè¿˜å¯ä»¥å‘é€-x2F-æ¥æ”¶-äºŒè¿›åˆ¶æ•°æ®" class="headerlink" title="4.2 WebSocketè¿˜å¯ä»¥å‘é€&#x2F;æ¥æ”¶ äºŒè¿›åˆ¶æ•°æ®"></a>4.2 <code>WebSocket</code>è¿˜å¯ä»¥å‘é€&#x2F;æ¥æ”¶ äºŒè¿›åˆ¶æ•°æ®</h3><blockquote>
<p>äºŒè¿›åˆ¶æ•°æ®åŒ…æ‹¬ï¼š<code>blob</code>å¯¹è±¡å’Œ<code>Arraybuffer</code>å¯¹è±¡ï¼Œæ‰€ä»¥æˆ‘ä»¬éœ€è¦åˆ†å¼€æ¥å¤„ç†</p>
</blockquote>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"> // æ¥æ”¶æ•°æ®</span><br><span class="line">ws.onmessage = function(event)&#123;</span><br><span class="line">    if(event.data instanceof ArrayBuffer)&#123;</span><br><span class="line">        // åˆ¤æ–­ ArrayBuffer å¯¹è±¡</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    if(event.data instanceof Blob)&#123;</span><br><span class="line">        // åˆ¤æ–­ Blob å¯¹è±¡</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">// å‘é€ Blob å¯¹è±¡çš„ä¾‹å­</span><br><span class="line">let file = document.querySelector(&#x27;input[type=&quot;file&quot;]&#x27;).files[0];</span><br><span class="line">ws.send(file);</span><br><span class="line"></span><br><span class="line">// å‘é€ ArrayBuffer å¯¹è±¡çš„ä¾‹å­</span><br><span class="line">var img = canvas_context.getImageData(0, 0, 400, 320);</span><br><span class="line">var binary = new Uint8Array(img.data.length);</span><br><span class="line">for (var i = 0; i &lt; img.data.length; i++) &#123;</span><br><span class="line">    binary[i] = img.data[i];</span><br><span class="line">&#125;</span><br><span class="line">ws.send(binary.buffer);</span><br></pre></td></tr></table></figure>

<blockquote>
<p>å¦‚æœä½ è¦å‘é€çš„äºŒè¿›åˆ¶æ•°æ®å¾ˆå¤§çš„è¯ï¼Œå¦‚ä½•åˆ¤æ–­å‘é€å®Œæ¯•ï¼š</p>
</blockquote>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">webSocket.bufferedAmountå±æ€§ï¼Œè¡¨ç¤ºè¿˜æœ‰å¤šå°‘å­—èŠ‚çš„äºŒè¿›åˆ¶æ•°æ®æ²¡æœ‰å‘é€å‡ºå»ï¼š</span><br><span class="line"></span><br><span class="line">var data = new ArrayBuffer(10000000);</span><br><span class="line">socket.send(data);</span><br><span class="line">if (socket.bufferedAmount === 0) &#123;</span><br><span class="line">    // å‘é€å®Œæ¯•</span><br><span class="line">&#125; else &#123;</span><br><span class="line">    // å‘é€è¿˜æ²¡ç»“æŸ</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="äº”ã€WebSocketçš„ä¼˜ç‚¹"><a href="#äº”ã€WebSocketçš„ä¼˜ç‚¹" class="headerlink" title="äº”ã€WebSocketçš„ä¼˜ç‚¹"></a>äº”ã€WebSocketçš„ä¼˜ç‚¹</h2><ul>
<li>åŒå‘é€šä¿¡</li>
<li>æ•°æ®æ ¼å¼æ¯”è¾ƒè½»é‡ï¼Œæ€§èƒ½å¼€é”€å°ï¼Œé€šä¿¡é«˜æ•ˆ<ul>
<li>åè®®æ§åˆ¶çš„æ•°æ®åŒ…å¤´éƒ¨è¾ƒå°ï¼Œè€Œ<code>HTTP</code>åè®®æ¯æ¬¡é€šä¿¡éƒ½éœ€è¦æºå¸¦å®Œæ•´çš„å¤´éƒ¨</li>
</ul>
</li>
<li>æ›´å¥½çš„äºŒè¿›åˆ¶æ”¯æŒ</li>
<li>æ²¡æœ‰åŒæºé™åˆ¶ï¼Œå®¢æˆ·ç«¯å¯ä»¥ä¸ä»»æ„æœåŠ¡å™¨é€šä¿¡</li>
<li>ä¸ <code>HTTP</code> åè®®æœ‰ç€è‰¯å¥½çš„å…¼å®¹æ€§ã€‚é»˜è®¤ç«¯å£ä¹Ÿæ˜¯<code>80</code>å’Œ<code>443</code>ï¼Œå¹¶ä¸”æ¡æ‰‹é˜¶æ®µé‡‡ç”¨ <code>HTTP</code> åè®®ï¼Œå› æ­¤æ¡æ‰‹æ—¶ä¸å®¹æ˜“å±è”½ï¼Œèƒ½é€šè¿‡å„ç§ <code>HTTP</code> ä»£ç†æœåŠ¡å™¨</li>
</ul>
<h1 id="ç¬¬äºŒéƒ¨åˆ†-socket-io"><a href="#ç¬¬äºŒéƒ¨åˆ†-socket-io" class="headerlink" title="ç¬¬äºŒéƒ¨åˆ† socket.io"></a>ç¬¬äºŒéƒ¨åˆ† <code>socket.io</code></h1><h2 id="ä¸€ã€åŸç”ŸNodeä¸socket-ioé€šä¿¡"><a href="#ä¸€ã€åŸç”ŸNodeä¸socket-ioé€šä¿¡" class="headerlink" title="ä¸€ã€åŸç”ŸNodeä¸socket.ioé€šä¿¡"></a>ä¸€ã€åŸç”ŸNodeä¸socket.ioé€šä¿¡</h2><blockquote>
<p>åŸç”Ÿ<code>nodejs</code>ç»“åˆ<code>Socket.io</code>å®ç°æœåŠ¡å™¨å’Œå®¢æˆ·ç«¯çš„ç›¸äº’é€šä¿¡</p>
</blockquote>
<blockquote>
<p>å®˜æ–¹æ–‡æ¡£ <a target="_blank" rel="noopener" href="https://socket.io/">https://socket.io</a></p>
</blockquote>
<h3 id="1-1-æ­å»ºæœåŠ¡"><a href="#1-1-æ­å»ºæœåŠ¡" class="headerlink" title="1.1 æ­å»ºæœåŠ¡"></a>1.1 æ­å»ºæœåŠ¡</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"># æ–°å»ºç›®å½•</span><br><span class="line">mkdir socket &amp;&amp; cd socket</span><br><span class="line"></span><br><span class="line"># ç”Ÿæˆpackage.json</span><br><span class="line">npm init -y</span><br><span class="line"></span><br><span class="line"># å®‰è£…socket</span><br><span class="line">npm install socket.io</span><br><span class="line">// app.js</span><br><span class="line"></span><br><span class="line">var http = require(&quot;http&quot;);</span><br><span class="line"></span><br><span class="line">var server = http.createServer(function(req,res)&#123;</span><br><span class="line">    if(req.url == &quot;/&quot;)&#123; //æ˜¾ç¤ºé¦–é¡µ</span><br><span class="line">        fs.readFile(&quot;./index.html&quot;,function(err,data)&#123; </span><br><span class="line">            res.end(data);</span><br><span class="line">        &#125;); </span><br><span class="line">    &#125;</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">var io = require(&#x27;socket.io&#x27;)(server);</span><br><span class="line"></span><br><span class="line">//ç›‘å¬è¿æ¥äº‹ä»¶ </span><br><span class="line">io.on(&quot;connection&quot;,function(socket)&#123;</span><br><span class="line">    console.log(&quot;1 ä¸ªå®¢æˆ·ç«¯è¿æ¥äº†&quot;); </span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line">server.listen(3000,&quot;127.0.0.1&quot;,function()&#123;</span><br><span class="line">    console.log(&#x27;app run at 127.0.0.1:3000&#x27;)</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">// å†™å®Œè¿™å¥è¯ä¹‹åï¼Œä½ å°±ä¼šå‘ç°ï¼Œhttp://127.0.0.1:3000/socket.io/socket.io.js å°±æ˜¯ä¸€ä¸ª js æ–‡ä»¶ çš„åœ°å€äº†</span><br></pre></td></tr></table></figure>

<h3 id="1-2-æ–°å»ºé¡µé¢"><a href="#1-2-æ–°å»ºé¡µé¢" class="headerlink" title="1.2 æ–°å»ºé¡µé¢"></a>1.2 æ–°å»ºé¡µé¢</h3><blockquote>
<p>ç°åœ¨éœ€è¦åˆ¶ä½œä¸€ä¸ª<code>index</code>é¡µé¢ï¼Œè¿™ä¸ªé¡µé¢ä¸­ï¼Œå¿…é¡»å¼•ç”¨ç§˜å¯†<code>js</code>æ–‡ä»¶ã€‚è°ƒç”¨<code>io</code>å‡½æ•°ï¼Œå–å¾—<code>socket</code> å¯¹è±¡</p>
</blockquote>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">&lt;!DOCTYPE html&gt; &lt;html lang=&quot;en&quot;&gt; &lt;head&gt;</span><br><span class="line">&lt;meta charset=&quot;UTF-8&quot;&gt;</span><br><span class="line">&lt;title&gt;Document&lt;/title&gt; &lt;/head&gt;</span><br><span class="line">&lt;body&gt;</span><br><span class="line"></span><br><span class="line">&lt;h1&gt;æˆ‘æ˜¯ index é¡µé¢ï¼Œæˆ‘å¼•ç”¨äº†ç§˜å¯† script æ–‡ä»¶&lt;/h1&gt;</span><br><span class="line"></span><br><span class="line">&lt;script type=&quot;text/javascript&quot; src=&quot;/socket.io/socket.io.js&quot;&gt;&lt;/script&gt; &lt;script type=&quot;text/javascript&quot;&gt;</span><br><span class="line">    var socket = io(); </span><br><span class="line">    console.log(socket)</span><br><span class="line">&lt;/script&gt;</span><br><span class="line"></span><br><span class="line">&lt;/body&gt; </span><br><span class="line">&lt;/html&gt;</span><br></pre></td></tr></table></figure>

<blockquote>
<p>è‡³æ­¤ï¼ŒæœåŠ¡å™¨å’Œå®¢æˆ·ç«¯éƒ½æœ‰ <code>socket</code> å¯¹è±¡äº†ã€‚æœåŠ¡å™¨çš„ <code>socket</code> å¯¹è±¡:</p>
</blockquote>
<blockquote>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">socketå¯¹è±¡</span><br></pre></td></tr></table></figure>
</blockquote>
<p><img src="https://poetries1.gitee.io/img-repo/2019/10/390.png" alt="img"><br><img src="https://poetries1.gitee.io/img-repo/2019/10/391.png" alt="img"></p>
<h3 id="1-3-æœåŠ¡å™¨ç«¯é€šè¿‡emitå¹¿æ’­ï¼Œé€šè¿‡onæ¥æ”¶å¹¿æ’­"><a href="#1-3-æœåŠ¡å™¨ç«¯é€šè¿‡emitå¹¿æ’­ï¼Œé€šè¿‡onæ¥æ”¶å¹¿æ’­" class="headerlink" title="1.3 æœåŠ¡å™¨ç«¯é€šè¿‡emitå¹¿æ’­ï¼Œé€šè¿‡onæ¥æ”¶å¹¿æ’­"></a>1.3 æœåŠ¡å™¨ç«¯é€šè¿‡emitå¹¿æ’­ï¼Œé€šè¿‡onæ¥æ”¶å¹¿æ’­</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line">// app.js</span><br><span class="line"></span><br><span class="line">var http = require(&quot;http&quot;);</span><br><span class="line"></span><br><span class="line">var server = http.createServer(function(req,res)&#123;</span><br><span class="line">    if(req.url == &quot;/&quot;)&#123; //æ˜¾ç¤ºé¦–é¡µ</span><br><span class="line">        fs.readFile(&quot;./index.html&quot;,function(err,data)&#123; </span><br><span class="line">            res.end(data);</span><br><span class="line">        &#125;); </span><br><span class="line">    &#125;</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">var io = require(&#x27;socket.io&#x27;)(server);</span><br><span class="line"></span><br><span class="line">//ç›‘å¬è¿æ¥äº‹ä»¶ </span><br><span class="line">io.on(&#x27;connection&#x27;,function(socket) &#123;</span><br><span class="line">    console.log(&#x27;å’ŒæœåŠ¡å™¨å»ºç«‹è¿æ¥äº†&#x27;);</span><br><span class="line">    </span><br><span class="line">    socket.on(&#x27;to-server&#x27;,function(data) &#123;</span><br><span class="line">    </span><br><span class="line">        // æ¥æ”¶å®¢æˆ·ç«¯ä¼ è¿‡æ¥çš„æ•°æ®</span><br><span class="line">        console.log(&#x27;å®¢æˆ·ç«¯è¯´:&#x27; + data);</span><br><span class="line">        </span><br><span class="line">        // å‘å®¢æˆ·ç«¯å‘é€æ•°æ®</span><br><span class="line">        // socket åªç»™å½“å‰å‘é€æ¶ˆæ¯ç»™æœåŠ¡ç«¯çš„å®¢æˆ·ç«¯å‘é€æ¶ˆæ¯</span><br><span class="line">        socket.emit(&#x27;to-client&#x27;,&#x27;æˆ‘æ˜¯æœåŠ¡å™¨è¿”å›çš„æ•°æ®&#x27;);</span><br><span class="line">        </span><br><span class="line">    &#125;) </span><br><span class="line">    socket.on(&#x27;disconnect&#x27;,function() &#123;</span><br><span class="line">        console.log(&#x27;æ–­å¼€è¿æ¥äº†&#x27;);</span><br><span class="line">    &#125;)</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line">server.listen(3000,&quot;127.0.0.1&quot;,function()&#123;</span><br><span class="line">    console.log(&#x27;app run at 127.0.0.1:3000&#x27;)</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<p><img src="https://poetries1.gitee.io/img-repo/2019/10/392.png" alt="img"></p>
<blockquote>
<p>æ¯ä¸€ä¸ªè¿æ¥ä¸Šæ¥çš„ç”¨æˆ·ï¼Œéƒ½æœ‰ä¸€ä¸ª <code>socket</code>ã€‚ç”±äºæˆ‘ä»¬çš„ <code>emit</code> è¯­å¥ï¼Œæ˜¯ <code>socket.emit()</code>å‘ å‡ºçš„ï¼Œæ‰€ä»¥æŒ‡çš„æ˜¯å‘è¿™ä¸ªå®¢æˆ·ç«¯å‘å‡ºè¯­å¥ã€‚<br>å¹¿æ’­ï¼Œå°±æ˜¯ç»™æ‰€æœ‰å½“å‰è¿æ¥çš„ç”¨æˆ·å‘é€ä¿¡æ¯:</p>
</blockquote>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">var io = require(&#x27;socket.io&#x27;)(server);</span><br><span class="line"></span><br><span class="line">io.on(&#x27;connection&#x27;,function(socket) &#123;</span><br><span class="line"></span><br><span class="line">    console.log(&#x27;å’ŒæœåŠ¡å™¨å»ºç«‹è¿æ¥äº†&#x27;)</span><br><span class="line">    </span><br><span class="line">    socket.on(&#x27;to-server&#x27;,function(data) &#123;</span><br><span class="line">    </span><br><span class="line">        console.log(&#x27;å®¢æˆ·ç«¯è¯´:&#x27; + data);</span><br><span class="line">        </span><br><span class="line">        // io ç»™æ‰€æœ‰å»ºç«‹è¿æ¥çš„å®¢æˆ·ç«¯å‘é€æ•°æ®ï¼Œä¸ç®¡æ˜¯å“ªä¸ªå®¢æˆ·ç«¯å‘é€æ¶ˆæ¯ï¼Œéƒ½ä¼šå¯¹æ‰€æœ‰å®¢æˆ·ç«¯è¿›è¡Œå¹¿æ’­ä¸€æ¬¡</span><br><span class="line">        io.emit(&#x27;to-client&#x27;,&#x27;æˆ‘æ˜¯æœåŠ¡å™¨è¿”å›çš„æ•°æ®&#x27;);</span><br><span class="line">    &#125;) </span><br><span class="line">    socket.on(&#x27;disconnect&#x27;,function() &#123;</span><br><span class="line">        console.log(&#x27;æ–­å¼€è¿æ¥äº†&#x27;);</span><br><span class="line">    &#125;)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>

<p><img src="https://poetries1.gitee.io/img-repo/2019/10/393.png" alt="img"><br><img src="https://poetries1.gitee.io/img-repo/2019/10/394.png" alt="img"></p>
<ul>
<li><code>io.emit()</code>å¯ä»¥å®ç°èŠå¤©å®¤æ¶ˆæ¯ç¾¤å‘</li>
<li><code>socket.emit()</code>å¯ä»¥å®ç°èŠå¤©æœºå™¨äººï¼Œä¸€å¯¹ä¸€å‘é€</li>
</ul>
<h3 id="1-4-å®¢æˆ·ç«¯ç«¯é€šè¿‡emitå¹¿æ’­ï¼Œé€šè¿‡onæ¥æ”¶å¹¿æ’­"><a href="#1-4-å®¢æˆ·ç«¯ç«¯é€šè¿‡emitå¹¿æ’­ï¼Œé€šè¿‡onæ¥æ”¶å¹¿æ’­" class="headerlink" title="1.4 å®¢æˆ·ç«¯ç«¯é€šè¿‡emitå¹¿æ’­ï¼Œé€šè¿‡onæ¥æ”¶å¹¿æ’­"></a>1.4 å®¢æˆ·ç«¯ç«¯é€šè¿‡emitå¹¿æ’­ï¼Œé€šè¿‡onæ¥æ”¶å¹¿æ’­</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line">// index.html</span><br><span class="line">&lt;!DOCTYPE html&gt; </span><br><span class="line">&lt;html lang=&quot;en&quot;&gt; </span><br><span class="line">&lt;head&gt;</span><br><span class="line">    &lt;meta charset=&quot;UTF-8&quot;&gt;</span><br><span class="line">    &lt;title&gt;socket demo&lt;/title&gt; </span><br><span class="line">&lt;/head&gt;</span><br><span class="line">&lt;body&gt;</span><br><span class="line"></span><br><span class="line">&lt;h1&gt;æˆ‘æ˜¯ index é¡µé¢ï¼Œæˆ‘å¼•ç”¨äº†ç§˜å¯† script æ–‡ä»¶&lt;/h1&gt;</span><br><span class="line">&lt;button id=&quot;btn&quot;&gt;ç»™æœåŠ¡ç«¯å‘é€æ•°æ®&lt;/button&gt;</span><br><span class="line"></span><br><span class="line">&lt;script type=&quot;text/javascript&quot; src=&quot;/socket.io/socket.io.js&quot;&gt;&lt;/script&gt; &lt;script type=&quot;text/javascript&quot;&gt;</span><br><span class="line"></span><br><span class="line">    // è¿æ¥çš„åœ°å€http://localhost:3000 åå°æä¾›</span><br><span class="line">    var socket = io.connect(&#x27;http://localhost:3000&#x27;);</span><br><span class="line"></span><br><span class="line">    // å®¢æˆ·ç«¯å»ºç«‹è¿æ¥</span><br><span class="line">    socket.on(&#x27;connect&#x27;,function() &#123;</span><br><span class="line">        console.log(&#x27;å®¢æˆ·ç«¯å’ŒæœåŠ¡ç«¯å»ºç«‹è¿æ¥äº†&#x27;);</span><br><span class="line">    &#125;) </span><br><span class="line"></span><br><span class="line">    socket.on(&#x27;disconnect&#x27;,function() &#123;</span><br><span class="line">        console.log(&#x27;å®¢æˆ·ç«¯å’ŒæœåŠ¡ç«¯æ–­å¼€è¿æ¥äº†&#x27;);</span><br><span class="line">    &#125;) </span><br><span class="line"></span><br><span class="line">    // å®¢æˆ·ç«¯ç»™æœåŠ¡ç«¯å‘é€æ•°æ®åï¼Œç›‘å¬æœåŠ¡ç«¯è¿”å›çš„æ•°æ®</span><br><span class="line">    socket.on(&#x27;to-client&#x27;,function(data) &#123;</span><br><span class="line">        console.log(&#x27;å®¢æˆ·ç«¯è¯´:&#x27; + data);</span><br><span class="line">    &#125;) </span><br><span class="line"></span><br><span class="line">    var btn = document.getElementById(&#x27;btn&#x27;);</span><br><span class="line"></span><br><span class="line">    btn.onclick = function() &#123;</span><br><span class="line">        socket.emit(&#x27;to-server&#x27;,&#x27;æˆ‘æ˜¯å®¢æˆ·ç«¯çš„æ•°æ®&#x27;);</span><br><span class="line">    &#125;</span><br><span class="line">&lt;/script&gt;</span><br><span class="line"></span><br><span class="line">&lt;/body&gt; </span><br><span class="line">&lt;/html&gt;</span><br></pre></td></tr></table></figure>

<h2 id="äºŒã€èŠå¤©å®¤ã€æ™ºèƒ½æœºå™¨äººå®ç°åŸç†"><a href="#äºŒã€èŠå¤©å®¤ã€æ™ºèƒ½æœºå™¨äººå®ç°åŸç†" class="headerlink" title="äºŒã€èŠå¤©å®¤ã€æ™ºèƒ½æœºå™¨äººå®ç°åŸç†"></a>äºŒã€èŠå¤©å®¤ã€æ™ºèƒ½æœºå™¨äººå®ç°åŸç†</h2><h3 id="2-1-expressç®€å•ä¾‹å­"><a href="#2-1-expressç®€å•ä¾‹å­" class="headerlink" title="2.1 expressç®€å•ä¾‹å­"></a>2.1 expressç®€å•ä¾‹å­</h3><blockquote>
<p><code>Express</code> ç»“åˆ <code>Socket.io</code> å®ç°æœåŠ¡å™¨å’Œå®¢æˆ· ç«¯çš„ç›¸äº’é€šä¿¡ã€èŠå¤©å®¤ã€æ™ºèƒ½æœºå™¨äººå®ç° åŸç†</p>
</blockquote>
<blockquote>
<ul>
<li><a target="_blank" rel="noopener" href="http://www.expressjs.com.cn/starter/generator.html">expressæ–‡æ¡£</a></li>
<li><a target="_blank" rel="noopener" href="https://socket.io/docs">socket.ioæ–‡æ¡£</a></li>
</ul>
</blockquote>
<p><strong>1. Server (app.js)</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">var app = require(&#x27;express&#x27;)();</span><br><span class="line">var server = require(&#x27;http&#x27;).Server(app);</span><br><span class="line">var io = require(&#x27;socket.io&#x27;)(server);</span><br><span class="line"></span><br><span class="line">server.listen(80);</span><br><span class="line">// WARNING: app.listen(80) will NOT work here!</span><br><span class="line"></span><br><span class="line">app.get(&#x27;/&#x27;, function (req, res) &#123;</span><br><span class="line">  res.sendFile(__dirname + &#x27;/index.html&#x27;);</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">io.on(&#x27;connection&#x27;, function (socket) &#123;</span><br><span class="line">  socket.emit(&#x27;news&#x27;, &#123; hello: &#x27;world&#x27; &#125;);</span><br><span class="line">  socket.on(&#x27;my other event&#x27;, function (data) &#123;</span><br><span class="line">    console.log(data);</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<p><strong>2. Client (index.html)</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">&lt;script src=&quot;/socket.io/socket.io.js&quot;&gt;&lt;/script&gt;</span><br><span class="line">&lt;script&gt;</span><br><span class="line">  var socket = io.connect(&#x27;http://localhost&#x27;);</span><br><span class="line">  socket.on(&#x27;news&#x27;, function (data) &#123;</span><br><span class="line">    console.log(data);</span><br><span class="line">    socket.emit(&#x27;my other event&#x27;, &#123; my: &#x27;data&#x27; &#125;);</span><br><span class="line">  &#125;);</span><br><span class="line">&lt;/script&gt;</span><br></pre></td></tr></table></figure>

<h3 id="2-2-expresså®ç°æ™ºèƒ½æœºå™¨äºº"><a href="#2-2-expresså®ç°æ™ºèƒ½æœºå™¨äºº" class="headerlink" title="2.2 expresså®ç°æ™ºèƒ½æœºå™¨äºº"></a>2.2 expresså®ç°æ™ºèƒ½æœºå™¨äºº</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br></pre></td><td class="code"><pre><span class="line">&lt;!--views/index.ejx--&gt;</span><br><span class="line">&lt;html&gt;</span><br><span class="line">&lt;head&gt;</span><br><span class="line">  &lt;title&gt;&lt;/title&gt;</span><br><span class="line"></span><br><span class="line">    &lt;script src=&quot;/jquery-1.11.3.min.js&quot;&gt;&lt;/script&gt;</span><br><span class="line"></span><br><span class="line">    &lt;script src=&quot;/socket.io/socket.io.js&quot;&gt;&lt;/script&gt;</span><br><span class="line">&lt;/head&gt;</span><br><span class="line">&lt;body&gt;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    &lt;input type=&quot;text&quot; id=&quot;msg&quot;/&gt;</span><br><span class="line"></span><br><span class="line">    &lt;br/&gt;</span><br><span class="line">    &lt;br/&gt;</span><br><span class="line"></span><br><span class="line">    &lt;button id=&quot;send&quot;&gt;å‘é€&lt;/button&gt;</span><br><span class="line"></span><br><span class="line">&lt;/body&gt;</span><br><span class="line">&lt;/html&gt;</span><br><span class="line"></span><br><span class="line">&lt;script&gt;</span><br><span class="line">$(function()&#123;</span><br><span class="line"></span><br><span class="line">    var socket = io.connect(&#x27;http://127.0.0.1:8000&#x27;);</span><br><span class="line"></span><br><span class="line">    //ç¾¤èŠåŠŸèƒ½--èŠå¤©å®¤</span><br><span class="line">    $(&#x27;#send&#x27;).click(function()&#123;</span><br><span class="line">        var msg=$(&#x27;#msg&#x27;).val();</span><br><span class="line"></span><br><span class="line">        socket.emit(&#x27;message&#x27;,msg);  /*å®¢æˆ·ç«¯ç»™æœåŠ¡å™¨å‘é€æ•°æ®*/</span><br><span class="line"></span><br><span class="line">    &#125;)</span><br><span class="line">    //æ¥å—æœåŠ¡å™¨è¿”å›çš„æ•°æ®</span><br><span class="line">    socket.on(&#x27;servermessage&#x27;,function(data)&#123;</span><br><span class="line"></span><br><span class="line">        console.log(data)</span><br><span class="line">    &#125;)</span><br><span class="line"></span><br><span class="line">&#125;)</span><br><span class="line">&lt;/script&gt;</span><br><span class="line">// app.js</span><br><span class="line"></span><br><span class="line">var express=require(&#x27;express&#x27;);</span><br><span class="line"></span><br><span class="line">var app=express();</span><br><span class="line"></span><br><span class="line">/*ç¬¬ä¸€æ­¥*/</span><br><span class="line">var server = require(&#x27;http&#x27;).Server(app);</span><br><span class="line">var io = require(&#x27;socket.io&#x27;)(server);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">app.set(&#x27;view engine&#x27;,&#x27;ejs&#x27;);</span><br><span class="line">app.use(express.static(&#x27;public&#x27;));</span><br><span class="line"></span><br><span class="line">app.get(&#x27;/&#x27;,function(req,res)&#123;</span><br><span class="line">    //res.send(&#x27;é¦–é¡µ&#x27;);</span><br><span class="line">    res.render(&#x27;index&#x27;);</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">app.get(&#x27;/news&#x27;,function(req,res)&#123;</span><br><span class="line">    res.send(&#x27;news&#x27;);</span><br><span class="line"></span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line">//2.ç›‘å¬ç«¯å£</span><br><span class="line">server.listen(8000,&#x27;127.0.0.1&#x27;);   /*æ”¹ip*/</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">//3ã€å†™socketçš„ä»£ç </span><br><span class="line"></span><br><span class="line">io.on(&#x27;connection&#x27;, function (socket) &#123;</span><br><span class="line">  console.log(&#x27;å»ºç«‹é“¾æ¥&#x27;)</span><br><span class="line"></span><br><span class="line">    socket.on(&#x27;message&#x27;,function(data)&#123;</span><br><span class="line"></span><br><span class="line">        console.log(data);</span><br><span class="line"></span><br><span class="line">        //io.emit  å¹¿æ’­ --- èŠå¤©å®¤</span><br><span class="line">        //socket.emit  è°ç»™æˆ‘å‘çš„ä¿¡æ¯æˆ‘å›è¿”å›ç»™è° --- æ™ºèƒ½æœºå™¨äºº</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">        //io.emit(&#x27;servermessage&#x27;,data);   /*æœåŠ¡å™¨ç»™å®¢æˆ·ç«¯å‘é€æ•°æ®*/</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">        if(data==1)&#123;</span><br><span class="line"></span><br><span class="line">            var msg=&#x27;æ‚¨å½“å‰çš„è¯è´¹æœ‰2å…ƒ&#x27;</span><br><span class="line">        &#125;else if(data==2)&#123;</span><br><span class="line">            var msg=&#x27;æ‚¨å½“å‰çš„æµé‡æœ‰200M&#x27;</span><br><span class="line"></span><br><span class="line">        &#125;else&#123;</span><br><span class="line">            var msg=&#x27;è¯·è¾“å…¥æ­£ç¡®çš„ä¿¡æ¯&#x27;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        socket.emit(&#x27;servermessage&#x27;,msg);</span><br><span class="line"></span><br><span class="line">    &#125;)</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<blockquote>
<p><a target="_blank" rel="noopener" href="https://github.com/poetries/socket.io-demo/tree/master/express-socket-chat">å®Œæ•´ä»£ç </a></p>
</blockquote>
<h3 id="2-3-expressç»“åˆsocket-ioåŠæ•°æ®åº“å®ç°æ™ºèƒ½æœºå™¨äºº"><a href="#2-3-expressç»“åˆsocket-ioåŠæ•°æ®åº“å®ç°æ™ºèƒ½æœºå™¨äºº" class="headerlink" title="2.3 expressç»“åˆsocket.ioåŠæ•°æ®åº“å®ç°æ™ºèƒ½æœºå™¨äºº"></a>2.3 expressç»“åˆ<code>socket.io</code>åŠæ•°æ®åº“å®ç°æ™ºèƒ½æœºå™¨äºº</h3><blockquote>
<p>è·¨åŸŸä¹Ÿå¯ä»¥è®¿é—®<code>socket.io</code></p>
</blockquote>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br></pre></td><td class="code"><pre><span class="line">// app.js</span><br><span class="line"></span><br><span class="line">var express=require(&#x27;express&#x27;);</span><br><span class="line"></span><br><span class="line">var app=express();</span><br><span class="line"></span><br><span class="line">var DB=require(&#x27;./module/db.js&#x27;);</span><br><span class="line"></span><br><span class="line">/*ç¬¬ä¸€æ­¥*/</span><br><span class="line">var server = require(&#x27;http&#x27;).Server(app);</span><br><span class="line">var io = require(&#x27;socket.io&#x27;)(server);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">app.set(&#x27;view engine&#x27;,&#x27;ejs&#x27;);</span><br><span class="line">app.use(express.static(&#x27;public&#x27;));</span><br><span class="line"></span><br><span class="line">app.get(&#x27;/&#x27;,function(req,res)&#123;</span><br><span class="line">    //res.send(&#x27;é¦–é¡µ&#x27;);</span><br><span class="line">    res.render(&#x27;index&#x27;);</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">app.get(&#x27;/news&#x27;,function(req,res)&#123;</span><br><span class="line">    res.send(&#x27;news&#x27;);</span><br><span class="line"></span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line">//2.ç›‘å¬ç«¯å£</span><br><span class="line">server.listen(8000,&#x27;127.0.0.1&#x27;, function () &#123;</span><br><span class="line">    console.log(&#x27;app run at 127.0.0.1:8000&#x27;)</span><br><span class="line">&#125;);   /*æ”¹ip*/</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">//3ã€å†™socketçš„ä»£ç </span><br><span class="line"></span><br><span class="line">io.on(&#x27;connection&#x27;, function (socket) &#123;</span><br><span class="line">    console.log(&#x27;å»ºç«‹é“¾æ¥&#x27;)</span><br><span class="line"></span><br><span class="line">    socket.on(&#x27;message&#x27;,function(data)&#123;</span><br><span class="line"></span><br><span class="line">        console.log(data)</span><br><span class="line">        //socket.emit(&#x27;servermessage&#x27;,msg);</span><br><span class="line"></span><br><span class="line">        var msg=data.msg||&#x27;&#x27;;  /*è·å–å®¢æˆ·ç«¯çš„æ•°æ®*/</span><br><span class="line"></span><br><span class="line">        //å»æœåŠ¡å™¨æŸ¥è¯¢æ•°æ®</span><br><span class="line"></span><br><span class="line">        DB.find(&#x27;article&#x27;,&#123;&#x27;title&#x27;:&#123;$regex:new RegExp(msg)&#125;&#125;,&#123;&#x27;title&#x27;:1&#125;,function(err,data)&#123;</span><br><span class="line"></span><br><span class="line">            console.log(data);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">            socket.emit(&#x27;servermessage&#x27;,&#123;</span><br><span class="line">                result:data</span><br><span class="line">            &#125;);</span><br><span class="line">        &#125;)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    &#125;)</span><br><span class="line">&#125;);</span><br><span class="line">&lt;!DOCTYPE&gt;</span><br><span class="line">&lt;html&gt;</span><br><span class="line">&lt;head&gt;</span><br><span class="line">    &lt;title&gt;&lt;/title&gt;</span><br><span class="line">    &lt;script</span><br><span class="line">  src=&quot;https://code.jquery.com/jquery-3.3.1.min.js&quot;</span><br><span class="line">  integrity=&quot;sha256-FgpCb/KJQlLNfOu91ta32o/NMZxltwRo8QtmkMRdAu8=&quot;</span><br><span class="line">  crossorigin=&quot;anonymous&quot;&gt;&lt;/script&gt;</span><br><span class="line"></span><br><span class="line">    &lt;script src=&quot;/socket.io/socket.io.js&quot;&gt;&lt;/script&gt;</span><br><span class="line">    &lt;style&gt;</span><br><span class="line"></span><br><span class="line">        .box&#123;</span><br><span class="line">            width: 300px;</span><br><span class="line">            height: 400px;</span><br><span class="line">            margin: 0 auto;</span><br><span class="line">            border: 1px solid #666;</span><br><span class="line">            margin-top:20px;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">        &#125;</span><br><span class="line">        .list&#123;</span><br><span class="line">            width: 300px;</span><br><span class="line">            height: 360px;</span><br><span class="line">            overflow-y: auto;</span><br><span class="line">        &#125;</span><br><span class="line">        .message&#123;</span><br><span class="line">            height: 40px;</span><br><span class="line">            line-height: 44px;</span><br><span class="line">            display: flex;</span><br><span class="line">        &#125;</span><br><span class="line">        .message input&#123;</span><br><span class="line"></span><br><span class="line">            border: 1px solid #666;</span><br><span class="line">        &#125;</span><br><span class="line">        .message input[type=&#x27;text&#x27;]&#123;</span><br><span class="line">            flex: 1;</span><br><span class="line">            height: 38px;</span><br><span class="line">        &#125;</span><br><span class="line">        .message input[type=&#x27;button&#x27;]&#123;</span><br><span class="line">            width: 100px;</span><br><span class="line">            height: 40px;</span><br><span class="line">            border: 1px solid #666;</span><br><span class="line">        &#125;</span><br><span class="line">    &lt;/style&gt;</span><br><span class="line">&lt;/head&gt;</span><br><span class="line">&lt;body&gt;</span><br><span class="line"></span><br><span class="line">    &lt;div class=&quot;box&quot;&gt;</span><br><span class="line">        &lt;div class=&quot;list&quot;&gt;</span><br><span class="line">            &lt;div id=&quot;list&quot;&gt;</span><br><span class="line">            &lt;/div&gt;</span><br><span class="line">            &lt;div class=&quot;footer&quot; id=&quot;footer&quot;&gt;</span><br><span class="line"></span><br><span class="line">            &lt;/div&gt;</span><br><span class="line">        &lt;/div&gt;</span><br><span class="line">        </span><br><span class="line">        &lt;div class=&quot;message&quot;&gt;</span><br><span class="line">            &lt;input type=&quot;text&quot; id=&quot;msg&quot; /&gt;</span><br><span class="line">            &lt;input type=&quot;button&quot; id=&quot;send&quot; value=&quot;å‘é€&quot;/&gt;</span><br><span class="line">        &lt;/div&gt;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    &lt;/div&gt;</span><br><span class="line"></span><br><span class="line">&lt;/body&gt;</span><br><span class="line">&lt;/html&gt;</span><br><span class="line"></span><br><span class="line">&lt;script&gt;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    $(function()&#123;</span><br><span class="line"></span><br><span class="line">        var socket = io.connect(&#x27;http://127.0.0.1:8000&#x27;);</span><br><span class="line"></span><br><span class="line">        socket.on(&#x27;servermessage&#x27;,function(data)&#123;</span><br><span class="line"></span><br><span class="line">            if(data.result.length)</span><br><span class="line"></span><br><span class="line">            &#123;</span><br><span class="line">                var str=&#x27;&lt;ul&gt;&#x27;;</span><br><span class="line">                for(var i=0;i&lt;data.result.length;i++)&#123;</span><br><span class="line"></span><br><span class="line">                    str+=&#x27;&lt;li&gt;&#x27;+data.result[i].title+&#x27;&lt;/li&gt;&#x27;;</span><br><span class="line">                &#125;</span><br><span class="line">                str+=&#x27;&lt;/ul&gt;&#x27;;</span><br><span class="line">            &#125;else&#123;</span><br><span class="line"></span><br><span class="line">                var str=&#x27;&lt;p&gt;æ²¡æœ‰æ‰¾åˆ°æ‚¨è¦çš„æ•°æ®ï¼Œè¯·è”ç³»äººå·¥å®¢æœ&lt;/p&gt;&#x27;</span><br><span class="line">            &#125;</span><br><span class="line">            $(&#x27;#list&#x27;).append(str);</span><br><span class="line">            $(&#x27;#footer&#x27;).get(0).scrollIntoView();</span><br><span class="line"></span><br><span class="line">        &#125;)</span><br><span class="line"></span><br><span class="line">        var username=&#x27;zhangsan&#x27;+Math.floor(Math.random()*10);</span><br><span class="line"></span><br><span class="line">        //ç¾¤èŠåŠŸèƒ½--èŠå¤©å®¤</span><br><span class="line">        $(&#x27;#send&#x27;).click(function()&#123;</span><br><span class="line">            var msg=$(&#x27;#msg&#x27;).val();</span><br><span class="line">            socket.emit(&#x27;message&#x27;,&#123;</span><br><span class="line">                &#x27;username&#x27;:username,</span><br><span class="line">                &#x27;msg&#x27;:msg</span><br><span class="line">            &#125;);</span><br><span class="line">            $(&#x27;#list&#x27;).append(`&lt;p&gt;&lt;strong&gt;$&#123;username&#125;:&lt;/strong&gt;  $&#123;msg&#125;&lt;/p&gt;`);</span><br><span class="line"></span><br><span class="line">            $(&#x27;#msg&#x27;).val();</span><br><span class="line"></span><br><span class="line">        &#125;)</span><br><span class="line">    &#125;)</span><br><span class="line">&lt;/script&gt;</span><br></pre></td></tr></table></figure>

<blockquote>
<p><a target="_blank" rel="noopener" href="https://github.com/poetries/socket.io-demo/tree/master/express-socket-chat-use-db">å®Œæ•´ä»£ç </a></p>
</blockquote>
<h2 id="ä¸‰ã€Koaä¸­Socket-ioçš„ä½¿ç”¨"><a href="#ä¸‰ã€Koaä¸­Socket-ioçš„ä½¿ç”¨" class="headerlink" title="ä¸‰ã€Koaä¸­Socket.ioçš„ä½¿ç”¨"></a>ä¸‰ã€Koaä¸­Socket.ioçš„ä½¿ç”¨</h2><p><strong>1. æœåŠ¡ç«¯é…ç½®</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"># 1 å®‰è£…</span><br><span class="line">cnpm i -S koa-socket</span><br><span class="line">// app.js</span><br><span class="line"></span><br><span class="line">// 2 å¼•å…¥</span><br><span class="line">const IO = require( &#x27;koa-socket&#x27; )</span><br><span class="line"></span><br><span class="line">// 3 å®ä¾‹åŒ–</span><br><span class="line">const io = new IO()</span><br><span class="line"></span><br><span class="line">io.attach( app )</span><br><span class="line"></span><br><span class="line">// 4 é…ç½®æœåŠ¡ç«¯</span><br><span class="line"></span><br><span class="line">app._io.on( &#x27;connection&#x27;, socket =&gt; &#123;</span><br><span class="line"></span><br><span class="line">console.log(&#x27;å»ºç«‹è¿æ¥äº†&#x27;);</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>

<p><strong>2. å®¢æˆ·ç«¯ä»£ç </strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&lt;script src=&quot;http://localhost:3000/socket.io/socket.io.js&quot;&gt;&lt;/script&gt;</span><br><span class="line">&lt;script&gt;</span><br><span class="line">   var socket=io.connect(&#x27;http://localhost:3000/&#x27;)</span><br><span class="line">&lt;/script&gt;</span><br></pre></td></tr></table></figure>

<blockquote>
<p><a target="_blank" rel="noopener" href="https://github.com/poetries/socket.io-demo/tree/master/koa-socket.io">å®Œæ•´ä»£ç </a></p>
</blockquote>

        
    </article>
    <footer class="cube-excerpt-footer">
        <a class="cube-excerpt-more" href="/2019/05/26/nodejs/nodejs-websocker%E4%B8%8Esocket.io%E7%9A%84%E5%8C%BA%E5%88%AB/">Read More</a>
    </footer>
</div>

<div class="cube-excerpt" id="cube-excerpt-åœ°å€æ è¾“å…¥ URL æ•²ä¸‹å›è½¦åå‘ç”Ÿäº†ä»€ä¹ˆ">
    <header class="cube-excerpt-header">
        <h1><a href="/2019/05/23/http/%E5%9C%B0%E5%9D%80%E6%A0%8F%E8%BE%93%E5%85%A5%20URL%20%E6%95%B2%E4%B8%8B%E5%9B%9E%E8%BD%A6%E5%90%8E%E5%8F%91%E7%94%9F%E4%BA%86%E4%BB%80%E4%B9%88/">åœ°å€æ è¾“å…¥ URL æ•²ä¸‹å›è½¦åå‘ç”Ÿäº†ä»€ä¹ˆ</a></h1>
        <div class="cube-excerpt-header-msg">
            <div class="cube-excerpt-date">
                <i class="cube-icon cube-icon-date" aria-hidden="true"></i>
                2019-05-23
            </div>
            <div class="cube-excerpt-tags">
                <i class="cube-icon cube-icon-tag" aria-hidden="true"></i>
                
                <a href="/tags/http/" class="cube-excerpt-tag-link">#http</a>
                
            </div>
        </div>
    </header>
    <article class="cube-excerpt-entry cube-markdown">
        
        
           <h2 id="ä¸€ã€ç®€å•åˆ†æ"><a href="#ä¸€ã€ç®€å•åˆ†æ" class="headerlink" title="ä¸€ã€ç®€å•åˆ†æ"></a>ä¸€ã€ç®€å•åˆ†æ</h2><p>ç®€å•çš„åˆ†æï¼Œä»è¾“å…¥ <code>URL</code>åˆ°å›è½¦åå‘ç”Ÿçš„è¡Œä¸ºå¦‚ä¸‹ï¼š</p>
<ul>
<li>URLè§£æ</li>
<li>DNS æŸ¥è¯¢</li>
<li>TCP è¿æ¥</li>
<li>HTTP è¯·æ±‚</li>
<li>å“åº”è¯·æ±‚</li>
<li>é¡µé¢æ¸²æŸ“</li>
</ul>
<h2 id="äºŒã€è¯¦ç»†åˆ†æ"><a href="#äºŒã€è¯¦ç»†åˆ†æ" class="headerlink" title="äºŒã€è¯¦ç»†åˆ†æ"></a>äºŒã€è¯¦ç»†åˆ†æ</h2><h3 id="URLè§£æ"><a href="#URLè§£æ" class="headerlink" title="URLè§£æ"></a>URLè§£æ</h3><p>é¦–å…ˆåˆ¤æ–­ä½ è¾“å…¥çš„æ˜¯ä¸€ä¸ªåˆæ³•çš„<code>URL</code> è¿˜æ˜¯ä¸€ä¸ªå¾…æœç´¢çš„å…³é”®è¯ï¼Œå¹¶ä¸”æ ¹æ®ä½ è¾“å…¥çš„å†…å®¹è¿›è¡Œå¯¹åº”æ“ä½œ</p>
<p><code>URL</code>çš„è§£æç¬¬è¿‡ç¨‹ä¸­çš„ç¬¬ä¸€æ­¥ï¼Œä¸€ä¸ª<code>url</code>çš„ç»“æ„è§£æå¦‚ä¸‹ï¼š</p>
<p><img src="https://static.vue-js.com/27a0c690-bdf4-11eb-ab90-d9ae814b240d.png" alt="img"></p>
<h3 id="DNSæŸ¥è¯¢"><a href="#DNSæŸ¥è¯¢" class="headerlink" title="DNSæŸ¥è¯¢"></a>DNSæŸ¥è¯¢</h3><p>åœ¨ä¹‹å‰æ–‡ç« ä¸­è®²è¿‡<code>DNS</code>çš„æŸ¥è¯¢ï¼Œè¿™é‡Œå°±ä¸å†è®²è¿°äº†</p>
<p>æ•´ä¸ªæŸ¥è¯¢è¿‡ç¨‹å¦‚ä¸‹å›¾æ‰€ç¤ºï¼š</p>
<p><img src="https://static.vue-js.com/330fb770-bdf4-11eb-85f6-6fac77c0c9b3.png" alt="img"></p>
<p>æœ€ç»ˆï¼Œè·å–åˆ°äº†åŸŸåå¯¹åº”çš„ç›®æ ‡æœåŠ¡å™¨<code>IP</code>åœ°å€</p>
<h3 id="TCPè¿æ¥"><a href="#TCPè¿æ¥" class="headerlink" title="TCPè¿æ¥"></a>TCPè¿æ¥</h3><p>åœ¨ä¹‹å‰æ–‡ç« ä¸­ï¼Œäº†è§£åˆ°<code>tcp</code>æ˜¯ä¸€ç§é¢å‘æœ‰è¿æ¥çš„ä¼ è¾“å±‚åè®®</p>
<p>åœ¨ç¡®å®šç›®æ ‡æœåŠ¡å™¨æœåŠ¡å™¨çš„<code>IP</code>åœ°å€åï¼Œåˆ™ç»å†ä¸‰æ¬¡æ¡æ‰‹å»ºç«‹<code>TCP</code>è¿æ¥ï¼Œæµç¨‹å¦‚ä¸‹ï¼š</p>
<p><img src="https://static.vue-js.com/ad750790-bdf4-11eb-85f6-6fac77c0c9b3.png" alt="img"></p>
<h3 id="å‘é€-http-è¯·æ±‚"><a href="#å‘é€-http-è¯·æ±‚" class="headerlink" title="å‘é€ http è¯·æ±‚"></a>å‘é€ http è¯·æ±‚</h3><p>å½“å»ºç«‹<code>tcp</code>è¿æ¥ä¹‹åï¼Œå°±å¯ä»¥åœ¨è¿™åŸºç¡€ä¸Šè¿›è¡Œé€šä¿¡ï¼Œæµè§ˆå™¨å‘é€ <code>http</code> è¯·æ±‚åˆ°ç›®æ ‡æœåŠ¡å™¨</p>
<p>è¯·æ±‚çš„å†…å®¹åŒ…æ‹¬ï¼š</p>
<ul>
<li>è¯·æ±‚è¡Œ</li>
<li>è¯·æ±‚å¤´</li>
<li>è¯·æ±‚ä¸»ä½“</li>
</ul>
<p><img src="https://static.vue-js.com/bbcb60f0-bdf4-11eb-ab90-d9ae814b240d.png" alt="img"></p>
<h3 id="å“åº”è¯·æ±‚"><a href="#å“åº”è¯·æ±‚" class="headerlink" title="å“åº”è¯·æ±‚"></a>å“åº”è¯·æ±‚</h3><p>å½“æœåŠ¡å™¨æ¥æ”¶åˆ°æµè§ˆå™¨çš„è¯·æ±‚ä¹‹åï¼Œå°±ä¼šè¿›è¡Œé€»è¾‘æ“ä½œï¼Œå¤„ç†å®Œæˆä¹‹åè¿”å›ä¸€ä¸ª<code>HTTP</code>å“åº”æ¶ˆæ¯ï¼ŒåŒ…æ‹¬ï¼š</p>
<ul>
<li>çŠ¶æ€è¡Œ</li>
<li>å“åº”å¤´</li>
<li>å“åº”æ­£æ–‡</li>
</ul>
<p><img src="https://static.vue-js.com/c5fe0140-bdf4-11eb-ab90-d9ae814b240d.png" alt="img"></p>
<p>åœ¨æœåŠ¡å™¨å“åº”ä¹‹åï¼Œç”±äºç°åœ¨<code>http</code>é»˜è®¤å¼€å§‹é•¿è¿æ¥<code>keep-alive</code>ï¼Œå½“é¡µé¢å…³é—­ä¹‹åï¼Œ<code>tcp</code>é“¾æ¥åˆ™ä¼šç»è¿‡å››æ¬¡æŒ¥æ‰‹å®Œæˆæ–­å¼€</p>
<h3 id="é¡µé¢æ¸²æŸ“"><a href="#é¡µé¢æ¸²æŸ“" class="headerlink" title="é¡µé¢æ¸²æŸ“"></a>é¡µé¢æ¸²æŸ“</h3><p>å½“æµè§ˆå™¨æ¥æ”¶åˆ°æœåŠ¡å™¨å“åº”çš„èµ„æºåï¼Œé¦–å…ˆä¼šå¯¹èµ„æºè¿›è¡Œè§£æï¼š</p>
<ul>
<li>æŸ¥çœ‹å“åº”å¤´çš„ä¿¡æ¯ï¼Œæ ¹æ®ä¸åŒçš„æŒ‡ç¤ºåšå¯¹åº”å¤„ç†ï¼Œæ¯”å¦‚é‡å®šå‘ï¼Œå­˜å‚¨cookieï¼Œè§£å‹gzipï¼Œç¼“å­˜èµ„æºç­‰ç­‰</li>
<li>æŸ¥çœ‹å“åº”å¤´çš„ Content-Typeçš„å€¼ï¼Œæ ¹æ®ä¸åŒçš„èµ„æºç±»å‹é‡‡ç”¨ä¸åŒçš„è§£ææ–¹å¼</li>
</ul>
<p>å…³äºé¡µé¢çš„æ¸²æŸ“è¿‡ç¨‹å¦‚ä¸‹ï¼š</p>
<ul>
<li>è§£æHTMLï¼Œæ„å»º DOM æ ‘</li>
<li>è§£æ CSS ï¼Œç”Ÿæˆ CSS è§„åˆ™æ ‘</li>
<li>åˆå¹¶ DOM æ ‘å’Œ CSS è§„åˆ™ï¼Œç”Ÿæˆ render æ ‘</li>
<li>å¸ƒå±€ render æ ‘ï¼ˆ Layout &#x2F; reflow ï¼‰ï¼Œè´Ÿè´£å„å…ƒç´ å°ºå¯¸ã€ä½ç½®çš„è®¡ç®—</li>
<li>ç»˜åˆ¶ render æ ‘ï¼ˆ paint ï¼‰ï¼Œç»˜åˆ¶é¡µé¢åƒç´ ä¿¡æ¯</li>
<li>æµè§ˆå™¨ä¼šå°†å„å±‚çš„ä¿¡æ¯å‘é€ç»™ GPUï¼ŒGPU ä¼šå°†å„å±‚åˆæˆï¼ˆ composite ï¼‰ï¼Œæ˜¾ç¤ºåœ¨å±å¹•ä¸Š</li>
</ul>
<p><img src="https://static.vue-js.com/db7bddd0-bdf4-11eb-85f6-6fac77c0c9b3.png" alt="img"></p>

        
    </article>
    <footer class="cube-excerpt-footer">
        <a class="cube-excerpt-more" href="/2019/05/23/http/%E5%9C%B0%E5%9D%80%E6%A0%8F%E8%BE%93%E5%85%A5%20URL%20%E6%95%B2%E4%B8%8B%E5%9B%9E%E8%BD%A6%E5%90%8E%E5%8F%91%E7%94%9F%E4%BA%86%E4%BB%80%E4%B9%88/">Read More</a>
    </footer>
</div>

<div class="cube-excerpt" id="cube-excerpt-vue-è™šæ‹ŸDOM">
    <header class="cube-excerpt-header">
        <h1><a href="/2019/05/21/Vue/%E8%99%9A%E6%8B%9Fdom/">vue-è™šæ‹ŸDOM</a></h1>
        <div class="cube-excerpt-header-msg">
            <div class="cube-excerpt-date">
                <i class="cube-icon cube-icon-date" aria-hidden="true"></i>
                2019-05-21
            </div>
            <div class="cube-excerpt-tags">
                <i class="cube-icon cube-icon-tag" aria-hidden="true"></i>
                
                <a href="/tags/vue/" class="cube-excerpt-tag-link">#vue</a>
                
            </div>
        </div>
    </header>
    <article class="cube-excerpt-entry cube-markdown">
        
        
           <h2 id="ä¸€ã€ä»€ä¹ˆæ˜¯è™šæ‹ŸDOM"><a href="#ä¸€ã€ä»€ä¹ˆæ˜¯è™šæ‹ŸDOM" class="headerlink" title="ä¸€ã€ä»€ä¹ˆæ˜¯è™šæ‹ŸDOM"></a>ä¸€ã€ä»€ä¹ˆæ˜¯è™šæ‹ŸDOM</h2><p>è™šæ‹Ÿ DOM ï¼ˆ<code>Virtual DOM</code> ï¼‰è¿™ä¸ªæ¦‚å¿µç›¸ä¿¡å¤§å®¶éƒ½ä¸é™Œç”Ÿï¼Œä» <code>React</code> åˆ° <code>Vue</code> ï¼Œè™šæ‹Ÿ <code>DOM</code> ä¸ºè¿™ä¸¤ä¸ªæ¡†æ¶éƒ½å¸¦æ¥äº†è·¨å¹³å°çš„èƒ½åŠ›ï¼ˆ<code>React-Native</code> å’Œ <code>Weex</code>ï¼‰</p>
<p>å®é™…ä¸Šå®ƒåªæ˜¯ä¸€å±‚å¯¹çœŸå®<code>DOM</code>çš„æŠ½è±¡ï¼Œä»¥<code>JavaScript</code> å¯¹è±¡ (<code>VNode</code> èŠ‚ç‚¹) ä½œä¸ºåŸºç¡€çš„æ ‘ï¼Œç”¨å¯¹è±¡çš„å±æ€§æ¥æè¿°èŠ‚ç‚¹ï¼Œæœ€ç»ˆå¯ä»¥é€šè¿‡ä¸€ç³»åˆ—æ“ä½œä½¿è¿™æ£µæ ‘æ˜ å°„åˆ°çœŸå®ç¯å¢ƒä¸Š</p>
<p>åœ¨<code>Javascript</code>å¯¹è±¡ä¸­ï¼Œè™šæ‹Ÿ<code>DOM</code> è¡¨ç°ä¸ºä¸€ä¸ª <code>Object</code>å¯¹è±¡ã€‚å¹¶ä¸”æœ€å°‘åŒ…å«æ ‡ç­¾å (<code>tag</code>)ã€å±æ€§ (<code>attrs</code>) å’Œå­å…ƒç´ å¯¹è±¡ (<code>children</code>) ä¸‰ä¸ªå±æ€§ï¼Œä¸åŒæ¡†æ¶å¯¹è¿™ä¸‰ä¸ªå±æ€§çš„åå‘½å¯èƒ½ä¼šæœ‰å·®åˆ«</p>
<p>åˆ›å»ºè™šæ‹Ÿ<code>DOM</code>å°±æ˜¯ä¸ºäº†æ›´å¥½å°†è™šæ‹Ÿçš„èŠ‚ç‚¹æ¸²æŸ“åˆ°é¡µé¢è§†å›¾ä¸­ï¼Œæ‰€ä»¥è™šæ‹Ÿ<code>DOM</code>å¯¹è±¡çš„èŠ‚ç‚¹ä¸çœŸå®<code>DOM</code>çš„å±æ€§ä¸€ä¸€ç…§åº”</p>
<p>åœ¨<code>vue</code>ä¸­åŒæ ·ä½¿ç”¨åˆ°äº†è™šæ‹Ÿ<code>DOM</code>æŠ€æœ¯</p>
<p>å®šä¹‰çœŸå®<code>DOM</code></p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">&quot;app&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">p</span> <span class="attr">class</span>=<span class="string">&quot;p&quot;</span>&gt;</span>èŠ‚ç‚¹å†…å®¹<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">h3</span>&gt;</span>&#123;&#123; foo &#125;&#125;<span class="tag">&lt;/<span class="name">h3</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>å®ä¾‹åŒ–<code>vue</code></p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> app = <span class="keyword">new</span> <span class="title class_">Vue</span>(&#123;</span><br><span class="line">    <span class="attr">el</span>:<span class="string">&quot;#app&quot;</span>,</span><br><span class="line">    <span class="attr">data</span>:&#123;</span><br><span class="line">        <span class="attr">foo</span>:<span class="string">&quot;foo&quot;</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>

<p>è§‚å¯Ÿ<code>render</code>çš„<code>render</code>ï¼Œæˆ‘ä»¬èƒ½å¾—åˆ°è™šæ‹Ÿ<code>DOM</code></p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">(<span class="keyword">function</span> <span class="title function_">anonymous</span>(<span class="params"></span></span><br><span class="line"><span class="params"></span>) &#123;</span><br><span class="line">	<span class="title function_">with</span>(<span class="params"><span class="variable language_">this</span></span>)&#123;<span class="keyword">return</span> <span class="title function_">_c</span>(<span class="string">&#x27;div&#x27;</span>,&#123;<span class="attr">attrs</span>:&#123;<span class="string">&quot;id&quot;</span>:<span class="string">&quot;app&quot;</span>&#125;&#125;,[<span class="title function_">_c</span>(<span class="string">&#x27;p&#x27;</span>,&#123;<span class="attr">staticClass</span>:<span class="string">&quot;p&quot;</span>&#125;,</span><br><span class="line">					  [<span class="title function_">_v</span>(<span class="string">&quot;èŠ‚ç‚¹å†…å®¹&quot;</span>)]),<span class="title function_">_v</span>(<span class="string">&quot; &quot;</span>),<span class="title function_">_c</span>(<span class="string">&#x27;h3&#x27;</span>,[<span class="title function_">_v</span>(<span class="title function_">_s</span>(foo))])])&#125;&#125;)</span><br></pre></td></tr></table></figure>

<p>é€šè¿‡<code>VNode</code>ï¼Œ<code>vue</code>å¯ä»¥å¯¹è¿™é¢—æŠ½è±¡æ ‘è¿›è¡Œåˆ›å»ºèŠ‚ç‚¹,åˆ é™¤èŠ‚ç‚¹ä»¥åŠä¿®æ”¹èŠ‚ç‚¹çš„æ“ä½œï¼Œ ç»è¿‡<code>diff</code>ç®—æ³•å¾—å‡ºä¸€äº›éœ€è¦ä¿®æ”¹çš„æœ€å°å•ä½,å†æ›´æ–°è§†å›¾ï¼Œå‡å°‘äº†<code>dom</code>æ“ä½œï¼Œæé«˜äº†æ€§èƒ½</p>
<h2 id="äºŒã€ä¸ºä»€ä¹ˆéœ€è¦è™šæ‹ŸDOM"><a href="#äºŒã€ä¸ºä»€ä¹ˆéœ€è¦è™šæ‹ŸDOM" class="headerlink" title="äºŒã€ä¸ºä»€ä¹ˆéœ€è¦è™šæ‹ŸDOM"></a>äºŒã€ä¸ºä»€ä¹ˆéœ€è¦è™šæ‹ŸDOM</h2><p><code>DOM</code>æ˜¯å¾ˆæ…¢çš„ï¼Œå…¶å…ƒç´ éå¸¸åºå¤§ï¼Œé¡µé¢çš„æ€§èƒ½é—®é¢˜ï¼Œå¤§éƒ¨åˆ†éƒ½æ˜¯ç”±<code>DOM</code>æ“ä½œå¼•èµ·çš„</p>
<p>çœŸå®çš„<code>DOM</code>èŠ‚ç‚¹ï¼Œå“ªæ€•ä¸€ä¸ªæœ€ç®€å•çš„<code>div</code>ä¹ŸåŒ…å«ç€å¾ˆå¤šå±æ€§ï¼Œå¯ä»¥æ‰“å°å‡ºæ¥ç›´è§‚æ„Ÿå—ä¸€ä¸‹ï¼š <img src="https://static.vue-js.com/cc95c7f0-442c-11eb-ab90-d9ae814b240d.png" alt="img"></p>
<p>ç”±æ­¤å¯è§ï¼Œæ“ä½œ<code>DOM</code>çš„ä»£ä»·ä»æ—§æ˜¯æ˜‚è´µçš„ï¼Œé¢‘ç¹æ“ä½œè¿˜æ˜¯ä¼šå‡ºç°é¡µé¢å¡é¡¿ï¼Œå½±å“ç”¨æˆ·çš„ä½“éªŒ</p>
<p><strong>ä¸¾ä¸ªä¾‹å­ï¼š</strong></p>
<p>ä½ ç”¨ä¼ ç»Ÿçš„åŸç”Ÿ<code>api</code>æˆ–<code>jQuery</code>å»æ“ä½œ<code>DOM</code>æ—¶ï¼Œæµè§ˆå™¨ä¼šä»æ„å»º<code>DOM</code>æ ‘å¼€å§‹ä»å¤´åˆ°å°¾æ‰§è¡Œä¸€éæµç¨‹</p>
<p>å½“ä½ åœ¨ä¸€æ¬¡æ“ä½œæ—¶ï¼Œéœ€è¦æ›´æ–°10ä¸ª<code>DOM</code>èŠ‚ç‚¹ï¼Œæµè§ˆå™¨æ²¡è¿™ä¹ˆæ™ºèƒ½ï¼Œæ”¶åˆ°ç¬¬ä¸€ä¸ªæ›´æ–°<code>DOM</code>è¯·æ±‚åï¼Œå¹¶ä¸çŸ¥é“åç»­è¿˜æœ‰9æ¬¡æ›´æ–°æ“ä½œï¼Œå› æ­¤ä¼šé©¬ä¸Šæ‰§è¡Œæµç¨‹ï¼Œæœ€ç»ˆæ‰§è¡Œ10æ¬¡æµç¨‹</p>
<p>è€Œé€šè¿‡<code>VNode</code>ï¼ŒåŒæ ·æ›´æ–°10ä¸ª<code>DOM</code>èŠ‚ç‚¹ï¼Œè™šæ‹Ÿ<code>DOM</code>ä¸ä¼šç«‹å³æ“ä½œ<code>DOM</code>ï¼Œè€Œæ˜¯å°†è¿™10æ¬¡æ›´æ–°çš„<code>diff</code>å†…å®¹ä¿å­˜åˆ°æœ¬åœ°çš„ä¸€ä¸ª<code>js</code>å¯¹è±¡ä¸­ï¼Œæœ€ç»ˆå°†è¿™ä¸ª<code>js</code>å¯¹è±¡ä¸€æ¬¡æ€§<code>attach</code>åˆ°<code>DOM</code>æ ‘ä¸Šï¼Œé¿å…å¤§é‡çš„æ— è°“è®¡ç®—</p>
<blockquote>
<p>å¾ˆå¤šäººè®¤ä¸ºè™šæ‹Ÿ DOM æœ€å¤§çš„ä¼˜åŠ¿æ˜¯ diff ç®—æ³•ï¼Œå‡å°‘ JavaScript æ“ä½œçœŸå® DOM çš„å¸¦æ¥çš„æ€§èƒ½æ¶ˆè€—ã€‚è™½ç„¶è¿™ä¸€ä¸ªè™šæ‹Ÿ DOM å¸¦æ¥çš„ä¸€ä¸ªä¼˜åŠ¿ï¼Œä½†å¹¶ä¸æ˜¯å…¨éƒ¨ã€‚è™šæ‹Ÿ DOM æœ€å¤§çš„ä¼˜åŠ¿åœ¨äºæŠ½è±¡äº†åŸæœ¬çš„æ¸²æŸ“è¿‡ç¨‹ï¼Œå®ç°äº†è·¨å¹³å°çš„èƒ½åŠ›ï¼Œè€Œä¸ä»…ä»…å±€é™äºæµè§ˆå™¨çš„ DOMï¼Œå¯ä»¥æ˜¯å®‰å“å’Œ IOS çš„åŸç”Ÿç»„ä»¶ï¼Œå¯ä»¥æ˜¯è¿‘æœŸå¾ˆç«çƒ­çš„å°ç¨‹åºï¼Œä¹Ÿå¯ä»¥æ˜¯å„ç§GUI</p>
</blockquote>
<h2 id="ä¸‰ã€å¦‚ä½•å®ç°è™šæ‹ŸDOM"><a href="#ä¸‰ã€å¦‚ä½•å®ç°è™šæ‹ŸDOM" class="headerlink" title="ä¸‰ã€å¦‚ä½•å®ç°è™šæ‹ŸDOM"></a>ä¸‰ã€å¦‚ä½•å®ç°è™šæ‹ŸDOM</h2><p>é¦–å…ˆå¯ä»¥çœ‹çœ‹<code>vue</code>ä¸­<code>VNode</code>çš„ç»“æ„</p>
<p>æºç ä½ç½®ï¼šsrc&#x2F;core&#x2F;vdom&#x2F;vnode.js</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="keyword">class</span> <span class="title class_">VNode</span> &#123;</span><br><span class="line">  <span class="attr">tag</span>: string | <span class="keyword">void</span>;</span><br><span class="line">  <span class="attr">data</span>: <span class="title class_">VNodeData</span> | <span class="keyword">void</span>;</span><br><span class="line">  <span class="attr">children</span>: ?<span class="title class_">Array</span>&lt;<span class="title class_">VNode</span>&gt;;</span><br><span class="line">  <span class="attr">text</span>: string | <span class="keyword">void</span>;</span><br><span class="line">  <span class="attr">elm</span>: <span class="title class_">Node</span> | <span class="keyword">void</span>;</span><br><span class="line">  <span class="attr">ns</span>: string | <span class="keyword">void</span>;</span><br><span class="line">  <span class="attr">context</span>: <span class="title class_">Component</span> | <span class="keyword">void</span>; <span class="comment">// rendered in this component&#x27;s scope</span></span><br><span class="line">  <span class="attr">functionalContext</span>: <span class="title class_">Component</span> | <span class="keyword">void</span>; <span class="comment">// only for functional component root nodes</span></span><br><span class="line">  <span class="attr">key</span>: string | number | <span class="keyword">void</span>;</span><br><span class="line">  <span class="attr">componentOptions</span>: <span class="title class_">VNodeComponentOptions</span> | <span class="keyword">void</span>;</span><br><span class="line">  <span class="attr">componentInstance</span>: <span class="title class_">Component</span> | <span class="keyword">void</span>; <span class="comment">// component instance</span></span><br><span class="line">  <span class="attr">parent</span>: <span class="title class_">VNode</span> | <span class="keyword">void</span>; <span class="comment">// component placeholder node</span></span><br><span class="line">  <span class="attr">raw</span>: boolean; <span class="comment">// contains raw HTML? (server only)</span></span><br><span class="line">  <span class="attr">isStatic</span>: boolean; <span class="comment">// hoisted static node</span></span><br><span class="line">  <span class="attr">isRootInsert</span>: boolean; <span class="comment">// necessary for enter transition check</span></span><br><span class="line">  <span class="attr">isComment</span>: boolean; <span class="comment">// empty comment placeholder?</span></span><br><span class="line">  <span class="attr">isCloned</span>: boolean; <span class="comment">// is a cloned node?</span></span><br><span class="line">  <span class="attr">isOnce</span>: boolean; <span class="comment">// is a v-once node?</span></span><br><span class="line"></span><br><span class="line">  <span class="title function_">constructor</span> (</span><br><span class="line">    tag?: string,</span><br><span class="line">    data?: <span class="title class_">VNodeData</span>,</span><br><span class="line">    children?: ?<span class="title class_">Array</span>&lt;<span class="title class_">VNode</span>&gt;,</span><br><span class="line">    text?: string,</span><br><span class="line">    elm?: <span class="title class_">Node</span>,</span><br><span class="line">    context?: <span class="title class_">Component</span>,</span><br><span class="line">    componentOptions?: <span class="title class_">VNodeComponentOptions</span></span><br><span class="line">  ) &#123;</span><br><span class="line">    <span class="comment">/*å½“å‰èŠ‚ç‚¹çš„æ ‡ç­¾å*/</span></span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">tag</span> = tag</span><br><span class="line">    <span class="comment">/*å½“å‰èŠ‚ç‚¹å¯¹åº”çš„å¯¹è±¡ï¼ŒåŒ…å«äº†å…·ä½“çš„ä¸€äº›æ•°æ®ä¿¡æ¯ï¼Œæ˜¯ä¸€ä¸ªVNodeDataç±»å‹ï¼Œå¯ä»¥å‚è€ƒVNodeDataç±»å‹ä¸­çš„æ•°æ®ä¿¡æ¯*/</span></span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">data</span> = data</span><br><span class="line">    <span class="comment">/*å½“å‰èŠ‚ç‚¹çš„å­èŠ‚ç‚¹ï¼Œæ˜¯ä¸€ä¸ªæ•°ç»„*/</span></span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">children</span> = children</span><br><span class="line">    <span class="comment">/*å½“å‰èŠ‚ç‚¹çš„æ–‡æœ¬*/</span></span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">text</span> = text</span><br><span class="line">    <span class="comment">/*å½“å‰è™šæ‹ŸèŠ‚ç‚¹å¯¹åº”çš„çœŸå®domèŠ‚ç‚¹*/</span></span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">elm</span> = elm</span><br><span class="line">    <span class="comment">/*å½“å‰èŠ‚ç‚¹çš„åå­—ç©ºé—´*/</span></span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">ns</span> = <span class="literal">undefined</span></span><br><span class="line">    <span class="comment">/*ç¼–è¯‘ä½œç”¨åŸŸ*/</span></span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">context</span> = context</span><br><span class="line">    <span class="comment">/*å‡½æ•°åŒ–ç»„ä»¶ä½œç”¨åŸŸ*/</span></span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">functionalContext</span> = <span class="literal">undefined</span></span><br><span class="line">    <span class="comment">/*èŠ‚ç‚¹çš„keyå±æ€§ï¼Œè¢«å½“ä½œèŠ‚ç‚¹çš„æ ‡å¿—ï¼Œç”¨ä»¥ä¼˜åŒ–*/</span></span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">key</span> = data &amp;&amp; data.<span class="property">key</span></span><br><span class="line">    <span class="comment">/*ç»„ä»¶çš„optioné€‰é¡¹*/</span></span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">componentOptions</span> = componentOptions</span><br><span class="line">    <span class="comment">/*å½“å‰èŠ‚ç‚¹å¯¹åº”çš„ç»„ä»¶çš„å®ä¾‹*/</span></span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">componentInstance</span> = <span class="literal">undefined</span></span><br><span class="line">    <span class="comment">/*å½“å‰èŠ‚ç‚¹çš„çˆ¶èŠ‚ç‚¹*/</span></span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">parent</span> = <span class="literal">undefined</span></span><br><span class="line">    <span class="comment">/*ç®€è€Œè¨€ä¹‹å°±æ˜¯æ˜¯å¦ä¸ºåŸç”ŸHTMLæˆ–åªæ˜¯æ™®é€šæ–‡æœ¬ï¼ŒinnerHTMLçš„æ—¶å€™ä¸ºtrueï¼ŒtextContentçš„æ—¶å€™ä¸ºfalse*/</span></span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">raw</span> = <span class="literal">false</span></span><br><span class="line">    <span class="comment">/*é™æ€èŠ‚ç‚¹æ ‡å¿—*/</span></span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">isStatic</span> = <span class="literal">false</span></span><br><span class="line">    <span class="comment">/*æ˜¯å¦ä½œä¸ºè·ŸèŠ‚ç‚¹æ’å…¥*/</span></span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">isRootInsert</span> = <span class="literal">true</span></span><br><span class="line">    <span class="comment">/*æ˜¯å¦ä¸ºæ³¨é‡ŠèŠ‚ç‚¹*/</span></span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">isComment</span> = <span class="literal">false</span></span><br><span class="line">    <span class="comment">/*æ˜¯å¦ä¸ºå…‹éš†èŠ‚ç‚¹*/</span></span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">isCloned</span> = <span class="literal">false</span></span><br><span class="line">    <span class="comment">/*æ˜¯å¦æœ‰v-onceæŒ‡ä»¤*/</span></span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">isOnce</span> = <span class="literal">false</span></span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// DEPRECATED: alias for componentInstance for backwards compat.</span></span><br><span class="line">  <span class="comment">/* istanbul ignore next https://github.com/answershuto/learnVue*/</span></span><br><span class="line">  get child (): <span class="title class_">Component</span> | <span class="keyword">void</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="variable language_">this</span>.<span class="property">componentInstance</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>è¿™é‡Œå¯¹<code>VNode</code>è¿›è¡Œç¨å¾®çš„è¯´æ˜ï¼š</p>
<ul>
<li>æ‰€æœ‰å¯¹è±¡çš„ <code>context</code> é€‰é¡¹éƒ½æŒ‡å‘äº† <code>Vue</code> å®ä¾‹</li>
<li><code>elm</code> å±æ€§åˆ™æŒ‡å‘äº†å…¶ç›¸å¯¹åº”çš„çœŸå® <code>DOM</code> èŠ‚ç‚¹</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">vue`æ˜¯é€šè¿‡`createElement`ç”Ÿæˆ`VNode</span><br></pre></td></tr></table></figure>

<p>æºç ä½ç½®ï¼šsrc&#x2F;core&#x2F;vdom&#x2F;create-element.js</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="keyword">function</span> <span class="title function_">createElement</span> (</span><br><span class="line">  <span class="attr">context</span>: <span class="title class_">Component</span>,</span><br><span class="line">  <span class="attr">tag</span>: any,</span><br><span class="line">  <span class="attr">data</span>: any,</span><br><span class="line">  <span class="attr">children</span>: any,</span><br><span class="line">  <span class="attr">normalizationType</span>: any,</span><br><span class="line">  <span class="attr">alwaysNormalize</span>: boolean</span><br><span class="line">): <span class="title class_">VNode</span> | <span class="title class_">Array</span>&lt;<span class="title class_">VNode</span>&gt; &#123;</span><br><span class="line">  <span class="keyword">if</span> (<span class="title class_">Array</span>.<span class="title function_">isArray</span>(data) || <span class="title function_">isPrimitive</span>(data)) &#123;</span><br><span class="line">    normalizationType = children</span><br><span class="line">    children = data</span><br><span class="line">    data = <span class="literal">undefined</span></span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">if</span> (<span class="title function_">isTrue</span>(alwaysNormalize)) &#123;</span><br><span class="line">    normalizationType = <span class="variable constant_">ALWAYS_NORMALIZE</span></span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> <span class="title function_">_createElement</span>(context, tag, data, children, normalizationType)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>ä¸Šé¢å¯ä»¥çœ‹åˆ°<code>createElement</code> æ–¹æ³•å®é™…ä¸Šæ˜¯å¯¹ <code>_createElement</code> æ–¹æ³•çš„å°è£…ï¼Œå¯¹å‚æ•°çš„ä¼ å…¥è¿›è¡Œäº†åˆ¤æ–­</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="keyword">function</span> <span class="title function_">_createElement</span>(<span class="params"></span></span><br><span class="line"><span class="params">    context: Component,</span></span><br><span class="line"><span class="params">    tag?: string | Class&lt;Component&gt; | <span class="built_in">Function</span> | <span class="built_in">Object</span>,</span></span><br><span class="line"><span class="params">    data?: VNodeData,</span></span><br><span class="line"><span class="params">    children?: any,</span></span><br><span class="line"><span class="params">    normalizationType?: number</span></span><br><span class="line"><span class="params"></span>): <span class="title class_">VNode</span> | <span class="title class_">Array</span>&lt;<span class="title class_">VNode</span>&gt; &#123;</span><br><span class="line">    <span class="keyword">if</span> (<span class="title function_">isDef</span>(data) &amp;&amp; <span class="title function_">isDef</span>((<span class="attr">data</span>: any).<span class="property">__ob__</span>)) &#123;</span><br><span class="line">        process.<span class="property">env</span>.<span class="property">NODE_ENV</span> !== <span class="string">&#x27;production&#x27;</span> &amp;&amp; <span class="title function_">warn</span>(</span><br><span class="line">            <span class="string">`Avoid using observed data object as vnode data: <span class="subst">$&#123;<span class="built_in">JSON</span>.stringify(data)&#125;</span>\n`</span> +</span><br><span class="line">            <span class="string">&#x27;Always create fresh vnode data objects in each render!&#x27;</span>,</span><br><span class="line">            context<span class="string">`</span></span><br><span class="line"><span class="string">        )</span></span><br><span class="line"><span class="string">        return createEmptyVNode()</span></span><br><span class="line"><span class="string">    &#125;</span></span><br><span class="line"><span class="string">    // object syntax in v-bind</span></span><br><span class="line"><span class="string">    if (isDef(data) &amp;&amp; isDef(data.is)) &#123;</span></span><br><span class="line"><span class="string">        tag = data.is</span></span><br><span class="line"><span class="string">    &#125;</span></span><br><span class="line"><span class="string">    if (!tag) &#123;</span></span><br><span class="line"><span class="string">        // in case of component :is set to falsy value</span></span><br><span class="line"><span class="string">        return createEmptyVNode()</span></span><br><span class="line"><span class="string">    &#125;</span></span><br><span class="line"><span class="string">    ... </span></span><br><span class="line"><span class="string">    // support single function children as default scoped slot</span></span><br><span class="line"><span class="string">    if (Array.isArray(children) &amp;&amp;</span></span><br><span class="line"><span class="string">        typeof children[0] === &#x27;function&#x27;</span></span><br><span class="line"><span class="string">    ) &#123;</span></span><br><span class="line"><span class="string">        data = data || &#123;&#125;</span></span><br><span class="line"><span class="string">        data.scopedSlots = &#123; default: children[0] &#125;</span></span><br><span class="line"><span class="string">        children.length = 0</span></span><br><span class="line"><span class="string">    &#125;</span></span><br><span class="line"><span class="string">    if (normalizationType === ALWAYS_NORMALIZE) &#123;</span></span><br><span class="line"><span class="string">        children = normalizeChildren(children)</span></span><br><span class="line"><span class="string">    &#125; else if ( === SIMPLE_NORMALIZE) &#123;</span></span><br><span class="line"><span class="string">        children = simpleNormalizeChildren(children)</span></span><br><span class="line"><span class="string">    &#125;</span></span><br><span class="line"><span class="string">	// åˆ›å»ºVNode</span></span><br><span class="line"><span class="string">    ...</span></span><br><span class="line"><span class="string">&#125;</span></span><br><span class="line"><span class="string"></span></span><br></pre></td></tr></table></figure>

<p>å¯ä»¥çœ‹åˆ°<code>_createElement</code>æ¥æ”¶5ä¸ªå‚æ•°ï¼š</p>
<ul>
<li><code>context</code> è¡¨ç¤º <code>VNode</code> çš„ä¸Šä¸‹æ–‡ç¯å¢ƒï¼Œæ˜¯ <code>Component</code> ç±»å‹</li>
<li>tag è¡¨ç¤ºæ ‡ç­¾ï¼Œå®ƒå¯ä»¥æ˜¯ä¸€ä¸ªå­—ç¬¦ä¸²ï¼Œä¹Ÿå¯ä»¥æ˜¯ä¸€ä¸ª <code>Component</code></li>
<li><code>data</code> è¡¨ç¤º <code>VNode</code> çš„æ•°æ®ï¼Œå®ƒæ˜¯ä¸€ä¸ª <code>VNodeData</code> ç±»å‹</li>
<li><code>children</code> è¡¨ç¤ºå½“å‰ <code>VNode</code>çš„å­èŠ‚ç‚¹ï¼Œå®ƒæ˜¯ä»»æ„ç±»å‹çš„</li>
<li><code>normalizationType</code> è¡¨ç¤ºå­èŠ‚ç‚¹è§„èŒƒçš„ç±»å‹ï¼Œç±»å‹ä¸åŒè§„èŒƒçš„æ–¹æ³•ä¹Ÿå°±ä¸ä¸€æ ·ï¼Œä¸»è¦æ˜¯å‚è€ƒ <code>render</code>å‡½æ•°æ˜¯ç¼–è¯‘ç”Ÿæˆçš„è¿˜æ˜¯ç”¨æˆ·æ‰‹å†™çš„</li>
</ul>
<p>æ ¹æ®<code>normalizationType</code> çš„ç±»å‹ï¼Œ<code>children</code>ä¼šæœ‰ä¸åŒçš„å®šä¹‰</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> (normalizationType === <span class="variable constant_">ALWAYS_NORMALIZE</span>) &#123;</span><br><span class="line">    children = <span class="title function_">normalizeChildren</span>(children)</span><br><span class="line">&#125; <span class="keyword">else</span> <span class="keyword">if</span> ( === <span class="variable constant_">SIMPLE_NORMALIZE</span>) &#123;</span><br><span class="line">    children = <span class="title function_">simpleNormalizeChildren</span>(children)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><code>simpleNormalizeChildren</code>æ–¹æ³•è°ƒç”¨åœºæ™¯æ˜¯ <code>render</code> å‡½æ•°æ˜¯ç¼–è¯‘ç”Ÿæˆçš„</p>
<p><code>normalizeChildren</code>æ–¹æ³•è°ƒç”¨åœºæ™¯åˆ†ä¸ºä¸‹é¢ä¸¤ç§ï¼š</p>
<ul>
<li><code>render</code> å‡½æ•°æ˜¯ç”¨æˆ·æ‰‹å†™çš„</li>
<li>ç¼–è¯‘ <code>slot</code>ã€<code>v-for</code> çš„æ—¶å€™ä¼šäº§ç”ŸåµŒå¥—æ•°ç»„</li>
</ul>
<p>æ— è®ºæ˜¯<code>simpleNormalizeChildren</code>è¿˜æ˜¯<code>normalizeChildren</code>éƒ½æ˜¯å¯¹<code>children</code>è¿›è¡Œè§„èŒƒï¼ˆä½¿<code>children</code> å˜æˆäº†ä¸€ä¸ªç±»å‹ä¸º <code>VNode</code> çš„ <code>Array</code>ï¼‰ï¼Œè¿™é‡Œå°±ä¸å±•å¼€è¯´äº†</p>
<p>è§„èŒƒåŒ–<code>children</code>çš„æºç ä½ç½®åœ¨ï¼šsrc&#x2F;core&#x2F;vdom&#x2F;helpers&#x2F;normalzie-children.js</p>
<p>åœ¨è§„èŒƒåŒ–<code>children</code>åï¼Œå°±å»åˆ›å»º<code>VNode</code></p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> vnode, ns</span><br><span class="line"><span class="comment">// å¯¹tagè¿›è¡Œåˆ¤æ–­</span></span><br><span class="line"><span class="keyword">if</span> (<span class="keyword">typeof</span> tag === <span class="string">&#x27;string&#x27;</span>) &#123;</span><br><span class="line">  <span class="keyword">let</span> <span class="title class_">Ctor</span></span><br><span class="line">  ns = (context.<span class="property">$vnode</span> &amp;&amp; context.<span class="property">$vnode</span>.<span class="property">ns</span>) || config.<span class="title function_">getTagNamespace</span>(tag)</span><br><span class="line">  <span class="keyword">if</span> (config.<span class="title function_">isReservedTag</span>(tag)) &#123;</span><br><span class="line">    <span class="comment">// å¦‚æœæ˜¯å†…ç½®çš„èŠ‚ç‚¹ï¼Œåˆ™ç›´æ¥åˆ›å»ºä¸€ä¸ªæ™®é€šVNode</span></span><br><span class="line">    vnode = <span class="keyword">new</span> <span class="title class_">VNode</span>(</span><br><span class="line">      config.<span class="title function_">parsePlatformTagName</span>(tag), data, children,</span><br><span class="line">      <span class="literal">undefined</span>, <span class="literal">undefined</span>, context</span><br><span class="line">    )</span><br><span class="line">  &#125; <span class="keyword">else</span> <span class="keyword">if</span> (<span class="title function_">isDef</span>(<span class="title class_">Ctor</span> = <span class="title function_">resolveAsset</span>(context.<span class="property">$options</span>, <span class="string">&#x27;components&#x27;</span>, tag))) &#123;</span><br><span class="line">    <span class="comment">// component</span></span><br><span class="line">    <span class="comment">// å¦‚æœæ˜¯componentç±»å‹ï¼Œåˆ™ä¼šé€šè¿‡createComponentåˆ›å»ºVNodeèŠ‚ç‚¹</span></span><br><span class="line">    vnode = <span class="title function_">createComponent</span>(<span class="title class_">Ctor</span>, data, context, children, tag)</span><br><span class="line">  &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    vnode = <span class="keyword">new</span> <span class="title class_">VNode</span>(</span><br><span class="line">      tag, data, children,</span><br><span class="line">      <span class="literal">undefined</span>, <span class="literal">undefined</span>, context</span><br><span class="line">    )</span><br><span class="line">  &#125;</span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">  <span class="comment">// direct component options / constructor</span></span><br><span class="line">  vnode = <span class="title function_">createComponent</span>(tag, data, context, children)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">createComponent`åŒæ ·æ˜¯åˆ›å»º`VNode</span><br></pre></td></tr></table></figure>

<p>æºç ä½ç½®ï¼šsrc&#x2F;core&#x2F;vdom&#x2F;create-component.js</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="keyword">function</span> <span class="title function_">createComponent</span> (</span><br><span class="line">  <span class="title class_">Ctor</span>: <span class="title class_">Class</span>&lt;<span class="title class_">Component</span>&gt; | <span class="title class_">Function</span> | <span class="title class_">Object</span> | <span class="keyword">void</span>,</span><br><span class="line">  <span class="attr">data</span>: ?<span class="title class_">VNodeData</span>,</span><br><span class="line">  <span class="attr">context</span>: <span class="title class_">Component</span>,</span><br><span class="line">  <span class="attr">children</span>: ?<span class="title class_">Array</span>&lt;<span class="title class_">VNode</span>&gt;,</span><br><span class="line">  tag?: string</span><br><span class="line">): <span class="title class_">VNode</span> | <span class="title class_">Array</span>&lt;<span class="title class_">VNode</span>&gt; | <span class="keyword">void</span> &#123;</span><br><span class="line">  <span class="keyword">if</span> (<span class="title function_">isUndef</span>(<span class="title class_">Ctor</span>)) &#123;</span><br><span class="line">    <span class="keyword">return</span></span><br><span class="line">  &#125;</span><br><span class="line"> <span class="comment">// æ„å»ºå­ç±»æ„é€ å‡½æ•° </span></span><br><span class="line">  <span class="keyword">const</span> baseCtor = context.<span class="property">$options</span>.<span class="property">_base</span></span><br><span class="line"></span><br><span class="line">  <span class="comment">// plain options object: turn it into a constructor</span></span><br><span class="line">  <span class="keyword">if</span> (<span class="title function_">isObject</span>(<span class="title class_">Ctor</span>)) &#123;</span><br><span class="line">    <span class="title class_">Ctor</span> = baseCtor.<span class="title function_">extend</span>(<span class="title class_">Ctor</span>)</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// if at this stage it&#x27;s not a constructor or an async component factory,</span></span><br><span class="line">  <span class="comment">// reject.</span></span><br><span class="line">  <span class="keyword">if</span> (<span class="keyword">typeof</span> <span class="title class_">Ctor</span> !== <span class="string">&#x27;function&#x27;</span>) &#123;</span><br><span class="line">    <span class="keyword">if</span> (process.<span class="property">env</span>.<span class="property">NODE_ENV</span> !== <span class="string">&#x27;production&#x27;</span>) &#123;</span><br><span class="line">      <span class="title function_">warn</span>(<span class="string">`Invalid Component definition: <span class="subst">$&#123;<span class="built_in">String</span>(Ctor)&#125;</span>`</span>, context)</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span></span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// async component</span></span><br><span class="line">  <span class="keyword">let</span> asyncFactory</span><br><span class="line">  <span class="keyword">if</span> (<span class="title function_">isUndef</span>(<span class="title class_">Ctor</span>.<span class="property">cid</span>)) &#123;</span><br><span class="line">    asyncFactory = <span class="title class_">Ctor</span></span><br><span class="line">    <span class="title class_">Ctor</span> = <span class="title function_">resolveAsyncComponent</span>(asyncFactory, baseCtor, context)</span><br><span class="line">    <span class="keyword">if</span> (<span class="title class_">Ctor</span> === <span class="literal">undefined</span>) &#123;</span><br><span class="line">      <span class="keyword">return</span> <span class="title function_">createAsyncPlaceholder</span>(</span><br><span class="line">        asyncFactory,</span><br><span class="line">        data,</span><br><span class="line">        context,</span><br><span class="line">        children,</span><br><span class="line">        tag</span><br><span class="line">      )</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  data = data || &#123;&#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// resolve constructor options in case global mixins are applied after</span></span><br><span class="line">  <span class="comment">// component constructor creation</span></span><br><span class="line">  <span class="title function_">resolveConstructorOptions</span>(<span class="title class_">Ctor</span>)</span><br><span class="line"></span><br><span class="line">  <span class="comment">// transform component v-model data into props &amp; events</span></span><br><span class="line">  <span class="keyword">if</span> (<span class="title function_">isDef</span>(data.<span class="property">model</span>)) &#123;</span><br><span class="line">    <span class="title function_">transformModel</span>(<span class="title class_">Ctor</span>.<span class="property">options</span>, data)</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// extract props</span></span><br><span class="line">  <span class="keyword">const</span> propsData = <span class="title function_">extractPropsFromVNodeData</span>(data, <span class="title class_">Ctor</span>, tag)</span><br><span class="line"></span><br><span class="line">  <span class="comment">// functional component</span></span><br><span class="line">  <span class="keyword">if</span> (<span class="title function_">isTrue</span>(<span class="title class_">Ctor</span>.<span class="property">options</span>.<span class="property">functional</span>)) &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="title function_">createFunctionalComponent</span>(<span class="title class_">Ctor</span>, propsData, data, context, children)</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// extract listeners, since these needs to be treated as</span></span><br><span class="line">  <span class="comment">// child component listeners instead of DOM listeners</span></span><br><span class="line">  <span class="keyword">const</span> listeners = data.<span class="property">on</span></span><br><span class="line">  <span class="comment">// replace with listeners with .native modifier</span></span><br><span class="line">  <span class="comment">// so it gets processed during parent component patch.</span></span><br><span class="line">  data.<span class="property">on</span> = data.<span class="property">nativeOn</span></span><br><span class="line"></span><br><span class="line">  <span class="keyword">if</span> (<span class="title function_">isTrue</span>(<span class="title class_">Ctor</span>.<span class="property">options</span>.<span class="property">abstract</span>)) &#123;</span><br><span class="line">    <span class="keyword">const</span> slot = data.<span class="property">slot</span></span><br><span class="line">    data = &#123;&#125;</span><br><span class="line">    <span class="keyword">if</span> (slot) &#123;</span><br><span class="line">      data.<span class="property">slot</span> = slot</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// å®‰è£…ç»„ä»¶é’©å­å‡½æ•°ï¼ŒæŠŠé’©å­å‡½æ•°åˆå¹¶åˆ°data.hookä¸­</span></span><br><span class="line">  <span class="title function_">installComponentHooks</span>(data)</span><br><span class="line"></span><br><span class="line">  <span class="comment">//å®ä¾‹åŒ–ä¸€ä¸ªVNodeè¿”å›ã€‚ç»„ä»¶çš„VNodeæ˜¯æ²¡æœ‰childrençš„</span></span><br><span class="line">  <span class="keyword">const</span> name = <span class="title class_">Ctor</span>.<span class="property">options</span>.<span class="property">name</span> || tag</span><br><span class="line">  <span class="keyword">const</span> vnode = <span class="keyword">new</span> <span class="title class_">VNode</span>(</span><br><span class="line">    <span class="string">`vue-component-<span class="subst">$&#123;Ctor.cid&#125;</span><span class="subst">$&#123;name ? <span class="string">`-<span class="subst">$&#123;name&#125;</span>`</span> : <span class="string">&#x27;&#x27;</span>&#125;</span>`</span>,</span><br><span class="line">    data, <span class="literal">undefined</span>, <span class="literal">undefined</span>, <span class="literal">undefined</span>, context,</span><br><span class="line">    &#123; <span class="title class_">Ctor</span>, propsData, listeners, tag, children &#125;,</span><br><span class="line">    asyncFactory</span><br><span class="line">  )</span><br><span class="line">  <span class="keyword">if</span> (__WEEX__ &amp;&amp; <span class="title function_">isRecyclableComponent</span>(vnode)) &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="title function_">renderRecyclableComponentTemplate</span>(vnode)</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> vnode</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>ç¨å¾®æä¸‹<code>createComponent</code>ç”Ÿæˆ<code>VNode</code>çš„ä¸‰ä¸ªå…³é”®æµç¨‹ï¼š</p>
<ul>
<li>æ„é€ å­ç±»æ„é€ å‡½æ•°<code>Ctor</code></li>
<li><code>installComponentHooks</code>å®‰è£…ç»„ä»¶é’©å­å‡½æ•°</li>
<li>å®ä¾‹åŒ– <code>vnode</code></li>
</ul>
<h3 id="å°ç»“"><a href="#å°ç»“" class="headerlink" title="å°ç»“"></a>å°ç»“</h3><p><code>createElement</code> åˆ›å»º <code>VNode</code> çš„è¿‡ç¨‹ï¼Œæ¯ä¸ª <code>VNode</code> æœ‰ <code>children</code>ï¼Œ<code>children</code> æ¯ä¸ªå…ƒç´ ä¹Ÿæ˜¯ä¸€ä¸ª<code>VNode</code>ï¼Œè¿™æ ·å°±å½¢æˆäº†ä¸€ä¸ªè™šæ‹Ÿæ ‘ç»“æ„ï¼Œç”¨äºæè¿°çœŸå®çš„<code>DOM</code>æ ‘ç»“æ„</p>

        
    </article>
    <footer class="cube-excerpt-footer">
        <a class="cube-excerpt-more" href="/2019/05/21/Vue/%E8%99%9A%E6%8B%9Fdom/">Read More</a>
    </footer>
</div>

<div class="cube-excerpt" id="cube-excerpt-WebSocket">
    <header class="cube-excerpt-header">
        <h1><a href="/2019/05/20/http/WebSocket/">WebSocket</a></h1>
        <div class="cube-excerpt-header-msg">
            <div class="cube-excerpt-date">
                <i class="cube-icon cube-icon-date" aria-hidden="true"></i>
                2019-05-20
            </div>
            <div class="cube-excerpt-tags">
                <i class="cube-icon cube-icon-tag" aria-hidden="true"></i>
                
                <a href="/tags/http/" class="cube-excerpt-tag-link">#http</a>
                
            </div>
        </div>
    </header>
    <article class="cube-excerpt-entry cube-markdown">
        
        
           <h2 id="ä¸€ã€æ˜¯ä»€ä¹ˆ"><a href="#ä¸€ã€æ˜¯ä»€ä¹ˆ" class="headerlink" title="ä¸€ã€æ˜¯ä»€ä¹ˆ"></a>ä¸€ã€æ˜¯ä»€ä¹ˆ</h2><p>WebSocketï¼Œæ˜¯ä¸€ç§ç½‘ç»œä¼ è¾“åè®®ï¼Œä½äº<code>OSI</code>æ¨¡å‹çš„åº”ç”¨å±‚ã€‚å¯åœ¨å•ä¸ª<code>TCP</code>è¿æ¥ä¸Šè¿›è¡Œå…¨åŒå·¥é€šä¿¡ï¼Œèƒ½æ›´å¥½çš„èŠ‚çœæœåŠ¡å™¨èµ„æºå’Œå¸¦å®½å¹¶è¾¾åˆ°å®æ—¶é€šè¿…</p>
<p>å®¢æˆ·ç«¯å’ŒæœåŠ¡å™¨åªéœ€è¦å®Œæˆä¸€æ¬¡æ¡æ‰‹ï¼Œä¸¤è€…ä¹‹é—´å°±å¯ä»¥åˆ›å»ºæŒä¹…æ€§çš„è¿æ¥ï¼Œå¹¶è¿›è¡ŒåŒå‘æ•°æ®ä¼ è¾“</p>
<p><img src="https://static.vue-js.com/ad386e20-c0f1-11eb-85f6-6fac77c0c9b3.png" alt="img"></p>
<p>ä»ä¸Šå›¾å¯è§ï¼Œ<code>websocket</code>æœåŠ¡å™¨ä¸å®¢æˆ·ç«¯é€šè¿‡æ¡æ‰‹è¿æ¥ï¼Œè¿æ¥æˆåŠŸåï¼Œä¸¤è€…éƒ½èƒ½ä¸»åŠ¨çš„å‘å¯¹æ–¹å‘é€æˆ–æ¥å—æ•°æ®</p>
<p>è€Œåœ¨<code>websocket</code>å‡ºç°ä¹‹å‰ï¼Œå¼€å‘å®æ—¶<code>web</code>åº”ç”¨çš„æ–¹å¼ä¸ºè½®è¯¢</p>
<p>ä¸åœåœ°å‘æœåŠ¡å™¨å‘é€ HTTP è¯·æ±‚ï¼Œé—®æœ‰æ²¡æœ‰æ•°æ®ï¼Œæœ‰æ•°æ®çš„è¯æœåŠ¡å™¨å°±ç”¨å“åº”æŠ¥æ–‡å›åº”ã€‚å¦‚æœè½®è¯¢çš„é¢‘ç‡æ¯”è¾ƒé«˜ï¼Œé‚£ä¹ˆå°±å¯ä»¥è¿‘ä¼¼åœ°å®ç°â€œå®æ—¶é€šä¿¡â€çš„æ•ˆæœ</p>
<p>è½®è¯¢çš„ç¼ºç‚¹ä¹Ÿå¾ˆæ˜æ˜¾ï¼Œåå¤å‘é€æ— æ•ˆæŸ¥è¯¢è¯·æ±‚è€—è´¹äº†å¤§é‡çš„å¸¦å®½å’Œ <code>CPU</code>èµ„æº</p>
<h2 id="äºŒã€ç‰¹ç‚¹"><a href="#äºŒã€ç‰¹ç‚¹" class="headerlink" title="äºŒã€ç‰¹ç‚¹"></a>äºŒã€ç‰¹ç‚¹</h2><h3 id="å…¨åŒå·¥"><a href="#å…¨åŒå·¥" class="headerlink" title="å…¨åŒå·¥"></a>å…¨åŒå·¥</h3><p>é€šä¿¡å…è®¸æ•°æ®åœ¨ä¸¤ä¸ªæ–¹å‘ä¸ŠåŒæ—¶ä¼ è¾“ï¼Œå®ƒåœ¨èƒ½åŠ›ä¸Šç›¸å½“äºä¸¤ä¸ªå•å·¥é€šä¿¡æ–¹å¼çš„ç»“åˆ</p>
<p>ä¾‹å¦‚æŒ‡ Aâ†’B çš„åŒæ—¶ Bâ†’A ï¼Œæ˜¯ç¬æ—¶åŒæ­¥çš„</p>
<h3 id="äºŒè¿›åˆ¶å¸§"><a href="#äºŒè¿›åˆ¶å¸§" class="headerlink" title="äºŒè¿›åˆ¶å¸§"></a>äºŒè¿›åˆ¶å¸§</h3><p>é‡‡ç”¨äº†äºŒè¿›åˆ¶å¸§ç»“æ„ï¼Œè¯­æ³•ã€è¯­ä¹‰ä¸ HTTP å®Œå…¨ä¸å…¼å®¹ï¼Œç›¸æ¯”<code>http/2</code>ï¼Œ<code>WebSocket</code>æ›´ä¾§é‡äºâ€œå®æ—¶é€šä¿¡â€ï¼Œè€Œ<code>HTTP/2</code> æ›´ä¾§é‡äºæé«˜ä¼ è¾“æ•ˆç‡ï¼Œæ‰€ä»¥ä¸¤è€…çš„å¸§ç»“æ„ä¹Ÿæœ‰å¾ˆå¤§çš„åŒºåˆ«</p>
<p>ä¸åƒ <code>HTTP/2</code> é‚£æ ·å®šä¹‰æµï¼Œä¹Ÿå°±ä¸å­˜åœ¨å¤šè·¯å¤ç”¨ã€ä¼˜å…ˆçº§ç­‰ç‰¹æ€§</p>
<p>è‡ªèº«å°±æ˜¯å…¨åŒå·¥ï¼Œä¹Ÿä¸éœ€è¦æœåŠ¡å™¨æ¨é€</p>
<h3 id="åè®®å"><a href="#åè®®å" class="headerlink" title="åè®®å"></a>åè®®å</h3><p>å¼•å…¥<code>ws</code>å’Œ<code>wss</code>åˆ†åˆ«ä»£è¡¨æ˜æ–‡å’Œå¯†æ–‡çš„<code>websocket</code>åè®®ï¼Œä¸”é»˜è®¤ç«¯å£ä½¿ç”¨80æˆ–443ï¼Œå‡ ä¹ä¸<code>http</code>ä¸€è‡´</p>
<figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">ws://www.chrono.com</span><br><span class="line">ws://www.chrono.com:8080/srv</span><br><span class="line">wss://www.chrono.com:445/im?user_id=xxx</span><br></pre></td></tr></table></figure>

<h3 id="æ¡æ‰‹"><a href="#æ¡æ‰‹" class="headerlink" title="æ¡æ‰‹"></a>æ¡æ‰‹</h3><p><code>WebSocket</code>ä¹Ÿè¦æœ‰ä¸€ä¸ªæ¡æ‰‹è¿‡ç¨‹ï¼Œç„¶åæ‰èƒ½æ­£å¼æ”¶å‘æ•°æ®</p>
<p>å®¢æˆ·ç«¯å‘é€æ•°æ®æ ¼å¼å¦‚ä¸‹ï¼š</p>
<figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">GET</span> <span class="string">/chat</span> <span class="meta">HTTP/1.1</span></span><br><span class="line"><span class="attribute">Host</span><span class="punctuation">: </span>server.example.com</span><br><span class="line"><span class="attribute">Upgrade</span><span class="punctuation">: </span>websocket</span><br><span class="line"><span class="attribute">Connection</span><span class="punctuation">: </span>Upgrade</span><br><span class="line"><span class="attribute">Sec-WebSocket-Key</span><span class="punctuation">: </span>dGhlIHNhbXBsZSBub25jZQ==</span><br><span class="line"><span class="attribute">Origin</span><span class="punctuation">: </span>http://example.com</span><br><span class="line"><span class="attribute">Sec-WebSocket-Protocol</span><span class="punctuation">: </span>chat, superchat</span><br><span class="line"><span class="attribute">Sec-WebSocket-Version</span><span class="punctuation">: </span>13</span><br></pre></td></tr></table></figure>

<ul>
<li>Connectionï¼šå¿…é¡»è®¾ç½®Upgradeï¼Œè¡¨ç¤ºå®¢æˆ·ç«¯å¸Œæœ›è¿æ¥å‡çº§</li>
<li>Upgradeï¼šå¿…é¡»è®¾ç½®Websocketï¼Œè¡¨ç¤ºå¸Œæœ›å‡çº§åˆ°Websocketåè®®</li>
<li>Sec-WebSocket-Keyï¼šå®¢æˆ·ç«¯å‘é€çš„ä¸€ä¸ª base64 ç¼–ç çš„å¯†æ–‡ï¼Œç”¨äºç®€å•çš„è®¤è¯ç§˜é’¥ã€‚è¦æ±‚æœåŠ¡ç«¯å¿…é¡»è¿”å›ä¸€ä¸ªå¯¹åº”åŠ å¯†çš„â€œSec-WebSocket-Acceptåº”ç­”ï¼Œå¦åˆ™å®¢æˆ·ç«¯ä¼šæŠ›å‡ºé”™è¯¯ï¼Œå¹¶å…³é—­è¿æ¥</li>
<li>Sec-WebSocket-Version ï¼šè¡¨ç¤ºæ”¯æŒçš„Websocketç‰ˆæœ¬</li>
</ul>
<p>æœåŠ¡ç«¯è¿”å›çš„æ•°æ®æ ¼å¼ï¼š</p>
<figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">HTTP/1.1</span> <span class="number">101</span> Switching Protocols</span><br><span class="line"><span class="attribute">Upgrade</span><span class="punctuation">: </span>websocket</span><br><span class="line"><span class="attribute">Connection</span><span class="punctuation">: </span>Upgrade</span><br><span class="line"><span class="attribute">Sec-WebSocket-Accept</span><span class="punctuation">: </span>s3pPLMBiTxaQ9kYGzzhZRbK+xOo=Sec-WebSocket-Protocol: chat</span><br></pre></td></tr></table></figure>

<ul>
<li>HTTP&#x2F;1.1 101 Switching Protocolsï¼šè¡¨ç¤ºæœåŠ¡ç«¯æ¥å— WebSocket åè®®çš„å®¢æˆ·ç«¯è¿æ¥</li>
<li>Sec-WebSocket-Accepï¼šéªŒè¯å®¢æˆ·ç«¯è¯·æ±‚æŠ¥æ–‡ï¼ŒåŒæ ·ä¹Ÿæ˜¯ä¸ºäº†é˜²æ­¢è¯¯è¿æ¥ã€‚å…·ä½“åšæ³•æ˜¯æŠŠè¯·æ±‚å¤´é‡Œâ€œSec-WebSocket-Keyâ€çš„å€¼ï¼ŒåŠ ä¸Šä¸€ä¸ªä¸“ç”¨çš„ UUIDï¼Œå†è®¡ç®—æ‘˜è¦</li>
</ul>
<h3 id="ä¼˜ç‚¹"><a href="#ä¼˜ç‚¹" class="headerlink" title="ä¼˜ç‚¹"></a>ä¼˜ç‚¹</h3><ul>
<li>è¾ƒå°‘çš„æ§åˆ¶å¼€é”€ï¼šæ•°æ®åŒ…å¤´éƒ¨åè®®è¾ƒå°ï¼Œä¸åŒäºhttpæ¯æ¬¡è¯·æ±‚éœ€è¦æºå¸¦å®Œæ•´çš„å¤´éƒ¨</li>
<li>æ›´å¼ºçš„å®æ—¶æ€§ï¼šç›¸å¯¹äºHTTPè¯·æ±‚éœ€è¦ç­‰å¾…å®¢æˆ·ç«¯å‘èµ·è¯·æ±‚æœåŠ¡ç«¯æ‰èƒ½å“åº”ï¼Œå»¶è¿Ÿæ˜æ˜¾æ›´å°‘</li>
<li>ä¿æŒåˆ›è¿æ¥çŠ¶æ€ï¼šåˆ›å»ºé€šä¿¡åï¼Œå¯çœç•¥çŠ¶æ€ä¿¡æ¯ï¼Œä¸åŒäºHTTPæ¯æ¬¡è¯·æ±‚éœ€è¦æºå¸¦èº«ä»½éªŒè¯</li>
<li>æ›´å¥½çš„äºŒè¿›åˆ¶æ”¯æŒï¼šå®šä¹‰äº†äºŒè¿›åˆ¶å¸§ï¼Œæ›´å¥½å¤„ç†äºŒè¿›åˆ¶å†…å®¹</li>
<li>æ”¯æŒæ‰©å±•ï¼šç”¨æˆ·å¯ä»¥æ‰©å±•websocketåè®®ã€å®ç°éƒ¨åˆ†è‡ªå®šä¹‰çš„å­åè®®</li>
<li>æ›´å¥½çš„å‹ç¼©æ•ˆæœï¼šWebsocketåœ¨é€‚å½“çš„æ‰©å±•æ”¯æŒä¸‹ï¼Œå¯ä»¥æ²¿ç”¨ä¹‹å‰å†…å®¹çš„ä¸Šä¸‹æ–‡ï¼Œåœ¨ä¼ é€’ç±»ä¼¼çš„æ•°æ®æ—¶ï¼Œå¯ä»¥æ˜¾è‘—åœ°æé«˜å‹ç¼©ç‡</li>
</ul>
<h2 id="äºŒã€åº”ç”¨åœºæ™¯"><a href="#äºŒã€åº”ç”¨åœºæ™¯" class="headerlink" title="äºŒã€åº”ç”¨åœºæ™¯"></a>äºŒã€åº”ç”¨åœºæ™¯</h2><p>åŸºäº<code>websocket</code>çš„äº‹å®é€šä¿¡çš„ç‰¹ç‚¹ï¼Œå…¶å­˜åœ¨çš„åº”ç”¨åœºæ™¯å¤§æ¦‚æœ‰ï¼š</p>
<ul>
<li>å¼¹å¹•</li>
<li>åª’ä½“èŠå¤©</li>
<li>ååŒç¼–è¾‘</li>
<li>åŸºäºä½ç½®çš„åº”ç”¨</li>
<li>ä½“è‚²å®å†µæ›´æ–°</li>
<li>è‚¡ç¥¨åŸºé‡‘æŠ¥ä»·å®æ—¶æ›´æ–°</li>
</ul>

        
    </article>
    <footer class="cube-excerpt-footer">
        <a class="cube-excerpt-more" href="/2019/05/20/http/WebSocket/">Read More</a>
    </footer>
</div>

<div class="cube-excerpt" id="cube-excerpt-vue-æŒ‡ä»¤">
    <header class="cube-excerpt-header">
        <h1><a href="/2019/05/16/Vue/vue-%E6%8C%87%E4%BB%A4/">vue-æŒ‡ä»¤</a></h1>
        <div class="cube-excerpt-header-msg">
            <div class="cube-excerpt-date">
                <i class="cube-icon cube-icon-date" aria-hidden="true"></i>
                2019-05-16
            </div>
            <div class="cube-excerpt-tags">
                <i class="cube-icon cube-icon-tag" aria-hidden="true"></i>
                
                <a href="/tags/vue/" class="cube-excerpt-tag-link">#vue</a>
                
            </div>
        </div>
    </header>
    <article class="cube-excerpt-entry cube-markdown">
        
        
           <h2 id="ä¸€ã€ä»€ä¹ˆæ˜¯æŒ‡ä»¤"><a href="#ä¸€ã€ä»€ä¹ˆæ˜¯æŒ‡ä»¤" class="headerlink" title="ä¸€ã€ä»€ä¹ˆæ˜¯æŒ‡ä»¤"></a>ä¸€ã€ä»€ä¹ˆæ˜¯æŒ‡ä»¤</h2><p><strong>æŒ‡ä»¤ç³»ç»Ÿ</strong>æ˜¯è®¡ç®—æœºç¡¬ä»¶çš„è¯­è¨€ç³»ç»Ÿï¼Œä¹Ÿå«æœºå™¨è¯­è¨€ï¼Œå®ƒæ˜¯ç³»ç»Ÿç¨‹åºå‘˜çœ‹åˆ°çš„è®¡ç®—æœºçš„ä¸»è¦å±æ€§ã€‚å› æ­¤æŒ‡ä»¤ç³»ç»Ÿè¡¨å¾äº†è®¡ç®—æœºçš„åŸºæœ¬åŠŸèƒ½å†³å®šäº†æœºå™¨æ‰€è¦æ±‚çš„èƒ½åŠ›</p>
<p>åœ¨<code>vue</code>ä¸­æä¾›äº†ä¸€å¥—ä¸ºæ•°æ®é©±åŠ¨è§†å›¾æ›´ä¸ºæ–¹ä¾¿çš„æ“ä½œï¼Œè¿™äº›æ“ä½œè¢«ç§°ä¸ºæŒ‡ä»¤ç³»ç»Ÿ</p>
<p>æˆ‘ä»¬çœ‹åˆ°çš„<code>v-</code>å¼€å¤´çš„è¡Œå†…å±æ€§ï¼Œéƒ½æ˜¯æŒ‡ä»¤ï¼Œä¸åŒçš„æŒ‡ä»¤å¯ä»¥å®Œæˆæˆ–å®ç°ä¸åŒçš„åŠŸèƒ½</p>
<p>é™¤äº†æ ¸å¿ƒåŠŸèƒ½é»˜è®¤å†…ç½®çš„æŒ‡ä»¤ (<code>v-model</code> å’Œ <code>v-show</code>)ï¼Œ<code>Vue</code> ä¹Ÿå…è®¸æ³¨å†Œè‡ªå®šä¹‰æŒ‡ä»¤</p>
<p>æŒ‡ä»¤ä½¿ç”¨çš„å‡ ç§æ–¹å¼ï¼š</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//ä¼šå®ä¾‹åŒ–ä¸€ä¸ªæŒ‡ä»¤ï¼Œä½†è¿™ä¸ªæŒ‡ä»¤æ²¡æœ‰å‚æ•° </span></span><br><span class="line"><span class="string">`v-xxx`</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// -- å°†å€¼ä¼ åˆ°æŒ‡ä»¤ä¸­</span></span><br><span class="line"><span class="string">`v-xxx=&quot;value&quot;`</span>  </span><br><span class="line"></span><br><span class="line"><span class="comment">// -- å°†å­—ç¬¦ä¸²ä¼ å…¥åˆ°æŒ‡ä»¤ä¸­ï¼Œå¦‚`v-html=&quot;&#x27;&lt;p&gt;å†…å®¹&lt;/p&gt;&#x27;&quot;`</span></span><br><span class="line"><span class="string">`v-xxx=&quot;&#x27;string&#x27;&quot;`</span> </span><br><span class="line"></span><br><span class="line"><span class="comment">// -- ä¼ å‚æ•°ï¼ˆ`arg`ï¼‰ï¼Œå¦‚`v-bind:class=&quot;className&quot;`</span></span><br><span class="line"><span class="string">`v-xxx:arg=&quot;value&quot;`</span> </span><br><span class="line"></span><br><span class="line"><span class="comment">// -- ä½¿ç”¨ä¿®é¥°ç¬¦ï¼ˆ`modifier`ï¼‰</span></span><br><span class="line"><span class="string">`v-xxx:arg.modifier=&quot;value&quot;`</span> </span><br></pre></td></tr></table></figure>

<h3 id="äºŒã€å¦‚ä½•å®ç°"><a href="#äºŒã€å¦‚ä½•å®ç°" class="headerlink" title="äºŒã€å¦‚ä½•å®ç°"></a>äºŒã€å¦‚ä½•å®ç°</h3><p>æ³¨å†Œä¸€ä¸ªè‡ªå®šä¹‰æŒ‡ä»¤æœ‰å…¨å±€æ³¨å†Œä¸å±€éƒ¨æ³¨å†Œ</p>
<p>å…¨å±€æ³¨å†Œä¸»è¦æ˜¯é€šè¿‡<code>Vue.directive</code>æ–¹æ³•è¿›è¡Œæ³¨å†Œ</p>
<p><code>Vue.directive</code>ç¬¬ä¸€ä¸ªå‚æ•°æ˜¯æŒ‡ä»¤çš„åå­—ï¼ˆä¸éœ€è¦å†™ä¸Š<code>v-</code>å‰ç¼€ï¼‰ï¼Œç¬¬äºŒä¸ªå‚æ•°å¯ä»¥æ˜¯å¯¹è±¡æ•°æ®ï¼Œä¹Ÿå¯ä»¥æ˜¯ä¸€ä¸ªæŒ‡ä»¤å‡½æ•°</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// æ³¨å†Œä¸€ä¸ªå…¨å±€è‡ªå®šä¹‰æŒ‡ä»¤ `v-focus`</span></span><br><span class="line"><span class="title class_">Vue</span>.<span class="title function_">directive</span>(<span class="string">&#x27;focus&#x27;</span>, &#123;</span><br><span class="line">  <span class="comment">// å½“è¢«ç»‘å®šçš„å…ƒç´ æ’å…¥åˆ° DOM ä¸­æ—¶â€¦â€¦</span></span><br><span class="line">  <span class="attr">inserted</span>: <span class="keyword">function</span> (<span class="params">el</span>) &#123;</span><br><span class="line">    <span class="comment">// èšç„¦å…ƒç´ </span></span><br><span class="line">    el.<span class="title function_">focus</span>()  <span class="comment">// é¡µé¢åŠ è½½å®Œæˆä¹‹åè‡ªåŠ¨è®©è¾“å…¥æ¡†è·å–åˆ°ç„¦ç‚¹çš„å°åŠŸèƒ½</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>

<p>å±€éƒ¨æ³¨å†Œé€šè¿‡åœ¨ç»„ä»¶<code>options</code>é€‰é¡¹ä¸­è®¾ç½®<code>directive</code>å±æ€§</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">directives</span>: &#123;</span><br><span class="line">  <span class="attr">focus</span>: &#123;</span><br><span class="line">    <span class="comment">// æŒ‡ä»¤çš„å®šä¹‰</span></span><br><span class="line">    <span class="attr">inserted</span>: <span class="keyword">function</span> (<span class="params">el</span>) &#123;</span><br><span class="line">      el.<span class="title function_">focus</span>() <span class="comment">// é¡µé¢åŠ è½½å®Œæˆä¹‹åè‡ªåŠ¨è®©è¾“å…¥æ¡†è·å–åˆ°ç„¦ç‚¹çš„å°åŠŸèƒ½</span></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>ç„¶åä½ å¯ä»¥åœ¨æ¨¡æ¿ä¸­ä»»ä½•å…ƒç´ ä¸Šä½¿ç”¨æ–°çš„ <code>v-focus</code> propertyï¼Œå¦‚ä¸‹ï¼š</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;input v-focus /&gt;</span><br></pre></td></tr></table></figure>

<p>è‡ªå®šä¹‰æŒ‡ä»¤ä¹Ÿåƒç»„ä»¶é‚£æ ·å­˜åœ¨é’©å­å‡½æ•°ï¼š</p>
<ul>
<li><code>bind</code>ï¼šåªè°ƒç”¨ä¸€æ¬¡ï¼ŒæŒ‡ä»¤ç¬¬ä¸€æ¬¡ç»‘å®šåˆ°å…ƒç´ æ—¶è°ƒç”¨ã€‚åœ¨è¿™é‡Œå¯ä»¥è¿›è¡Œä¸€æ¬¡æ€§çš„åˆå§‹åŒ–è®¾ç½®</li>
<li><code>inserted</code>ï¼šè¢«ç»‘å®šå…ƒç´ æ’å…¥çˆ¶èŠ‚ç‚¹æ—¶è°ƒç”¨ (ä»…ä¿è¯çˆ¶èŠ‚ç‚¹å­˜åœ¨ï¼Œä½†ä¸ä¸€å®šå·²è¢«æ’å…¥æ–‡æ¡£ä¸­)</li>
<li><code>update</code>ï¼šæ‰€åœ¨ç»„ä»¶çš„ <code>VNode</code> æ›´æ–°æ—¶è°ƒç”¨ï¼Œä½†æ˜¯å¯èƒ½å‘ç”Ÿåœ¨å…¶å­ <code>VNode</code> æ›´æ–°ä¹‹å‰ã€‚æŒ‡ä»¤çš„å€¼å¯èƒ½å‘ç”Ÿäº†æ”¹å˜ï¼Œä¹Ÿå¯èƒ½æ²¡æœ‰ã€‚ä½†æ˜¯ä½ å¯ä»¥é€šè¿‡æ¯”è¾ƒæ›´æ–°å‰åçš„å€¼æ¥å¿½ç•¥ä¸å¿…è¦çš„æ¨¡æ¿æ›´æ–°</li>
<li><code>componentUpdated</code>ï¼šæŒ‡ä»¤æ‰€åœ¨ç»„ä»¶çš„ <code>VNode</code> åŠå…¶å­ <code>VNode</code> å…¨éƒ¨æ›´æ–°åè°ƒç”¨</li>
<li><code>unbind</code>ï¼šåªè°ƒç”¨ä¸€æ¬¡ï¼ŒæŒ‡ä»¤ä¸å…ƒç´ è§£ç»‘æ—¶è°ƒç”¨</li>
</ul>
<p>æ‰€æœ‰çš„é’©å­å‡½æ•°çš„å‚æ•°éƒ½æœ‰ä»¥ä¸‹ï¼š</p>
<ul>
<li><code>el</code>ï¼šæŒ‡ä»¤æ‰€ç»‘å®šçš„å…ƒç´ ï¼Œå¯ä»¥ç”¨æ¥ç›´æ¥æ“ä½œ <code>DOM</code></li>
<li>bindingï¼šä¸€ä¸ªå¯¹è±¡ï¼ŒåŒ…å«ä»¥ä¸‹propertyï¼š<ul>
<li><code>name</code>ï¼šæŒ‡ä»¤åï¼Œä¸åŒ…æ‹¬ <code>v-</code> å‰ç¼€ã€‚</li>
<li><code>value</code>ï¼šæŒ‡ä»¤çš„ç»‘å®šå€¼ï¼Œä¾‹å¦‚ï¼š<code>v-my-directive=&quot;1 + 1&quot;</code> ä¸­ï¼Œç»‘å®šå€¼ä¸º <code>2</code>ã€‚</li>
<li><code>oldValue</code>ï¼šæŒ‡ä»¤ç»‘å®šçš„å‰ä¸€ä¸ªå€¼ï¼Œä»…åœ¨ <code>update</code> å’Œ <code>componentUpdated</code> é’©å­ä¸­å¯ç”¨ã€‚æ— è®ºå€¼æ˜¯å¦æ”¹å˜éƒ½å¯ç”¨ã€‚</li>
<li><code>expression</code>ï¼šå­—ç¬¦ä¸²å½¢å¼çš„æŒ‡ä»¤è¡¨è¾¾å¼ã€‚ä¾‹å¦‚ <code>v-my-directive=&quot;1 + 1&quot;</code> ä¸­ï¼Œè¡¨è¾¾å¼ä¸º <code>&quot;1 + 1&quot;</code>ã€‚</li>
<li><code>arg</code>ï¼šä¼ ç»™æŒ‡ä»¤çš„å‚æ•°ï¼Œå¯é€‰ã€‚ä¾‹å¦‚ <code>v-my-directive:foo</code> ä¸­ï¼Œå‚æ•°ä¸º <code>&quot;foo&quot;</code>ã€‚</li>
<li><code>modifiers</code>ï¼šä¸€ä¸ªåŒ…å«ä¿®é¥°ç¬¦çš„å¯¹è±¡ã€‚ä¾‹å¦‚ï¼š<code>v-my-directive.foo.bar</code> ä¸­ï¼Œä¿®é¥°ç¬¦å¯¹è±¡ä¸º <code>&#123; foo: true, bar: true &#125;</code></li>
</ul>
</li>
<li><code>vnode</code>ï¼š<code>Vue</code> ç¼–è¯‘ç”Ÿæˆçš„è™šæ‹ŸèŠ‚ç‚¹</li>
<li><code>oldVnode</code>ï¼šä¸Šä¸€ä¸ªè™šæ‹ŸèŠ‚ç‚¹ï¼Œä»…åœ¨ <code>update</code> å’Œ <code>componentUpdated</code> é’©å­ä¸­å¯ç”¨</li>
</ul>
<blockquote>
<p>é™¤äº† <code>el</code> ä¹‹å¤–ï¼Œå…¶å®ƒå‚æ•°éƒ½åº”è¯¥æ˜¯åªè¯»çš„ï¼Œåˆ‡å‹¿è¿›è¡Œä¿®æ”¹ã€‚å¦‚æœéœ€è¦åœ¨é’©å­ä¹‹é—´å…±äº«æ•°æ®ï¼Œå»ºè®®é€šè¿‡å…ƒç´ çš„ <code>dataset</code> æ¥è¿›è¡Œ</p>
</blockquote>
<p>ä¸¾ä¸ªä¾‹å­ï¼š</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">v-demo</span>=<span class="string">&quot;&#123; color: &#x27;white&#x27;, text: &#x27;hello!&#x27; &#125;&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">    <span class="title class_">Vue</span>.<span class="title function_">directive</span>(<span class="string">&#x27;demo&#x27;</span>, <span class="keyword">function</span> (<span class="params">el, binding</span>) &#123;</span></span><br><span class="line"><span class="language-javascript">    <span class="variable language_">console</span>.<span class="title function_">log</span>(binding.<span class="property">value</span>.<span class="property">color</span>) <span class="comment">// &quot;white&quot;</span></span></span><br><span class="line"><span class="language-javascript">    <span class="variable language_">console</span>.<span class="title function_">log</span>(binding.<span class="property">value</span>.<span class="property">text</span>)  <span class="comment">// &quot;hello!&quot;</span></span></span><br><span class="line"><span class="language-javascript">    &#125;)</span></span><br><span class="line"><span class="language-javascript"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure>



<h2 id="ä¸‰ã€åº”ç”¨åœºæ™¯"><a href="#ä¸‰ã€åº”ç”¨åœºæ™¯" class="headerlink" title="ä¸‰ã€åº”ç”¨åœºæ™¯"></a>ä¸‰ã€åº”ç”¨åœºæ™¯</h2><p>ä½¿ç”¨è‡ªå®šä¹‰æŒ‡ä»¤å¯ä»¥æ»¡è¶³æˆ‘ä»¬æ—¥å¸¸ä¸€äº›åœºæ™¯ï¼Œè¿™é‡Œç»™å‡ºå‡ ä¸ªè‡ªå®šä¹‰æŒ‡ä»¤çš„æ¡ˆä¾‹ï¼š</p>
<ul>
<li>é˜²æŠ–</li>
<li>å›¾ç‰‡æ‡’åŠ è½½</li>
<li>ä¸€é”® Copyçš„åŠŸèƒ½</li>
</ul>
<h3 id="è¾“å…¥æ¡†é˜²æŠ–"><a href="#è¾“å…¥æ¡†é˜²æŠ–" class="headerlink" title="è¾“å…¥æ¡†é˜²æŠ–"></a>è¾“å…¥æ¡†é˜²æŠ–</h3><p>é˜²æŠ–è¿™ç§æƒ…å†µè®¾ç½®ä¸€ä¸ª<code>v-throttle</code>è‡ªå®šä¹‰æŒ‡ä»¤æ¥å®ç°</p>
<p>ä¸¾ä¸ªä¾‹å­ï¼š</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 1.è®¾ç½®v-throttleè‡ªå®šä¹‰æŒ‡ä»¤</span></span><br><span class="line"><span class="title class_">Vue</span>.<span class="title function_">directive</span>(<span class="string">&#x27;throttle&#x27;</span>, &#123;</span><br><span class="line">  <span class="attr">bind</span>: <span class="function">(<span class="params">el, binding</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">let</span> throttleTime = binding.<span class="property">value</span>; <span class="comment">// é˜²æŠ–æ—¶é—´</span></span><br><span class="line">    <span class="keyword">if</span> (!throttleTime) &#123; <span class="comment">// ç”¨æˆ·è‹¥ä¸è®¾ç½®é˜²æŠ–æ—¶é—´ï¼Œåˆ™é»˜è®¤2s</span></span><br><span class="line">      throttleTime = <span class="number">2000</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">let</span> cbFun;</span><br><span class="line">    el.<span class="title function_">addEventListener</span>(<span class="string">&#x27;click&#x27;</span>, <span class="function"><span class="params">event</span> =&gt;</span> &#123;</span><br><span class="line">      <span class="keyword">if</span> (!cbFun) &#123; <span class="comment">// ç¬¬ä¸€æ¬¡æ‰§è¡Œ</span></span><br><span class="line">        cbFun = <span class="built_in">setTimeout</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">          cbFun = <span class="literal">null</span>;</span><br><span class="line">        &#125;, throttleTime);</span><br><span class="line">      &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        event &amp;&amp; event.<span class="title function_">stopImmediatePropagation</span>();</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;, <span class="literal">true</span>);</span><br><span class="line">  &#125;,</span><br><span class="line">&#125;);</span><br><span class="line"><span class="comment">// 2.ä¸ºbuttonæ ‡ç­¾è®¾ç½®v-throttleè‡ªå®šä¹‰æŒ‡ä»¤</span></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;<span class="name">button</span> @<span class="attr">click</span>=<span class="string">&quot;sayHello&quot;</span> <span class="attr">v-throttle</span>&gt;</span>æäº¤<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span></span><br></pre></td></tr></table></figure>

<h3 id="å›¾ç‰‡æ‡’åŠ è½½"><a href="#å›¾ç‰‡æ‡’åŠ è½½" class="headerlink" title="å›¾ç‰‡æ‡’åŠ è½½"></a>å›¾ç‰‡æ‡’åŠ è½½</h3><p>è®¾ç½®ä¸€ä¸ª<code>v-lazy</code>è‡ªå®šä¹‰æŒ‡ä»¤å®Œæˆå›¾ç‰‡æ‡’åŠ è½½</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> <span class="title class_">LazyLoad</span> = &#123;</span><br><span class="line">    <span class="comment">// installæ–¹æ³•</span></span><br><span class="line">    <span class="title function_">install</span>(<span class="params">Vue,options</span>)&#123;</span><br><span class="line">    	  <span class="comment">// ä»£æ›¿å›¾ç‰‡çš„loadingå›¾</span></span><br><span class="line">        <span class="keyword">let</span> defaultSrc = options.<span class="property">default</span>;</span><br><span class="line">        <span class="title class_">Vue</span>.<span class="title function_">directive</span>(<span class="string">&#x27;lazy&#x27;</span>,&#123;</span><br><span class="line">            <span class="title function_">bind</span>(<span class="params">el,binding</span>)&#123;</span><br><span class="line">                <span class="title class_">LazyLoad</span>.<span class="title function_">init</span>(el,binding.<span class="property">value</span>,defaultSrc);</span><br><span class="line">            &#125;,</span><br><span class="line">            <span class="title function_">inserted</span>(<span class="params">el</span>)&#123;</span><br><span class="line">                <span class="comment">// å…¼å®¹å¤„ç†</span></span><br><span class="line">                <span class="keyword">if</span>(<span class="string">&#x27;IntersectionObserver&#x27;</span> <span class="keyword">in</span> <span class="variable language_">window</span>)&#123;</span><br><span class="line">                    <span class="title class_">LazyLoad</span>.<span class="title function_">observe</span>(el);</span><br><span class="line">                &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">                    <span class="title class_">LazyLoad</span>.<span class="title function_">listenerScroll</span>(el);</span><br><span class="line">                &#125;</span><br><span class="line">                </span><br><span class="line">            &#125;,</span><br><span class="line">        &#125;)</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="comment">// åˆå§‹åŒ–</span></span><br><span class="line">    <span class="title function_">init</span>(<span class="params">el,val,def</span>)&#123;</span><br><span class="line">        <span class="comment">// data-src å‚¨å­˜çœŸå®src</span></span><br><span class="line">        el.<span class="title function_">setAttribute</span>(<span class="string">&#x27;data-src&#x27;</span>,val);</span><br><span class="line">        <span class="comment">// è®¾ç½®srcä¸ºloadingå›¾</span></span><br><span class="line">        el.<span class="title function_">setAttribute</span>(<span class="string">&#x27;src&#x27;</span>,def);</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="comment">// åˆ©ç”¨IntersectionObserverç›‘å¬el</span></span><br><span class="line">    <span class="title function_">observe</span>(<span class="params">el</span>)&#123;</span><br><span class="line">        <span class="keyword">let</span> io = <span class="keyword">new</span> <span class="title class_">IntersectionObserver</span>(<span class="function"><span class="params">entries</span> =&gt;</span> &#123;</span><br><span class="line">            <span class="keyword">let</span> realSrc = el.<span class="property">dataset</span>.<span class="property">src</span>;</span><br><span class="line">            <span class="keyword">if</span>(entries[<span class="number">0</span>].<span class="property">isIntersecting</span>)&#123;</span><br><span class="line">                <span class="keyword">if</span>(realSrc)&#123;</span><br><span class="line">                    el.<span class="property">src</span> = realSrc;</span><br><span class="line">                    el.<span class="title function_">removeAttribute</span>(<span class="string">&#x27;data-src&#x27;</span>);</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;);</span><br><span class="line">        io.<span class="title function_">observe</span>(el);</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="comment">// ç›‘å¬scrolläº‹ä»¶</span></span><br><span class="line">    <span class="title function_">listenerScroll</span>(<span class="params">el</span>)&#123;</span><br><span class="line">        <span class="keyword">let</span> handler = <span class="title class_">LazyLoad</span>.<span class="title function_">throttle</span>(<span class="title class_">LazyLoad</span>.<span class="property">load</span>,<span class="number">300</span>);</span><br><span class="line">        <span class="title class_">LazyLoad</span>.<span class="title function_">load</span>(el);</span><br><span class="line">        <span class="variable language_">window</span>.<span class="title function_">addEventListener</span>(<span class="string">&#x27;scroll&#x27;</span>,<span class="function">() =&gt;</span> &#123;</span><br><span class="line">            <span class="title function_">handler</span>(el);</span><br><span class="line">        &#125;);</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="comment">// åŠ è½½çœŸå®å›¾ç‰‡</span></span><br><span class="line">    <span class="title function_">load</span>(<span class="params">el</span>)&#123;</span><br><span class="line">        <span class="keyword">let</span> windowHeight = <span class="variable language_">document</span>.<span class="property">documentElement</span>.<span class="property">clientHeight</span></span><br><span class="line">        <span class="keyword">let</span> elTop = el.<span class="title function_">getBoundingClientRect</span>().<span class="property">top</span>;</span><br><span class="line">        <span class="keyword">let</span> elBtm = el.<span class="title function_">getBoundingClientRect</span>().<span class="property">bottom</span>;</span><br><span class="line">        <span class="keyword">let</span> realSrc = el.<span class="property">dataset</span>.<span class="property">src</span>;</span><br><span class="line">        <span class="keyword">if</span>(elTop - windowHeight&lt;<span class="number">0</span>&amp;&amp;elBtm &gt; <span class="number">0</span>)&#123;</span><br><span class="line">            <span class="keyword">if</span>(realSrc)&#123;</span><br><span class="line">                el.<span class="property">src</span> = realSrc;</span><br><span class="line">                el.<span class="title function_">removeAttribute</span>(<span class="string">&#x27;data-src&#x27;</span>);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="comment">// èŠ‚æµ</span></span><br><span class="line">    <span class="title function_">throttle</span>(<span class="params">fn,delay</span>)&#123;</span><br><span class="line">        <span class="keyword">let</span> timer; </span><br><span class="line">        <span class="keyword">let</span> prevTime;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">function</span>(<span class="params">...args</span>)&#123;</span><br><span class="line">            <span class="keyword">let</span> currTime = <span class="title class_">Date</span>.<span class="title function_">now</span>();</span><br><span class="line">            <span class="keyword">let</span> context = <span class="variable language_">this</span>;</span><br><span class="line">            <span class="keyword">if</span>(!prevTime) prevTime = currTime;</span><br><span class="line">            <span class="built_in">clearTimeout</span>(timer);</span><br><span class="line">            </span><br><span class="line">            <span class="keyword">if</span>(currTime - prevTime &gt; delay)&#123;</span><br><span class="line">                prevTime = currTime;</span><br><span class="line">                fn.<span class="title function_">apply</span>(context,args);</span><br><span class="line">                <span class="built_in">clearTimeout</span>(timer);</span><br><span class="line">                <span class="keyword">return</span>;</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            timer = <span class="built_in">setTimeout</span>(<span class="keyword">function</span>(<span class="params"></span>)&#123;</span><br><span class="line">                prevTime = <span class="title class_">Date</span>.<span class="title function_">now</span>();</span><br><span class="line">                timer = <span class="literal">null</span>;</span><br><span class="line">                fn.<span class="title function_">apply</span>(context,args);</span><br><span class="line">            &#125;,delay);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="title class_">LazyLoad</span>;</span><br></pre></td></tr></table></figure>

<h3 id="ä¸€é”®-Copyçš„åŠŸèƒ½"><a href="#ä¸€é”®-Copyçš„åŠŸèƒ½" class="headerlink" title="ä¸€é”® Copyçš„åŠŸèƒ½"></a>ä¸€é”® Copyçš„åŠŸèƒ½</h3><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; <span class="title class_">Message</span> &#125; <span class="keyword">from</span> <span class="string">&#x27;ant-design-vue&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> vCopy = &#123; <span class="comment">//</span></span><br><span class="line">  <span class="comment">/*</span></span><br><span class="line"><span class="comment">    bind é’©å­å‡½æ•°ï¼Œç¬¬ä¸€æ¬¡ç»‘å®šæ—¶è°ƒç”¨ï¼Œå¯ä»¥åœ¨è¿™é‡Œåšåˆå§‹åŒ–è®¾ç½®</span></span><br><span class="line"><span class="comment">    el: ä½œç”¨çš„ dom å¯¹è±¡</span></span><br><span class="line"><span class="comment">    value: ä¼ ç»™æŒ‡ä»¤çš„å€¼ï¼Œä¹Ÿå°±æ˜¯æˆ‘ä»¬è¦ copy çš„å€¼</span></span><br><span class="line"><span class="comment">  */</span></span><br><span class="line">  <span class="title function_">bind</span>(<span class="params">el, &#123; value &#125;</span>) &#123;</span><br><span class="line">    el.<span class="property">$value</span> = value; <span class="comment">// ç”¨ä¸€ä¸ªå…¨å±€å±æ€§æ¥å­˜ä¼ è¿›æ¥çš„å€¼ï¼Œå› ä¸ºè¿™ä¸ªå€¼åœ¨åˆ«çš„é’©å­å‡½æ•°é‡Œè¿˜ä¼šç”¨åˆ°</span></span><br><span class="line">    el.<span class="property">handler</span> = <span class="function">() =&gt;</span> &#123;</span><br><span class="line">      <span class="keyword">if</span> (!el.<span class="property">$value</span>) &#123;</span><br><span class="line">      <span class="comment">// å€¼ä¸ºç©ºçš„æ—¶å€™ï¼Œç»™å‡ºæç¤ºï¼Œæˆ‘è¿™é‡Œçš„æç¤ºæ˜¯ç”¨çš„ ant-design-vue çš„æç¤ºï¼Œä½ ä»¬éšæ„</span></span><br><span class="line">        <span class="title class_">Message</span>.<span class="title function_">warning</span>(<span class="string">&#x27;æ— å¤åˆ¶å†…å®¹&#x27;</span>);</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="comment">// åŠ¨æ€åˆ›å»º textarea æ ‡ç­¾</span></span><br><span class="line">      <span class="keyword">const</span> textarea = <span class="variable language_">document</span>.<span class="title function_">createElement</span>(<span class="string">&#x27;textarea&#x27;</span>);</span><br><span class="line">      <span class="comment">// å°†è¯¥ textarea è®¾ä¸º readonly é˜²æ­¢ iOS ä¸‹è‡ªåŠ¨å”¤èµ·é”®ç›˜ï¼ŒåŒæ—¶å°† textarea ç§»å‡ºå¯è§†åŒºåŸŸ</span></span><br><span class="line">      textarea.<span class="property">readOnly</span> = <span class="string">&#x27;readonly&#x27;</span>;</span><br><span class="line">      textarea.<span class="property">style</span>.<span class="property">position</span> = <span class="string">&#x27;absolute&#x27;</span>;</span><br><span class="line">      textarea.<span class="property">style</span>.<span class="property">left</span> = <span class="string">&#x27;-9999px&#x27;</span>;</span><br><span class="line">      <span class="comment">// å°†è¦ copy çš„å€¼èµ‹ç»™ textarea æ ‡ç­¾çš„ value å±æ€§</span></span><br><span class="line">      textarea.<span class="property">value</span> = el.<span class="property">$value</span>;</span><br><span class="line">      <span class="comment">// å°† textarea æ’å…¥åˆ° body ä¸­</span></span><br><span class="line">      <span class="variable language_">document</span>.<span class="property">body</span>.<span class="title function_">appendChild</span>(textarea);</span><br><span class="line">      <span class="comment">// é€‰ä¸­å€¼å¹¶å¤åˆ¶</span></span><br><span class="line">      textarea.<span class="title function_">select</span>();</span><br><span class="line">      <span class="comment">// textarea.setSelectionRange(0, textarea.value.length);</span></span><br><span class="line">      <span class="keyword">const</span> result = <span class="variable language_">document</span>.<span class="title function_">execCommand</span>(<span class="string">&#x27;Copy&#x27;</span>);</span><br><span class="line">      <span class="keyword">if</span> (result) &#123;</span><br><span class="line">        <span class="title class_">Message</span>.<span class="title function_">success</span>(<span class="string">&#x27;å¤åˆ¶æˆåŠŸ&#x27;</span>);</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="variable language_">document</span>.<span class="property">body</span>.<span class="title function_">removeChild</span>(textarea);</span><br><span class="line">    &#125;;</span><br><span class="line">    <span class="comment">// ç»‘å®šç‚¹å‡»äº‹ä»¶ï¼Œå°±æ˜¯æ‰€è°“çš„ä¸€é”® copy å•¦</span></span><br><span class="line">    el.<span class="title function_">addEventListener</span>(<span class="string">&#x27;click&#x27;</span>, el.<span class="property">handler</span>);</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="comment">// å½“ä¼ è¿›æ¥çš„å€¼æ›´æ–°çš„æ—¶å€™è§¦å‘</span></span><br><span class="line">  <span class="title function_">componentUpdated</span>(<span class="params">el, &#123; value &#125;</span>) &#123;</span><br><span class="line">    el.<span class="property">$value</span> = value;</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="comment">// æŒ‡ä»¤ä¸å…ƒç´ è§£ç»‘çš„æ—¶å€™ï¼Œç§»é™¤äº‹ä»¶ç»‘å®š</span></span><br><span class="line">  <span class="title function_">unbind</span>(<span class="params">el</span>) &#123;</span><br><span class="line">    el.<span class="title function_">removeEventListener</span>(<span class="string">&#x27;click&#x27;</span>, el.<span class="property">handler</span>);</span><br><span class="line">  &#125;,</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> vCopy;</span><br></pre></td></tr></table></figure>

<p>å…³äºè‡ªå®šä¹‰æŒ‡ä»¤è¿˜æœ‰å¾ˆå¤šåº”ç”¨åœºæ™¯ï¼Œå¦‚ï¼šæ‹–æ‹½æŒ‡ä»¤ã€é¡µé¢æ°´å°ã€æƒé™æ ¡éªŒç­‰ç­‰åº”ç”¨åœºæ™¯</p>

        
    </article>
    <footer class="cube-excerpt-footer">
        <a class="cube-excerpt-more" href="/2019/05/16/Vue/vue-%E6%8C%87%E4%BB%A4/">Read More</a>
    </footer>
</div>

<div class="cube-excerpt" id="cube-excerpt-node-åŸºç¡€æ€»ç»“">
    <header class="cube-excerpt-header">
        <h1><a href="/2019/05/14/nodejs/node-%E5%9F%BA%E7%A1%80%E7%AF%87/">node-åŸºç¡€æ€»ç»“</a></h1>
        <div class="cube-excerpt-header-msg">
            <div class="cube-excerpt-date">
                <i class="cube-icon cube-icon-date" aria-hidden="true"></i>
                2019-05-14
            </div>
            <div class="cube-excerpt-tags">
                <i class="cube-icon cube-icon-tag" aria-hidden="true"></i>
                
                <a href="/tags/nodejs/" class="cube-excerpt-tag-link">#nodejs</a>
                
            </div>
        </div>
    </header>
    <article class="cube-excerpt-entry cube-markdown">
        
        
           <h1 id="ä¸€ã€nodejsä»‹ç»"><a href="#ä¸€ã€nodejsä»‹ç»" class="headerlink" title="ä¸€ã€nodejsä»‹ç»"></a>ä¸€ã€nodejsä»‹ç»</h1><h2 id="1-1-ç®€ä»‹"><a href="#1-1-ç®€ä»‹" class="headerlink" title="1.1 ç®€ä»‹"></a>1.1 ç®€ä»‹</h2><ul>
<li><code>nodejs</code>æ˜¯ä¸€ä¸ª<code>JavaScript</code>è¿è¡Œç¯å¢ƒã€‚å®ƒè®© <code>JavaScript</code> å¯ä»¥å¼€å‘åç«¯ç¨‹åºï¼Œå®ç°å‡ ä¹å…¶ä»–åç«¯è¯­è¨€å®ç°çš„æ‰€æœ‰åŠŸèƒ½</li>
<li><code>Nodejs</code> æ˜¯åŸºäº <code>V8</code> å¼•æ“ï¼Œ<code>V8</code> æ˜¯ <code>Google</code> å‘å¸ƒçš„å¼€æº <code>JavaScript</code> å¼•æ“ï¼Œæœ¬èº«å°±æ˜¯ç”¨äº <code>Chrome</code> æµè§ˆå™¨ çš„ <code>JS</code> è§£é‡Šéƒ¨åˆ†ï¼Œ <code>V8</code> æ¬åˆ°äº†æœåŠ¡å™¨ä¸Šï¼Œç”¨äºåšæœåŠ¡å™¨çš„è½¯ä»¶</li>
<li>çŸ­çŸ­å‡ å¹´çš„æ—¶é—´ï¼ŒNode å–å¾—äº†å·¨å¤§çš„æˆåŠŸã€‚åœ¨ä¼ä¸šç•Œï¼ŒNode çš„åº”ç”¨ä¹Ÿè¶Šæ¥è¶Šå¹¿æ³›ï¼Œ2016 å¹´ nodeJS å®˜æ–¹çš„è°ƒæŸ¥æŠ¥å‘Šã€‚2016 å¹´å…¨çƒæœ‰ 350 ä¸‡å¼€å‘è€…ä½¿ç”¨ nodeJS,ç›¸æ¯”å»å¹´ä¿æŒäº† 100%çš„å¢é•¿ç‡ã€‚åƒ Yahooã€ Microsoft è¿™æ ·çš„å¤§å…¬å¸ï¼Œæœ‰å¥½å¤šåº”ç”¨å·²ç»è¿ç§»åˆ° Node äº†ã€‚å›½å†…çš„é˜¿é‡Œå·´å·´ã€ç½‘æ˜“ã€è…¾è®¯ã€æ–°æµªã€ç™¾åº¦ç­‰ å…¬å¸çš„å¾ˆå¤šçº¿ä¸Šäº§å“ä¹Ÿçº·çº·æ”¹ç”¨ Node å¼€å‘ï¼Œå¹¶å–å¾—äº†å¾ˆå¥½çš„æ•ˆæœã€‚æ®ç»Ÿè®¡å¾ˆå¤š A è½®ã€ B è½®çš„åˆ›ä¸šå…¬å¸æ›´ å–œæ¬¢ä½¿ç”¨ NodeJs å¼€å‘ã€‚</li>
</ul>
<blockquote>
<p><a target="_blank" rel="noopener" href="https://nodejs.org/static/documents/2016-survey-report.pdf">https://nodejs.org/static/documents/2016-survey-report.pdf</a></p>
</blockquote>
<h2 id="1-2-NodeJs-çš„ä¼˜åŠ¿"><a href="#1-2-NodeJs-çš„ä¼˜åŠ¿" class="headerlink" title="1.2 NodeJs çš„ä¼˜åŠ¿"></a>1.2 NodeJs çš„ä¼˜åŠ¿</h2><p><strong>1. NodeJs è¯­æ³•å®Œå…¨æ˜¯ js è¯­æ³•ï¼Œåªè¦ä½ æ‡‚ JS åŸºç¡€å°±å¯ä»¥å­¦ä¼š Nodejs åç«¯å¼€å‘</strong></p>
<blockquote>
<p>Node æ‰“ç ´äº†è¿‡å» JavaScript åªèƒ½åœ¨æµè§ˆå™¨ä¸­è¿è¡Œçš„å±€é¢ã€‚å‰åç«¯ç¼–ç¨‹ç¯å¢ƒç»Ÿä¸€ï¼Œå¯ä»¥å¤§å¤§é™ä½å¼€å‘æˆæœ¬</p>
</blockquote>
<p><strong>2. NodeJs è¶…å¼ºçš„é«˜å¹¶å‘èƒ½åŠ›</strong></p>
<ul>
<li><code>Node.js</code> çš„é¦–è¦ç›®æ ‡æ˜¯æä¾›ä¸€ç§ç®€å•çš„ã€ç”¨äºåˆ›å»ºé«˜æ€§èƒ½æœåŠ¡å™¨åŠå¯åœ¨è¯¥æœåŠ¡å™¨ä¸­è¿è¡Œçš„å„ç§åº”ç”¨ç¨‹ åºçš„å¼€å‘å·¥å…·</li>
<li>é¦–å…ˆè®©æˆ‘ä»¬æ¥çœ‹ä¸€ä¸‹ç°åœ¨çš„æœåŠ¡å™¨ç«¯è¯­è¨€ä¸­å­˜åœ¨ç€ä»€ä¹ˆé—®é¢˜ã€‚<br>åœ¨ <code>Java</code>ã€<code>PHP</code> æˆ–è€…<code>.net</code> ç­‰æœåŠ¡å™¨ç«¯è¯­è¨€ä¸­ï¼Œä¼šä¸ºæ¯ä¸€ä¸ªå®¢æˆ·ç«¯è¿æ¥åˆ›å»ºä¸€ä¸ªæ–°çš„çº¿ç¨‹ã€‚è€Œæ¯ä¸ªçº¿ç¨‹éœ€è¦è€—è´¹å¤§çº¦ <code>2MB</code> å†…å­˜<br>ç†è®ºä¸Šï¼Œä¸€ä¸ª <code>8GB</code> å†…å­˜çš„æœåŠ¡å™¨å¯ä»¥åŒæ—¶è¿æ¥çš„æœ€å¤§ç”¨æˆ·æ•°ä¸º <code>4000</code> ä¸ªå·¦å³<br>ã€‚è¦è®© <code>Web</code> åº”ç”¨ç¨‹åºæ”¯æŒæ›´å¤šçš„ç”¨æˆ·ï¼Œå°± éœ€è¦å¢åŠ æœåŠ¡å™¨çš„æ•°é‡ï¼Œè€Œ <code>Web</code> åº”ç”¨ç¨‹åºçš„ç¡¬ä»¶æˆæœ¬å½“ç„¶å°±ä¸Šå‡äº†</li>
<li><code>Node.js</code> ä¸ä¸ºæ¯ä¸ªå®¢æˆ·è¿æ¥åˆ›å»ºä¸€ä¸ªæ–°çš„çº¿ç¨‹ï¼Œè€Œä»…ä»…ä½¿ç”¨ä¸€ä¸ªçº¿ç¨‹ã€‚å½“æœ‰ç”¨æˆ·è¿æ¥äº†ï¼Œå°±è§¦å‘ä¸€ä¸ª å†…éƒ¨äº‹ä»¶ï¼Œé€šè¿‡éé˜»å¡ <code>I/O</code>ã€äº‹ä»¶é©±åŠ¨æœºåˆ¶ï¼Œè®© <code>Node.js</code> ç¨‹åºå®è§‚ä¸Šä¹Ÿæ˜¯å¹¶è¡Œçš„ã€‚ä½¿ç”¨ <code>Node.js</code>ï¼Œä¸€ä¸ª <code>8GB</code> å†…å­˜çš„æœåŠ¡å™¨ï¼Œå¯ä»¥åŒæ—¶å¤„ç†è¶…è¿‡ <code>4 ä¸‡</code>ç”¨æˆ·çš„è¿æ¥</li>
</ul>
<p><strong>3. å®ç°é«˜æ€§èƒ½æœåŠ¡å™¨</strong></p>
<ul>
<li>ä¸¥æ ¼åœ°è¯´ï¼Œ<code>Node.js</code> æ˜¯ä¸€ä¸ªç”¨äºå¼€å‘å„ç§ Web æœåŠ¡å™¨çš„å¼€å‘å·¥å…·ã€‚åœ¨ <code>Node.js</code> æœåŠ¡å™¨ä¸­ï¼Œè¿è¡Œçš„æ˜¯é«˜æ€§èƒ½ <code>V8 JavaScript</code> è„šæœ¬è¯­è¨€ï¼Œè¯¥è¯­è¨€æ˜¯ä¸€ç§å¯ä»¥è¿è¡Œåœ¨æœåŠ¡å™¨ç«¯çš„ <code>JavaScript</code> è„šæœ¬è¯­è¨€</li>
<li>é‚£ä¹ˆï¼Œä»€ä¹ˆæ˜¯ <code>V8 JavaScript</code> è„šæœ¬è¯­è¨€å‘¢?è¯¥è¯­è¨€æ˜¯ä¸€ç§è¢« <code>V8 JavaScript</code> å¼•æ“æ‰€è§£æå¹¶æ‰§è¡Œçš„è„šæœ¬è¯­è¨€ã€‚<code>V8 JavaScript</code> å¼•æ“æ˜¯ç”± <code>Google</code> å…¬å¸ä½¿ç”¨ C++è¯­è¨€å¼€å‘çš„ä¸€ç§é«˜æ€§èƒ½ <code>JavaScript</code> å¼•æ“ï¼Œè¯¥å¼•æ“å¹¶ä¸å±€é™äºåœ¨æµè§ˆ å™¨ä¸­è¿è¡Œã€‚<code>Node.js</code> å°†å…¶è½¬ç”¨åœ¨äº†æœåŠ¡å™¨ä¸­ï¼Œå¹¶ä¸”ä¸ºå…¶æä¾›äº†è®¸å¤šé™„åŠ çš„å…·æœ‰å„ç§ä¸åŒç”¨é€”çš„ <code>API</code>ã€‚ä¾‹å¦‚ï¼Œ åœ¨ä¸€ä¸ªæœåŠ¡å™¨ä¸­ï¼Œç»å¸¸éœ€è¦å¤„ç†å„ç§äºŒè¿›åˆ¶æ•°æ®ã€‚åœ¨ <code>JavaScript</code> è„šæœ¬è¯­è¨€ä¸­ï¼Œåªå…·æœ‰éå¸¸æœ‰é™çš„å¯¹äºŒè¿›åˆ¶æ•° æ®çš„å¤„ç†èƒ½åŠ›ï¼Œè€Œ <code>Node.js</code> æ‰€æä¾›çš„ <code>Buffer</code> ç±»åˆ™æä¾›äº†ä¸°å¯Œçš„å¯¹äºŒè¿›åˆ¶æ•°æ®çš„å¤„ç†èƒ½åŠ›</li>
<li>å¦å¤–ï¼Œåœ¨ <code>V8 JavaScript</code>å¼•æ“å†…éƒ¨ä½¿ç”¨ä¸€ç§å…¨æ–°çš„ç¼–è¯‘æŠ€æœ¯ã€‚è¿™æ„å‘³ç€å¼€å‘è€…ç¼–å†™çš„é«˜ç«¯çš„ <code>JavaScript</code> è„šæœ¬ä»£ç ä¸å¼€å‘è€…ç¼–å†™çš„ä½ç«¯çš„Cè¯­è¨€å…·æœ‰éå¸¸ç›¸è¿‘çš„æ‰§è¡Œæ•ˆç‡ï¼Œè¿™ä¹Ÿæ˜¯<code>Node.js</code>æœåŠ¡å™¨å¯ä»¥æä¾›çš„ä¸€ä¸ªé‡è¦ç‰¹æ€§</li>
</ul>
<p><strong>4. å¼€å‘å‘¨æœŸçŸ­ã€å¼€å‘æˆæœ¬ä½ã€å­¦ä¹ æˆæœ¬ä½ã€‚</strong></p>
<ul>
<li><code>Node.js</code> è‡ªèº«å“²å­¦ï¼Œæ˜¯èŠ±æœ€å°çš„ç¡¬ä»¶æˆæœ¬ï¼Œè¿½æ±‚æ›´é«˜çš„å¹¶å‘ï¼Œæ›´é«˜çš„å¤„ç†æ€§èƒ½ã€‚</li>
<li>ç‰¹ç‚¹:<code>Node.js uses an event-driven, non-blocking I/O model that makes it lightweight and efficient.</code></li>
</ul>
<h2 id="1-3-NodeJs-é€‚åˆåšä»€ä¹ˆ"><a href="#1-3-NodeJs-é€‚åˆåšä»€ä¹ˆ" class="headerlink" title="1.3 NodeJs é€‚åˆåšä»€ä¹ˆ"></a>1.3 NodeJs é€‚åˆåšä»€ä¹ˆ</h2><blockquote>
<p>åœ¨çŸ­çŸ­å‡ å¹´å¤šçš„æ—¶é—´é‡Œï¼Œ<code>Node</code> å˜å¾—éå¸¸çƒ­é—¨ï¼Œä½¿ç”¨è€…ä¹Ÿéå¸¸å¤šã€‚è¿™äº›ä½¿ç”¨è€…å¯¹äº <code>Node</code> çš„å„è‡ªå€šé‡ç‚¹ä¹Ÿå„éƒ¨ç›¸åŒï¼Œç»è¿‡æ•´ç†,ä¸»è¦æœ‰ä¸‹å‡ ç±»</p>
</blockquote>
<p><strong>1. å‰åç«¯ç¼–ç¨‹è¯­è¨€ç¯å¢ƒç»Ÿä¸€</strong></p>
<blockquote>
<p>è¿™ç±»é‡ç‚¹çš„ä»£è¡¨æ˜¯é›…è™ã€‚é›…è™å¼€æ”¾äº† <code>Cocktai</code> æ¡†æ¶ï¼Œåˆ©ç”¨ è‡ªå·±æ·±åšçš„å‰ç«¯æ²‰æ·€ï¼Œå°† <code>YUI3</code> è¿™ä¸ªå‰ç«¯æ¡†æ¶çš„èƒ½åŠ›å€ŸåŠ© <code>Node</code> å»¶ä¼¸åˆ°æœåŠ¡å™¨ç«¯ï¼Œä½¿å¾—ä½¿ç”¨ è€…æ‘†è„±äº†æ—¥å¸¸å·¥ä½œä¸­ä¸€è¾¹å†™ <code>JavaScript</code> â€”è¾¹å†™ <code>PHP</code> æ‰€å¸¯æ¥çš„ä¸Šä¸‹æ–‡äº¤æ¢è´Ÿæ‹…</p>
</blockquote>
<p><strong>2. Node å¸¦æ¥çš„é«˜æ€§èƒ½ I&#x2F;0 ç”¨äºå®æ—¶åº”ç”¨</strong></p>
<blockquote>
<p><code>Voxer</code> å°† <code>Node</code> åº”ç”¨åœ¨å®æ—¶è¯­éŸ³ä¸Šã€‚å›½å†…è…¾è®¯çš„ æœ‹å‹ç½‘å°† Node åº”ç”¨åœ¨é•¿è¿æ¥ä¸­ï¼Œä»¥æä¾›å®æ—¶åŠŸèƒ½ï¼ŒèŠ±ç“£ç½‘ã€è˜‘è‡è¡—ç­‰å…¬å¸é€šè¿‡ <code>socket.io</code> å® ç°å®æ—¶é€šçŸ¥çš„åŠŸèƒ½ã€‚</p>
</blockquote>
<p><strong>3. å¹¶è¡Œ I&#x2F;0 ä½¿å¾—ä½¿ç”¨è€…å¯ä»¥æ›´é«˜æ•ˆåœ°åˆ©ç”¨åˆ†å¸ƒå¼ç¯å¢ƒ</strong></p>
<blockquote>
<p>é˜¿é‡Œå·´å·´ eBay æ˜¯è¿™æ–¹é¢çš„å…¸å‹ã€‚ é˜¿é‡Œå·´å·´çš„ NodeFox å’Œ eBay çš„ ql.io éƒ½æ˜¯å€Ÿç”¨ Node å¹¶è¡Œ I&#x2F;O çš„èƒ½åŠ›ï¼Œæ›´é«˜æ•ˆåœ°ä½¿ç”¨å·²æœ‰çš„ æ•°æ®</p>
</blockquote>
<p><strong>4. å¹¶è¡Œ I&#x2F;O â€¢æœ‰æ•ˆåˆ©ç”¨ç¨³å®šæ¥å£æå‡ Web æ¸²æŸ“èƒ½åŠ›</strong></p>
<blockquote>
<p>é›ªçƒè´¢ç»å’Œ Linkedln çš„ç§»åŠ¨ç‰ˆç½‘ç«™å‡ æ˜¯è¿™ç§æ¡ˆä¾‹ï¼Œæ’‡å¼ƒ åŒæ­¥ç­‰å¾…å¼çš„é¡ºåºè¯·æ±‚ï¼Œå¤§èƒ†é‡‡ç”¨å¹¶è¡Œä¸¨&#x2F;ã€‡ï¼ŒåŠ é€Ÿæ•°æ®çš„è·å–è¿›è€Œæå‡ Web çš„æ¸²æŸ“é€Ÿåº¦</p>
</blockquote>
<p><strong>5. äº‘è®¡ç®—å¹³å°æä¾› Node æ”¯æŒ</strong></p>
<blockquote>
<p>å¾®è½¯å°† Node å¼•å…¥ Azure çš„å¼€å‘ä¸­ï¼Œé˜¿é‡Œäº‘ã€ç™¾åº¦å‡çº·çº· åœ¨äº‘æœåŠ¡å™¨ä¸Šæä¾› Node åº”ç”¨æ‰˜ç®¡æœåŠ¡ï¼ŒJoyent æ›´æ˜¯äº‘è®¡ç®—ä¸­æä¾› Node æ”¯æŒçš„ä»£è¡¨ã€‚è¿™ç±» å¹³å°çœ‹é‡ JavaScript å¸¦æ¥çš„å¼€å‘ä¸Šçš„ä¼˜åŠ¿ï¼Œä»¥åŠä½èµ„æºå ç”¨ã€é«˜æ€§èƒ½çš„ç‰¹ç‚¹</p>
</blockquote>
<p><strong>6. æ¸¸æˆå¼€å‘é¢†åŸŸ</strong></p>
<blockquote>
<p>æ¸¸æˆé¢†åŸŸå¯¹å®æ—¶å’Œå¹¶å‘æœ‰å¾ˆé«˜çš„è¦æ±‚ï¼Œç½‘æ˜“å¼€æºäº† pomelo å®æ—¶æ¡†æ¶ï¼Œ å¯ä»¥åº”ç”¨åœ¨æ¸¸æˆå’Œé«˜å®æ—¶åº”ç”¨ä¸­</p>
</blockquote>
<p><strong>7. å·¥å…·ç±»åº”ç”¨</strong></p>
<blockquote>
<p>è¿‡å»ä¾èµ– <code>java</code> æˆ–å…¶ä»–è¯­è¨€æ„å»ºçš„å‰ç«¯å·¥å…·ç±»åº”ç”¨ï¼Œçº·çº·è¢«ä¸€äº›å‰ç«¯å·¥ç¨‹ å¸ˆç”¨ <code>Node</code> é‡å†™ï¼Œç”¨å‰ç«¯ç†Ÿæ‚‰çš„è¯­è¨€ä¸ºå‰ç«¯æ„å»ºç†Ÿæ‚‰çš„å·¥å…·</p>
</blockquote>
<h1 id="äºŒã€HTTPæ¨¡å—ã€URLæ¨¡å—-supervisorå·¥å…·"><a href="#äºŒã€HTTPæ¨¡å—ã€URLæ¨¡å—-supervisorå·¥å…·" class="headerlink" title="äºŒã€HTTPæ¨¡å—ã€URLæ¨¡å— supervisorå·¥å…·"></a>äºŒã€HTTPæ¨¡å—ã€URLæ¨¡å— supervisorå·¥å…·</h1><blockquote>
<p>ç”¨ <code>Node.js</code> æ—¶ï¼Œæˆ‘ä»¬ä¸ä»…ä»…åœ¨å®ç°ä¸€ä¸ªåº”ç”¨ï¼ŒåŒæ—¶è¿˜å®ç°äº†æ•´ä¸ª <code>HTTP</code> æœåŠ¡å™¨</p>
</blockquote>
<h2 id="2-1-åˆ›å»ºä¸€ä¸ªç®€å•çš„ç¨‹åº"><a href="#2-1-åˆ›å»ºä¸€ä¸ªç®€å•çš„ç¨‹åº" class="headerlink" title="2.1 åˆ›å»ºä¸€ä¸ªç®€å•çš„ç¨‹åº"></a>2.1 åˆ›å»ºä¸€ä¸ªç®€å•çš„ç¨‹åº</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">var http = require(&#x27;http&#x27;);</span><br><span class="line"></span><br><span class="line">http.createServer(function(request, response) &#123;</span><br><span class="line">    // å‘é€ HTTP å¤´éƒ¨</span><br><span class="line">    // HTTP çŠ¶æ€å€¼: 200 : OK</span><br><span class="line">    //è®¾ç½® HTTP å¤´éƒ¨ï¼ŒçŠ¶æ€ç æ˜¯ 200ï¼Œæ–‡ä»¶ç±»å‹æ˜¯ htmlï¼Œå­—ç¬¦é›†æ˜¯ utf8 response.writeHead(200,&#123;&quot;Content-Type&quot;:&quot;text/html;charset=UTF-8&quot;&#125;);</span><br><span class="line">    // å‘é€å“åº”æ•°æ® &quot;Hello World&quot;</span><br><span class="line">    res.end(&quot;å“ˆå“ˆå“ˆå“ˆï¼Œæˆ‘ä¹°äº†ä¸€ä¸ª iPhone&quot; + (1 + 2 + 3) + &quot;s&quot;);</span><br><span class="line">&#125;).listen(8888);</span><br><span class="line">// ç»ˆç«¯æ‰“å°å¦‚ä¸‹ä¿¡æ¯</span><br><span class="line">console.log(&#x27;Server running at http://127.0.0.1:8888/&#x27;);</span><br></pre></td></tr></table></figure>

<blockquote>
<p>ä½ ä¼šå‘ç°ï¼Œæˆ‘ä»¬æœ¬åœ°å†™ä¸€ä¸ª <code>js</code>ï¼Œæ‰“æ­»éƒ½ä¸èƒ½ç›´æ¥æ‹–å…¥æµè§ˆå™¨è¿è¡Œï¼Œä½†æ˜¯æœ‰äº† <code>node</code>ï¼Œæˆ‘ ä»¬ä»»ä½•ä¸€ä¸ª <code>js</code> æ–‡ä»¶ï¼Œéƒ½å¯ä»¥é€šè¿‡ <code>node</code> æ¥è¿è¡Œã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œ<code>node</code> å°±æ˜¯ä¸€ä¸ª <code>js</code> çš„æ‰§è¡Œç¯å¢ƒ</p>
</blockquote>
<h2 id="2-2-HTTP-æ¨¡å—ã€URLæ¨¡å—"><a href="#2-2-HTTP-æ¨¡å—ã€URLæ¨¡å—" class="headerlink" title="2.2 HTTP æ¨¡å—ã€URLæ¨¡å—"></a>2.2 HTTP æ¨¡å—ã€URLæ¨¡å—</h2><blockquote>
<p><code>Node.js</code> ä¸­ï¼Œå°†å¾ˆå¤šçš„åŠŸèƒ½ï¼Œåˆ’åˆ†ä¸ºäº†ä¸€ä¸ªä¸ª <code>module</code>(æ¨¡å—)ã€‚ <code>Node.js</code> ä¸­çš„å¾ˆå¤šåŠŸèƒ½éƒ½ æ˜¯é€šè¿‡æ¨¡å—å®ç°</p>
</blockquote>
<h3 id="2-2-1ã€HTTP-æ¨¡å—çš„ä½¿ç”¨"><a href="#2-2-1ã€HTTP-æ¨¡å—çš„ä½¿ç”¨" class="headerlink" title="2.2.1ã€HTTP æ¨¡å—çš„ä½¿ç”¨"></a>2.2.1ã€HTTP æ¨¡å—çš„ä½¿ç”¨</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">//å¼•ç”¨æ¨¡å—</span><br><span class="line">var http = require(&quot;http&quot;);</span><br><span class="line">//åˆ›å»ºä¸€ä¸ªæœåŠ¡å™¨ï¼Œå›è°ƒå‡½æ•°è¡¨ç¤ºæ¥æ”¶åˆ°è¯·æ±‚ä¹‹ååšçš„äº‹æƒ…</span><br><span class="line">var server = http.createServer(function(req, res) &#123; //req å‚æ•°è¡¨ç¤ºè¯·æ±‚ï¼Œres è¡¨ç¤ºå“åº”</span><br><span class="line">    console.log(&quot;æœåŠ¡å™¨æ¥æ”¶åˆ°äº†è¯·æ±‚&quot; + req.url);</span><br><span class="line">    res.end(); // End æ–¹æ³•ä½¿ Web æœåŠ¡å™¨åœæ­¢å¤„ç†è„šæœ¬å¹¶è¿”å›å½“å‰ç»“æœ</span><br><span class="line">&#125;);</span><br><span class="line">//ç›‘å¬ç«¯å£</span><br><span class="line">server.listen(3000, &quot;127.0.0.1&quot;);</span><br></pre></td></tr></table></figure>

<p><strong>è®¾ç½®ä¸€ä¸ªå“åº”å¤´</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">res.writeHead(200,&#123;&quot;Content-Type&quot;:&quot;text/html;charset=UTF8&quot;&#125;);</span><br></pre></td></tr></table></figure>

<p><img src="https://poetries1.gitee.io/img-repo/2019/10/356.png" alt="img"></p>
<ul>
<li>æˆ‘ä»¬ç°åœ¨æ¥çœ‹ä¸€ä¸‹ <code>req</code> é‡Œé¢èƒ½å¤Ÿä½¿ç”¨çš„ä¸œè¥¿</li>
<li>æœ€å…³é”®çš„å°±æ˜¯ <code>req.url</code> å±æ€§ï¼Œè¡¨ç¤ºç”¨æˆ·çš„è¯·æ±‚ <code>URL</code> åœ°å€ã€‚æ‰€æœ‰çš„è·¯ç”±è®¾è®¡ï¼Œéƒ½æ˜¯é€šè¿‡ <code>req.url</code> æ¥å®ç°çš„ã€‚</li>
<li>æˆ‘ä»¬æ¯”è¾ƒå…³å¿ƒçš„ä¸æ˜¯æ‹¿åˆ° <code>URL</code>ï¼Œè€Œæ˜¯è¯†åˆ«è¿™ä¸ª <code>URL</code></li>
<li>è¯†åˆ« <code>URL</code>ï¼Œç”¨åˆ°äº†ä¸‹é¢çš„ <code>URL</code> æ¨¡å—</li>
</ul>
<h3 id="2-2-2ã€URL-æ¨¡å—çš„ä½¿ç”¨"><a href="#2-2-2ã€URL-æ¨¡å—çš„ä½¿ç”¨" class="headerlink" title="2.2.2ã€URL æ¨¡å—çš„ä½¿ç”¨"></a>2.2.2ã€URL æ¨¡å—çš„ä½¿ç”¨</h3><ul>
<li><code>url.parse()</code> è§£æ<code>URL</code></li>
<li><code>url.format(urlObject)</code> æ˜¯ä¸Šé¢ <code>url.parse()</code> æ“ä½œçš„é€†å‘æ“ä½œ</li>
<li><code>url.resolve(from, to)</code> æ·»åŠ æˆ–è€…æ›¿æ¢åœ°å€</li>
</ul>
<p><strong>1. url.parse()</strong></p>
<p><img src="https://poetries1.gitee.io/img-repo/2019/10/357.png" alt="img"></p>
<p><img src="https://poetries1.gitee.io/img-repo/2019/10/358.png" alt="img"></p>
<p><strong>2. url.format()</strong></p>
<p><img src="https://poetries1.gitee.io/img-repo/2019/10/359.png" alt="img"></p>
<p><strong>3. url.resolve()</strong></p>
<p><img src="https://poetries1.gitee.io/img-repo/2019/10/360.png" alt="img"></p>
<h2 id="2-3-Nodejs-è‡ªå¯åŠ¨å·¥å…·-supervisor"><a href="#2-3-Nodejs-è‡ªå¯åŠ¨å·¥å…·-supervisor" class="headerlink" title="2.3 Nodejs è‡ªå¯åŠ¨å·¥å…· supervisor"></a>2.3 Nodejs è‡ªå¯åŠ¨å·¥å…· supervisor</h2><blockquote>
<p><code>supervisor</code> ä¼šä¸åœçš„ <code>watch</code> ä½ åº”ç”¨ä¸‹é¢çš„æ‰€æœ‰æ–‡ä»¶ï¼Œå‘ç°æœ‰æ–‡ä»¶è¢«ä¿®æ”¹ï¼Œå°±é‡æ–°è½½å…¥ç¨‹åºæ–‡ä»¶è¿™æ ·å°±å®ç°äº†éƒ¨ç½²ï¼Œä¿®æ”¹äº†ç¨‹åºæ–‡ä»¶åé©¬ä¸Šå°±èƒ½çœ‹åˆ°å˜æ›´åçš„ç»“æœã€‚éº»éº»å†ä¹Ÿä¸ç”¨æ‹…å¿ƒæˆ‘çš„é‡å¯ <code>nodejs</code> äº†</p>
</blockquote>
<p><strong>é¦–å…ˆå®‰è£… supervisor</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm install -g supervisor</span><br></pre></td></tr></table></figure>

<p><strong>ä½¿ç”¨ supervisor ä»£æ›¿ node å‘½ä»¤å¯åŠ¨åº”ç”¨</strong></p>
<p><img src="https://poetries1.gitee.io/img-repo/2019/10/361.png" alt="img"></p>
<h1 id="ä¸‰ã€CommonJs-å’Œ-Nodejs-æ¨¡å—"><a href="#ä¸‰ã€CommonJs-å’Œ-Nodejs-æ¨¡å—" class="headerlink" title="ä¸‰ã€CommonJs å’Œ Nodejs æ¨¡å—"></a>ä¸‰ã€CommonJs å’Œ Nodejs æ¨¡å—</h1><h2 id="3-1-ä»€ä¹ˆæ˜¯-CommonJs"><a href="#3-1-ä»€ä¹ˆæ˜¯-CommonJs" class="headerlink" title="3.1 ä»€ä¹ˆæ˜¯ CommonJs"></a>3.1 ä»€ä¹ˆæ˜¯ CommonJs</h2><blockquote>
<p><code>JavaScript</code> æ˜¯ä¸€ä¸ªå¼ºå¤§é¢å‘å¯¹è±¡è¯­è¨€ï¼Œå®ƒæœ‰å¾ˆå¤šå¿«é€Ÿé«˜æ•ˆçš„è§£é‡Šå™¨ã€‚ç„¶è€Œï¼Œ <code>JavaScript</code> æ ‡å‡†å®šä¹‰çš„ <code>API</code> æ˜¯ä¸ºäº†æ„å»ºåŸºäºæµè§ˆå™¨çš„åº”ç”¨ç¨‹åºã€‚å¹¶æ²¡æœ‰åˆ¶å®šä¸€ä¸ªç”¨äºæ›´å¹¿æ³›çš„åº”ç”¨ç¨‹åº çš„æ ‡å‡†åº“ã€‚<br>,è€Œä¸åªæ˜¯åœç•™åœ¨å°è„šæœ¬ç¨‹åº çš„é˜¶æ®µã€‚ç”¨ <code>CommonJS API</code> ç¼–å†™å‡ºçš„åº”ç”¨ï¼Œä¸ä»…å¯ä»¥åˆ©ç”¨ <code>JavaScript</code>å¼€å‘å®¢æˆ·ç«¯åº”ç”¨ï¼Œè€Œä¸”è¿˜å¯ä»¥ç¼–å†™ä»¥ä¸‹åº” ç”¨</p>
</blockquote>
<ul>
<li>æœåŠ¡å™¨ç«¯ <code>JavaScript</code> åº”ç”¨ç¨‹åºã€‚(<code>nodejs</code>)</li>
<li>å‘½ä»¤è¡Œå·¥å…·</li>
<li>æ¡Œé¢å›¾å½¢ç•Œé¢åº”ç”¨ç¨‹åº</li>
</ul>
<blockquote>
<p><code>CommonJS</code> å°±æ˜¯æ¨¡å—åŒ–çš„æ ‡å‡†ï¼Œ<code>nodejs</code> å°±æ˜¯ <code>CommonJS</code>(æ¨¡å—åŒ–)çš„å®ç°</p>
</blockquote>
<h2 id="3-2-Nodejs-ä¸­çš„æ¨¡å—åŒ–"><a href="#3-2-Nodejs-ä¸­çš„æ¨¡å—åŒ–" class="headerlink" title="3.2 Nodejs ä¸­çš„æ¨¡å—åŒ–"></a>3.2 Nodejs ä¸­çš„æ¨¡å—åŒ–</h2><blockquote>
<p><code>Node</code> åº”ç”¨ç”±æ¨¡å—ç»„æˆï¼Œé‡‡ç”¨ <code>CommonJS</code> æ¨¡å—è§„èŒƒ</p>
</blockquote>
<h3 id="3-2-1-åœ¨-Node-ä¸­ï¼Œæ¨¡å—åˆ†ä¸ºä¸¤ç±»"><a href="#3-2-1-åœ¨-Node-ä¸­ï¼Œæ¨¡å—åˆ†ä¸ºä¸¤ç±»" class="headerlink" title="3.2.1 åœ¨ Node ä¸­ï¼Œæ¨¡å—åˆ†ä¸ºä¸¤ç±»"></a>3.2.1 åœ¨ Node ä¸­ï¼Œæ¨¡å—åˆ†ä¸ºä¸¤ç±»</h3><ul>
<li>ä¸€ç±»æ˜¯ <code>Node</code> æä¾›çš„æ¨¡å—,ç§°ä¸ºæ ¸å¿ƒæ¨¡å—;å¦ä¸€ç±»æ˜¯ç”¨æˆ·ç¼–å†™çš„æ¨¡å—ï¼Œç§°ä¸ºæ–‡ä»¶æ¨¡å—</li>
</ul>
<blockquote>
<ul>
<li>æ ¸å¿ƒæ¨¡å—éƒ¨åˆ†åœ¨ <code>Node</code> æºä»£ç çš„ç¼–è¯‘è¿‡ç¨‹ä¸­ï¼Œç¼–è¯‘è¿›äº†äºŒè¿›åˆ¶æ‰§è¡Œæ–‡ä»¶ã€‚åœ¨ <code>Node</code> è¿›ç¨‹å¯åŠ¨æ—¶ï¼Œéƒ¨åˆ†æ ¸å¿ƒæ¨¡å—å°±è¢«ç›´æ¥åŠ è½½è¿›å†…å­˜ä¸­ï¼Œæ‰€ä»¥è¿™éƒ¨åˆ†æ ¸å¿ƒæ¨¡å—å¼•å…¥æ—¶ï¼Œæ–‡ä»¶å®šä½å’Œ ç¼–è¯‘æ‰§è¡Œè¿™ä¸¤ä¸ªæ­¥éª¤å¯ä»¥çœç•¥æ‰ï¼Œå¹¶ä¸”åœ¨è·¯å¾„åˆ†æä¸­ä¼˜å…ˆåˆ¤æ–­ï¼Œæ‰€ä»¥å®ƒçš„åŠ è½½é€Ÿåº¦æ˜¯æœ€å¿«çš„ã€‚ å¦‚:<code>HTTP</code> æ¨¡å— ã€<code>URL</code> æ¨¡å—ã€<code>Fs</code> æ¨¡å—éƒ½æ˜¯ <code>nodejs</code> å†…ç½®çš„æ ¸å¿ƒæ¨¡å—ï¼Œå¯ä»¥ç›´æ¥å¼•å…¥ä½¿ç”¨</li>
<li>æ–‡ä»¶æ¨¡å—åˆ™æ˜¯åœ¨è¿è¡Œæ—¶åŠ¨æ€åŠ è½½ï¼Œéœ€è¦å®Œæ•´çš„è·¯å¾„åˆ†æã€æ–‡ä»¶å®šä½ã€ç¼–è¯‘æ‰§è¡Œè¿‡ç¨‹ã€é€Ÿåº¦ç›¸æ¯”æ ¸å¿ƒæ¨¡å—ç¨å¾®æ…¢ä¸€äº›ï¼Œä½†æ˜¯ç”¨çš„éå¸¸å¤šã€‚è¿™äº›æ¨¡å—éœ€è¦æˆ‘ä»¬è‡ªå·±å®šä¹‰ã€‚æ¥ä¸‹æ¥æˆ‘ ä»¬çœ‹ä¸€ä¸‹ <code>nodejs</code> ä¸­çš„è‡ªå®šä¹‰æ¨¡å—ã€‚</li>
</ul>
</blockquote>
<h3 id="3-2-2-CommonJS-Nodejs-ä¸­è‡ªå®šä¹‰æ¨¡å—çš„è§„å®š"><a href="#3-2-2-CommonJS-Nodejs-ä¸­è‡ªå®šä¹‰æ¨¡å—çš„è§„å®š" class="headerlink" title="3.2.2 CommonJS(Nodejs)ä¸­è‡ªå®šä¹‰æ¨¡å—çš„è§„å®š"></a>3.2.2 CommonJS(Nodejs)ä¸­è‡ªå®šä¹‰æ¨¡å—çš„è§„å®š</h3><ol>
<li>æˆ‘ä»¬å¯ä»¥æŠŠå…¬å…±çš„åŠŸèƒ½æŠ½ç¦»æˆä¸ºä¸€ä¸ªå•ç‹¬çš„ <code>js</code> æ–‡ä»¶ä½œä¸ºä¸€ä¸ªæ¨¡å—ï¼Œé»˜è®¤æƒ…å†µä¸‹é¢è¿™ ä¸ªæ¨¡å—é‡Œé¢çš„æ–¹æ³•æˆ–è€…å±æ€§ï¼Œå¤–é¢æ˜¯æ²¡æ³•è®¿é—®çš„ã€‚å¦‚æœè¦è®©å¤–éƒ¨å¯ä»¥è®¿é—®æ¨¡å—é‡Œé¢çš„æ–¹æ³•æˆ– è€…å±æ€§ï¼Œå°±å¿…é¡»åœ¨æ¨¡å—é‡Œé¢é€šè¿‡ <code>exports</code> æˆ–è€… <code>module.exports</code> æš´éœ²å±æ€§æˆ–è€…æ–¹æ³•</li>
<li>åœ¨éœ€è¦ä½¿ç”¨è¿™äº›æ¨¡å—çš„æ–‡ä»¶ä¸­ï¼Œé€šè¿‡ <code>require</code> çš„æ–¹å¼å¼•å…¥è¿™ä¸ªæ¨¡å—ã€‚è¿™ä¸ªæ—¶å€™å°±å¯ä»¥ ä½¿ç”¨æ¨¡å—é‡Œé¢æš´éœ²çš„å±æ€§å’Œæ–¹æ³•</li>
</ol>
<p><img src="https://poetries1.gitee.io/img-repo/2019/10/362.png" alt="img"></p>
<h3 id="3-2-3-å®šä¹‰ä½¿ç”¨æ¨¡å—"><a href="#3-2-3-å®šä¹‰ä½¿ç”¨æ¨¡å—" class="headerlink" title="3.2.3 å®šä¹‰ä½¿ç”¨æ¨¡å—"></a>3.2.3 å®šä¹‰ä½¿ç”¨æ¨¡å—</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">// å®šä¹‰ä¸€ä¸ª tools.js çš„æ¨¡å— //æ¨¡å—å®šä¹‰</span><br><span class="line">var tools = &#123;</span><br><span class="line">    sayHello: function() &#123;</span><br><span class="line">        return &#x27;hello NodeJS&#x27;;</span><br><span class="line">    &#125;,</span><br><span class="line">    add: function(x, y) &#123;</span><br><span class="line">        return x + y;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br><span class="line">// æ¨¡å—æ¥å£çš„æš´éœ²</span><br><span class="line">// module.exports = tools; exports.sayHello = tools.sayHello; exports.add = tools.add;</span><br><span class="line">var http = require(&#x27;http&#x27;);</span><br><span class="line">// å¼•å…¥è‡ªå®šä¹‰çš„ tools.js æ¨¡å—</span><br><span class="line">var tools = require(&#x27;./tools&#x27;);</span><br><span class="line"></span><br><span class="line">tools.sa yHello(); //ä½¿ç”¨æ¨¡å—</span><br></pre></td></tr></table></figure>

<h1 id="å››ã€NPMç¬¬ä¸‰æ–¹æ¨¡å—å’Œpackage"><a href="#å››ã€NPMç¬¬ä¸‰æ–¹æ¨¡å—å’Œpackage" class="headerlink" title="å››ã€NPMç¬¬ä¸‰æ–¹æ¨¡å—å’Œpackage"></a>å››ã€NPMç¬¬ä¸‰æ–¹æ¨¡å—å’Œpackage</h1><h2 id="4-1-åŒ…ä¸-NPM"><a href="#4-1-åŒ…ä¸-NPM" class="headerlink" title="4.1 åŒ…ä¸ NPM"></a>4.1 åŒ…ä¸ NPM</h2><h3 id="4-1-1-åŒ…"><a href="#4-1-1-åŒ…" class="headerlink" title="4.1.1 åŒ…"></a>4.1.1 åŒ…</h3><blockquote>
<p><code>Nodejs</code> ä¸­é™¤äº†å®ƒè‡ªå·±æä¾›çš„æ ¸å¿ƒæ¨¡å—å¤–ï¼Œæˆ‘ä»¬å¯ä»¥è‡ªå®šä¹‰æ¨¡å—ï¼Œä¹Ÿå¯ä»¥ä½¿ç”¨ ç¬¬ä¸‰æ–¹çš„æ¨¡å—ã€‚<code>Nodejs</code>ä¸­ç¬¬ä¸‰æ–¹æ¨¡å—ç”±åŒ…ç»„æˆï¼Œå¯ä»¥é€šè¿‡åŒ…æ¥å¯¹ä¸€ç»„å…·æœ‰ç›¸äº’ä¾ èµ–å…³ç³»çš„æ¨¡å—è¿›è¡Œç»Ÿä¸€ç®¡ç†</p>
</blockquote>
<p><img src="https://poetries1.gitee.io/img-repo/2019/10/363.png" alt="img"></p>
<p><strong>å®Œå…¨ç¬¦åˆ CommonJs è§„èŒƒçš„åŒ…ç›®å½•ä¸€èˆ¬åŒ…å«å¦‚ä¸‹è¿™äº›æ–‡ä»¶</strong></p>
<ul>
<li><code>package.json</code> :åŒ…æè¿°æ–‡ä»¶</li>
<li><code>bin</code> :ç”¨äºå­˜æ”¾å¯æ‰§è¡ŒäºŒè¿›åˆ¶æ–‡ä»¶çš„ç›®å½•</li>
<li><code>lib</code> :ç”¨äºå­˜æ”¾ <code>JavaScript</code> ä»£ç çš„ç›®å½•</li>
<li><code>doc</code> :ç”¨äºå­˜æ”¾æ–‡æ¡£çš„ç›®å½•</li>
</ul>
<blockquote>
<p>åœ¨ <code>NodeJs</code> ä¸­é€šè¿‡ <code>NPM</code> å‘½ä»¤æ¥ä¸‹è½½ç¬¬ä¸‰æ–¹çš„æ¨¡å—(åŒ…)</p>
</blockquote>
<h3 id="4-1-2-NPM-ä»‹ç»"><a href="#4-1-2-NPM-ä»‹ç»" class="headerlink" title="4.1.2 NPM ä»‹ç»"></a>4.1.2 NPM ä»‹ç»</h3><ul>
<li>npm æ˜¯ä¸–ç•Œä¸Šæœ€å¤§çš„å¼€æ”¾æºä»£ç çš„ç”Ÿæ€ç³»ç»Ÿã€‚æˆ‘ä»¬å¯ä»¥é€šè¿‡ npm ä¸‹è½½å„ç§å„æ ·çš„åŒ…ï¼Œ<br>è¿™äº›æºä»£ç (åŒ…)æˆ‘ä»¬å¯ä»¥åœ¨ <a target="_blank" rel="noopener" href="https://www.npmjs.com/">https://www.npmjs.com</a> æ‰¾åˆ°</li>
</ul>
<blockquote>
<p><code>npm</code> æ˜¯éšåŒ <code>NodeJS</code> ä¸€èµ·å®‰è£…çš„åŒ…ç®¡ç†å·¥å…·ï¼Œèƒ½è§£å†³ <code>NodeJS</code> ä»£ç éƒ¨ç½²ä¸Šçš„å¾ˆå¤šé—®é¢˜ï¼Œå¸¸è§çš„ä½¿ç”¨åœºæ™¯æœ‰ ä»¥ä¸‹å‡ ç§</p>
</blockquote>
<ul>
<li>å…è®¸ç”¨æˆ·ä» <code>NPM</code> æœåŠ¡å™¨ä¸‹è½½åˆ«äººç¼–å†™çš„ç¬¬ä¸‰æ–¹åŒ…åˆ°æœ¬åœ°ä½¿ç”¨</li>
<li>å…è®¸ç”¨æˆ·ä» <code>NPM</code> æœåŠ¡å™¨ä¸‹è½½å¹¶å®‰è£…åˆ«äººç¼–å†™çš„å‘½ä»¤è¡Œç¨‹åº(å·¥å…·)åˆ°æœ¬åœ°ä½¿ç”¨</li>
<li>å…è®¸ç”¨æˆ·å°†è‡ªå·±ç¼–å†™çš„åŒ…æˆ–å‘½ä»¤è¡Œç¨‹åºä¸Šä¼ åˆ° <code>NPM</code> æœåŠ¡å™¨ä¾›åˆ«äººä½¿ç”¨</li>
</ul>
<p><strong>NPM å‘½ä»¤è¯¦è§£</strong></p>
<ul>
<li><code>npm -v</code> æŸ¥çœ‹ <code>npm</code> ç‰ˆæœ¬</li>
<li><code>npm install</code> ä½¿ç”¨ <code>npm</code> å‘½ä»¤å®‰è£…æ¨¡å—</li>
<li><code>npm uninstall moudleName</code> å¸è½½æ¨¡å—</li>
<li><code>npm list</code> æŸ¥çœ‹å½“å‰ç›®å½•ä¸‹å·²å®‰è£…çš„ <code>node</code> åŒ…</li>
<li><code>npm info jquery</code> æŸ¥çœ‹ <code>jquery</code> çš„ç‰ˆæœ¬</li>
<li>æŒ‡å®šç‰ˆæœ¬å®‰è£… <code>npm install jquery@1.8.0</code></li>
</ul>
<h2 id="4-2-package-json"><a href="#4-2-package-json" class="headerlink" title="4.2 package.json"></a>4.2 package.json</h2><blockquote>
<p><code>package.json</code> å®šä¹‰äº†è¿™ä¸ªé¡¹ç›®æ‰€éœ€è¦çš„å„ç§æ¨¡å—,ä»¥åŠé¡¹ç›®çš„é…ç½®ä¿¡æ¯(æ¯”å¦‚åç§°ã€<br>ç‰ˆæœ¬ã€è®¸å¯è¯ç­‰å…ƒæ•°æ®)</p>
</blockquote>
<p><strong>1. åˆ›å»º package.json</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">npm init</span><br><span class="line">npm init â€“yes</span><br></pre></td></tr></table></figure>

<p><strong>2. å®‰è£…æ¨¡å—å¹¶æŠŠæ¨¡å—å†™å…¥ package.json(ä¾èµ–)</strong></p>
<ul>
<li><code>npm install babel-cli --save-dev</code></li>
<li><code>npm install æ¨¡å— --save</code></li>
</ul>
<p><strong>3. dependencies ä¸ devDependencies ä¹‹é—´çš„åŒºåˆ«</strong></p>
<ul>
<li>ä½¿ç”¨ <code>npm install node_module â€“save</code> è‡ªåŠ¨æ›´æ–° <code>dependencies</code> å­—æ®µå€¼;</li>
<li>ä½¿ç”¨ <code>npm install node_module â€“save-dev</code> è‡ªåŠ¨æ›´æ–° <code>devDependencies</code> å­—æ®µå€¼</li>
<li><code>dependencies</code> é…ç½®å½“å‰ç¨‹åºæ‰€ä¾èµ–çš„å…¶ä»–</li>
<li><code>devDependencies</code> é…ç½®å½“å‰ç¨‹åºæ‰€ä¾èµ–çš„å…¶ä»–åŒ…ï¼Œåªä¼šä¸‹è½½æ¨¡å—ï¼Œè€Œä¸ä¸‹è½½è¿™äº›æ¨¡å—çš„æµ‹è¯• å’Œæ–‡æ¡£æ¡†æ¶</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">&quot;dependencies&quot;: &#123;</span><br><span class="line">    &quot;ejs&quot;: &quot;^2.3.4&quot;,</span><br><span class="line">    &quot;express&quot;: &quot;^4.13.3&quot;,</span><br><span class="line">    &quot;formidable&quot;: &quot;^1.0.17&quot;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ul>
<li><code>^</code>è¡¨ç¤ºç¬¬ä¸€ä½ç‰ˆæœ¬å·ä¸å˜ï¼Œåé¢ä¸¤ä½å–æœ€æ–°çš„</li>
<li><code>~</code>è¡¨ç¤ºå‰ä¸¤ä½ä¸å˜ï¼Œæœ€åä¸€ä¸ªå–æœ€æ–°</li>
<li><code>*</code>è¡¨ç¤ºå…¨éƒ¨å–æœ€æ–°</li>
</ul>
<h2 id="4-3-å®‰è£…æ·˜å®é•œåƒ"><a href="#4-3-å®‰è£…æ·˜å®é•œåƒ" class="headerlink" title="4.3 å®‰è£…æ·˜å®é•œåƒ"></a>4.3 å®‰è£…æ·˜å®é•œåƒ</h2><ul>
<li><a target="_blank" rel="noopener" href="http://www.npmjs.org/">http://www.npmjs.org</a> npm åŒ…å®˜ç½‘</li>
<li><a target="_blank" rel="noopener" href="https://npm.taobao.org/">https://npm.taobao.org/</a> æ·˜å® npm é•œåƒå®˜ç½‘</li>
</ul>
<blockquote>
<p>æ·˜å® <code>NPM</code> é•œåƒæ˜¯ä¸€ä¸ªå®Œæ•´ <code>npmjs.org</code> é•œåƒï¼Œä½ å¯ä»¥ç”¨æ­¤ä»£æ›¿å®˜æ–¹ç‰ˆæœ¬(åªè¯»)ï¼ŒåŒæ­¥é¢‘ ç‡ç›®å‰ä¸º 10 åˆ†é’Ÿ ä¸€æ¬¡ä»¥ä¿è¯å°½é‡ä¸å®˜æ–¹æœåŠ¡åŒæ­¥</p>
</blockquote>
<p>æˆ‘ä»¬å¯ä»¥ä½¿ç”¨æˆ‘ä»¬å®šåˆ¶çš„ <code>cnpm</code> (<code>gzip</code> å‹ç¼©æ”¯æŒ) å‘½ä»¤è¡Œå·¥å…·ä»£æ›¿é»˜è®¤çš„ <code>npm</code>:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm install -g cnpm --registry=https://registry.npm.taobao.org</span><br></pre></td></tr></table></figure>

<h1 id="äº”ã€fsæ¨¡å—"><a href="#äº”ã€fsæ¨¡å—" class="headerlink" title="äº”ã€fsæ¨¡å—"></a>äº”ã€fsæ¨¡å—</h1><h2 id="5-1-fs-stat-æ£€æµ‹æ˜¯æ–‡ä»¶è¿˜æ˜¯ç›®å½•"><a href="#5-1-fs-stat-æ£€æµ‹æ˜¯æ–‡ä»¶è¿˜æ˜¯ç›®å½•" class="headerlink" title="5.1 fs.stat æ£€æµ‹æ˜¯æ–‡ä»¶è¿˜æ˜¯ç›®å½•"></a>5.1 fs.stat æ£€æµ‹æ˜¯æ–‡ä»¶è¿˜æ˜¯ç›®å½•</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">const fs = require(&#x27;fs&#x27;)</span><br><span class="line"></span><br><span class="line">fs.stat(&#x27;hello.js&#x27;, (error, stats) = &gt;&#123;</span><br><span class="line">    if (error) &#123;</span><br><span class="line">        console.log(error)</span><br><span class="line">    &#125; else &#123;</span><br><span class="line">        console.log(stats) </span><br><span class="line">        </span><br><span class="line">        console.log(`æ–‡ä»¶: $ &#123;</span><br><span class="line">            stats.isFile()</span><br><span class="line">        &#125;`) </span><br><span class="line">        </span><br><span class="line">        console.log(`ç›®å½•: $ &#123;</span><br><span class="line">            stats.isDirectory()</span><br><span class="line">        &#125;`)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>

<h2 id="5-2-fs-mkdir-åˆ›å»ºç›®å½•"><a href="#5-2-fs-mkdir-åˆ›å»ºç›®å½•" class="headerlink" title="5.2 fs.mkdir åˆ›å»ºç›®å½•"></a>5.2 fs.mkdir åˆ›å»ºç›®å½•</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">const fs = require(&#x27;fs&#x27;) </span><br><span class="line"></span><br><span class="line">fs.mkdir(&#x27;logs&#x27;, (error) = &gt;&#123;</span><br><span class="line">    if (error) &#123;</span><br><span class="line">        console.log(error)</span><br><span class="line">    &#125; else &#123;</span><br><span class="line">        console.log(&#x27;æˆåŠŸåˆ› å»ºç›®å½•:logs&#x27;)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>

<h2 id="5-3-fs-writeFile-åˆ›å»ºå†™å…¥æ–‡ä»¶"><a href="#5-3-fs-writeFile-åˆ›å»ºå†™å…¥æ–‡ä»¶" class="headerlink" title="5.3 fs.writeFile åˆ›å»ºå†™å…¥æ–‡ä»¶"></a>5.3 fs.writeFile åˆ›å»ºå†™å…¥æ–‡ä»¶</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">fs.writeFile(&#x27;logs/hello.log&#x27;, &#x27;æ‚¨å¥½ ~ \n&#x27;, (error) = &gt;&#123;</span><br><span class="line">    if (error) &#123;</span><br><span class="line">        console.log(error)</span><br><span class="line">    &#125; else &#123;</span><br><span class="line">        console.log(&#x27;æˆåŠŸå†™ å…¥æ–‡ä»¶&#x27;)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>

<h2 id="5-4-fs-appendFile-è¿½åŠ æ–‡ä»¶"><a href="#5-4-fs-appendFile-è¿½åŠ æ–‡ä»¶" class="headerlink" title="5.4 fs.appendFile è¿½åŠ æ–‡ä»¶"></a>5.4 fs.appendFile è¿½åŠ æ–‡ä»¶</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">fs.appendFile(&#x27;logs/hello.log&#x27;, &#x27;hello ~ \n&#x27;, (error) = &gt;&#123;</span><br><span class="line">    if (error) &#123;</span><br><span class="line">        console.log(error)</span><br><span class="line">    &#125; else &#123;</span><br><span class="line">        console.log(&#x27;æˆåŠŸå†™ å…¥æ–‡ä»¶&#x27;)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>

<h2 id="5-5-fs-readFile-è¯»å–æ–‡ä»¶"><a href="#5-5-fs-readFile-è¯»å–æ–‡ä»¶" class="headerlink" title="5.5 fs.readFile è¯»å–æ–‡ä»¶"></a>5.5 fs.readFile è¯»å–æ–‡ä»¶</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">const fs = require(&#x27;fs&#x27;) </span><br><span class="line"></span><br><span class="line">fs.readFile(&#x27;logs/hello.log&#x27;, &#x27;utf8&#x27;, (error, data) = &gt;&#123;</span><br><span class="line">    if (error) &#123;</span><br><span class="line">        console.log(error)</span><br><span class="line">    &#125; else &#123;</span><br><span class="line">        console.log(data)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>

<h2 id="5-6-fs-readdir-è¯»å–ç›®å½•"><a href="#5-6-fs-readdir-è¯»å–ç›®å½•" class="headerlink" title="5.6 fs.readdir è¯»å–ç›®å½•"></a>5.6 fs.readdir è¯»å–ç›®å½•</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">const fs = require(&#x27;fs&#x27;) </span><br><span class="line"></span><br><span class="line">fs.readdir(&#x27;logs&#x27;, (error, files) = &gt;&#123;</span><br><span class="line">    if (error) &#123;</span><br><span class="line">        console.log(error)</span><br><span class="line">    &#125; else &#123;</span><br><span class="line">        console.log(files)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>

<h2 id="5-7-fs-rename-é‡å‘½å"><a href="#5-7-fs-rename-é‡å‘½å" class="headerlink" title="5.7 fs.rename é‡å‘½å"></a>5.7 fs.rename é‡å‘½å</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">const fs = require(&#x27;fs&#x27;) </span><br><span class="line"></span><br><span class="line">fs.rename(&#x27;js/hello.log&#x27;, &#x27;js/greeting.log&#x27;, (error) = &gt;&#123;</span><br><span class="line">    if (error) &#123;</span><br><span class="line">        console.log(error)</span><br><span class="line">    &#125; else &#123;</span><br><span class="line">        console.log(&#x27; é‡å‘½åæˆåŠŸ&#x27;)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>

<h2 id="5-8-fs-rmdir-åˆ é™¤ç›®å½•"><a href="#5-8-fs-rmdir-åˆ é™¤ç›®å½•" class="headerlink" title="5.8 fs.rmdir åˆ é™¤ç›®å½•"></a>5.8 fs.rmdir åˆ é™¤ç›®å½•</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">fs.rmdir(&#x27;logs&#x27;, (error) = &gt;&#123;</span><br><span class="line">    if (error) &#123;</span><br><span class="line">        console.log(error)</span><br><span class="line">    &#125; else &#123;</span><br><span class="line">        console.log(&#x27;æˆåŠŸçš„åˆ é™¤äº†ç›®å½•:logs&#x27;)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>

<h2 id="5-9-fs-unlink-åˆ é™¤æ–‡ä»¶"><a href="#5-9-fs-unlink-åˆ é™¤æ–‡ä»¶" class="headerlink" title="5.9 fs.unlink åˆ é™¤æ–‡ä»¶"></a>5.9 fs.unlink åˆ é™¤æ–‡ä»¶</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">fs.unlink(`logs / $ &#123;</span><br><span class="line">    file</span><br><span class="line">&#125;`, (error) = &gt;&#123;</span><br><span class="line">    if (error) &#123;</span><br><span class="line">        console.log(error)</span><br><span class="line">    &#125; else &#123;</span><br><span class="line">        console.log(`æˆåŠŸçš„åˆ é™¤äº†æ–‡ä»¶: $ &#123;</span><br><span class="line">            file</span><br><span class="line">        &#125;`)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>

<h2 id="5-10-fs-createReadStream-ä»æ–‡ä»¶æµä¸­è¯»å–æ•°æ®"><a href="#5-10-fs-createReadStream-ä»æ–‡ä»¶æµä¸­è¯»å–æ•°æ®" class="headerlink" title="5.10 fs.createReadStream ä»æ–‡ä»¶æµä¸­è¯»å–æ•°æ®"></a>5.10 fs.createReadStream ä»æ–‡ä»¶æµä¸­è¯»å–æ•°æ®</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">const fs = require(&#x27;fs&#x27;) </span><br><span class="line"></span><br><span class="line">var fileReadStream = fs.createReadStream(&#x27;data.json&#x27;) </span><br><span class="line">let count = 0;</span><br><span class="line">var str = &#x27;&#x27;;</span><br><span class="line"></span><br><span class="line">fileReadStream.on(&#x27;data&#x27;, (chunk) = &gt;&#123;</span><br><span class="line">    console.log(`$ &#123;++count</span><br><span class="line">    &#125;æ¥æ”¶åˆ°: $ &#123;</span><br><span class="line">        chunk.length</span><br><span class="line">    &#125;`);</span><br><span class="line">    str += chunk</span><br><span class="line">&#125;) </span><br><span class="line"></span><br><span class="line">fileReadStream.on(&#x27;end&#x27;, () = &gt;&#123;</span><br><span class="line">    console.log(&#x27;--- ç»“æŸ ---&#x27;);</span><br><span class="line">    console.log(coun t);</span><br><span class="line">    console.log(str);</span><br><span class="line">&#125;) </span><br><span class="line"></span><br><span class="line">fileReadStream.on(&#x27;error&#x27;, (error) = &gt;&#123;</span><br><span class="line">    console.log(error)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>

<h2 id="5-11-fs-createWriteStream-å†™å…¥æ–‡ä»¶"><a href="#5-11-fs-createWriteStream-å†™å…¥æ–‡ä»¶" class="headerlink" title="5.11 fs.createWriteStream å†™å…¥æ–‡ä»¶"></a>5.11 fs.createWriteStream å†™å…¥æ–‡ä»¶</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">var fs = require(&quot;fs&quot;);</span><br><span class="line">var data = &#x27;æˆ‘æ˜¯ä»æ•°æ®åº“è·å–çš„æ•°æ®ï¼Œæˆ‘è¦ä¿å­˜èµ·æ¥&#x27;;</span><br><span class="line">// åˆ›å»ºä¸€ä¸ªå¯ä»¥å†™å…¥çš„æµï¼Œå†™å…¥åˆ°æ–‡ä»¶ output.txt ä¸­</span><br><span class="line">var writerStream = fs.createWriteStream(&#x27;output.txt&#x27;); // ä½¿ç”¨ utf8 ç¼–ç å†™å…¥æ•°æ®</span><br><span class="line"></span><br><span class="line">writerStream.write(data, &#x27;UTF8&#x27;); // æ ‡è®°æ–‡ä»¶æœ«å°¾</span><br><span class="line">writerStream.end();</span><br><span class="line">// å¤„ç†æµäº‹ä»¶ --&gt; finish äº‹ä»¶</span><br><span class="line">writerStream.on(&#x27;finish&#x27;,</span><br><span class="line">function() &#123;</span><br><span class="line">    /*finish - æ‰€æœ‰æ•°æ®å·²è¢«å†™å…¥åˆ°åº•å±‚ç³»ç»Ÿæ—¶è§¦å‘ã€‚*/</span><br><span class="line">    console.log(&quot;å†™å…¥å®Œ æˆã€‚&quot;);</span><br><span class="line">&#125;);</span><br><span class="line">writerStream.on(&#x27;error&#x27;,</span><br><span class="line">function(err) &#123;</span><br><span class="line">    console.log(err.stack);</span><br><span class="line">&#125;);</span><br><span class="line">console.log(&quot;ç¨‹åºæ‰§ è¡Œå®Œæ¯•&quot;);</span><br></pre></td></tr></table></figure>

<h2 id="5-12-ç®¡é“æµ"><a href="#5-12-ç®¡é“æµ" class="headerlink" title="5.12 ç®¡é“æµ"></a>5.12 ç®¡é“æµ</h2><blockquote>
<p>ç®¡é“æä¾›äº†ä¸€ä¸ªè¾“å‡ºæµåˆ°è¾“å…¥æµçš„æœºåˆ¶ã€‚é€šå¸¸æˆ‘ä»¬ç”¨äºä»ä¸€ä¸ªæµä¸­è·å–æ•°æ®å¹¶å°†æ•°æ®ä¼ é€’åˆ°å¦å¤–ä¸€ä¸ªæµä¸­ã€‚</p>
</blockquote>
<p><img src="https://poetries1.gitee.io/img-repo/2019/10/364.png" alt="img"></p>
<blockquote>
<p>å¦‚ä¸Šé¢çš„å›¾ç‰‡æ‰€ç¤ºï¼Œæˆ‘ä»¬æŠŠæ–‡ä»¶æ¯”ä½œè£…æ°´çš„æ¡¶ï¼Œè€Œæ°´å°±æ˜¯æ–‡ä»¶é‡Œçš„å†…å®¹ ï¼Œæˆ‘ä»¬ç”¨ä¸€æ ¹ç®¡å­(pipe )è¿æ¥ä¸¤ä¸ªæ¡¶ä½¿å¾—æ°´ä»ä¸€ä¸ªæ¡¶æµå…¥å¦ä¸€ä¸ªæ¡¶ï¼Œè¿™æ ·å°±æ…¢æ…¢çš„å®ç°äº†å¤§æ–‡ä»¶çš„å¤åˆ¶è¿‡ç¨‹ã€‚</p>
</blockquote>
<p>ä»¥ä¸‹å®ä¾‹æˆ‘ä»¬é€šè¿‡è¯»å–ä¸€ä¸ªæ–‡ä»¶å†…å®¹å¹¶å°†å†…å®¹å†™å…¥åˆ°å¦å¤–ä¸€ä¸ªæ–‡ä»¶ä¸­</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">var fs = require(&quot;fs&quot;);</span><br><span class="line">// åˆ›å»ºä¸€ä¸ªå¯è¯»æµ</span><br><span class="line">var readerStream = fs.createReadStream(&#x27;input.txt&#x27;); // åˆ›å»ºä¸€ä¸ªå¯å†™æµ</span><br><span class="line">var writerStream = fs.createWriteStream(&#x27;output.txt&#x27;);</span><br><span class="line"></span><br><span class="line">// ç®¡é“è¯»å†™æ“ä½œ</span><br><span class="line">// è¯»å– input.txt æ–‡ä»¶å†…å®¹ï¼Œå¹¶å°†å†…å®¹å†™å…¥åˆ° output.txt æ–‡ä»¶ä¸­ </span><br><span class="line">readerStream.pipe(writerStream);</span><br><span class="line">console.log(&quot;ç¨‹ åºæ‰§è¡Œå®Œæ¯•&quot;);</span><br></pre></td></tr></table></figure>

<h1 id="å…­ã€åˆ›å»ºä¸€ä¸ª-WEB-æœåŠ¡å™¨"><a href="#å…­ã€åˆ›å»ºä¸€ä¸ª-WEB-æœåŠ¡å™¨" class="headerlink" title="å…­ã€åˆ›å»ºä¸€ä¸ª WEB æœåŠ¡å™¨"></a>å…­ã€åˆ›å»ºä¸€ä¸ª WEB æœåŠ¡å™¨</h1><blockquote>
<p>åˆ©ç”¨HTTPæ¨¡å— URlæ¨¡å— PATHæ¨¡å— FS æ¨¡å—åˆ›å»ºä¸€ä¸ª WEB æœåŠ¡å™¨</p>
</blockquote>
<p><strong>1. Node.js åˆ›å»ºçš„ç¬¬ä¸€ä¸ªåº”ç”¨</strong></p>
<blockquote>
<p>å¼•å…¥ http æ¨¡å—</p>
</blockquote>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">var http = require(&quot;http&quot;);</span><br></pre></td></tr></table></figure>

<p><strong>2. åˆ›å»ºæœåŠ¡å™¨</strong></p>
<blockquote>
<p>æ¥ä¸‹æ¥æˆ‘ä»¬ä½¿ç”¨ <code>http.createServer()</code> æ–¹æ³•åˆ›å»ºæœåŠ¡å™¨ï¼Œå¹¶ä½¿ç”¨ <code>listen</code> æ–¹æ³•ç»‘å®š <code>8888</code> ç«¯å£ã€‚ å‡½æ•°é€šè¿‡ <code>request</code>, <code>response</code> å‚æ•°æ¥æ¥æ”¶å’Œå“åº”æ•°æ®</p>
</blockquote>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">//1.å¼•å…¥ http æ¨¡å—</span><br><span class="line">var http=require(&#x27;http&#x27;);</span><br><span class="line"></span><br><span class="line">//2.ç”¨ http æ¨¡å—åˆ›å»ºæœåŠ¡</span><br><span class="line">http.createServer(fun ction(req, res) &#123;</span><br><span class="line">    // å‘é€ HTTP å¤´éƒ¨</span><br><span class="line">    // HTTP çŠ¶æ€å€¼: 200 : OK</span><br><span class="line">    //è®¾ç½® HTTP å¤´éƒ¨ï¼ŒçŠ¶æ€ç æ˜¯ 200ï¼Œæ–‡ä»¶ç±»å‹æ˜¯ htmlï¼Œå­—ç¬¦é›†æ˜¯ utf-8</span><br><span class="line">    res.writeHead(200, &#123;</span><br><span class="line">        &quot;Content-Type&quot;: &quot;text/html;charset=&#x27;utf-8&#x27;&quot;</span><br><span class="line">    &#125;);</span><br><span class="line">    res.write(&#x27;ä½ å¥½ nodejs&#x27;);</span><br><span class="line">    res.write(&#x27;æˆ‘æ˜¯ç¬¬ä¸€ä¸ª nodejs ç¨‹åº&#x27;);</span><br><span class="line">    res.end();</span><br><span class="line">    /*ç»“æŸå“åº”*/</span><br><span class="line">&#125;).listen(8001);</span><br></pre></td></tr></table></figure>

<p><strong>3. WEB æœåŠ¡å™¨ä»‹ç»</strong></p>
<blockquote>
<p>Web æœåŠ¡å™¨ä¸€èˆ¬æŒ‡ç½‘ç«™æœåŠ¡å™¨ï¼Œæ˜¯æŒ‡é©»ç•™äºå› ç‰¹ç½‘ä¸ŠæŸç§ç±»å‹è®¡ç®—æœºçš„ç¨‹åºï¼Œå¯ä»¥å‘æµè§ˆ å™¨ç­‰ Web å®¢æˆ·ç«¯æä¾›æ–‡æ¡£ï¼Œä¹Ÿå¯ä»¥æ”¾ç½®ç½‘ç«™æ–‡ä»¶ï¼Œè®©å…¨ä¸–ç•Œæµè§ˆ;å¯ä»¥æ”¾ç½®æ•°æ®æ–‡ä»¶ï¼Œè®© å…¨ä¸–ç•Œä¸‹è½½ã€‚ç›®å‰æœ€ä¸»æµçš„ä¸‰ä¸ª Web æœåŠ¡å™¨æ˜¯ Apache Nginx IISã€‚</p>
</blockquote>
<h1 id="ä¸ƒã€Nodejs-çš„éé˜»å¡-I-x2F-Oã€å¼‚æ­¥ã€äº‹ä»¶é©±åŠ¨"><a href="#ä¸ƒã€Nodejs-çš„éé˜»å¡-I-x2F-Oã€å¼‚æ­¥ã€äº‹ä»¶é©±åŠ¨" class="headerlink" title="ä¸ƒã€Nodejs çš„éé˜»å¡ I&#x2F;Oã€å¼‚æ­¥ã€äº‹ä»¶é©±åŠ¨"></a>ä¸ƒã€Nodejs çš„éé˜»å¡ I&#x2F;Oã€å¼‚æ­¥ã€äº‹ä»¶é©±åŠ¨</h1><h2 id="7-1-Nodejsçš„å•çº¿ç¨‹-éé˜»å¡I-x2F-Oäº‹ä»¶é©±åŠ¨"><a href="#7-1-Nodejsçš„å•çº¿ç¨‹-éé˜»å¡I-x2F-Oäº‹ä»¶é©±åŠ¨" class="headerlink" title="7.1 Nodejsçš„å•çº¿ç¨‹ éé˜»å¡I&#x2F;Oäº‹ä»¶é©±åŠ¨"></a>7.1 Nodejsçš„å•çº¿ç¨‹ éé˜»å¡I&#x2F;Oäº‹ä»¶é©±åŠ¨</h2><ul>
<li>åœ¨ Javaã€PHP æˆ–è€….net ç­‰æœåŠ¡å™¨ç«¯è¯­è¨€ä¸­ï¼Œä¼šä¸ºæ¯ä¸€ä¸ªå®¢æˆ·ç«¯è¿æ¥åˆ›å»ºä¸€ä¸ªæ–°çš„çº¿ç¨‹ã€‚ è€Œæ¯ä¸ªçº¿ç¨‹éœ€è¦è€—è´¹å¤§çº¦ 2MB å†…å­˜ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œç†è®ºä¸Šï¼Œä¸€ä¸ª 8GB å†…å­˜çš„æœåŠ¡å™¨å¯ä»¥åŒæ—¶ è¿æ¥çš„æœ€å¤§ç”¨æˆ·æ•°ä¸º 4000 ä¸ªå·¦å³ã€‚è¦è®© Web åº”ç”¨ç¨‹åºæ”¯æŒæ›´å¤šçš„ç”¨æˆ·ï¼Œå°±éœ€è¦å¢åŠ æœåŠ¡å™¨ çš„æ•°é‡ï¼Œè€Œ Web åº”ç”¨ç¨‹åºçš„ç¡¬ä»¶æˆæœ¬å½“ç„¶å°±ä¸Šå‡äº†</li>
<li>Node.js ä¸ä¸ºæ¯ä¸ªå®¢æˆ·è¿æ¥åˆ›å»ºä¸€ä¸ªæ–°çš„çº¿ç¨‹ï¼Œè€Œä»…ä»…ä½¿ç”¨ä¸€ä¸ªçº¿ç¨‹ã€‚å½“æœ‰ç”¨æˆ·è¿æ¥äº†ï¼Œ å°±è§¦å‘ä¸€ä¸ªå†…éƒ¨äº‹ä»¶ï¼Œé€šè¿‡éé˜»å¡ I&#x2F;Oã€äº‹ä»¶é©±åŠ¨æœºåˆ¶ï¼Œè®© Node.js ç¨‹åºå®è§‚ä¸Šä¹Ÿæ˜¯å¹¶è¡Œçš„ã€‚ ä½¿ç”¨ Node.jsï¼Œä¸€ä¸ª 8GB å†…å­˜çš„æœåŠ¡å™¨ï¼Œå¯ä»¥åŒæ—¶å¤„ç†è¶…è¿‡ 4 ä¸‡ç”¨æˆ·çš„è¿æ¥ã€‚</li>
</ul>
<h2 id="7-2-Nodejs-å›è°ƒå¤„ç†å¼‚æ­¥"><a href="#7-2-Nodejs-å›è°ƒå¤„ç†å¼‚æ­¥" class="headerlink" title="7.2 Nodejs å›è°ƒå¤„ç†å¼‚æ­¥"></a>7.2 Nodejs å›è°ƒå¤„ç†å¼‚æ­¥</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">//é”™è¯¯çš„å†™æ³•:</span><br><span class="line">function getData()&#123; </span><br><span class="line">    //æ¨¡æ‹Ÿè¯·æ±‚æ•°æ® </span><br><span class="line">    var result=&#x27;&#x27;;</span><br><span class="line">    setTimeout(functio n ()&#123; </span><br><span class="line">        result=&#x27;è¿™æ˜¯è¯·æ±‚åˆ°çš„ æ•°æ®&#x27;</span><br><span class="line">    &#125;,200);</span><br><span class="line">    </span><br><span class="line">    return result; </span><br><span class="line">&#125;</span><br><span class="line">console .log(getData());/*å¼‚æ­¥å¯¼è‡´è¯·æ±‚ä¸åˆ°æ•°æ®*/</span><br><span class="line">//æ­£ç¡®çš„å¤„ç†å¼‚æ­¥:</span><br><span class="line">function getData(callback) &#123; //æ¨¡æ‹Ÿè¯·æ±‚æ•°æ®</span><br><span class="line">    var result = &#x27;&#x27;;</span><br><span class="line">    setTimeout(function() &#123;</span><br><span class="line">        result = &#x27;è¿™æ˜¯è¯·æ±‚åˆ°çš„ æ•°æ®&#x27;;</span><br><span class="line">        callback(result);</span><br><span class="line">    &#125;,</span><br><span class="line">    200);</span><br><span class="line">&#125;</span><br><span class="line">getData(function(data) &#123;</span><br><span class="line">    console.log(data);</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>

<h2 id="7-3-Nodejs-events-æ¨¡å—å¤„ç†å¼‚æ­¥"><a href="#7-3-Nodejs-events-æ¨¡å—å¤„ç†å¼‚æ­¥" class="headerlink" title="7.3 Nodejs events æ¨¡å—å¤„ç†å¼‚æ­¥"></a>7.3 Nodejs events æ¨¡å—å¤„ç†å¼‚æ­¥</h2><blockquote>
<p><code>Node.js</code> æœ‰å¤šä¸ªå†…ç½®çš„äº‹ä»¶ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡å¼•å…¥ <code>events</code> æ¨¡å—ï¼Œå¹¶é€šè¿‡å®ä¾‹åŒ– <code>EventEmitter</code> ç±»æ¥ç»‘å®šå’Œç›‘å¬äº‹ä»¶ã€‚</p>
</blockquote>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">// å¼•å…¥ events æ¨¡å—</span><br><span class="line">var events = require(&#x27;events&#x27;);</span><br><span class="line">var Even tEmitter =new event s .EventEmitter() ; /*å®ä¾‹åŒ–äº‹ä»¶å¯¹è±¡*/</span><br><span class="line">EventEmitter.on(&#x27;toparent&#x27;,function()&#123; console.log(&#x27;æ¥æ”¶åˆ°äº†å¹¿æ’­äº‹ä»¶&#x27;);</span><br><span class="line">&#125;)</span><br><span class="line">setTimeout(function ()&#123;</span><br><span class="line">    console.log(&#x27;å¹¿æ’­&#x27;);</span><br><span class="line">    EventEmitter.emit(&#x27;toparent&#x27; ); /*å‘é€å¹¿æ’­*/ </span><br><span class="line">&#125;,1000)</span><br></pre></td></tr></table></figure>

<h1 id="å…«ã€é™æ€æ–‡ä»¶æ‰˜ç®¡-GET-POSTè·¯ç”±EJSæ¨¡æ¿å¼•æ“"><a href="#å…«ã€é™æ€æ–‡ä»¶æ‰˜ç®¡-GET-POSTè·¯ç”±EJSæ¨¡æ¿å¼•æ“" class="headerlink" title="å…«ã€é™æ€æ–‡ä»¶æ‰˜ç®¡ GET POSTè·¯ç”±EJSæ¨¡æ¿å¼•æ“"></a>å…«ã€é™æ€æ–‡ä»¶æ‰˜ç®¡ GET POSTè·¯ç”±EJSæ¨¡æ¿å¼•æ“</h1><h2 id="8-1-è·¯ç”±"><a href="#8-1-è·¯ç”±" class="headerlink" title="8.1 è·¯ç”±"></a>8.1 è·¯ç”±</h2><blockquote>
<p>è·¯ç”±æŒ‡çš„å°±æ˜¯é’ˆå¯¹ä¸åŒè¯·æ±‚çš„ URLï¼Œå¤„ç†ä¸åŒçš„ä¸šåŠ¡é€»è¾‘ã€‚</p>
</blockquote>
<p><img src="https://poetries1.gitee.io/img-repo/2019/10/365.png" alt="img"></p>
<h2 id="8-2-åˆè¯†-EJS-æ¨¡å—å¼•æ“"><a href="#8-2-åˆè¯†-EJS-æ¨¡å—å¼•æ“" class="headerlink" title="8.2 åˆè¯† EJS æ¨¡å—å¼•æ“"></a>8.2 åˆè¯† EJS æ¨¡å—å¼•æ“</h2><blockquote>
<p>æˆ‘ä»¬å­¦çš„ EJS æ˜¯åå°æ¨¡æ¿ï¼Œå¯ä»¥æŠŠæˆ‘ä»¬æ•°æ®åº“å’Œæ–‡ä»¶è¯»å–çš„æ•°æ®æ˜¾ç¤ºåˆ° Html é¡µé¢ä¸Šé¢ã€‚å®ƒ æ˜¯ä¸€ä¸ªç¬¬ä¸‰æ–¹æ¨¡å—ï¼Œéœ€è¦é€šè¿‡ npm å®‰è£…</p>
</blockquote>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm install ejs â€“save / cnpm install ejs --save</span><br></pre></td></tr></table></figure>

<blockquote>
<p>Nodejs ä¸­ä½¿ç”¨:</p>
</blockquote>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">ejs.renderFile(filename, data, options, function(err, str)&#123;</span><br><span class="line">// str =&gt; Rendered HTML string</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<p><strong>EJS å¸¸ç”¨æ ‡ç­¾</strong></p>
<ul>
<li><code>&lt;%%&gt;</code>æµç¨‹æ§åˆ¶æ ‡ç­¾</li>
<li><code>&lt;%=%&gt;</code>è¾“å‡ºæ ‡ç­¾(åŸæ–‡è¾“å‡ºHTMLæ ‡ç­¾)</li>
<li><code>&lt;%-%&gt;</code>è¾“å‡ºæ ‡ç­¾(HTMLä¼šè¢«æµè§ˆå™¨è§£æ)</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">&lt;a href=&quot;&lt;%= url %&gt;&quot;&gt;&lt;img src=&quot;&lt;%= imageURL %&gt;&quot; alt=&quot;&quot;&gt;&lt;/a&gt;&lt;ul&gt;</span><br><span class="line">&lt;html&gt;</span><br><span class="line"> &lt;head&gt;&lt;/head&gt;</span><br><span class="line"> &lt;body&gt;</span><br><span class="line">  &lt;ul&gt;</span><br><span class="line">    &amp;lt;% for(var i = 0 ; i &amp;lt; news.length ; i++)&#123; %&amp;gt; </span><br><span class="line">   &lt;li&gt;&amp;lt;%= news[i] %&amp;gt;&lt;/li&gt; &amp;lt;% &#125; %&amp;gt; </span><br><span class="line">  &lt;/ul&gt;</span><br><span class="line"> &lt;/body&gt;</span><br><span class="line">&lt;/html&gt;</span><br></pre></td></tr></table></figure>

<h2 id="8-3-Getã€Post"><a href="#8-3-Getã€Post" class="headerlink" title="8.3 Getã€Post"></a>8.3 Getã€Post</h2><ul>
<li>è¶…æ–‡æœ¬ä¼ è¾“åè®®(HTTP)çš„è®¾è®¡ç›®çš„æ˜¯ä¿è¯å®¢æˆ·ç«¯æœºå™¨ä¸æœåŠ¡å™¨ä¹‹é—´çš„é€šä¿¡</li>
<li>åœ¨å®¢æˆ·ç«¯å’ŒæœåŠ¡å™¨ä¹‹é—´è¿›è¡Œè¯·æ±‚-å“åº”æ—¶ï¼Œä¸¤ç§æœ€å¸¸è¢«ç”¨åˆ°çš„æ–¹æ³•æ˜¯:GET å’Œ POST<ul>
<li>GET - ä»æŒ‡å®šçš„èµ„æºè¯·æ±‚æ•°æ®ã€‚(ä¸€èˆ¬ç”¨äºè·å–æ•°æ®)</li>
<li>POST - å‘æŒ‡å®šçš„èµ„æºæäº¤è¦è¢«å¤„ç†çš„æ•°æ®ã€‚(ä¸€èˆ¬ç”¨äºæäº¤æ•°æ®)</li>
</ul>
</li>
</ul>
<p><strong>è·å– GET ä¼ å€¼:</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">var urlinfo=url.parse(req.url,true); </span><br><span class="line">urlinfo.query();</span><br></pre></td></tr></table></figure>

<p><strong>è·å– POST ä¼ å€¼:</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">var postData = &#x27;&#x27;; </span><br><span class="line"></span><br><span class="line">// æ•°æ®å—æ¥æ”¶ä¸­</span><br><span class="line">req.on(&#x27;data&#x27;,</span><br><span class="line">function(postDataChunk) &#123;</span><br><span class="line">    postData += postDataChunk;</span><br><span class="line">&#125;);</span><br><span class="line">// æ•°æ®æ¥æ”¶å®Œæ¯•ï¼Œæ‰§è¡Œå›è°ƒå‡½æ•°</span><br><span class="line">req.on(&#x27;end&#x27;,</span><br><span class="line">function() &#123;</span><br><span class="line">    try &#123;</span><br><span class="line">        postData = JSON.parse(postData);</span><br><span class="line">    &#125; catch(e) &#123;&#125;</span><br><span class="line">    req.query = postData;</span><br><span class="line">    console.log(q uerystring.parse(postData));</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<h1 id="ä¹ã€MongoDb-æ•°æ®åº“ä»‹ç»ã€å®‰è£…ã€ä½¿ç”¨"><a href="#ä¹ã€MongoDb-æ•°æ®åº“ä»‹ç»ã€å®‰è£…ã€ä½¿ç”¨" class="headerlink" title="ä¹ã€MongoDb æ•°æ®åº“ä»‹ç»ã€å®‰è£…ã€ä½¿ç”¨"></a>ä¹ã€MongoDb æ•°æ®åº“ä»‹ç»ã€å®‰è£…ã€ä½¿ç”¨</h1><h2 id="9-1-æ•°æ®åº“å’Œæ–‡ä»¶çš„ä¸»è¦åŒºåˆ«"><a href="#9-1-æ•°æ®åº“å’Œæ–‡ä»¶çš„ä¸»è¦åŒºåˆ«" class="headerlink" title="9.1 æ•°æ®åº“å’Œæ–‡ä»¶çš„ä¸»è¦åŒºåˆ«"></a>9.1 æ•°æ®åº“å’Œæ–‡ä»¶çš„ä¸»è¦åŒºåˆ«</h2><ul>
<li>æ•°æ®åº“æœ‰æ•°æ®åº“è¡¨ã€è¡Œå’Œåˆ—çš„æ¦‚å¿µï¼Œè®©æˆ‘ä»¬å­˜å‚¨æ“ä½œæ•°æ®æ›´æ–¹ä¾¿</li>
<li>æ•°æ®åº“æä¾›äº†éå¸¸æ–¹ä¾¿çš„æ¥å£ï¼Œå¯ä»¥è®© <code>nodejs</code>ã€<code>php</code> <code>java</code> <code>.net</code> å¾ˆæ–¹ä¾¿çš„å®ç°å¢åŠ ä¿®æ”¹åˆ é™¤åŠŸèƒ½</li>
</ul>
<h2 id="9-2-NoSql-ä»‹ç»"><a href="#9-2-NoSql-ä»‹ç»" class="headerlink" title="9.2 NoSql ä»‹ç»"></a>9.2 NoSql ä»‹ç»</h2><h3 id="9-2-1-NoSQL-ä»‹ç»"><a href="#9-2-1-NoSQL-ä»‹ç»" class="headerlink" title="9.2.1 NoSQL ä»‹ç»"></a>9.2.1 NoSQL ä»‹ç»</h3><ul>
<li>ç”±äºäº’è”ç½‘çš„è¿…é€Ÿå‘å±•ï¼Œäº‘è®¡ç®—ä¸ Web2.0ã€‚è¿™æ ·å¤§é‡çš„äº¤äº’ç»™æ•°æ®åº“æå‡ºäº†æ›´é«˜çš„æ€§èƒ½è¦<br>æ±‚ï¼Œä¼ ç»Ÿçš„æ•°æ®åº“(æœ¬æ–‡æ³›æŒ‡ SQL æ•°æ®åº“)ï¼Œå³å…³ç³»æ•°æ®åº“è™½ç„¶å…·å¤‡è‰¯å¥½çš„äº‹ç‰©ç®¡ç†ï¼Œ<br>ä½†åœ¨ å¤„ç†å¤§é‡æ•°æ® çš„åº”ç”¨ æ—¶å¾ˆéš¾ åœ¨æ€§èƒ½ ä¸Šæ»¡è¶³ è®¾è®¡è¦ æ±‚ã€‚NoSQL å°±æ˜¯ä¸»è¦ä¸ºäº†è§£å†³å½“ä¸‹å¤§é‡é«˜å¹¶å‘é«˜è¦æ±‚çš„æ•°æ® åº“åº”ç”¨ éœ€æ±‚ï¼Œå…³ç³»æ•° æ®åº“ å…·æœ‰ä¸¥ æ ¼çš„å‚ ç…§æ€§ï¼Œä¸€è‡´æ€§ ï¼Œå¯ç”¨ æ€§ï¼ŒåŸå­æ€§ ï¼Œéš”ç¦» æ€§ç­‰ç‰¹ ç‚¹</li>
<li>å› æ­¤ä¼šäº§ç”Ÿä¸€äº›ä¾‹å¦‚è¡¨è¿æ¥ç­‰æ“ä½œï¼Œè¿™æ ·ä¼šå¤§å¤§é™ä½ç³»ç»Ÿçš„æ€§èƒ½ã€‚è€Œåœ¨å½“å‰å¾ˆå¤šåº”ç”¨åœºæ™¯ä¸‹å¯¹æ€§èƒ½çš„è¦æ±‚ è¿œè¿œå¼º äºä¼ ç»Ÿ æ•°æ®åº“ å…³æ³¨çš„ ç‚¹ï¼Œ<code>NoSQL</code>å°±æ˜¯ä¸ºäº†è§£å†³å¤§è§„æ¨¡æ•°æ®ä¸å¤šæ ·æ•° æ®ç§ç±» ç­‰é—®é¢˜ï¼Œå°¤å…¶æ˜¯å…¶ä¸­å¤§æ•°æ®çš„ç›¸å…³é—®é¢˜ã€‚</li>
<li><code>NoSQL</code>(<code>NoSQL = Not Only SQL</code> )ï¼Œæ„å³â€œä¸ä»…ä»…æ˜¯ SQLâ€ï¼Œå®ƒæŒ‡çš„æ˜¯éå…³ç³»å‹çš„æ•°æ®åº“ï¼Œæ˜¯ä»¥ <code>key-value</code><br>å½¢å¼å­˜å‚¨ï¼Œå’Œä¼ ç»Ÿçš„å…³ç³»å‹æ•°æ®åº“ä¸ä¸€æ ·ï¼Œä¸ä¸€å®šéµå¾ªä¼ ç»Ÿæ•°æ®åº“çš„ä¸€äº›åŸºæœ¬è¦æ±‚ï¼Œæ¯”å¦‚è¯´éµå¾ªSQL æ ‡å‡†ACID å±æ€§ã€è¡¨ç»“æ„ç­‰ç­‰ã€‚<code>NoSQL</code> æœ€æ—©è¢«æå‡ºæ˜¯åœ¨ 20 ä¸–çºª 80 å¹´ä»£ï¼Œåœ¨å½“æ—¶æ›´å¤šæ˜¯å¼ºè°ƒçš„æ˜¯ä¸å…³ç³»æ•°æ®åº“åŒº åˆ«å¯¹å¾… ï¼Œæœ€è¿‘è¿™äº›å¹´è¢«æåŠçš„æ›´å¤šæ˜¯å¼ºè°ƒååŠ©è§£å†³å¤§æ•°æ®ç­‰ç›¸å…³é—®é¢˜ã€‚<code>NoSQL</code> åœ¨å¤§æ•°æ®æ—¶ä»£æœ‰è‡ªå·±çš„æ„ä¹‰</li>
</ul>
<h3 id="9-2-2-NoSQL-åº”ç”¨æƒ…å†µä»‹ç»"><a href="#9-2-2-NoSQL-åº”ç”¨æƒ…å†µä»‹ç»" class="headerlink" title="9.2.2 NoSQL åº”ç”¨æƒ…å†µä»‹ç»"></a>9.2.2 NoSQL åº”ç”¨æƒ…å†µä»‹ç»</h3><blockquote>
<p>å›½å†…çš„äº’è”ç½‘è“¬å‹ƒå‘å±•ï¼Œä¸ä»…æ¶Œç°å‡º BAT(ç™¾åº¦ï¼Œé˜¿é‡Œå·´å·´ï¼Œè…¾è®¯)ä¹‹ç±»çš„å·¨å¤´ï¼Œä¹Ÿå¸¦åŠ¨äº†æ•´ä¸ªäº’è” ç½‘è¡Œä¸šçš„å‘å±•ï¼Œå¤§é‡çš„åˆ›ä¸šå‹å…¬å¸å¦‚æ˜¥ç¬‹èˆ¬çš„æ¶Œå‡ºï¼Œåœ¨å›½å®¶å±‚é¢ä¹Ÿæå‡ºäº†â€œäº’è”ç½‘+â€å’Œâ€œä¸‡ä¼—åˆ›ä¸šâ€çš„å£ å·ã€‚æ›´å¤šä¼ ç»Ÿçš„è¡Œä¸šä¹Ÿå¼€å§‹æ‹¥æŠ±äº’è”ç½‘ã€‚ä½†æ˜¯æ— è®ºæ˜¯åšæ‰€è°“çš„ç”Ÿæ€å¹³å°è¿˜æ˜¯ ä¼ ç»Ÿä¸šåŠ¡çš„è½¬å‹ï¼Œæ¶‰åŠåˆ°çš„ä¸šåŠ¡æ˜¯å¤šç§å¤šæ ·çš„ã€‚è¿™ä¸ªæ—¶å€™ä¼ä¸šæ¶æ„å¸ˆå¯¹äºåº”ç”¨ç³»ç»Ÿçš„æ ¸å¿ƒâ€”â€”æ•°æ®åº“ç®¡ç† ä¸ä»…æœ‰ä¼ ç»Ÿçš„ SQL é€‰é¡¹ä¹Ÿæœ‰äº† NoSQLè¿™ç§é€‚åˆç‰¹å®šåœºæ™¯éœ€æ±‚çš„é€‰é¡¹</p>
</blockquote>
<p><strong>NoSQL æ•°æ®åº“åœ¨ä»¥ä¸‹çš„è¿™å‡ ç§æƒ…å†µä¸‹æ¯”è¾ƒé€‚ç”¨</strong></p>
<ul>
<li>æ•°æ®æ¨¡å‹æ¯”è¾ƒç®€å•</li>
<li>éœ€è¦çµæ´»æ€§æ›´å¼ºçš„ IT ç³»ç»Ÿ</li>
<li>å¯¹æ•°æ®åº“æ€§èƒ½è¦æ±‚è¾ƒé«˜</li>
<li>ä¸éœ€è¦é«˜åº¦çš„æ•°æ®ä¸€è‡´æ€§</li>
<li>å¯¹äºç»™å®š keyï¼Œæ¯”è¾ƒå®¹æ˜“æ˜ å°„å¤æ‚å€¼çš„ç¯å¢ƒ</li>
</ul>
<p><strong>NoSQL å‘å±•ç°çŠ¶</strong></p>
<ul>
<li>å›½å¤–: Google çš„ BigTable å’Œ Amazon çš„ Dynamo ä½¿ç”¨çš„å°±æ˜¯ NoSQL å‹æ•°æ®åº“ã€‚</li>
<li>å›½å†…:ç™¾åº¦ã€é˜¿é‡Œã€è…¾è®¯ã€æ–°æµªå¾®åšã€è§†è§‰ä¸­å›½ã€ä¼˜é…·è¿è¥æ•°æ®åˆ†æã€é£ä¿¡ç©ºé—´ã€è±†ç“£ç¤¾åŒºç­‰</li>
</ul>
<h2 id="9-3-ä»€ä¹ˆæ—¶å€™å»ºè®®ä½¿ç”¨-NoSql"><a href="#9-3-ä»€ä¹ˆæ—¶å€™å»ºè®®ä½¿ç”¨-NoSql" class="headerlink" title="9.3 ä»€ä¹ˆæ—¶å€™å»ºè®®ä½¿ç”¨ NoSql"></a>9.3 ä»€ä¹ˆæ—¶å€™å»ºè®®ä½¿ç”¨ NoSql</h2><ul>
<li>å¯¹æ•°æ®åº“é«˜å¹¶å‘è¯»å†™çš„éœ€æ±‚</li>
<li>å¯¹æµ·é‡æ•°æ®çš„é«˜æ•ˆç‡å­˜å‚¨å’Œè®¿é—®çš„éœ€æ±‚</li>
<li>å¯¹æ•°æ®åº“çš„é«˜å¯æ‰©å±•æ€§å’Œé«˜å¯ç”¨æ€§çš„éœ€æ±‚</li>
</ul>
<h2 id="9-4-NoSql-å’Œä¼ ç»Ÿæ•°æ®åº“ç®€å•å¯¹æ¯”"><a href="#9-4-NoSql-å’Œä¼ ç»Ÿæ•°æ®åº“ç®€å•å¯¹æ¯”" class="headerlink" title="9.4 NoSql å’Œä¼ ç»Ÿæ•°æ®åº“ç®€å•å¯¹æ¯”"></a>9.4 NoSql å’Œä¼ ç»Ÿæ•°æ®åº“ç®€å•å¯¹æ¯”</h2><ul>
<li>éç»“æ„å‹æ•°æ®åº“ã€‚æ²¡æœ‰è¡Œã€åˆ—çš„æ¦‚å¿µã€‚ç”¨ JSON æ¥å­˜å‚¨æ•°æ®ã€‚</li>
<li>é›†åˆå°±ç›¸å½“äºâ€œè¡¨ â€ï¼Œæ–‡æ¡£å°±ç›¸å½“äºâ€œè¡Œâ€ã€‚</li>
</ul>
<p><img src="https://poetries1.gitee.io/img-repo/2019/10/366.png" alt="img"></p>
<h2 id="9-5-NoSql-ç§ç±»"><a href="#9-5-NoSql-ç§ç±»" class="headerlink" title="9.5 NoSql ç§ç±»"></a>9.5 NoSql ç§ç±»</h2><p><img src="https://poetries1.gitee.io/img-repo/2019/10/367.png" alt="img"></p>
<h2 id="9-6-MongoDb-ä»‹ç»"><a href="#9-6-MongoDb-ä»‹ç»" class="headerlink" title="9.6 MongoDb ä»‹ç»"></a>9.6 MongoDb ä»‹ç»</h2><blockquote>
<p>MongoDB æ˜¯ä¸€ä¸ªä»‹äºå…³ç³»æ•°æ®åº“å’Œéå…³ç³»æ•°æ®åº“ä¹‹é—´çš„äº§å“ï¼Œæ˜¯éå…³ç³»æ•°æ®åº“å½“ä¸­åŠŸèƒ½æœ€ä¸°å¯Œï¼Œæœ€åƒ å…³ç³»æ•°æ®åº“çš„ã€‚ä»–æ”¯æŒçš„æ•°æ®ç»“æ„éå¸¸æ¾æ•£ï¼Œæ˜¯ç±»ä¼¼ json çš„ bson æ ¼å¼ï¼Œå› æ­¤å¯ä»¥å­˜å‚¨æ¯”è¾ƒå¤æ‚çš„æ•°æ®ç±» å‹ã€‚Mongo æœ€å¤§çš„ç‰¹ç‚¹æ˜¯ä»–æ”¯æŒçš„æŸ¥è¯¢è¯­è¨€éå¸¸å¼ºå¤§ï¼Œå…¶è¯­æ³•æœ‰ç‚¹ç±»ä¼¼äºé¢å‘å¯¹è±¡çš„æŸ¥è¯¢è¯­è¨€ï¼Œå‡ ä¹å¯ä»¥ å®ç°ç±»ä¼¼å…³ç³»æ•°æ®åº“å•è¡¨æŸ¥è¯¢çš„ç»å¤§éƒ¨åˆ†åŠŸèƒ½ï¼Œè€Œä¸”è¿˜æ”¯æŒå¯¹æ•°æ®å»ºç«‹ç´¢å¼•ã€‚å®ƒçš„ç‰¹ç‚¹æ˜¯é«˜ æ€§èƒ½ ã€æ˜“éƒ¨ç½² ã€ æ˜“ä½¿ç”¨ ï¼Œå­˜å‚¨æ•°æ®éå¸¸ æ–¹ä¾¿</p>
</blockquote>
<h2 id="9-7-MongoDb-å®‰è£…"><a href="#9-7-MongoDb-å®‰è£…" class="headerlink" title="9.7 MongoDb å®‰è£…"></a>9.7 MongoDb å®‰è£…</h2><ul>
<li>å®˜ç½‘:<a target="_blank" rel="noopener" href="https://www.mongodb.com/">https://www.mongodb.com/</a></li>
<li>æ‰‹å†Œ:<a target="_blank" rel="noopener" href="https://docs.mongodb.org/manual/">https://docs.mongodb.org/manual/</a></li>
</ul>
<p><strong>1. åŒå‡» MongoDB è½¯ä»¶ä¸‹ä¸€æ­¥ä¸‹ä¸€æ­¥å®‰è£…</strong></p>
<p><img src="https://poetries1.gitee.io/img-repo/2019/10/368.png" alt="img"></p>
<p><strong>2. å®‰è£…å®Œæˆé…ç½®ç¯å¢ƒå˜é‡ C:\Program Files\MongoDB\Server\3.0\bin åŠ å…¥åˆ°ç³»ç»Ÿçš„path ç¯å¢ƒå˜é‡ä¸­</strong></p>
<p><strong>3. æ‰“å¼€ cmd è¾“å…¥ :mongoå‘½ä»¤çœ‹çœ‹æ˜¯å¦æˆåŠŸã€‚å¦‚æœå‡ºæ¥ä¸‹å›¾è¯´æ˜ mongodbé…ç½®æˆåŠŸã€‚</strong></p>
<p><img src="https://poetries1.gitee.io/img-repo/2019/10/369.png" alt="img"></p>
<h2 id="9-8-ä½¿ç”¨-MongoDb"><a href="#9-8-ä½¿ç”¨-MongoDb" class="headerlink" title="9.8 ä½¿ç”¨ MongoDb"></a>9.8 ä½¿ç”¨ MongoDb</h2><ol>
<li>æ–°å»ºä¸€ä¸ªå­˜æ”¾æ•°æ®åº“çš„æ–‡ä»¶å¤¹ï¼Œæ³¨æ„:ä¸èƒ½æœ‰ä¸­æ–‡å’Œç©ºæ ¼ï¼Œå»ºè®®ä¸è¦æ”¾åœ¨ C ç›˜</li>
<li>å¯åŠ¨ MongoDb æœåŠ¡</li>
</ol>
<blockquote>
<p>æœåŠ¡ç«¯:<code>mongod</code> å¼€å¯æ•°æ®åº“æœåŠ¡ <code>mongod --dbpath C:\mongodb</code></p>
</blockquote>
<p><strong>å¼€å¯ MongoDb æœåŠ¡å‘½ä»¤:</strong></p>
<p><img src="https://poetries1.gitee.io/img-repo/2019/10/370.png" alt="img"></p>
<ul>
<li><code>--dbpath</code> å°±æ˜¯é€‰æ‹©æ•°æ®åº“æ–‡æ¡£æ‰€åœ¨çš„æ–‡ä»¶å¤¹</li>
<li>ä¹Ÿå°±æ˜¯è¯´ï¼Œ<code>mongoDB</code> ä¸­ï¼ŒçœŸçš„æœ‰ç‰©ç†æ–‡ä»¶ï¼Œå¯¹åº”ä¸€ä¸ªä¸ªæ•°æ®åº“ã€‚U ç›˜å¯ä»¥æ‹·èµ°ã€‚</li>
<li>æ³¨æ„:ä¸€å®šè¦ä¿æŒï¼Œå¼€æœºè¿™ä¸ª CMD ä¸èƒ½åŠ¨äº†ï¼Œä¸èƒ½å…³ï¼Œä¸èƒ½ <code>ctrl+c</code>ã€‚ ä¸€æ—¦è¿™ä¸ª <code>cmd</code> æœ‰é—®é¢˜äº†ï¼Œæ•°æ®åº“å°±è‡ªåŠ¨å…³é—­äº†</li>
</ul>
<ol>
<li>å®¢æˆ·ç«¯è¾“å…¥ <code>mongo</code> å‘½ä»¤è¿æ¥æœåŠ¡ç«¯</li>
</ol>
<blockquote>
<p>å®¢æˆ·ç«¯:<code>mongo</code> ä½¿ç”¨æ•°æ®åº“</p>
</blockquote>
<p><img src="https://poetries1.gitee.io/img-repo/2019/10/371.png" alt="img"></p>
<blockquote>
<p>å®¢æˆ·ç«¯:<code>mongo</code> ä½¿ç”¨æ•°æ®åº“ <code>ip</code> åœ°å€:ç«¯å£å·</p>
</blockquote>
<p><img src="https://poetries1.gitee.io/img-repo/2019/10/372.png" alt="img"></p>
<h1 id="åã€MongoDB-æ•°æ®åº“åˆ›å»ºåˆ é™¤ã€è¡¨ï¼ˆé›†åˆï¼‰åˆ›å»ºåˆ é™¤ã€æ•°æ®å¢åˆ æ”¹æŸ¥"><a href="#åã€MongoDB-æ•°æ®åº“åˆ›å»ºåˆ é™¤ã€è¡¨ï¼ˆé›†åˆï¼‰åˆ›å»ºåˆ é™¤ã€æ•°æ®å¢åˆ æ”¹æŸ¥" class="headerlink" title="åã€MongoDB æ•°æ®åº“åˆ›å»ºåˆ é™¤ã€è¡¨ï¼ˆé›†åˆï¼‰åˆ›å»ºåˆ é™¤ã€æ•°æ®å¢åˆ æ”¹æŸ¥"></a>åã€MongoDB æ•°æ®åº“åˆ›å»ºåˆ é™¤ã€è¡¨ï¼ˆé›†åˆï¼‰åˆ›å»ºåˆ é™¤ã€æ•°æ®å¢åˆ æ”¹æŸ¥</h1><h2 id="10-1-æ•°æ®åº“ä½¿ç”¨"><a href="#10-1-æ•°æ®åº“ä½¿ç”¨" class="headerlink" title="10.1 æ•°æ®åº“ä½¿ç”¨"></a>10.1 æ•°æ®åº“ä½¿ç”¨</h2><blockquote>
<p>å¼€å¯ <code>mongodb</code> æœåŠ¡:è¦ç®¡ç†æ•°æ®åº“ï¼Œå¿…é¡»å…ˆå¼€å¯æœåŠ¡ï¼Œå¼€å¯æœåŠ¡ä½¿ç”¨ <code>mongod --dbpath c:\mongodb</code></p>
</blockquote>
<p><img src="https://poetries1.gitee.io/img-repo/2019/10/373.png" alt="img"></p>
<blockquote>
<p>ç®¡ç† <code>mongodb</code> æ•°æ®åº“:<code>mongo</code> (ä¸€å®šè¦åœ¨æ–°çš„ <code>cmd</code> ä¸­è¾“å…¥)</p>
</blockquote>
<p><img src="https://poetries1.gitee.io/img-repo/2019/10/374.png" alt="img"></p>
<blockquote>
<p>æŸ¥çœ‹æ‰€æœ‰æ•°æ®åº“åˆ— è¡¨</p>
</blockquote>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">show dbs</span><br></pre></td></tr></table></figure>

<h2 id="10-2-åˆ›å»ºæ•°æ®åº“"><a href="#10-2-åˆ›å»ºæ•°æ®åº“" class="headerlink" title="10.2 åˆ›å»ºæ•°æ®åº“"></a>10.2 åˆ›å»ºæ•°æ®åº“</h2><p><img src="https://poetries1.gitee.io/img-repo/2019/10/375.png" alt="img"></p>
<p><strong>ä½¿ç”¨æ•°æ®åº“ã€åˆ›å»º æ•°æ®åº“</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">use student</span><br></pre></td></tr></table></figure>

<ul>
<li>å¦‚æœçœŸçš„æƒ³æŠŠè¿™ä¸ªæ•°æ®åº“åˆ›å»ºæˆåŠŸï¼Œé‚£ä¹ˆå¿…é¡»æ’å…¥ä¸€ä¸ªæ•°æ®</li>
<li>æ•°æ®åº“ä¸­ä¸èƒ½ç›´æ¥æ’å…¥æ•°æ®ï¼Œåªèƒ½å¾€é›†åˆ(collectio ns)ä¸­æ’å…¥æ•° æ®ã€‚ä¸éœ€è¦ä¸“é—¨åˆ›å»ºé›†åˆï¼Œåªéœ€è¦å†™ç‚¹è¯­æ³•æ’å…¥æ•°æ®å°±ä¼šåˆ›å»ºé›†åˆ:</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">db.student.insert(&#123;â€œnameâ€:â€x iaom ingâ€&#125;);</span><br></pre></td></tr></table></figure>

<ul>
<li>db.student ç³»ç»Ÿå‘ç° student æ˜¯ä¸€ä¸ªé™Œç”Ÿçš„é›†åˆåå­—ï¼Œæ‰€ä»¥å°±è‡ªåŠ¨åˆ›å»ºäº†é›†åˆ</li>
</ul>
<p><strong>æ˜¾ç¤ºå½“å‰çš„æ•°æ®é›†åˆ(mysql ä¸­å«è¡¨)</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">show collections</span><br></pre></td></tr></table></figure>

<p><strong>åˆ é™¤æ•°æ®åº“ï¼Œåˆ é™¤å½“å‰æ‰€åœ¨çš„æ•°æ®åº“</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">db.dropDatabase();</span><br></pre></td></tr></table></figure>

<p><strong>åˆ é™¤é›†åˆï¼Œåˆ é™¤æŒ‡å®šçš„é›†åˆåˆ é™¤è¡¨</strong></p>
<blockquote>
<p>åˆ é™¤é›†åˆ</p>
</blockquote>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">db.COLLECTION_NAME.drop()</span><br><span class="line"></span><br><span class="line">db.user.drop()</span><br></pre></td></tr></table></figure>

<h2 id="10-3-æ’å…¥-å¢åŠ -æ•°æ®"><a href="#10-3-æ’å…¥-å¢åŠ -æ•°æ®" class="headerlink" title="10.3 æ’å…¥(å¢åŠ )æ•°æ®"></a>10.3 æ’å…¥(å¢åŠ )æ•°æ®</h2><blockquote>
<p>æ’å…¥æ•°æ®ï¼Œéšç€æ•°æ®çš„æ’å…¥ï¼Œæ•°æ®åº“åˆ›å»ºæˆåŠŸäº†ï¼Œé›†åˆä¹Ÿåˆ›å»ºæˆåŠŸäº†ã€‚</p>
</blockquote>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">db.è¡¨å.insert(&#123;&quot;name&quot;:&quot;zhangsan&quot;&#125;);</span><br><span class="line"></span><br><span class="line">student é›†åˆåç§°(è¡¨)</span><br></pre></td></tr></table></figure>

<h2 id="10-4-æŸ¥æ‰¾æ•°æ®"><a href="#10-4-æŸ¥æ‰¾æ•°æ®" class="headerlink" title="10.4 æŸ¥æ‰¾æ•°æ®"></a>10.4 æŸ¥æ‰¾æ•°æ®</h2><p><strong>1. æŸ¥è¯¢æ‰€æœ‰è®° å½•</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">db.userInfo.find();</span><br></pre></td></tr></table></figure>

<blockquote>
<p>ç›¸å½“äº:<code>select* from userInfo;</code></p>
</blockquote>
<p><strong>2. æŸ¥è¯¢å»æ‰å çš„å½“å‰èšé›†é›†åˆä¸­çš„æŸåˆ—çš„é‡å¤æ•°æ®</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">db.userInfo.distinct(&quot;name&quot;);</span><br></pre></td></tr></table></figure>

<ul>
<li>ä¼šè¿‡æ»¤æ‰ <code>name</code> ä¸­çš„ç›¸åŒæ•°æ®</li>
<li>ç›¸å½“äº:<code>select distict name from userInfo;</code></li>
</ul>
<p><strong>3. æŸ¥è¯¢ age &#x3D; 22 çš„è®°å½•</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">db.userInfo.find(&#123;&quot;age&quot;: 22&#125;);</span><br></pre></td></tr></table></figure>

<blockquote>
<p>ç›¸å½“äº: <code>select * from userInfo where age = 22;</code></p>
</blockquote>
<p><strong>4. æŸ¥è¯¢ age &gt; 22 çš„è®°å½•</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">db.userInfo.find(&#123;age: &#123;$gt: 22&#125;&#125;);</span><br></pre></td></tr></table></figure>

<blockquote>
<p>ç›¸å½“äº:<code>select * from userInfo where age &gt;22;</code></p>
</blockquote>
<p><strong>5. æŸ¥è¯¢ age &lt; 22 çš„è®°å½•</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">db.userInfo.find(&#123;age: &#123;$lt: 22&#125;&#125;);</span><br></pre></td></tr></table></figure>

<blockquote>
<p>ç›¸å½“äº:<code>select * from userInfo where age &lt;22;</code></p>
</blockquote>
<p><strong>6. æŸ¥è¯¢ age &gt;&#x3D; 25 çš„è®°å½•</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">db.userInfo.find(&#123;age: &#123;$gte: 25&#125;&#125;);</span><br></pre></td></tr></table></figure>

<blockquote>
<p>ç›¸å½“äº:<code>select * from userInfo where age &gt;= 25;</code></p>
</blockquote>
<p><strong>7. æŸ¥è¯¢ age &lt;&#x3D; 25 çš„è®°å½•</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">db.userInfo.find(&#123;age: &#123;$lte: 25&#125;&#125;);</span><br></pre></td></tr></table></figure>

<p><strong>8. æŸ¥è¯¢ age &gt;&#x3D; 23 å¹¶ä¸” age &lt;&#x3D; 26</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">db.userInfo.find(&#123;age: &#123;$gte: 23, $lte: 26&#125;&#125;);</span><br></pre></td></tr></table></figure>

<p><strong>9. æŸ¥è¯¢nameä¸­åŒ…å« mongoçš„æ•°æ®,æ¨¡ç³ŠæŸ¥è¯¢ç”¨äºæœç´¢</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">db.userInfo.find(&#123;name: /mongo/&#125;);</span><br><span class="line">//ç›¸å½“äº%%</span><br><span class="line">select * from userInfo where name like â€˜%mongo%â€™;</span><br></pre></td></tr></table></figure>

<p><strong>10. æŸ¥è¯¢ name ä¸­ä»¥ mongo å¼€å¤´çš„</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">db.userInfo.find(&#123;name: /^mongo/&#125;);</span><br></pre></td></tr></table></figure>

<blockquote>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">select * from userInfo where name like â€˜mongo%â€™;</span><br></pre></td></tr></table></figure>
</blockquote>
<p><strong>11. æŸ¥è¯¢æŒ‡å®šåˆ— nameã€age æ•°æ®</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">db.userInfo.find(&#123;&#125;, &#123;name: 1, age: 1&#125;);</span><br></pre></td></tr></table></figure>

<blockquote>
<p>ç›¸å½“äº:<code>select name, age from userInfo;</code></p>
</blockquote>
<blockquote>
<p>å½“ç„¶ <code>name</code> ä¹Ÿå¯ä»¥ç”¨ <code>true</code> æˆ– <code>false</code>,å½“ç”¨ <code>ture</code> çš„æƒ…å†µä¸‹æ²³ <code>name:1</code> æ•ˆæœä¸€æ ·ï¼Œå¦‚æœç”¨ <code>false</code> å°± æ˜¯æ’é™¤ <code>name</code>ï¼Œæ˜¾ç¤º <code>name</code> ä»¥å¤–çš„åˆ—ä¿¡æ¯</p>
</blockquote>
<p><strong>12. æŸ¥è¯¢æŒ‡å®šåˆ— nameã€age æ•°æ®, age &gt; 25</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">db.userInfo.find(&#123;age: &#123;$gt: 25&#125;&#125;, &#123;name: 1, age: 1&#125;);</span><br></pre></td></tr></table></figure>

<blockquote>
<p>ç›¸å½“äº:<code>select name, age from userInfo where age &gt;25;</code></p>
</blockquote>
<p><strong>13. æŒ‰ç…§å¹´é¾„æ’åº 1 å‡åº -1 é™åº</strong></p>
<ul>
<li>å‡åº:<code>db.userInfo.find().sort(&#123;age: 1&#125;);</code></li>
<li>é™åº:<code>db.userInfo.find().sort(&#123;age: -1&#125;);</code></li>
</ul>
<p><strong>14. æŸ¥è¯¢ name &#x3D; zhangsan, age &#x3D; 22 çš„æ•°æ®</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">db.userInfo.find(&#123;name: &#x27;zhangsan&#x27;, age: 22&#125;);</span><br></pre></td></tr></table></figure>

<blockquote>
<p>ç›¸å½“äº:<code>select * from userInfo where name = â€˜zhangsanâ€™ and age = â€˜22â€™;</code></p>
</blockquote>
<p><strong>15. æŸ¥è¯¢å‰ 5 æ¡æ•°æ®</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">db.userInfo.find().limit(5 );</span><br></pre></td></tr></table></figure>

<blockquote>
<p>ç›¸å½“äº:<code>selecttop 5 * from userInfo;</code></p>
</blockquote>
<p><strong>16. æŸ¥è¯¢ 10 æ¡ä»¥åçš„æ•°æ®</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">db.userInfo.find().skip(10);</span><br><span class="line">// ç›¸å½“äº:</span><br><span class="line">select * from userInfo where id not in ( </span><br><span class="line">    selecttop 10 * from userInfo</span><br><span class="line">);</span><br></pre></td></tr></table></figure>

<p><strong>17. æŸ¥è¯¢åœ¨ 5-10 ä¹‹é—´çš„æ•°æ®</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">db.userInfo.find().limit (10).skip(5);</span><br></pre></td></tr></table></figure>

<blockquote>
<p>å¯ç”¨äºåˆ†é¡µï¼Œ<code>limit</code> æ˜¯ <code>pageSize</code>ï¼Œ<code>skip</code> æ˜¯ç¬¬å‡ é¡µ<code>*pageSize</code></p>
</blockquote>
<p><strong>18. orä¸ æŸ¥è¯¢</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">db.userInfo.find(&#123;$or: [&#123;age: 22&#125;, &#123;age: 25&#125;]&#125;);</span><br></pre></td></tr></table></figure>

<blockquote>
<p>ç›¸å½“äº:<code>select * from userInfo where age = 22 or age = 25;</code></p>
</blockquote>
<p><strong>19. findOne æŸ¥è¯¢ç¬¬ä¸€æ¡æ•°æ®</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">db.userInfo.findOne( );</span><br></pre></td></tr></table></figure>

<blockquote>
<p>ç›¸å½“äº:<code>selecttop 1 * from userInfo;</code></p>
</blockquote>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">db.userInfo.find().limit(1 );</span><br></pre></td></tr></table></figure>

<p><strong>20. æŸ¥è¯¢æŸ ä¸ªç»“æœé›†çš„è®°å½•æ¡æ•° ç»Ÿè®¡æ•°é‡</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">db.userInfo.find(&#123;age: &#123;$gte: 25&#125;&#125;).count();</span><br></pre></td></tr></table></figure>

<blockquote>
<p>ç›¸å½“äº:<code>select count(*) from userInfo where age &gt;= 20;</code></p>
</blockquote>
<blockquote>
<p>å¦‚æœè¦è¿”å›é™åˆ¶ä¹‹åçš„è®°å½•æ•°é‡ï¼Œè¦ä½¿ç”¨ <code>count(true)</code>æˆ–è€… <code>count</code>(é <code>0</code>)</p>
</blockquote>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">db.users.find().skip(1 0).limit(5).count(true);</span><br></pre></td></tr></table></figure>

<h2 id="10-5-ä¿®æ”¹æ•°æ®"><a href="#10-5-ä¿®æ”¹æ•°æ®" class="headerlink" title="10.5 ä¿®æ”¹æ•°æ®"></a>10.5 ä¿®æ”¹æ•°æ®</h2><blockquote>
<p>ä¿®æ”¹é‡Œé¢è¿˜æœ‰æŸ¥è¯¢æ¡ä»¶ã€‚ä½ è¦è¯¥è°ï¼Œè¦å‘Šè¯‰ <code>mongo</code></p>
</blockquote>
<p><strong>æŸ¥æ‰¾åå­—å«åšå°æ˜çš„ï¼ŒæŠŠå¹´é¾„æ›´æ”¹ä¸º 16 å²</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">db.student.update(&#123;&quot;name&quot;:&quot;å°æ˜&quot;&#125;,&#123;$set:&#123;&quot;ag e&quot;:16&#125;&#125;);</span><br></pre></td></tr></table></figure>

<p><strong>æŸ¥æ‰¾æ•°å­¦æˆç»©æ˜¯ 70ï¼ŒæŠŠå¹´é¾„æ›´æ”¹ä¸º 33 å²:</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">db.student.update(&#123;&quot;sc ore.shuxue&quot;:70&#125;,&#123;$set:&#123;&quot;ag e&quot;:33&#125;&#125;);</span><br></pre></td></tr></table></figure>

<p><strong>æ›´æ”¹æ‰€æœ‰åŒ¹é…é¡¹ç›®</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">db.student.update(&#123;&quot;sex&quot;:&quot;ç”·&quot;&#125;,&#123;$set:&#123;&quot;age&quot;:33&#125;&#125;,&#123;multi: true&#125;);</span><br></pre></td></tr></table></figure>

<p><strong>å®Œæ•´æ›¿æ¢ï¼Œä¸å‡ºç°$set å…³é”®å­—äº†: æ³¨æ„</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">db.student.update(&#123;&quot;name&quot;:&quot;å°æ˜&quot;&#125;,&#123;&quot;name&quot;:&quot;å¤§æ˜&quot;,&quot;age&quot;:16&#125;);</span><br></pre></td></tr></table></figure>

<blockquote>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">db.users.update(&#123;name: &#x27;Lisi&#x27;&#125;, &#123;$inc: &#123;age: 50&#125;&#125;, false, true);` ç›¸å½“äº:`update users set age = age + 50 where name = â€˜Lisiâ€™;</span><br></pre></td></tr></table></figure>
</blockquote>
<blockquote>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">db.users.update(&#123;name: &#x27;Lisi&#x27;&#125;, &#123;$inc: &#123;age: 50&#125;, $set: &#123;name: &#x27;hoho&#x27;&#125;&#125;, false, true);` ç›¸å½“äº: `update users set age = age + 50, name = â€˜hohoâ€™ where name = â€˜Lisiâ€™;</span><br></pre></td></tr></table></figure>
</blockquote>
<h2 id="10-6-åˆ é™¤æ•°æ®"><a href="#10-6-åˆ é™¤æ•°æ®" class="headerlink" title="10.6 åˆ é™¤æ•°æ®"></a>10.6 åˆ é™¤æ•°æ®</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">db.collectionsNames.remove( &#123; &quot;borough&quot;: &quot;Manhattan&quot; &#125; )</span><br><span class="line"></span><br><span class="line">db.users.remove(&#123;age: 132&#125;);</span><br><span class="line"></span><br><span class="line">db.restaurants.remove( &#123; &quot;borough&quot;: &quot;Queens&quot; &#125;, &#123; justOne: true &#125; )</span><br></pre></td></tr></table></figure>

<h1 id="åä¸€ã€MongoDB-ç´¢å¼•-explain-åˆ†ææŸ¥è¯¢é€Ÿåº¦"><a href="#åä¸€ã€MongoDB-ç´¢å¼•-explain-åˆ†ææŸ¥è¯¢é€Ÿåº¦" class="headerlink" title="åä¸€ã€MongoDB ç´¢å¼• explain åˆ†ææŸ¥è¯¢é€Ÿåº¦"></a>åä¸€ã€MongoDB ç´¢å¼• explain åˆ†ææŸ¥è¯¢é€Ÿåº¦</h1><h2 id="11-1-ç´¢å¼•åŸºç¡€"><a href="#11-1-ç´¢å¼•åŸºç¡€" class="headerlink" title="11.1 ç´¢å¼•åŸºç¡€"></a>11.1 ç´¢å¼•åŸºç¡€</h2><blockquote>
<p>ç´¢å¼•æ˜¯å¯¹æ•°æ®åº“è¡¨ä¸­ä¸€åˆ—æˆ–å¤šåˆ—çš„å€¼è¿›è¡Œæ’åºçš„ä¸€ç§ç»“æ„ï¼Œå¯ä»¥è®©æˆ‘ä»¬æŸ¥è¯¢æ•°æ®åº“å˜å¾— æ›´å¿«ã€‚MongoDB çš„ç´¢å¼•å‡ ä¹ä¸ä¼ ç»Ÿçš„å…³ç³»å‹æ•°æ®åº“ä¸€æ¨¡ä¸€æ ·ï¼Œè¿™å…¶ä¸­ä¹ŸåŒ…æ‹¬ä¸€äº›åŸºæœ¬çš„æŸ¥ è¯¢ä¼˜åŒ–æŠ€å·§ã€‚</p>
</blockquote>
<p><strong>ä¸‹é¢æ˜¯åˆ›å»ºç´¢å¼•çš„ å‘½ä»¤</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">db.user.ensureIndex( &#123;&quot;username&quot;:1&#125;)</span><br></pre></td></tr></table></figure>

<p><strong>è·å–å½“å‰é›†åˆçš„ç´¢ å¼•</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">db.user.getIndexes()</span><br></pre></td></tr></table></figure>

<p><strong>åˆ é™¤ç´¢å¼•çš„å‘½ä»¤æ˜¯</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">db.user.dropIndex( &#123;&quot;username&quot;:1&#125;)</span><br></pre></td></tr></table></figure>

<ul>
<li>åœ¨ MongoDB ä¸­ï¼Œæˆ‘ä»¬åŒæ ·å¯ä»¥åˆ›å»ºå¤åˆç´¢å¼•ï¼Œå¦‚:</li>
<li>æ•°å­— <code>1</code> è¡¨ç¤º <code>username</code> é”®çš„ç´¢å¼•æŒ‰å‡åºå­˜å‚¨ï¼Œ<code>-1</code> è¡¨ç¤º <code>age</code> é”®çš„ç´¢å¼•æŒ‰ç…§é™åºæ–¹å¼å­˜å‚¨</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">db.user.ensureIndex(&#123;&quot;username&quot;:1, &quot;age&quot;:-1&#125;)</span><br></pre></td></tr></table></figure>

<blockquote>
<p>è¯¥ç´¢å¼•è¢«åˆ›å»ºåï¼ŒåŸºäº username å’Œ age çš„æŸ¥è¯¢å°†ä¼šç”¨åˆ°è¯¥ç´¢å¼•ï¼Œæˆ–è€…æ˜¯åŸºäº username çš„æŸ¥è¯¢ä¹Ÿä¼šç”¨åˆ°è¯¥ç´¢å¼•ï¼Œä½†æ˜¯åªæ˜¯åŸºäº age çš„æŸ¥è¯¢å°†ä¸ä¼šç”¨åˆ°è¯¥å¤åˆç´¢å¼•ã€‚å› æ­¤å¯ä»¥è¯´ï¼Œå¦‚æœæƒ³ç”¨åˆ°å¤åˆç´¢å¼•ï¼Œå¿…é¡»åœ¨æŸ¥è¯¢æ¡ä»¶ä¸­åŒ…å«å¤åˆç´¢å¼•ä¸­çš„å‰ Nä¸ªç´¢å¼•åˆ—ã€‚ç„¶è€Œå¦‚æœæŸ¥è¯¢æ¡ä»¶ä¸­çš„é”®å€¼é¡ºåºå’Œå¤åˆç´¢å¼•ä¸­çš„åˆ›å»ºé¡ºåºä¸ä¸€è‡´çš„è¯ï¼ŒMongoDB å¯ä»¥æ™ºèƒ½çš„å¸®åŠ©æˆ‘ä»¬è°ƒæ•´è¯¥é¡ºåºï¼Œä»¥ä¾¿ä½¿å¤åˆç´¢å¼•å¯ä»¥ä¸ºæŸ¥è¯¢æ‰€ç”¨ã€‚å¦‚:</p>
</blockquote>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">db.user.find(&#123;&quot;age&quot;: 30, &quot;username&quot;: &quot;stephen&quot;&#125;)</span><br></pre></td></tr></table></figure>

<blockquote>
<p>å¯¹äºä¸Šé¢ç¤ºä¾‹ä¸­çš„æŸ¥è¯¢æ¡ä»¶ï¼ŒMongoDB åœ¨æ£€ç´¢ä¹‹å‰å°†ä¼šåŠ¨æ€çš„è°ƒæ•´æŸ¥è¯¢æ¡ä»¶æ–‡æ¡£çš„é¡º åºï¼Œä»¥ä½¿è¯¥æŸ¥è¯¢å¯ä»¥ç”¨åˆ°åˆšåˆšåˆ›å»ºçš„å¤åˆç´¢å¼•ã€‚</p>
</blockquote>
<blockquote>
<p>å¯¹äºä¸Šé¢åˆ›å»ºçš„ç´¢å¼•ï¼ŒMongoDB éƒ½ä¼šæ ¹æ®ç´¢å¼•çš„ keyname å’Œç´¢å¼•æ–¹å‘ä¸ºæ–°åˆ›å»ºçš„ç´¢å¼•è‡ªåŠ¨åˆ†é…ä¸€ä¸ªç´¢å¼•åï¼Œä¸‹é¢çš„å‘½ä»¤å¯ä»¥åœ¨åˆ›å»ºç´¢å¼•æ—¶ä¸ºå…¶æŒ‡å®šç´¢å¼•åï¼Œå¦‚:</p>
</blockquote>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">db.user.ensureIndex( &#123;&quot;username&quot;:1&#125;,&#123;&quot;name&quot;:&quot;userindex&quot;&#125;)</span><br></pre></td></tr></table></figure>

<blockquote>
<p>éšç€é›†åˆçš„å¢é•¿ï¼Œéœ€è¦é’ˆå¯¹æŸ¥è¯¢ä¸­å¤§é‡çš„æ’åºåšç´¢å¼•ã€‚å¦‚æœæ²¡æœ‰å¯¹ç´¢å¼•çš„é”®è°ƒç”¨ <code>sort</code>ï¼Œ <code>MongoDB</code> éœ€è¦å°†æ‰€æœ‰æ•°æ®æå–åˆ°å†…å­˜å¹¶æ’åºã€‚å› æ­¤åœ¨åšæ— ç´¢å¼•æ’åºæ—¶ï¼Œå¦‚æœæ•°æ®é‡è¿‡å¤§ä»¥ è‡´æ— æ³•åœ¨å†…å­˜ä¸­è¿›è¡Œæ’åºï¼Œæ­¤æ—¶ <code>MongoDB</code> å°†ä¼šæŠ¥é”™</p>
</blockquote>
<h2 id="11-2-å”¯ä¸€ç´¢å¼•"><a href="#11-2-å”¯ä¸€ç´¢å¼•" class="headerlink" title="11.2 å”¯ä¸€ç´¢å¼•"></a>11.2 å”¯ä¸€ç´¢å¼•</h2><blockquote>
<p>åœ¨ç¼ºçœæƒ…å†µä¸‹åˆ›å»ºçš„ç´¢å¼•å‡ä¸æ˜¯å”¯ä¸€ç´¢å¼•ã€‚ä¸‹é¢çš„ç¤ºä¾‹å°†åˆ›å»ºå”¯ä¸€ç´¢å¼•ï¼Œå¦‚</p>
</blockquote>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">db.user.ensureIndex( &#123;&quot;useri d&quot;:1&#125;,&#123;&quot;uniq ue&quot;:true&#125;)</span><br></pre></td></tr></table></figure>

<blockquote>
<p>å¦‚æœå†æ¬¡æ’å…¥ userid é‡å¤çš„æ–‡æ¡£æ—¶ï¼ŒMongoDB å°†æŠ¥é”™ï¼Œä»¥æç¤ºæ’å…¥é‡å¤é”®ï¼Œå¦‚:</p>
</blockquote>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">db.user.insert(&#123;&quot;userid&quot;:5&#125;) </span><br><span class="line">db.user.insert(&#123;&quot;userid&quot;:5&#125;)</span><br><span class="line"></span><br><span class="line">// E11000 duplicate key error index: user.user.$userid_1 dup key: &#123; : 5.0 &#125;</span><br></pre></td></tr></table></figure>

<blockquote>
<p>å¦‚æœæ’å…¥çš„æ–‡æ¡£ä¸­ä¸åŒ…å« userid é”®ï¼Œé‚£ä¹ˆè¯¥æ–‡æ¡£ä¸­è¯¥é”®çš„å€¼ä¸º nullï¼Œå¦‚æœå¤šæ¬¡æ’å…¥ç±»ä¼¼ çš„æ–‡æ¡£ï¼ŒMongoDB å°†ä¼šæŠ¥å‡ºåŒæ ·çš„é”™è¯¯ï¼Œå¦‚:</p>
</blockquote>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">db.user.insert(&#123;&quot;userid1&quot;:5&#125;) </span><br><span class="line">db.user.insert(&#123;&quot;userid1&quot;:5&#125;)</span><br><span class="line"></span><br><span class="line">// E11000 duplicate key error index: user.user.$userid_1 dup key: &#123; : null &#125;</span><br></pre></td></tr></table></figure>

<blockquote>
<p>å¦‚æœåœ¨åˆ›å»ºå”¯ä¸€ç´¢å¼•æ—¶å·²ç»å­˜åœ¨äº†é‡å¤é¡¹ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡ä¸‹é¢çš„å‘½ä»¤å¸®åŠ©æˆ‘ä»¬åœ¨åˆ›å»ºå”¯ ä¸€ç´¢å¼•æ—¶æ¶ˆé™¤é‡å¤æ–‡æ¡£ï¼Œä»…ä¿ç•™å‘ç°çš„ç¬¬ä¸€ä¸ªæ–‡æ¡£ï¼Œå¦‚:</p>
</blockquote>
<p><strong>å…ˆåˆ é™¤åˆšåˆšåˆ›å»ºçš„å”¯ä¸€ç´¢å¼•</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">db.user.dropIndex( &#123;&quot; userid&quot; :1&#125; )</span><br></pre></td></tr></table></figure>

<p><strong>æ’å…¥æµ‹è¯•æ•°æ®ï¼Œä»¥ä¿è¯é›†åˆä¸­æœ‰é‡å¤é”®å­˜åœ¨ã€‚</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">db.user.remove() </span><br><span class="line">db.user.insert(&#123;&quot;userid&quot;:5&#125;)</span><br><span class="line">db.user.insert(&#123;&quot;userid&quot;:5&#125;)</span><br></pre></td></tr></table></figure>

<p><strong>é‡æ–°åˆ›å»ºå”¯ä¸€ç´¢å¼•</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">db.user.ensureIndex(&#123;&quot;userid&quot;:1&#125;,&#123;&quot;unique&quot;:true &#125;)</span><br></pre></td></tr></table></figure>

<p><strong>æˆ‘ä»¬åŒæ ·å¯ä»¥åˆ›å»º å¤åˆå”¯ä¸€ç´¢å¼•ï¼Œå³ä¿è¯å¤åˆé”®å€¼å”¯ä¸€ å³å¯ã€‚å¦‚:</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">db.user.ensureIndex( &#123;&quot;useri d&quot;:1,&quot;age&quot;:1&#125;,&#123;&quot;unique&quot;:true&#125;)</span><br></pre></td></tr></table></figure>

<h2 id="11-3-ç´¢å¼•çš„ä¸€äº›å‚æ•°"><a href="#11-3-ç´¢å¼•çš„ä¸€äº›å‚æ•°" class="headerlink" title="11.3 ç´¢å¼•çš„ä¸€äº›å‚æ•°"></a>11.3 ç´¢å¼•çš„ä¸€äº›å‚æ•°</h2><p><img src="https://upload-images.jianshu.io/upload_images/1480597-450216a694af3946.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="image.png"></p>
<blockquote>
<p>å¦‚æœåœ¨ä¸ºå·²æœ‰æ•°æ®çš„æ–‡æ¡£åˆ›å»ºç´¢å¼•æ—¶ï¼Œå¯ä»¥æ‰§è¡Œä¸‹é¢çš„å‘½ä»¤ï¼Œä»¥ä½¿ MongoDB åœ¨åå°åˆ› å»ºç´¢å¼•ï¼Œè¿™æ ·çš„åˆ›å»ºæ—¶å°±ä¸ä¼šé˜»å¡å…¶ä»–æ“ä½œã€‚ä½†æ˜¯ç›¸æ¯”è€Œè¨€ï¼Œä»¥é˜» å¡æ–¹å¼åˆ›å»ºç´¢å¼•ï¼Œä¼šä½¿æ•´ ä¸ªåˆ›å»ºè¿‡ç¨‹æ•ˆç‡æ›´é«˜ï¼Œä½†æ˜¯åœ¨åˆ›å»ºæ—¶ MongoDB å°†æ— æ³•æ¥æ”¶å…¶ä»–çš„æ“ä½œ</p>
</blockquote>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">db.user.ensureIndex( &#123;&quot;username&quot;:1&#125;,&#123;&quot;backgroun d&quot;:true&#125;)</span><br></pre></td></tr></table></figure>

<h2 id="11-4-ä½¿ç”¨-explain"><a href="#11-4-ä½¿ç”¨-explain" class="headerlink" title="11.4 ä½¿ç”¨ explain"></a>11.4 ä½¿ç”¨ explain</h2><blockquote>
<p>explain æ˜¯éå¸¸æœ‰ç”¨çš„å·¥å…·ï¼Œä¼šå¸®åŠ©ä½ è·å¾—æŸ¥è¯¢æ–¹é¢è¯¸å¤šæœ‰ç”¨çš„ä¿¡æ¯ã€‚åªè¦å¯¹æ¸¸æ ‡è°ƒç”¨ è¯¥æ–¹æ³•ï¼Œå°±å¯ä»¥å¾—åˆ°æŸ¥è¯¢ç»†èŠ‚ã€‚explain ä¼šè¿”å›ä¸€ä¸ªæ–‡æ¡£ï¼Œè€Œä¸æ˜¯æ¸¸æ ‡æœ¬èº«ã€‚å¦‚</p>
</blockquote>
<p><img src="https://poetries1.gitee.io/img-repo/2019/10/376.png" alt="img"></p>
<blockquote>
<p><code>explain</code> ä¼šè¿”å›æŸ¥è¯¢ä½¿ç”¨çš„ç´¢å¼•æƒ…å†µï¼Œè€—æ—¶å’Œæ‰«ææ–‡æ¡£æ•°çš„ç»Ÿè®¡ä¿¡æ¯</p>
</blockquote>
<h2 id="11-5-explain-executionStats-æŸ¥è¯¢å…·ä½“çš„æ‰§è¡Œ-æ—¶é—´"><a href="#11-5-explain-executionStats-æŸ¥è¯¢å…·ä½“çš„æ‰§è¡Œ-æ—¶é—´" class="headerlink" title="11.5 explain executionStats æŸ¥è¯¢å…·ä½“çš„æ‰§è¡Œ æ—¶é—´"></a>11.5 explain executionStats æŸ¥è¯¢å…·ä½“çš„æ‰§è¡Œ æ—¶é—´</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">db.tablename.find().explain( &quot;executionStats&quot; )</span><br></pre></td></tr></table></figure>

<blockquote>
<p>å…³æ³¨è¾“å‡ºçš„å¦‚ä¸‹æ•°å€¼:<code>explain.executionStats.executionTimeMillis</code></p>
</blockquote>
<h1 id="åäºŒã€nodejsæ“ä½œmongodb3-xæ•°æ®åº“çš„æ–¹æ³•"><a href="#åäºŒã€nodejsæ“ä½œmongodb3-xæ•°æ®åº“çš„æ–¹æ³•" class="headerlink" title="åäºŒã€nodejsæ“ä½œmongodb3.xæ•°æ®åº“çš„æ–¹æ³•"></a>åäºŒã€nodejsæ“ä½œmongodb3.xæ•°æ®åº“çš„æ–¹æ³•</h1><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br></pre></td><td class="code"><pre><span class="line">//http://mongodb.github.io/node-mongodb-native/3.0/quick-start/quick-start/</span><br><span class="line"></span><br><span class="line">/*</span><br><span class="line">nodejsæ“ä½œmongodbæ•°æ®åº“</span><br><span class="line"></span><br><span class="line"> 1.å®‰è£…mongodbã€</span><br><span class="line"></span><br><span class="line">    cnpm install mongodb --save</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"> 2.å¼•å…¥mongodbä¸‹é¢çš„MongoClient</span><br><span class="line">    var MongoClient = require(&#x27;mongodb&#x27;).MongoClient;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"> 3.å®šä¹‰æ•°æ®åº“è¿æ¥çš„åœ°å€ ä»¥åŠé…ç½®æ•°æ®åº“</span><br><span class="line">    qianfengæ•°æ®åº“çš„åç§°</span><br><span class="line"></span><br><span class="line">    var url = &#x27;mongodb://localhost:27017/&#x27;;</span><br><span class="line"></span><br><span class="line">    var dbName = &#x27;shop&#x27;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"> 4.nodejsè¿æ¥æ•°æ®åº“</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"> MongoClient.connect(url,function(err,client)&#123;</span><br><span class="line"></span><br><span class="line">        const db = client.db(dbName);  æ•°æ®åº“dbå¯¹è±¡</span><br><span class="line"></span><br><span class="line"> &#125;)</span><br><span class="line"></span><br><span class="line">5.æ“ä½œæ•°æ®åº“</span><br><span class="line">    </span><br><span class="line"></span><br><span class="line"></span><br><span class="line">	 MongoClient.connect(url,function(err,client)&#123;</span><br><span class="line"></span><br><span class="line">			const db = client.db(dbName);  æ•°æ®åº“dbå¯¹è±¡</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">			MongoClient.connect(url,function(err,db)&#123;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">				db.collection(&#x27;user&#x27;).insertOne(&#123;&quot;name&quot;:&quot;å¼ ä¸‰&quot;&#125;,function(err,result)&#123;</span><br><span class="line"></span><br><span class="line">					db.close() //å…³é—­è¿æ¥</span><br><span class="line">				&#125;)</span><br><span class="line"></span><br><span class="line">		     &#125;)</span><br><span class="line"></span><br><span class="line">	 &#125;)</span><br><span class="line">     </span><br><span class="line"></span><br><span class="line">*/</span><br><span class="line">var MongoClient = require(&#x27;mongodb&#x27;).MongoClient;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">//å®šä¹‰è¿æ¥æ•°æ®åº“çš„åœ°å€</span><br><span class="line"></span><br><span class="line">const  url = &#x27;mongodb://localhost:27017/&#x27;;</span><br><span class="line">var dbName = &#x27;shop&#x27;</span><br><span class="line"></span><br><span class="line">//è¿æ¥æ•°æ®åº“</span><br><span class="line">MongoClient.connect(url,(err,client)=&gt;&#123;</span><br><span class="line"></span><br><span class="line">    if(err)&#123;</span><br><span class="line">        console.log(&#x27;æ•°æ®è¿æ¥å¤±è´¥&#x27;);</span><br><span class="line">        return false;</span><br><span class="line">    &#125;</span><br><span class="line">    let db=client.db(dbName);   /*è·å–dbå¯¹è±¡*/</span><br><span class="line"></span><br><span class="line">    db.collection(&quot;admin&quot;).insertOne(&#123;&quot;name&quot;:&quot;mongodb3.0&quot;,&quot;age&quot;:10&#125;,function(err)&#123;</span><br><span class="line"></span><br><span class="line">        if(err)&#123;</span><br><span class="line">            console.log(&#x27;å¢åŠ å¤±è´¥&#x27;);</span><br><span class="line">            return false;</span><br><span class="line">        &#125;</span><br><span class="line">        console.log(&#x27;å¢åŠ æˆåŠŸ&#x27;);</span><br><span class="line">        client.close();  /*å…³é—­æ•°æ®åº“*/</span><br><span class="line">    &#125;)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>

<h1 id="åä¸‰ã€NodeJsæ“ä½œMongoDbæ•°æ®åº“-æ•°æ®çš„å¢åŠ -ä¿®æ”¹-åˆ é™¤"><a href="#åä¸‰ã€NodeJsæ“ä½œMongoDbæ•°æ®åº“-æ•°æ®çš„å¢åŠ -ä¿®æ”¹-åˆ é™¤" class="headerlink" title="åä¸‰ã€NodeJsæ“ä½œMongoDbæ•°æ®åº“ æ•°æ®çš„å¢åŠ  ä¿®æ”¹ åˆ é™¤"></a>åä¸‰ã€NodeJsæ“ä½œMongoDbæ•°æ®åº“ æ•°æ®çš„å¢åŠ  ä¿®æ”¹ åˆ é™¤</h1><h2 id="13-1-åœ¨-Nodejs-ä¸­ä½¿ç”¨-Mongodb"><a href="#13-1-åœ¨-Nodejs-ä¸­ä½¿ç”¨-Mongodb" class="headerlink" title="13.1 åœ¨ Nodejs ä¸­ä½¿ç”¨ Mongodb"></a>13.1 åœ¨ Nodejs ä¸­ä½¿ç”¨ Mongodb</h2><blockquote>
<p>å‰é¢çš„è¯¾ç¨‹æˆ‘ä»¬è®²äº†ç”¨å‘½ä»¤æ“ä½œ <code>MongoDB</code>ï¼Œè¿™é‡Œæˆ‘ä»¬çœ‹ä¸‹å¦‚ä½•ç”¨ <code>nodejs</code> æ¥æ“ä½œæ•°æ®åº“</p>
</blockquote>
<p><strong>éœ€è¦å¼•åŒ…</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm install mongodb --save-dev / cnpm install mongodb --save-dev</span><br></pre></td></tr></table></figure>

<h2 id="13-2-Nodejs-è¿æ¥-MongoDb-æ•°æ®åº“"><a href="#13-2-Nodejs-è¿æ¥-MongoDb-æ•°æ®åº“" class="headerlink" title="13.2 Nodejs è¿æ¥ MongoDb æ•°æ®åº“"></a>13.2 Nodejs è¿æ¥ MongoDb æ•°æ®åº“</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line">var express = require(&quot;express&quot;); //æ•°æ®åº“å¼•ç”¨</span><br><span class="line"></span><br><span class="line">var MongoClient = require(&#x27;mongodb&#x27;).MongoClient;</span><br><span class="line">var app = express();</span><br><span class="line">//æ•°æ®åº“è¿æ¥çš„åœ°å€ï¼Œæœ€åçš„æ–œæ è¡¨ç¤ºæ•°æ®åº“åå­—</span><br><span class="line">var shujukuURL = &#x27;mongodb://localhost:27017/news&#x27;;</span><br><span class="line">app.get(&quot;/&quot;, fu nction(req, res) &#123; //è¿æ¥æ•°æ®åº“ï¼Œè¿™æ˜¯ä¸€ä¸ªå¼‚æ­¥çš„æ“ä½œ</span><br><span class="line">    MongoClient.connect(shujukuURL,</span><br><span class="line">    function(err, db) &#123;</span><br><span class="line">        res.writeHe ad(200, &#123;</span><br><span class="line">            &quot;Content-Type&quot;: &quot; text/html;charset =UTF8&quot;</span><br><span class="line">        &#125;);</span><br><span class="line">        if (err) &#123;</span><br><span class="line">            res.send(&quot;æ•°æ®åº“è¿æ¥å¤± è´¥&quot;);</span><br><span class="line">            return;</span><br><span class="line">        &#125;</span><br><span class="line">        res.write(&quot;æ­å–œï¼Œæ•°æ®åº“å·²ç»æˆåŠŸè¿æ¥ \n&quot;);</span><br><span class="line">        db.collection(&quot;user&quot;).insertOne(&#123;</span><br><span class="line">            &quot;name&quot;: &quot;å“ˆå“ˆ&quot;</span><br><span class="line">        &#125;,</span><br><span class="line">        functio n(err, result) &#123;</span><br><span class="line">            if (err) &#123;</span><br><span class="line">                res.send(&quot;æ•°æ®åº“å†™å…¥ å¤±è´¥&quot;);</span><br><span class="line">                return;</span><br><span class="line">            &#125;</span><br><span class="line">            res.write(&quot;æ­å–œï¼Œæ•°æ® å·²ç»æˆåŠŸæ’å…¥&quot;);</span><br><span class="line">            res.end();</span><br><span class="line">            //å…³é—­æ•°æ®åº“</span><br><span class="line">            db.close();</span><br><span class="line">        &#125;);</span><br><span class="line">    &#125;);</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">app.listen(8020);</span><br></pre></td></tr></table></figure>

<h2 id="13-3-Nodejs-æŸ¥æ‰¾-MongoDb-æ•°æ®åº“é›†åˆ"><a href="#13-3-Nodejs-æŸ¥æ‰¾-MongoDb-æ•°æ®åº“é›†åˆ" class="headerlink" title="13.3 Nodejs æŸ¥æ‰¾ MongoDb æ•°æ®åº“é›†åˆ"></a>13.3 Nodejs æŸ¥æ‰¾ MongoDb æ•°æ®åº“é›†åˆ</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line">MongoClient.connect(dbUrl,</span><br><span class="line">function(err, db) &#123;</span><br><span class="line">    if (err) &#123;</span><br><span class="line">        /*æ•°æ®åº“è¿æ¥å¤±è´¥*/</span><br><span class="line">        console.log(&#x27;æ•°æ®åº“è¿æ¥å¤±è´¥&#x27;);</span><br><span class="line">        return;</span><br><span class="line">    &#125;</span><br><span class="line">    var result = [];</span><br><span class="line">    var userRel = db.collection(&#x27;user&#x27;).find();</span><br><span class="line">    //res.send(userRel);</span><br><span class="line">    userRel.each(function(err, doc) &#123;</span><br><span class="line">        if (err) &#123;</span><br><span class="line">            res.write(&quot;æ¸¸æ ‡éå†é”™ è¯¯&quot;);</span><br><span class="line">            return;</span><br><span class="line">        &#125;</span><br><span class="line">        if (doc != null) &#123;</span><br><span class="line">            result.push(doc);</span><br><span class="line">        &#125; else &#123;</span><br><span class="line">            console.log(result); //éå†å®Œæ¯•</span><br><span class="line">            db.close();</span><br><span class="line">            res.render(&quot;index&quot;, &#123;</span><br><span class="line">                &quot;result&quot;: result</span><br><span class="line">            &#125;);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;);</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>

<h2 id="13-4-Nodejs-ç»™-MongoDb-å¢åŠ æ•°æ®"><a href="#13-4-Nodejs-ç»™-MongoDb-å¢åŠ æ•°æ®" class="headerlink" title="13.4 Nodejs ç»™ MongoDb å¢åŠ æ•°æ®"></a>13.4 Nodejs ç»™ MongoDb å¢åŠ æ•°æ®</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">MongoClient.connect(dbUrl,</span><br><span class="line">function(err, db) &#123;</span><br><span class="line">    if (err) &#123;</span><br><span class="line">        return</span><br><span class="line">    &#125;</span><br><span class="line">    db.collection(&#x27;user&#x27;).insertOne(&#123;</span><br><span class="line">        &quot;name&quot;: name,</span><br><span class="line">        &quot;age&quot;: age,</span><br><span class="line">        &quot;score&quot;: &#123;</span><br><span class="line">            &quot;shuxue&quot;: shuxuechengji,</span><br><span class="line">            &quot;yuwen&quot;: yuwenchengji</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;,</span><br><span class="line">    function(err, result) &#123;</span><br><span class="line">        if (err) &#123;</span><br><span class="line">            console.log(&#x27;å†™å…¥æ•°æ®å¤±è´¥&#x27;);</span><br><span class="line">        &#125;</span><br><span class="line">        //å…³é—­æ•°æ®åº“</span><br><span class="line">        db.close();</span><br><span class="line">        //res.redirect(&#x27;/add&#x27;); res.redirect(&#x27;/&#x27; ); /*è·¯ç”±è·³è½¬*/ res.end(); ////res.location(&#x27;/add&#x27;)</span><br><span class="line">    &#125;)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>

<h2 id="13-5-Nodejs-ä¿®æ”¹-MongoDb-æ•°æ®"><a href="#13-5-Nodejs-ä¿®æ”¹-MongoDb-æ•°æ®" class="headerlink" title="13.5 Nodejs ä¿®æ”¹ MongoDb æ•°æ®"></a>13.5 Nodejs ä¿®æ”¹ MongoDb æ•°æ®</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">MongoClient.connect(dbUrl,</span><br><span class="line">function(err, db) &#123;</span><br><span class="line">    if (err) &#123;</span><br><span class="line">        console.log(&#x27;æ•°æ®åº“è¿æ¥é”™è¯¯&#x27;);</span><br><span class="line">        return;</span><br><span class="line">    &#125;</span><br><span class="line">    db.collection(&#x27;user&#x27;).updateOne(&#123;</span><br><span class="line">        &quot;_id&quot;: ObjectID(id)</span><br><span class="line">    &#125;,</span><br><span class="line">    &#123;</span><br><span class="line">        &quot;name&quot;: name,</span><br><span class="line">        &quot;age&quot;: age,</span><br><span class="line">        &quot;score&quot;: &#123;</span><br><span class="line">            &quot;shuxue&quot;: shuxue,</span><br><span class="line">            &quot;yuwen&quot;: yuwen</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;,</span><br><span class="line">    function(err, results) &#123;</span><br><span class="line">        console.log(results);</span><br><span class="line">        db.close();</span><br><span class="line">        res.redirect(&#x27;/&#x27;);</span><br><span class="line">        /*è·¯ç”±è·³è½¬*/</span><br><span class="line">        res.end(&#x27;end&#x27;);</span><br><span class="line">    &#125;)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>

<h2 id="13-6-Nodejs-åˆ é™¤-MongoDb-æ•°æ®"><a href="#13-6-Nodejs-åˆ é™¤-MongoDb-æ•°æ®" class="headerlink" title="13.6 Nodejs åˆ é™¤ MongoDb æ•°æ®"></a>13.6 Nodejs åˆ é™¤ MongoDb æ•°æ®</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">MongoClient.connect(dbUrl,</span><br><span class="line">function(err, db) &#123;</span><br><span class="line">    if (err) &#123;</span><br><span class="line">        throw new Error(&quot;æ•°æ®åº“è¿æ¥å¤±è´¥&quot;);</span><br><span class="line">        return;</span><br><span class="line">    &#125;</span><br><span class="line">    db.collection(&#x27;user&#x27;).deleteOne(&#123;</span><br><span class="line">        &quot;_id&quot;: ObjectID(id)</span><br><span class="line">    &#125;,</span><br><span class="line">    func tion(error, result) &#123;</span><br><span class="line">        if (error) &#123;</span><br><span class="line">            throw new Error(&#x27;åˆ é™¤æ•°æ®å¤±è´¥&#x27;);</span><br><span class="line">            return;</span><br><span class="line">        &#125;</span><br><span class="line">        db.close();</span><br><span class="line">        res.redirect(&#x27;/&#x27;);</span><br><span class="line">        /*è·¯ç”±è·³è½¬*/</span><br><span class="line">    &#125;)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>

<h1 id="åå››ã€Express-å®‰è£…å’Œä½¿ç”¨"><a href="#åå››ã€Express-å®‰è£…å’Œä½¿ç”¨" class="headerlink" title="åå››ã€Express å®‰è£…å’Œä½¿ç”¨"></a>åå››ã€Express å®‰è£…å’Œä½¿ç”¨</h1><h2 id="14-1-Express-ç®€å•ä»‹ç»"><a href="#14-1-Express-ç®€å•ä»‹ç»" class="headerlink" title="14.1 Express ç®€å•ä»‹ç»"></a>14.1 Express ç®€å•ä»‹ç»</h2><ul>
<li>Express æ˜¯ä¸€ä¸ªåŸºäº Node.js å¹³å°ï¼Œå¿«é€Ÿã€å¼€æ”¾ã€æç®€çš„ web å¼€å‘æ¡†æ¶</li>
<li>Express æ¡†æ¶æ˜¯åå°çš„ Node æ¡†æ¶ï¼Œæ‰€ä»¥å’Œ jQueryã€zeptoã€yuiã€bootstrap éƒ½ä¸ä¸€ä¸ªä¸œè¥¿ã€‚ Express åœ¨åå°çš„å—æ¬¢è¿çš„ç¨‹åº¦ç±»ä¼¼å‰ç«¯çš„ jQueryï¼Œå°±æ˜¯ä¼ä¸šçš„äº‹å®ä¸Šçš„æ ‡å‡†ã€‚</li>
</ul>
<p><strong>Express ç‰¹ç‚¹</strong></p>
<ul>
<li><code>Express</code> æ˜¯ä¸€ä¸ªåŸºäº <code>Node.js</code> å¹³å°çš„æç®€ã€çµæ´»çš„ web åº”ç”¨å¼€å‘æ¡†æ¶ï¼Œå®ƒæä¾›ä¸€<br>ç³»åˆ—å¼ºå¤§çš„ç‰¹æ€§ï¼Œå¸®åŠ©ä½ åˆ›å»ºå„ç§ <code>Web</code> å’Œç§»åŠ¨è®¾å¤‡åº”ç”¨</li>
<li>ä¸°å¯Œçš„ HTTP å¿«æ·æ–¹æ³•å’Œä»»æ„æ’åˆ—ç»„åˆçš„ <code>Connect</code> ä¸­é—´ä»¶ï¼Œè®©ä½ åˆ›å»ºå¥å£®ã€å‹å¥½çš„ API å˜å¾—æ—¢å¿«é€Ÿåˆç®€å•</li>
<li><code>Express</code> ä¸å¯¹ <code>Node.js</code> å·²æœ‰çš„ç‰¹æ€§è¿›è¡ŒäºŒæ¬¡æŠ½è±¡ï¼Œæˆ‘ä»¬åªæ˜¯åœ¨å®ƒä¹‹ä¸Šæ‰©å±•äº† Webåº”ç”¨æ‰€éœ€çš„åŸºæœ¬åŠŸèƒ½</li>
</ul>
<h2 id="14-2-Express-å®‰è£…ä½¿ç”¨"><a href="#14-2-Express-å®‰è£…ä½¿ç”¨" class="headerlink" title="14.2 Express å®‰è£…ä½¿ç”¨"></a>14.2 Express å®‰è£…ä½¿ç”¨</h2><p><strong>å®‰è£…:</strong></p>
<blockquote>
<p>å®‰è£… Express æ¡†æ¶ï¼Œå°±æ˜¯ä½¿ç”¨ npm çš„å‘½ä»¤</p>
</blockquote>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm install express --save</span><br></pre></td></tr></table></figure>

<blockquote>
<p><code>--save</code> å‚æ•°ï¼Œè¡¨ç¤ºè‡ªåŠ¨ä¿®æ”¹ <code>package.json</code> æ–‡ä»¶ï¼Œè‡ªåŠ¨æ·»åŠ ä¾èµ–é¡¹</p>
</blockquote>
<p><strong>ç®€å•ä½¿ç”¨</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">npm install expressâ€“save //1.å¼•å…¥</span><br><span class="line">var express = require(&#x27;express&#x27;);</span><br><span class="line">var app = express();</span><br><span class="line">//2.é…ç½®è·¯ç”±</span><br><span class="line">app.get(&#x27;/&#x27;,</span><br><span class="line">function(req, res) &#123;</span><br><span class="line">    res.send(&#x27;Hello World!&#x27;);</span><br><span class="line">&#125;); //3.ç›‘å¬ç«¯å£</span><br><span class="line"></span><br><span class="line">app.listen(3000,&#x27;127.0.0.1&#x27;);</span><br></pre></td></tr></table></figure>

<p><strong>å®Œæ•´ Demo</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line">var express = require(&#x27;express&#x27;);</span><br><span class="line">/*å¼•å…¥ express*/</span><br><span class="line">var app = newexpress();</span><br><span class="line">/*å®ä¾‹åŒ–express èµ‹å€¼ç»™app*/</span><br><span class="line">//é…ç½®è·¯ç”± åŒ¹é… URl åœ°å€å®ç°ä¸åŒçš„åŠŸèƒ½</span><br><span class="line">app.get(&#x27;/&#x27;,</span><br><span class="line">function(req, res) &#123;</span><br><span class="line">    res.send(&#x27;é¦–é¡µ&#x27;);</span><br><span class="line">&#125;) </span><br><span class="line"></span><br><span class="line">app.get(&#x27;/search&#x27;,</span><br><span class="line">function(req, res) &#123;</span><br><span class="line">    res.send(&#x27;æœç´¢&#x27;); //?keyword=åä¸ºæ‰‹æœº&amp;enc=utf-8&amp;suggest=1.his.0.0&amp;wq</span><br><span class="line">&#125;) </span><br><span class="line"></span><br><span class="line">app.get(&#x27;/login&#x27;,</span><br><span class="line">function(req, res) &#123;</span><br><span class="line">    res.send(&#x27;ç™»å½•&#x27;);</span><br><span class="line">&#125;) </span><br><span class="line"></span><br><span class="line">app.get(&#x27;/register&#x27;,</span><br><span class="line">function(req, res) &#123;</span><br><span class="line">    res.send(&#x27;æ³¨å†Œ&#x27;);</span><br><span class="line">&#125;) </span><br><span class="line"></span><br><span class="line">app.listen(3000, &quot;127.0.0.1&quot;);</span><br></pre></td></tr></table></figure>

<h2 id="14-3-Express-æ¡†æ¶ä¸­çš„è·¯ç”±"><a href="#14-3-Express-æ¡†æ¶ä¸­çš„è·¯ç”±" class="headerlink" title="14.3 Express æ¡†æ¶ä¸­çš„è·¯ç”±"></a>14.3 Express æ¡†æ¶ä¸­çš„è·¯ç”±</h2><blockquote>
<p>è·¯ç”±(Routing)æ˜¯ç”±ä¸€ä¸ª URI(æˆ–è€…å«è·¯å¾„)å’Œä¸€ä¸ªç‰¹å®šçš„ HTTP æ–¹æ³•(GETã€POST ç­‰) ç»„æˆçš„ï¼Œæ¶‰åŠåˆ°åº”ç”¨å¦‚ä½•å“åº”å®¢æˆ·ç«¯å¯¹æŸä¸ªç½‘ç«™èŠ‚ç‚¹çš„è®¿é—®</p>
</blockquote>
<p><strong>ç®€å•çš„è·¯ç”±é…ç½®</strong></p>
<blockquote>
<p>å½“ç”¨ get è¯·æ±‚è®¿é—®ä¸€ä¸ªç½‘å€çš„æ—¶å€™ï¼Œåšä»€ä¹ˆäº‹æƒ…</p>
</blockquote>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">app.get(&quot;ç½‘å€&quot;,function(req,res)&#123;</span><br><span class="line"></span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<blockquote>
<p>å½“ç”¨ post è®¿é—®ä¸€ä¸ªç½‘å€çš„æ—¶å€™ï¼Œåšä»€ä¹ˆäº‹æƒ…:</p>
</blockquote>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">app.post(&quot;ç½‘å€&quot;,function(req,res)&#123;</span><br><span class="line"></span><br><span class="line">&#125;);</span><br><span class="line">// user èŠ‚ç‚¹æ¥å— PUT è¯·æ±‚</span><br><span class="line"></span><br><span class="line">app.put(&#x27;/user&#x27;, function (req, res) &#123;</span><br><span class="line">    res.send(&#x27;Got a PUT request at /user&#x27;); </span><br><span class="line">&#125;);</span><br><span class="line">// user èŠ‚ç‚¹æ¥å— DELETE è¯·æ±‚</span><br><span class="line"></span><br><span class="line">app.delete(&#x27;/user&#x27;, function (req, res) &#123;</span><br><span class="line">    res.send(&#x27;Got a DELETE request at /user&#x27;); </span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<p><strong>åŠ¨æ€è·¯ç”±é…ç½®:</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">app.get( ,function(req,res)&#123; </span><br><span class="line">    var id = req.params[&quot;id&quot;];</span><br><span class="line">    res.send(id); </span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<p><strong>è·¯ç”±çš„æ­£åˆ™åŒ¹é…:(äº†è§£)</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">app.get(&#x27;/ab*cd&#x27;, function(req, res) &#123; </span><br><span class="line">    res.send(&#x27;ab*cd&#x27;);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<p><strong>è·¯ç”±é‡Œé¢è·å– Get ä¼ å€¼</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">// /news?id=2&amp;sex=nan</span><br><span class="line"></span><br><span class="line">app.get(&#x27;/news, function(req, res) &#123; </span><br><span class="line">    console.log(req.query);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<h2 id="14-4-Express-æ¡†æ¶ä¸­-ejs-çš„å®‰è£…ä½¿ç”¨"><a href="#14-4-Express-æ¡†æ¶ä¸­-ejs-çš„å®‰è£…ä½¿ç”¨" class="headerlink" title="14.4 Express æ¡†æ¶ä¸­ ejs çš„å®‰è£…ä½¿ç”¨"></a>14.4 Express æ¡†æ¶ä¸­ ejs çš„å®‰è£…ä½¿ç”¨</h2><p><strong>Express ä¸­ ejs çš„å®‰è£…:</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">npm install ejs --save </span><br><span class="line"></span><br><span class="line">// æˆ–è€…:</span><br><span class="line">npm install ejs --save-dev</span><br></pre></td></tr></table></figure>

<p><strong>Express ä¸­ ejs çš„ä½¿ç”¨</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">var express = require(&quot;express&quot;);</span><br><span class="line">var app = express();</span><br><span class="line">app.set(&quot;view engine&quot;, &quot;ejs&quot;);</span><br><span class="line"></span><br><span class="line">app.get(&quot;/&quot;,</span><br><span class="line">    function(req, res) &#123;&#125;);</span><br><span class="line">        res.render(&quot;news&quot;, &#123;</span><br><span class="line">            &quot;news&quot;: [&quot;æˆ‘æ˜¯å°æ–°é—»å•Š&quot;, &quot;æˆ‘ä¹Ÿæ˜¯å•Š&quot;, &quot;å“ˆå“ˆå“ˆå“ˆ&quot;]</span><br><span class="line">&#125;);</span><br><span class="line">app.listen(3000);</span><br></pre></td></tr></table></figure>

<p><strong>æŒ‡å®šæ¨¡æ¿ä½ç½® ï¼Œé»˜è®¤æ¨¡æ¿ä½ç½®åœ¨ views</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">app.set(&#x27;views&#x27;, __dirname + &#x27;/views&#x27;);</span><br></pre></td></tr></table></figure>

<p><strong>Ejs å¼•å…¥æ¨¡æ¿</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;%- include header.ejs %&gt;</span><br></pre></td></tr></table></figure>

<p><strong>Ejs ç»‘å®šæ•°æ®</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;%=h%&gt;</span><br></pre></td></tr></table></figure>

<p><strong>Ejs ç»‘å®š html æ•°æ®</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;%-h%&gt;</span><br></pre></td></tr></table></figure>

<p><strong>Ejs æ¨¡æ¿åˆ¤æ–­è¯­å¥</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">&lt;% if(true)&#123; %&gt; </span><br><span class="line">    &lt;div&gt;true&lt;/div&gt;</span><br><span class="line">    &lt;%&#125; </span><br><span class="line">  else&#123; %&gt; </span><br><span class="line">    &lt;div&gt;false&lt; /di v&gt;</span><br><span class="line">&lt;%&#125; %&gt;</span><br></pre></td></tr></table></figure>

<p><strong>Ejs æ¨¡æ¿ä¸­å¾ªç¯æ•°æ®</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&lt;%for(var i=0;i&lt;list.length;i++) &#123; %&gt;</span><br><span class="line">    &lt;li&gt;&lt;%=list[i] %&gt;&lt;/li&gt;</span><br><span class="line">&lt;%&#125;%&gt;</span><br></pre></td></tr></table></figure>

<p><strong>Ejs åç¼€ä¿®æ”¹ä¸º Html</strong></p>
<blockquote>
<p>è¿™æ˜¯ä¸€ä¸ªå°æŠ€å·§ï¼Œçœ‹ç€<code>.ejs</code> çš„åç¼€æ€»è§‰å¾—ä¸çˆ½ï¼Œä½¿ç”¨å¦‚ä¸‹æ–¹æ³•ï¼Œå¯ä»¥å°†æ¨¡æ¿æ–‡ä»¶çš„åç¼€æ¢æˆæˆ‘ä»¬ä¹ æƒ¯çš„<code>.html</code></p>
</blockquote>
<ol>
<li>åœ¨ <code>app.js</code> çš„å¤´ä¸Šå®šä¹‰ <code>ejs</code>:,ä»£ç å¦‚ä¸‹:</li>
</ol>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">var ejs = require(&#x27;ejs&#x27;);</span><br></pre></td></tr></table></figure>

<ol>
<li>æ³¨å†Œ html æ¨¡æ¿å¼•æ“ä»£ç å¦‚ä¸‹:</li>
</ol>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">app.engine(&#x27;html&#x27;,ejs.__express);</span><br></pre></td></tr></table></figure>

<ol>
<li>å°†æ¨¡æ¿å¼•æ“æ¢æˆ htmlä»£ç å¦‚ä¸‹:</li>
</ol>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">app.set(&#x27;view engine&#x27;, &#x27;html&#x27;);</span><br></pre></td></tr></table></figure>

<ol>
<li>ä¿®æ”¹æ¨¡æ¿æ–‡ä»¶çš„åç¼€ä¸º <code>.html</code></li>
</ol>
<h2 id="14-5-åˆ©ç”¨-Express-static-æ‰˜ç®¡é™æ€æ–‡ä»¶"><a href="#14-5-åˆ©ç”¨-Express-static-æ‰˜ç®¡é™æ€æ–‡ä»¶" class="headerlink" title="14.5 åˆ©ç”¨ Express.static æ‰˜ç®¡é™æ€æ–‡ä»¶"></a>14.5 åˆ©ç”¨ Express.static æ‰˜ç®¡é™æ€æ–‡ä»¶</h2><ol>
<li>å¦‚æœä½ çš„é™æ€èµ„æºå­˜æ”¾åœ¨å¤šä¸ªç›®å½•ä¸‹é¢ï¼Œä½ å¯ä»¥å¤šæ¬¡è°ƒç”¨ <code>express.static</code> ä¸­é—´ä»¶:</li>
</ol>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">app.use(express.static(&#x27;public&#x27;));</span><br></pre></td></tr></table></figure>

<blockquote>
<p>ç°åœ¨ï¼Œpublic ç›®å½•ä¸‹é¢çš„æ–‡ä»¶å°±å¯ä»¥è®¿é—®äº†</p>
</blockquote>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">http://localhost:3000/images/kitten.jpg</span><br><span class="line">http://localhost:3000/css/style.css </span><br><span class="line">http://localhost:3000/js/app.js</span><br><span class="line">http://localhost:3000/images/bg.png h</span><br><span class="line">ttp://localhost:3000/hello.html</span><br></pre></td></tr></table></figure>

<ol>
<li>å¦‚æœä½ å¸Œæœ›æ‰€æœ‰é€šè¿‡ <code>express.static</code> è®¿é—®çš„æ–‡ä»¶éƒ½å­˜æ”¾åœ¨ä¸€ä¸ªâ€œè™šæ‹Ÿ(virtual)â€ç›® å½•(å³ç›®å½•æ ¹æœ¬ä¸å­˜åœ¨)ä¸‹é¢ï¼Œå¯ä»¥é€šè¿‡ä¸ºé™æ€èµ„æºç›®å½•æŒ‡å®šä¸€ä¸ªæŒ‚è½½è·¯å¾„çš„æ–¹å¼æ¥å®ç°ï¼Œå¦‚ä¸‹æ‰€ç¤º</li>
</ol>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">app.use(&#x27;/static&#x27;, express.static(&#x27;public&#x27;));</span><br></pre></td></tr></table></figure>

<blockquote>
<p>ç°åœ¨ï¼Œä½ å°±çˆ±å¯ä»¥é€šè¿‡å¸¦æœ‰ â€œ&#x2F;staticâ€ å‰ç¼€çš„åœ°å€æ¥è®¿é—® public ç›®å½•ä¸‹ é¢çš„æ–‡ä»¶äº†</p>
</blockquote>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">http://localhost:3000/static/images/kitten.jpg</span><br><span class="line">http://localhost:3000/static/css/style.css http://localhost:3000/static/js/app.js http://localhost:3000/static/images/bg.png</span><br><span class="line">http://localhost:3000/static/hello.html</span><br></pre></td></tr></table></figure>

<h2 id="14-6-Express-ä¸­é—´ä»¶"><a href="#14-6-Express-ä¸­é—´ä»¶" class="headerlink" title="14.6 Express ä¸­é—´ä»¶"></a>14.6 Express ä¸­é—´ä»¶</h2><ul>
<li><code>Express</code> æ˜¯ä¸€ä¸ªè‡ªèº«åŠŸèƒ½æç®€ï¼Œå®Œå…¨æ˜¯ç”±è·¯ç”±å’Œä¸­é—´ä»¶æ„æˆä¸€ä¸ªçš„ web å¼€å‘æ¡†æ¶:ä»<br>æœ¬è´¨ä¸Šæ¥è¯´ï¼Œä¸€ä¸ª <code>Express</code> åº”ç”¨å°±æ˜¯åœ¨è°ƒç”¨å„ç§ä¸­é—´ä»¶</li>
<li>ä¸­é—´ä»¶(<code>Middleware</code>) æ˜¯ä¸€ä¸ªå‡½æ•°ï¼Œå®ƒå¯ä»¥è®¿é—®è¯·æ±‚å¯¹è±¡(request object (req)), å“ åº”å¯¹è±¡(response object (res)), å’Œ web åº”ç”¨ä¸­å¤„ç†è¯·æ±‚-å“åº”å¾ªç¯æµç¨‹ä¸­çš„ä¸­é—´ä»¶ï¼Œä¸€èˆ¬ è¢«å‘½åä¸º next çš„å˜é‡</li>
</ul>
<p><strong>ä¸­é—´ä»¶çš„åŠŸèƒ½åŒ…æ‹¬</strong></p>
<ul>
<li>æ‰§è¡Œä»»ä½•ä»£ç </li>
<li>ä¿®æ”¹è¯·æ±‚å’Œå“åº”å¯¹è±¡</li>
<li>ç»ˆç»“è¯·æ±‚-å“åº”å¾ªç¯</li>
<li>è°ƒç”¨å †æ ˆä¸­çš„ä¸‹ä¸€ä¸ªä¸­é—´ä»¶</li>
</ul>
<blockquote>
<p>å¦‚æœæˆ‘çš„ <code>get</code>ã€<code>post</code> å›è°ƒå‡½æ•°ä¸­ï¼Œæ²¡æœ‰ <code>next</code> å‚æ•°ï¼Œé‚£ä¹ˆå°±åŒ¹é…ä¸Šç¬¬ä¸€ä¸ªè·¯ç”±ï¼Œå°±ä¸ä¼šå¾€ä¸‹åŒ¹ é…äº†ã€‚å¦‚æœæƒ³å¾€ä¸‹åŒ¹é…çš„è¯ï¼Œé‚£ä¹ˆéœ€è¦å†™ <code>next()</code></p>
</blockquote>
<p><strong>Express åº”ç”¨å¯ä½¿ç”¨å¦‚ä¸‹å‡ ç§ä¸­é—´ä»¶</strong></p>
<ul>
<li>åº”ç”¨çº§ä¸­é—´ä»¶</li>
<li>è·¯ç”±çº§ä¸­é—´ä»¶</li>
<li>é”™è¯¯å¤„ç†ä¸­é—´ä»¶</li>
<li>å†…ç½®ä¸­é—´ä»¶</li>
<li>ç¬¬ä¸‰æ–¹ä¸­é—´ä»¶</li>
</ul>
<ol>
<li>åº”ç”¨çº§ä¸­é—´ä»¶</li>
</ol>
<p><img src="https://poetries1.gitee.io/img-repo/2019/10/377.png" alt="img"></p>
<ol>
<li>è·¯ç”±ä¸­é—´ä»¶</li>
</ol>
<p><img src="https://poetries1.gitee.io/img-repo/2019/10/378.png" alt="img"></p>
<ol>
<li>é”™è¯¯å¤„ç†ä¸­é—´ä»¶</li>
</ol>
<p><img src="https://poetries1.gitee.io/img-repo/2019/10/379.png" alt="img"></p>
<ol>
<li>å†…ç½®ä¸­é—´ä»¶</li>
</ol>
<p><img src="https://poetries1.gitee.io/img-repo/2019/10/380.png" alt="img"></p>
<ol>
<li>ç¬¬ä¸‰æ–¹ä¸­é—´ä»¶</li>
</ol>
<p><img src="https://poetries1.gitee.io/img-repo/2019/10/381.png" alt="img"><br><img src="https://poetries1.gitee.io/img-repo/2019/10/382.png" alt="img"></p>
<h2 id="14-7-è·å–-Get-Post-è¯·æ±‚çš„å‚æ•°"><a href="#14-7-è·å–-Get-Post-è¯·æ±‚çš„å‚æ•°" class="headerlink" title="14.7 è·å– Get Post è¯·æ±‚çš„å‚æ•°"></a>14.7 è·å– Get Post è¯·æ±‚çš„å‚æ•°</h2><ul>
<li><code>GET</code> è¯·æ±‚çš„å‚æ•°åœ¨ <code>URL</code> ä¸­ï¼Œåœ¨åŸç”Ÿ <code>Node</code> ä¸­ï¼Œéœ€è¦ä½¿ç”¨ <code>url</code> æ¨¡å—æ¥è¯†åˆ«å‚æ•°å­—ç¬¦ä¸²ã€‚åœ¨<code>Express</code> ä¸­ï¼Œä¸éœ€è¦ä½¿ç”¨ <code>url</code> æ¨¡å—äº†ã€‚å¯ä»¥ç›´æ¥ä½¿ç”¨ <code>req.query</code> å¯¹è±¡</li>
<li><code>POST</code> è¯·æ±‚åœ¨ <code>express</code> ä¸­ä¸èƒ½ç›´æ¥è·å¾—ï¼Œå¯ä»¥ä½¿ç”¨ <code>body-parser</code> æ¨¡å—ã€‚ä½¿ç”¨åï¼Œå°†å¯ä»¥ç”¨<code>req.body</code>å¾—åˆ°å‚æ•°ã€‚ä½†æ˜¯å¦‚æœè¡¨å•ä¸­å«æœ‰æ–‡ä»¶ä¸Šä¼ ï¼Œé‚£ä¹ˆè¿˜æ˜¯éœ€è¦ä½¿ç”¨ <code>formidable</code> æ¨¡å—</li>
</ul>
<p><strong>1. å®‰è£…</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm install body-parser</span><br></pre></td></tr></table></figure>

<p><strong>2. ä½¿ç”¨ req.body è·å– post è¿‡æ¥çš„å‚æ•°</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">var express = require(&#x27;express&#x27;) </span><br><span class="line">var bodyParser = require(&#x27;body-parser&#x27;) </span><br><span class="line">var app = express()</span><br><span class="line"></span><br><span class="line">// parse application/x-www-form-urlencoded</span><br><span class="line">app.use(bodyParser.urlencoded(&#123;</span><br><span class="line">    extended: false</span><br><span class="line">&#125;))</span><br><span class="line"></span><br><span class="line">// parse application/json</span><br><span class="line">app.use(bodyParser.json()) </span><br><span class="line"></span><br><span class="line">app.use(function(req, res) &#123;</span><br><span class="line">    res.setHeader(&#x27;Content-Type&#x27;, &#x27;text/plain&#x27;) res.write(&#x27;you posted:\n&#x27;) res.end(JSON.stringify(req.body, null, 2))</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>

<h1 id="åäº”ã€expressä¸­é—´ä»¶cookieçš„åŸºæœ¬ä½¿ç”¨"><a href="#åäº”ã€expressä¸­é—´ä»¶cookieçš„åŸºæœ¬ä½¿ç”¨" class="headerlink" title="åäº”ã€expressä¸­é—´ä»¶cookieçš„åŸºæœ¬ä½¿ç”¨"></a>åäº”ã€expressä¸­é—´ä»¶cookieçš„åŸºæœ¬ä½¿ç”¨</h1><h2 id="15-1-Cookie-ç®€ä»‹"><a href="#15-1-Cookie-ç®€ä»‹" class="headerlink" title="15.1 Cookie ç®€ä»‹"></a>15.1 Cookie ç®€ä»‹</h2><p><img src="https://poetries1.gitee.io/img-repo/2019/10/383.png" alt="img"></p>
<h2 id="15-2-Cookie-ç‰¹ç‚¹"><a href="#15-2-Cookie-ç‰¹ç‚¹" class="headerlink" title="15.2 Cookie ç‰¹ç‚¹"></a>15.2 Cookie ç‰¹ç‚¹</h2><ul>
<li><code>cookie</code> ä¿å­˜åœ¨æµè§ˆå™¨æœ¬åœ°</li>
<li>æ­£å¸¸è®¾ç½®çš„ <code>cookie</code> æ˜¯ä¸åŠ å¯†çš„ï¼Œç”¨æˆ·å¯ä»¥è‡ªç”±çœ‹åˆ°;</li>
<li>ç”¨æˆ·å¯ä»¥åˆ é™¤ <code>cookie</code>ï¼Œæˆ–è€…ç¦ç”¨å®ƒ</li>
<li><code>cookie</code> å¯ä»¥è¢«ç¯¡æ”¹</li>
<li><code>cookie</code> å¯ä»¥ç”¨äºæ”»å‡»</li>
<li><code>cookie</code> å­˜å‚¨é‡å¾ˆå°ã€‚æœªæ¥å®é™…ä¸Šè¦è¢« <code>localStorage</code> æ›¿ä»£ï¼Œä½†æ˜¯åè€… <code>IE9</code> å…¼å®¹</li>
</ul>
<h2 id="15-3-Cookie-çš„ä½¿ç”¨"><a href="#15-3-Cookie-çš„ä½¿ç”¨" class="headerlink" title="15.3 Cookie çš„ä½¿ç”¨"></a>15.3 Cookie çš„ä½¿ç”¨</h2><p><img src="https://poetries1.gitee.io/img-repo/2019/10/384.png" alt="img"><br><img src="https://poetries1.gitee.io/img-repo/2019/10/385.png" alt="img"><br><img src="https://poetries1.gitee.io/img-repo/2019/10/386.png" alt="img"></p>
<p><strong>è®¾ç½® cookie</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">res.cookie(&#x27;rememberme&#x27;, &#x27;1&#x27;, &#123; maxAge: 900000, httpOnly: true &#125;)</span><br><span class="line"></span><br><span class="line">res.cookie(&#x27;name&#x27;, &#x27;tobi&#x27;, &#123; domain: &#x27;.example.com&#x27;, path: &#x27;/admin&#x27;, secure: true &#125;);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">res.cookie(&#x27;rememberme&#x27;, &#x27;1&#x27;, &#123; expires: new Date(Date.now() + 900000), httpOnly: true &#125;);</span><br></pre></td></tr></table></figure>

<p><strong>è·å– cookie</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">req.cookies.name</span><br></pre></td></tr></table></figure>

<p><strong>åˆ é™¤ cookie</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">res.cookie(&#x27;rememberme&#x27;, &#x27;&#x27;, &#123; expires: new Date(0)&#125;);</span><br><span class="line"></span><br><span class="line">res.cookie(&#x27;username&#x27;,&#x27;zhangsan&#x27;,&#123;domain:&#x27;.ccc.com&#x27;,maxAge:0,httpOnly:true&#125;);</span><br></pre></td></tr></table></figure>

<h2 id="15-4-åŠ å¯†-Cookie"><a href="#15-4-åŠ å¯†-Cookie" class="headerlink" title="15.4 åŠ å¯† Cookie"></a>15.4 åŠ å¯† Cookie</h2><p><strong>1. é…ç½®ä¸­é—´ä»¶çš„æ—¶å€™éœ€è¦ä¼ å‚</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">var cookieParser = require(&#x27;cookie-parser&#x27;);</span><br><span class="line"></span><br><span class="line">app.use(cookieParser(&#x27;123456&#x27;));</span><br></pre></td></tr></table></figure>

<p><strong>2. è®¾ç½® cookie çš„æ—¶å€™é…ç½® signed å±æ€§</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">res.c ookie(&#x27;userinfo&#x27;,&#x27;hahaha&#x27;,&#123;domain:&#x27;.c cc.c om&#x27;,maxAge :900000,httpOnly :true,signed :true&#125;)</span><br></pre></td></tr></table></figure>

<p><strong>3. signedCookies è°ƒç”¨è®¾ç½®çš„ cookie</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">console.log(req.signedCookies);</span><br></pre></td></tr></table></figure>

<h1 id="åå…­ã€expressä¸­é—´ä»¶express-sessionå¸¸è§å‚æ•°é…ç½®ä½¿ç”¨"><a href="#åå…­ã€expressä¸­é—´ä»¶express-sessionå¸¸è§å‚æ•°é…ç½®ä½¿ç”¨" class="headerlink" title="åå…­ã€expressä¸­é—´ä»¶express-sessionå¸¸è§å‚æ•°é…ç½®ä½¿ç”¨"></a>åå…­ã€expressä¸­é—´ä»¶express-sessionå¸¸è§å‚æ•°é…ç½®ä½¿ç”¨</h1><h2 id="16-1-Session-ç®€å•ä»‹ç»"><a href="#16-1-Session-ç®€å•ä»‹ç»" class="headerlink" title="16.1 Session ç®€å•ä»‹ç»"></a>16.1 Session ç®€å•ä»‹ç»</h2><blockquote>
<p><code>session</code> æ˜¯å¦ä¸€ç§è®°å½•å®¢æˆ·çŠ¶æ€çš„æœºåˆ¶ï¼Œä¸åŒçš„æ˜¯ <code>Cookie</code>ä¿å­˜åœ¨å®¢æˆ·ç«¯æµè§ˆå™¨ä¸­ï¼Œè€Œ <code>session</code> ä¿å­˜åœ¨æœ<br>åŠ¡å™¨ä¸Š</p>
</blockquote>
<p><strong>Session çš„ç”¨é€”</strong></p>
<ul>
<li><code>session</code> è¿è¡Œåœ¨æœåŠ¡å™¨ç«¯ï¼Œå½“å®¢æˆ·ç«¯ç¬¬ä¸€æ¬¡è®¿é—®æœåŠ¡å™¨æ—¶ï¼Œå¯ä»¥å°†å®¢æˆ·çš„ç™»å½•ä¿¡æ¯ä¿å­˜</li>
<li>å½“å®¢æˆ·è®¿é—®å…¶ä»–é¡µé¢æ—¶ï¼Œå¯ä»¥åˆ¤æ–­å®¢æˆ·çš„ç™»å½•çŠ¶æ€ï¼Œåšå‡ºæç¤ºï¼Œç›¸å½“äºç™»å½•æ‹¦æˆª</li>
<li><code>session</code> å¯ä»¥å’Œ <code>Redis</code>æˆ–è€…æ•°æ®åº“ç­‰ç»“åˆåšæŒä¹…åŒ–æ“ä½œï¼Œå½“æœåŠ¡å™¨æŒ‚æ‰æ—¶ä¹Ÿä¸ä¼šå¯¼è‡´æŸäº›å®¢æˆ·ä¿¡æ¯(è´­ç‰©è½¦)<br>ä¸¢å¤±ã€‚</li>
</ul>
<h2 id="16-2-Session-çš„å·¥ä½œæµç¨‹"><a href="#16-2-Session-çš„å·¥ä½œæµç¨‹" class="headerlink" title="16.2 Session çš„å·¥ä½œæµç¨‹"></a>16.2 Session çš„å·¥ä½œæµç¨‹</h2><blockquote>
<p>å½“æµè§ˆå™¨è®¿é—®æœåŠ¡å™¨å¹¶å‘é€ç¬¬ä¸€æ¬¡è¯·æ±‚æ—¶ï¼ŒæœåŠ¡å™¨ç«¯ä¼šåˆ›å»ºä¸€ä¸ª session å¯¹è±¡ï¼Œç”Ÿæˆä¸€ä¸ªç±»ä¼¼äº key,value çš„é”®å€¼å¯¹ï¼Œç„¶åå°† key(cookie)è¿”å›åˆ°æµè§ˆå™¨(å®¢æˆ·)ç«¯ï¼Œæµè§ˆå™¨ä¸‹æ¬¡å†è®¿é—®æ—¶ï¼Œæºå¸¦ key(cookie)ï¼Œ æ‰¾åˆ°å¯¹åº”çš„ session(value)ã€‚ å®¢æˆ·çš„ä¿¡æ¯éƒ½ä¿å­˜åœ¨ session ä¸­</p>
</blockquote>
<h2 id="16-3-express-session-çš„ä½¿ç”¨"><a href="#16-3-express-session-çš„ä½¿ç”¨" class="headerlink" title="16.3 express-session çš„ä½¿ç”¨"></a>16.3 express-session çš„ä½¿ç”¨</h2><p><strong>1. å®‰è£… express-session</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cnpm install express-session --save</span><br></pre></td></tr></table></figure>

<p><strong>2. å¼•å…¥ express-session</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">var session = require(&quot;express-session&quot;);</span><br></pre></td></tr></table></figure>

<p><strong>3. è®¾ç½®å®˜æ–¹æ–‡æ¡£æä¾›çš„ä¸­é—´ä»¶</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">app.use(session(&#123;</span><br><span class="line">    secret: &#x27;keyboard cat&#x27;,</span><br><span class="line">    resave: true,</span><br><span class="line">    saveUninitialized: true</span><br><span class="line">&#125;))</span><br></pre></td></tr></table></figure>

<p><strong>4. ä½¿ç”¨</strong></p>
<ul>
<li>è®¾ç½®å€¼ <code>req.session.username = &quot;å¼ ä¸‰&quot;;</code></li>
<li>è·å–å€¼ <code>req.session.username</code></li>
</ul>
<h2 id="16-4-express-session-çš„å¸¸ç”¨å‚æ•°"><a href="#16-4-express-session-çš„å¸¸ç”¨å‚æ•°" class="headerlink" title="16.4 express-session çš„å¸¸ç”¨å‚æ•°"></a>16.4 express-session çš„å¸¸ç”¨å‚æ•°</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">app.use(session(&#123;</span><br><span class="line">    secret: &#x27;12345&#x27;,</span><br><span class="line">    name: &#x27;name&#x27;,</span><br><span class="line">    cookie: &#123;</span><br><span class="line">        maxAge: 60000</span><br><span class="line">    &#125;,</span><br><span class="line">    resave: false,</span><br><span class="line">    saveUninitialized: true</span><br><span class="line">&#125;));</span><br></pre></td></tr></table></figure>

<p><strong>è¡ŒåŠ å¯†çš„å­—ç¬¦ä¸².è¿™ä¸ª</strong></p>
<p><img src="https://poetries1.gitee.io/img-repo/2019/10/387.png" alt="img"><br><img src="https://poetries1.gitee.io/img-repo/2019/10/388.png" alt="img"></p>
<h2 id="16-5-express-session-çš„å¸¸ç”¨æ–¹æ³•"><a href="#16-5-express-session-çš„å¸¸ç”¨æ–¹æ³•" class="headerlink" title="16.5 express-session çš„å¸¸ç”¨æ–¹æ³•"></a>16.5 express-session çš„å¸¸ç”¨æ–¹æ³•</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">req.session.destroy(function(err) &#123;</span><br><span class="line">    /*é”€æ¯ session*/</span><br><span class="line">&#125;) </span><br><span class="line">req.session.username = &#x27;å¼ ä¸‰&#x27;; //è®¾ç½® session req.session.username //è·å– </span><br><span class="line"></span><br><span class="line">session req.session.cookie.maxAge=0; //é‡æ–°è®¾ç½® cookie çš„è¿‡æœŸæ—¶é—´</span><br></pre></td></tr></table></figure>

<h2 id="16-6-è´Ÿè½½å‡è¡¡é…ç½®-Sessionï¼ŒæŠŠ-Session-ä¿å­˜åˆ°æ•°æ®åº“-é‡Œé¢"><a href="#16-6-è´Ÿè½½å‡è¡¡é…ç½®-Sessionï¼ŒæŠŠ-Session-ä¿å­˜åˆ°æ•°æ®åº“-é‡Œé¢" class="headerlink" title="16.6 è´Ÿè½½å‡è¡¡é…ç½® Sessionï¼ŒæŠŠ Session ä¿å­˜åˆ°æ•°æ®åº“ é‡Œé¢"></a>16.6 è´Ÿè½½å‡è¡¡é…ç½® Sessionï¼ŒæŠŠ Session ä¿å­˜åˆ°æ•°æ®åº“ é‡Œé¢</h2><ol>
<li>éœ€è¦å®‰è£…<code>express-session</code> å’Œ <code>connect-mongo</code>æ¨¡å—</li>
<li>å¼•å…¥æ¨¡å—</li>
</ol>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">var session = require(&quot;express-session&quot;);</span><br><span class="line"></span><br><span class="line">const MongoStore = require(&#x27;connect-mongo&#x27;)(session);</span><br></pre></td></tr></table></figure>

<ol>
<li>é…ç½®ä¸­é—´ä»¶</li>
</ol>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">app.use(session(&#123;</span><br><span class="line">    secret: &#x27;keyboard cat&#x27;,</span><br><span class="line">    resave: false,</span><br><span class="line">    saveUninitialized: true,</span><br><span class="line">    rolling:true,</span><br><span class="line">    cookie:&#123;</span><br><span class="line">        maxAge:100000</span><br><span class="line">    &#125;,</span><br><span class="line">    store: new MongoStore(&#123;</span><br><span class="line">        url: &#x27;mongodb://127.0.0.1:27017/student&#x27;,</span><br><span class="line">        touchAfter: 24 * 3600 // time period in seconds</span><br><span class="line">    &#125;)</span><br><span class="line">&#125;))</span><br></pre></td></tr></table></figure>

<h2 id="16-7-Cookie-å’Œ-Session-åŒºåˆ«"><a href="#16-7-Cookie-å’Œ-Session-åŒºåˆ«" class="headerlink" title="16.7 Cookie å’Œ Session åŒºåˆ«"></a>16.7 Cookie å’Œ Session åŒºåˆ«</h2><ol>
<li><code>cookie</code> æ•°æ®å­˜æ”¾åœ¨å®¢æˆ·çš„æµè§ˆå™¨ä¸Šï¼Œ<code>session</code> æ•°æ®æ”¾åœ¨æœåŠ¡å™¨ä¸Š</li>
<li><code>cookie</code> ä¸æ˜¯å¾ˆå®‰å…¨ï¼Œåˆ«äººå¯ä»¥åˆ†æå­˜æ”¾åœ¨æœ¬åœ°çš„ <code>COOKIE</code> å¹¶è¿›è¡Œ <code>COOKIE</code> æ¬ºéª— è€ƒè™‘åˆ°å®‰å…¨åº”å½“ä½¿ç”¨ <code>session</code></li>
<li><code>session</code> ä¼šåœ¨ä¸€å®šæ—¶é—´å†…ä¿å­˜åœ¨æœåŠ¡å™¨ä¸Šã€‚å½“è®¿é—®å¢å¤šï¼Œä¼šæ¯”è¾ƒå ç”¨ä½ æœåŠ¡å™¨çš„æ€§èƒ½ è€ƒè™‘åˆ°å‡è½»æœåŠ¡å™¨æ€§èƒ½æ–¹é¢ï¼Œåº”å½“ä½¿ç”¨ <code>COOKIE</code></li>
<li>å•ä¸ª <code>cookie</code> ä¿å­˜çš„æ•°æ®ä¸èƒ½è¶…è¿‡ <code>4K</code>ï¼Œå¾ˆå¤šæµè§ˆå™¨éƒ½é™åˆ¶ä¸€ä¸ªç«™ç‚¹æœ€å¤šä¿å­˜ <code>20</code> ä¸ª <code>cookie</code></li>
</ol>

        
    </article>
    <footer class="cube-excerpt-footer">
        <a class="cube-excerpt-more" href="/2019/05/14/nodejs/node-%E5%9F%BA%E7%A1%80%E7%AF%87/">Read More</a>
    </footer>
</div>



<ul class="cube-pagination cube-pagination-9">
    
    <li class="cube-pagination-prev">
        <a href="/page/9/">Â« Prev</a>
    </li>
    
    
        
                <li class="cube-pagination-index">
                    <a href="/">1</a>
                </li>
                <li class="cube-pagination-ellipses">
                    <span>...</span>
                </li>
            
                
                <li class="cube-pagination-index">
                    <a href="/page/9">9</a>
                </li>
                
            
                
                <li class="cube-pagination-index disabled">
                    <span>10</span>
                </li>
                
            
                
                <li class="cube-pagination-index">
                    <a href="/page/11">11</a>
                </li>
                
            
                <li class="cube-pagination-ellipses">
                    <span>...</span>
                </li>
                <li class="cube-pagination-index">
                    <a href="/page/19">19</a>
                </li>
        
    

    
    <li class="cube-pagination-next">
        <a href="/page/11/">Next Â»</a>
    </li>
    
</ul>

<!--å…¶ä»–ç»„ä»¶åç»­æ·»åŠ -->
        </div>
        <div class="cube-right">
            

<div class="cube-search cube-sidebar" id="cube-search">
    <div class="search-container">
        <input type="text" placeholder="Search" class="cube-search-input" id="cube-search-input">
        <i class="cube-icon cube-icon-search cube-search-submit" aria-hidden="true"></i>
    </div>
    <!-- TODO é€šè¿‡ç»™windowèµ‹ä¸€ä¸ªå…¨å±€å˜é‡ï¼Œé€šè¿‡è„šæœ¬èµ‹å€¼ -->
</div>
<script>
    (function (window) {
        'use strict';
        window.searchModule = {}
        window.searchModule.JSONUrl = '/content.json'
        window.searchModule.rootUrl = '/'
    })(window)
</script>
<div class="cube-search-form">
    <div class="cube-search-control">
        <input type="text" placeholder="Search" class="search-input">
        <a class="close-button">
            <i class="cube-icon cube-close" aria-hidden="true"></i>
        </a>
    </div>
    <div class="cube-search-result"></div>
</div>


<div class="cube-author cube-sidebar" id="cube-author">
    
    
    <span>John Doe</span>
    
    
    <div class="count">
        <a class="count articles"><span>186</span>Article</a>
        <a class="count tags"><span>35</span>Tags</a>
        <a class="count categories"><span>23</span>Categories</a>
    </div>
</div>



<div class="cube-music cube-sidebar" id="cube-music">
    <div class="cube-player aplayer" id="cube-player"></div>
</div>
<script>
    (function (window) {
        window.musicModule = {}
        window.musicModule.musicConfig = '{"narrow":false,"autoplay":false,"showlrc":3,"theme":"#b7daff","mutex":true,"mode":"circulation","preload":"auto","listmaxheight":"513px","music":[{"title":"Dear friends","author":"TRIPLANE","url":"http://cube-1252774894.cosgz.myqcloud.com/music/source/TRIPLANE - Dear friends.mp3","lrc":"http://cube-1252774894.cosgz.myqcloud.com/music/lrc/Dear friends - TRIPLANE.lrc","pic":"http://cube-1252774894.cosgz.myqcloud.com/music/image/TRIPLANE - Dear friends.jpg"},{"title":"Butter-Fly","author":"å’Œç”°å…‰å¸","url":"http://cube-1252774894.cosgz.myqcloud.com/music/source/å’Œç”°å…‰å¸ - Butter-Fly (ãƒ”ã‚¢ãƒãƒ´ã‚¡ãƒ¼ã‚¸ãƒ§ãƒ³).mp3","lrc":"http://cube-1252774894.cosgz.myqcloud.com/music/lrc/Butter-Fly (ãƒ”ã‚¢ãƒãƒ´ã‚¡ãƒ¼ã‚¸ãƒ§ãƒ³) - å’Œç”°å…‰å¸.lrc","pic":"http://cube-1252774894.cosgz.myqcloud.com/music/image/å’Œç”°å…‰å¸ - Butter-Fly (ãƒ”ã‚¢ãƒãƒ´ã‚¡ãƒ¼ã‚¸ãƒ§ãƒ³).jpg"},{"title":"å®µé—‡èŠ±ç«","author":"è‘‰æœˆã‚†ã‚‰","url":"http://cube-1252774894.cosgz.myqcloud.com/music/source/è‘‰æœˆã‚†ã‚‰ - å®µé—‡èŠ±ç«.mp3","lrc":"http://cube-1252774894.cosgz.myqcloud.com/music/lrc/å®µé—‡èŠ±ç« - è‘‰æœˆã‚†ã‚‰.lrc","pic":"http://cube-1252774894.cosgz.myqcloud.com/music/image/è‘‰æœˆã‚†ã‚‰ - å®µé—‡èŠ±ç«.jpg"}]}'
        window.musicModule.lrcConfig = {
            open: 'Open Lyrics',
            close: 'Close Lyrics'
        }
    })(window)
</script>



<div class="cube-recent-posts cube-sidebar" id="cube-recent-posts">
    <div class="title">
        <a>Recent Posts</a>
    </div>
    <ul class="list">
        
        
        <li>
            <!-- TODO å¦‚æœæ–‡ç« è¦æ˜¾ç¤ºå›¾ç‰‡ï¼Œé‚£ä¹ˆåœ¨front-matterä¸Šæ·»åŠ previewå±æ€§(url or path) -->
            
            <div class="normal">
                <p class="index first">
                    <span>1</span>
                </p>
                <p class="title">
                    <a href="/2022/08/25/Js%E5%9F%BA%E6%9C%AC%E6%95%B0%E6%8D%AE%E7%B1%BB%E5%9E%8B/" title="å˜é‡ç±»å‹">å˜é‡ç±»å‹</a>
                </p>
            </div>
            
        </li>
        
        
        
        <li>
            <div class="normal">
                <p class="index">
                    <span>2</span>
                </p>
                <p class="title">
                    <a href="/2022/06/09/html+css+js+ts/3-js%E5%B8%B8%E7%94%A8%E4%BB%A3%E7%A0%81%E6%93%8D%E4%BD%9C%E5%AE%9E%E4%BE%8B/" title="js-å¸¸ç”¨ä»£ç æ“ä½œå®ä¾‹">js-å¸¸ç”¨ä»£ç æ“ä½œå®ä¾‹</a>
                </p>
            </div>
        </li>
        
        
        
        <li>
            <div class="normal">
                <p class="index">
                    <span>3</span>
                </p>
                <p class="title">
                    <a href="/2022/05/28/html+css+js+ts/1-%E9%9F%B3%E8%A7%86%E9%A2%91/" title="html-åŸç”ŸéŸ³è§†é¢‘">html-åŸç”ŸéŸ³è§†é¢‘</a>
                </p>
            </div>
        </li>
        
        
        
        <li>
            <div class="normal">
                <p class="index">
                    <span>4</span>
                </p>
                <p class="title">
                    <a href="/2022/04/25/http/DNS%E5%8D%8F%E8%AE%AE/" title="DNSåè®®">DNSåè®®</a>
                </p>
            </div>
        </li>
        
        
        
        <li>
            <div class="normal">
                <p class="index">
                    <span>5</span>
                </p>
                <p class="title">
                    <a href="/2022/04/17/html+css+js+ts/4-%E8%A3%85%E9%A5%B0%E5%99%A8/" title="ES6 è£…é¥°å™¨">ES6 è£…é¥°å™¨</a>
                </p>
            </div>
        </li>
        
        
    </ul>
</div>



<div class="cube-categories cube-sidebar" id="cube-categories">
    <div class="title">
        <a href="/categories">Categories</a>
    </div>
    <div class="cube-boxs">
        
        
        <div class="cube-box ">
            <a href="/categories/http/">#http</a>
        </div>
        
        
        <div class="cube-box ">
            <a href="/categories/%E6%A1%86%E6%9E%B6/">#æ¡†æ¶</a>
        </div>
        
        
        <div class="cube-box ">
            <a href="/categories/React/">#React</a>
        </div>
        
        
        <div class="cube-box ">
            <a href="/categories/%E6%95%B0%E6%8D%AE%E5%8F%AF%E8%A7%86%E5%8C%96/">#æ•°æ®å¯è§†åŒ–</a>
        </div>
        
        
        <div class="cube-box-bg ">
            <a href="/categories/%E6%9E%B6%E6%9E%84%E6%A8%A1%E5%BC%8F/">#æ¶æ„æ¨¡å¼</a>
        </div>
        
        
        <div class="cube-box-bg ">
            <a href="/categories/%E6%9E%B6%E6%9E%84%E6%A8%A1%E5%BC%8F/%E6%A1%86%E6%9E%B6/">#æ¡†æ¶</a>
        </div>
        
        
        <div class="cube-box-bg ">
            <a href="/categories/%E5%89%8D%E7%AB%AF/">#å‰ç«¯</a>
        </div>
        
        
        <div class="cube-box ">
            <a href="/categories/%E5%89%8D%E7%AB%AF/%E7%A7%BB%E5%8A%A8%E7%AB%AF/">#ç§»åŠ¨ç«¯</a>
        </div>
        
        
        <div class="cube-box ">
            <a href="/categories/%E5%89%8D%E7%AB%AF/%E9%9F%B3%E8%A7%86%E9%A2%91/">#éŸ³è§†é¢‘</a>
        </div>
        
        
        <div class="cube-box-bg ">
            <a href="/categories/javascript/">#javascript</a>
        </div>
        
        
        <div class="cube-box ">
            <a href="/categories/%E5%89%8D%E7%AB%AF/%E9%97%AE%E9%A2%98/">#é—®é¢˜</a>
        </div>
        
        
        <div class="cube-box ">
            <a href="/categories/%E5%90%8E%E7%AB%AF/">#åç«¯</a>
        </div>
        
        
        <div class="cube-box-bg ">
            <a href="/categories/%E5%B0%8F%E7%A8%8B%E5%BA%8F/">#å°ç¨‹åº</a>
        </div>
        
        
        <div class="cube-box ">
            <a href="/categories/%E5%90%8E%E7%AB%AF/%E6%A1%86%E6%9E%B6/">#æ¡†æ¶</a>
        </div>
        
        
        <div class="cube-box ">
            <a href="/categories/%E5%90%8E%E7%AB%AF/%E7%AE%97%E6%B3%95/">#ç®—æ³•</a>
        </div>
        
        
        <div class="cube-box ">
            <a href="/categories/%E5%89%8D%E7%AB%AF%E5%B7%A5%E7%A8%8B%E5%8C%96/">#å‰ç«¯å·¥ç¨‹åŒ–</a>
        </div>
        
        
        <div class="cube-box ">
            <a href="/categories/%E5%B7%A5%E5%85%B7/">#å·¥å…·</a>
        </div>
        
        
        <div class="cube-box ">
            <a href="/categories/%E6%AD%A3%E5%88%99%E8%A1%A8%E8%BE%BE%E5%BC%8F/">#æ­£åˆ™è¡¨è¾¾å¼</a>
        </div>
        
        
        <div class="cube-box ">
            <a href="/categories/%E5%89%8D%E7%AB%AF%E6%80%A7%E8%83%BD%E4%BC%98%E5%8C%96/">#å‰ç«¯æ€§èƒ½ä¼˜åŒ–</a>
        </div>
        
        
        <div class="cube-box ">
            <a href="/categories/%E6%95%B0%E6%8D%AE%E5%BA%93/">#æ•°æ®åº“</a>
        </div>
        
        
        <div class="cube-box ">
            <a href="/categories/%E7%AE%97%E6%B3%95/">#ç®—æ³•</a>
        </div>
        
        
        <div class="cube-box ">
            <a href="/categories/liunx/">#liunx</a>
        </div>
        
        
        <div class="cube-box ">
            <a href="/categories/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/">#è®¾è®¡æ¨¡å¼</a>
        </div>
        
    </div>
</div>



<div class="cube-tagcloud cube-sidebar" id="cube-tagcloud">
    <div class="title">
        <a href="/tags">Tagcloud</a>
    </div>
    <div class="cube-boxs">
        
        
        <div class="cube-box ">
            <a href="/tags/http/">#http</a>
        </div>
        
        
        <div class="cube-box-bg ">
            <a href="/tags/vue/">#vue</a>
        </div>
        
        
        <div class="cube-box ">
            <a href="/tags/React/">#React</a>
        </div>
        
        
        <div class="cube-box-bg ">
            <a href="/tags/Redux/">#Redux</a>
        </div>
        
        
        <div class="cube-box ">
            <a href="/tags/echart/">#echart</a>
        </div>
        
        
        <div class="cube-box ">
            <a href="/tags/vue3/">#vue3</a>
        </div>
        
        
        <div class="cube-box ">
            <a href="/tags/react/">#react</a>
        </div>
        
        
        <div class="cube-box ">
            <a href="/tags/html/">#html</a>
        </div>
        
        
        <div class="cube-box ">
            <a href="/tags/xml/">#xml</a>
        </div>
        
        
        <div class="cube-box ">
            <a href="/tags/%E7%A7%BB%E5%8A%A8%E7%AB%AF/">#ç§»åŠ¨ç«¯</a>
        </div>
        
        
        <div class="cube-box ">
            <a href="/tags/css/">#css</a>
        </div>
        
        
        <div class="cube-box ">
            <a href="/tags/javascript/">#javascript</a>
        </div>
        
        
        <div class="cube-box ">
            <a href="/tags/Promise/">#Promise</a>
        </div>
        
        
        <div class="cube-box-bg ">
            <a href="/tags/es6/">#es6</a>
        </div>
        
        
        <div class="cube-box ">
            <a href="/tags/typescript/">#typescript</a>
        </div>
        
        
        <div class="cube-box ">
            <a href="/tags/async-await/">#async/await</a>
        </div>
        
        
        <div class="cube-box ">
            <a href="/tags/nodejs/">#nodejs</a>
        </div>
        
        
        <div class="cube-box-bg ">
            <a href="/tags/%E5%B0%8F%E7%A8%8B%E5%BA%8F/">#å°ç¨‹åº</a>
        </div>
        
        
        <div class="cube-box ">
            <a href="/tags/python/">#python</a>
        </div>
        
        
        <div class="cube-box ">
            <a href="/tags/glup/">#glup</a>
        </div>
        
        
        <div class="cube-box ">
            <a href="/tags/webpack/">#webpack</a>
        </div>
        
        
        <div class="cube-box ">
            <a href="/tags/%E5%89%8D%E7%AB%AF/">#å‰ç«¯</a>
        </div>
        
        
        <div class="cube-box ">
            <a href="/tags/git/">#git</a>
        </div>
        
        
        <div class="cube-box ">
            <a href="/tags/Mock/">#Mock</a>
        </div>
        
        
        <div class="cube-box-bg ">
            <a href="/tags/eslint/">#eslint</a>
        </div>
        
        
        <div class="cube-box ">
            <a href="/tags/RESTful/">#RESTful</a>
        </div>
        
        
        <div class="cube-box-bg ">
            <a href="/tags/hexo/">#hexo</a>
        </div>
        
        
        <div class="cube-box ">
            <a href="/tags/vs-code/">#vs code</a>
        </div>
        
        
        <div class="cube-box ">
            <a href="/tags/%E6%AD%A3%E5%88%99%E8%A1%A8%E8%BE%BE%E5%BC%8F/">#æ­£åˆ™è¡¨è¾¾å¼</a>
        </div>
        
        
        <div class="cube-box-bg ">
            <a href="/tags/%E4%BC%98%E5%8C%96/">#ä¼˜åŒ–</a>
        </div>
        
        
        <div class="cube-box ">
            <a href="/tags/mongodb/">#mongodb</a>
        </div>
        
        
        <div class="cube-box-bg ">
            <a href="/tags/mysql/">#mysql</a>
        </div>
        
        
        <div class="cube-box ">
            <a href="/tags/%E7%AE%97%E6%B3%95/">#ç®—æ³•</a>
        </div>
        
        
        <div class="cube-box ">
            <a href="/tags/nginx/">#nginx</a>
        </div>
        
        
        <div class="cube-box ">
            <a href="/tags/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/">#è®¾è®¡æ¨¡å¼</a>
        </div>
        
    </div>
</div>



<div class="cube-links cube-sidebar" id="cube-links">
    <div class="title">
        <a>Links</a>
    </div>
    <ul class="list">
        
        <li>
            
            
            <img src="http://cube-1252774894.cosgz.myqcloud.com/links/GitHub.png">
            
            <a href="https://github.com/ZEROKISEKI" target="_blank">GitHub</a>
        </li>
        
        <li>
            
            
            <img src="http://cube-1252774894.cosgz.myqcloud.com/links/Coding.png">
            
            <a href="https://coding.net/u/SORA1" target="_blank">Coding</a>
        </li>
        
        <li>
            
            
            <img src="http://cube-1252774894.cosgz.myqcloud.com/links/SF.png">
            
            <a href="https://segmentfault.com/u/aonosora" target="_blank">SFç¤¾åŒº</a>
        </li>
        
        <li>
            
            
            <img src="http://cube-1252774894.cosgz.myqcloud.com/links/å¼€å‘è€…å¤´æ¡.png">
            
            <a href="https://toutiao.io/u/148070" target="_blank">å¼€å‘è€…å¤´æ¡</a>
        </li>
        
    </ul>
</div>



<div class="cube-friend-links cube-sidebar" id="cube-friend-links">
    <div class="title">
        <a>Friend Links</a>
    </div>
    <ul class="list">
        
        <li>
            <!-- TODO change avatar.png to friend.png-->
            <img src="http://cube-1252774894.cosgz.myqcloud.com/friend_links/micblo.png">
            <a href="https://blog.micblo.com/" target="_blank">ç½—å¤§ä½¬</a>
        </li>
        
        <li>
            <!-- TODO change avatar.png to friend.png-->
            <img src="http://cube-1252774894.cosgz.myqcloud.com/friend_links/DIYgod.jpg">
            <a href="https://www.anotherhome.net/" target="_blank">DIYgod</a>
        </li>
        
        <li>
            <!-- TODO change avatar.png to friend.png-->
            <img src="/images/friend_links.jpg ">
            <a href="https://aonosora.com/" target="_blank">å’ªè¥¿è¥¿ã®éƒ¨è½æ ¼</a>
        </li>
        
    </ul>
</div>


        </div>
    </div>
</div>
<footer class="cube-footer">
    
Â© 2017 John Doe

<br>
Powered by <a href="https://hexo.io/" target="_blank">Hexo</a>.&nbsp;Theme by <a href="https://github.com/ZEROKISEKI" target="_blank">AONOSORA</a>
</footer>
<!-- inject:script -->
<script src="/js/script.js"></script>
<!-- endinject -->
<div class="cube-loading out"></div>
</body>
</html>
<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
    <meta name="author" content="John Doe">
    
    
    
    
    
    
    <title>Hexo</title>
    <!-- inject:style -->
    <link href="/css/style.css" rel="stylesheet" type="text/css">
    <!-- endinject -->
    <style>
        .cube-loading {
            top: 0;
            position: fixed;
            width: 100%;
            height: 100%;
            background: url('/images/lg/loading.gif') no-repeat center center;
            background-color: rgba(0,0,0,.7);
        }

        .cube-loading.out {
            display: none;
        }

        .cube-loading:before {
            display: block;
            content: 'Loading';
            position: relative;
            width: 100%;
            top: 50%;
            right: -50%;
            color: #fff;
        }

        @media(max-width: 768px) {
            .cube-loading:before {
                font-size: 1.2em;
                transform: translate(-24px,20px);
                -webkit-transform: translate(-24px,20px);
                -o-transform: translate(-24px,20px);
                -ms-transform: translate(-24px,20px);
            }
        }

        @media(min-width: 768px) {
            .cube-loading:before {

            }
        }
    </style>
    
<meta name="generator" content="Hexo 6.2.0"></head>
<body>
<div class="cube-body">
    <nav id="cube-top-memu" class="cube-menu">
    <ul class="cube-menu-collapse">
        
        <li>
            <i class="cube-icon cube-icon-home" aria-hidden="true"></i>
            <a href="/">é¦–é¡µ</a>
        </li>
        
        <li>
            <i class="cube-icon cube-icon-archive" aria-hidden="true"></i>
            <a href="/archives">å½’æ¡£</a>
        </li>
        
        <li>
            <i class="cube-icon cube-icon-categories" aria-hidden="true"></i>
            <a href="/categories">åˆ†ç±»</a>
        </li>
        
        <li>
            <i class="cube-icon cube-icon-tags" aria-hidden="true"></i>
            <a href="/tags">æ ‡ç­¾</a>
        </li>
        
        <li>
            <i class="cube-icon cube-icon-about" aria-hidden="true"></i>
            <a href="/about-me">å…³äºæˆ‘</a>
        </li>
        
    </ul>
</nav>
<nav class="cube-side-menu" id="cube-side-menu">
    <ul class="cube-menu-list">
        
        <li>
            <a class="lrc-control">Open Lyrics</a>
        </li>
        
        <li>
            <a class="scroll-to-top">Top</a>
        </li>
    </ul>
</nav>
    <header class="cube-header" id="cube-header">
    <img src=" https://gimg2.baidu.com/image_search/src=http%3A%2F%2Fb-ssl.duitang.com%2Fuploads%2Fitem%2F201502%2F28%2F20150228220759_zaP3N.png&amp;refer=http%3A%2F%2Fb-ssl.duitang.com&amp;app=2002&amp;size=f9999,10000&amp;q=a80&amp;n=0&amp;g=0n&amp;fmt=auto?sec=1664943562&amp;t=f546331d7d5aee27ceb7af09c60899f2 " alt="å¤´éƒ¨èƒŒæ™¯å›¾ç‰‡">
    
    <div class="cube-type">
        <span class="cube-typed-title">ğŸçš„ä¸ªäººåšå®¢ ^_^</span>
        <span class="cube-typed-cursor">|</span>
    </div>
    
</header>

    <style>
        nav.cube-menu:before {
            content: '';
            visibility: hidden;
            position: absolute;
            left: 0;
            top: 0;
            width: 100%;
            height: 44px;
        
            filter: blur(5px);
            -webkit-filter: blur(5px);
        
            z-index: -1;
            background-image: url('https://gimg2.baidu.com/image_search/src=http%3A%2F%2Fb-ssl.duitang.com%2Fuploads%2Fitem%2F201502%2F28%2F20150228220759_zaP3N.png&amp;refer=http%3A%2F%2Fb-ssl.duitang.com&amp;app=2002&amp;size=f9999,10000&amp;q=a80&amp;n=0&amp;g=0n&amp;fmt=auto?sec=1664943562&amp;t=f546331d7d5aee27ceb7af09c60899f2');
            background-repeat: no-repeat;
            background-position: center -356px;
            background-size: cover;
            background-color: transparent;
        }

        header.cube-background.cube-header-background {
            visibility: hidden;
            background-image: url('https://gimg2.baidu.com/image_search/src=http%3A%2F%2Fb-ssl.duitang.com%2Fuploads%2Fitem%2F201502%2F28%2F20150228220759_zaP3N.png&amp;refer=http%3A%2F%2Fb-ssl.duitang.com&amp;app=2002&amp;size=f9999,10000&amp;q=a80&amp;n=0&amp;g=0n&amp;fmt=auto?sec=1664943562&amp;t=f546331d7d5aee27ceb7af09c60899f2');
            background-position: center -400px;
        }
    </style>
    <header class="cube-background cube-header-background">
        
        <div class="cube-type">
            <span class="cube-typed-title">ğŸçš„ä¸ªäººåšå®¢ ^_^</span>
            <span class="cube-typed-cursor">|</span>
        </div>
        
    </header>
    <div class="load-header-background"></div>
    <script>
        (function (window) {

            window.headerModule = {}
            window.headerModule.image = {
                width: '2000',
                height: '1414'
            }

        })(window)
    </script>
    
    <div class="cube-content">
        <div class="cube-left">
            
<div class="cube-excerpt" id="cube-excerpt-React-äº‹ä»¶ç»‘å®šæ–¹å¼">
    <header class="cube-excerpt-header">
        <h1><a href="/2020/04/13/React/React-%E4%BA%8B%E4%BB%B6%E7%BB%91%E5%AE%9A%E6%96%B9%E5%BC%8F/">React-äº‹ä»¶ç»‘å®šæ–¹å¼</a></h1>
        <div class="cube-excerpt-header-msg">
            <div class="cube-excerpt-date">
                <i class="cube-icon cube-icon-date" aria-hidden="true"></i>
                2020-04-13
            </div>
            <div class="cube-excerpt-tags">
                <i class="cube-icon cube-icon-tag" aria-hidden="true"></i>
                
                <a href="/tags/React/" class="cube-excerpt-tag-link">#React</a>
                
            </div>
        </div>
    </header>
    <article class="cube-excerpt-entry cube-markdown">
        
        
           <h2 id="ä¸€ã€æ˜¯ä»€ä¹ˆ"><a href="#ä¸€ã€æ˜¯ä»€ä¹ˆ" class="headerlink" title="ä¸€ã€æ˜¯ä»€ä¹ˆ"></a>ä¸€ã€æ˜¯ä»€ä¹ˆ</h2><p>åœ¨<code>react</code>åº”ç”¨ä¸­ï¼Œäº‹ä»¶åéƒ½æ˜¯ç”¨å°é©¼å³°æ ¼å¼è¿›è¡Œä¹¦å†™ï¼Œä¾‹å¦‚<code>onclick</code>è¦æ”¹å†™æˆ<code>onClick</code></p>
<p>æœ€ç®€å•çš„äº‹ä»¶ç»‘å®šå¦‚ä¸‹ï¼š</p>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">ShowAlert</span> <span class="keyword">extends</span> <span class="title class_ inherited__">React.Component</span> &#123;</span><br><span class="line">  <span class="title function_">showAlert</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;Hi&quot;</span>);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="title function_">render</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="language-xml"><span class="tag">&lt;<span class="name">button</span> <span class="attr">onClick</span>=<span class="string">&#123;this.showAlert&#125;</span>&gt;</span>show<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span>;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>ä»ä¸Šé¢å¯ä»¥çœ‹åˆ°ï¼Œäº‹ä»¶ç»‘å®šçš„æ–¹æ³•éœ€è¦ä½¿ç”¨<code>&#123;&#125;</code>åŒ…ä½</p>
<p>ä¸Šè¿°çš„ä»£ç çœ‹ä¼¼æ²¡æœ‰é—®é¢˜ï¼Œä½†æ˜¯å½“å°†å¤„ç†å‡½æ•°è¾“å‡ºä»£ç æ¢æˆ<code>console.log(this)</code>çš„æ—¶å€™ï¼Œç‚¹å‡»æŒ‰é’®ï¼Œåˆ™ä¼šå‘ç°æ§åˆ¶å°è¾“å‡º<code>undefined</code></p>
<h2 id="äºŒã€å¦‚ä½•ç»‘å®š"><a href="#äºŒã€å¦‚ä½•ç»‘å®š" class="headerlink" title="äºŒã€å¦‚ä½•ç»‘å®š"></a>äºŒã€å¦‚ä½•ç»‘å®š</h2><p>ä¸ºäº†è§£å†³ä¸Šé¢æ­£ç¡®è¾“å‡º<code>this</code>çš„é—®é¢˜ï¼Œå¸¸è§çš„ç»‘å®šæ–¹å¼æœ‰å¦‚ä¸‹ï¼š</p>
<ul>
<li>renderæ–¹æ³•ä¸­ä½¿ç”¨bind</li>
<li>renderæ–¹æ³•ä¸­ä½¿ç”¨ç®­å¤´å‡½æ•°</li>
<li>constructorä¸­bind</li>
<li>å®šä¹‰é˜¶æ®µä½¿ç”¨ç®­å¤´å‡½æ•°ç»‘å®š</li>
</ul>
<h3 id="renderæ–¹æ³•ä¸­ä½¿ç”¨bind"><a href="#renderæ–¹æ³•ä¸­ä½¿ç”¨bind" class="headerlink" title="renderæ–¹æ³•ä¸­ä½¿ç”¨bind"></a>renderæ–¹æ³•ä¸­ä½¿ç”¨bind</h3><p>å¦‚æœä½¿ç”¨ä¸€ä¸ªç±»ç»„ä»¶ï¼Œåœ¨å…¶ä¸­ç»™æŸä¸ªç»„ä»¶&#x2F;å…ƒç´ ä¸€ä¸ª<code>onClick</code>å±æ€§ï¼Œå®ƒç°åœ¨å¹¶ä¼šè‡ªå®šç»‘å®šå…¶<code>this</code>åˆ°å½“å‰ç»„ä»¶ï¼Œè§£å†³è¿™ä¸ªé—®é¢˜çš„æ–¹æ³•æ˜¯åœ¨äº‹ä»¶å‡½æ•°åä½¿ç”¨<code>.bind(this)</code>å°†<code>this</code>ç»‘å®šåˆ°å½“å‰ç»„ä»¶ä¸­</p>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">App</span> <span class="keyword">extends</span> <span class="title class_ inherited__">React.Component</span> &#123;</span><br><span class="line">  <span class="title function_">handleClick</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;this &gt; &#x27;</span>, <span class="variable language_">this</span>);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="title function_">render</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> (</span><br><span class="line">      <span class="language-xml"><span class="tag">&lt;<span class="name">div</span> <span class="attr">onClick</span>=<span class="string">&#123;this.handleClick.bind(this)&#125;</span>&gt;</span>test<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line">    )</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>è¿™ç§æ–¹å¼åœ¨ç»„ä»¶æ¯æ¬¡<code>render</code>æ¸²æŸ“çš„æ—¶å€™ï¼Œéƒ½ä¼šé‡æ–°è¿›è¡Œ<code>bind</code>çš„æ“ä½œï¼Œå½±å“æ€§èƒ½</p>
<h3 id="renderæ–¹æ³•ä¸­ä½¿ç”¨ç®­å¤´å‡½æ•°"><a href="#renderæ–¹æ³•ä¸­ä½¿ç”¨ç®­å¤´å‡½æ•°" class="headerlink" title="renderæ–¹æ³•ä¸­ä½¿ç”¨ç®­å¤´å‡½æ•°"></a>renderæ–¹æ³•ä¸­ä½¿ç”¨ç®­å¤´å‡½æ•°</h3><p>é€šè¿‡<code>ES6</code>çš„ä¸Šä¸‹æ–‡æ¥å°†<code>this</code>çš„æŒ‡å‘ç»‘å®šç»™å½“å‰ç»„ä»¶ï¼ŒåŒæ ·å†æ¯ä¸€æ¬¡<code>render</code>çš„æ—¶å€™éƒ½ä¼šç”Ÿæˆæ–°çš„æ–¹æ³•ï¼Œå½±å“æ€§èƒ½</p>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">App</span> <span class="keyword">extends</span> <span class="title class_ inherited__">React.Component</span> &#123;</span><br><span class="line">  <span class="title function_">handleClick</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;this &gt; &#x27;</span>, <span class="variable language_">this</span>);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="title function_">render</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> (</span><br><span class="line">      <span class="language-xml"><span class="tag">&lt;<span class="name">div</span> <span class="attr">onClick</span>=<span class="string">&#123;e</span> =&gt;</span> this.handleClick(e)&#125;&gt;test<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line">    )</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="constructorä¸­bind"><a href="#constructorä¸­bind" class="headerlink" title="constructorä¸­bind"></a>constructorä¸­bind</h2><p>åœ¨<code>constructor</code>ä¸­é¢„å…ˆ<code>bind</code>å½“å‰ç»„ä»¶ï¼Œå¯ä»¥é¿å…åœ¨<code>render</code>æ“ä½œä¸­é‡å¤ç»‘å®š</p>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">App</span> <span class="keyword">extends</span> <span class="title class_ inherited__">React.Component</span> &#123;</span><br><span class="line">  <span class="title function_">constructor</span>(<span class="params">props</span>) &#123;</span><br><span class="line">    <span class="variable language_">super</span>(props);</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">handleClick</span> = <span class="variable language_">this</span>.<span class="property">handleClick</span>.<span class="title function_">bind</span>(<span class="variable language_">this</span>);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="title function_">handleClick</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;this &gt; &#x27;</span>, <span class="variable language_">this</span>);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="title function_">render</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> (</span><br><span class="line">      <span class="language-xml"><span class="tag">&lt;<span class="name">div</span> <span class="attr">onClick</span>=<span class="string">&#123;this.handleClick&#125;</span>&gt;</span>test<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line">    )</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="å®šä¹‰é˜¶æ®µä½¿ç”¨ç®­å¤´å‡½æ•°ç»‘å®š"><a href="#å®šä¹‰é˜¶æ®µä½¿ç”¨ç®­å¤´å‡½æ•°ç»‘å®š" class="headerlink" title="å®šä¹‰é˜¶æ®µä½¿ç”¨ç®­å¤´å‡½æ•°ç»‘å®š"></a>å®šä¹‰é˜¶æ®µä½¿ç”¨ç®­å¤´å‡½æ•°ç»‘å®š</h3><p>è·Ÿä¸Šè¿°æ–¹å¼ä¸‰ä¸€æ ·ï¼Œèƒ½å¤Ÿé¿å…åœ¨<code>render</code>æ“ä½œä¸­é‡å¤ç»‘å®šï¼Œå®ç°ä¹Ÿéå¸¸çš„ç®€å•ï¼Œå¦‚ä¸‹ï¼š</p>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">App</span> <span class="keyword">extends</span> <span class="title class_ inherited__">React.Component</span> &#123;</span><br><span class="line">  <span class="title function_">constructor</span>(<span class="params">props</span>) &#123;</span><br><span class="line">    <span class="variable language_">super</span>(props);</span><br><span class="line">  &#125;</span><br><span class="line">  handleClick = <span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;this &gt; &#x27;</span>, <span class="variable language_">this</span>);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="title function_">render</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> (</span><br><span class="line">      <span class="language-xml"><span class="tag">&lt;<span class="name">div</span> <span class="attr">onClick</span>=<span class="string">&#123;this.handleClick&#125;</span>&gt;</span>test<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line">    )</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="ä¸‰ã€åŒºåˆ«"><a href="#ä¸‰ã€åŒºåˆ«" class="headerlink" title="ä¸‰ã€åŒºåˆ«"></a>ä¸‰ã€åŒºåˆ«</h2><p>ä¸Šè¿°å››ç§æ–¹æ³•çš„æ–¹å¼ï¼ŒåŒºåˆ«ä¸»è¦å¦‚ä¸‹ï¼š</p>
<ul>
<li>ç¼–å†™æ–¹é¢ï¼šæ–¹å¼ä¸€ã€æ–¹å¼äºŒå†™æ³•ç®€å•ï¼Œæ–¹å¼ä¸‰çš„ç¼–å†™è¿‡äºå†—æ‚</li>
<li>æ€§èƒ½æ–¹é¢ï¼šæ–¹å¼ä¸€å’Œæ–¹å¼äºŒåœ¨æ¯æ¬¡ç»„ä»¶renderçš„æ—¶å€™éƒ½ä¼šç”Ÿæˆæ–°çš„æ–¹æ³•å®ä¾‹ï¼Œæ€§èƒ½é—®é¢˜æ¬ ç¼ºã€‚è‹¥è¯¥å‡½æ•°ä½œä¸ºå±æ€§å€¼ä¼ ç»™å­ç»„ä»¶çš„æ—¶å€™ï¼Œéƒ½ä¼šå¯¼è‡´é¢å¤–çš„æ¸²æŸ“ã€‚è€Œæ–¹å¼ä¸‰ã€æ–¹å¼å››åªä¼šç”Ÿæˆä¸€ä¸ªæ–¹æ³•å®ä¾‹</li>
</ul>
<p>ç»¼åˆä¸Šè¿°ï¼Œæ–¹å¼å››æ˜¯æœ€ä¼˜çš„äº‹ä»¶ç»‘å®šæ–¹å¼</p>

        
    </article>
    <footer class="cube-excerpt-footer">
        <a class="cube-excerpt-more" href="/2020/04/13/React/React-%E4%BA%8B%E4%BB%B6%E7%BB%91%E5%AE%9A%E6%96%B9%E5%BC%8F/">Read More</a>
    </footer>
</div>

<div class="cube-excerpt" id="cube-excerpt-Reactè®¾è®¡æ¨¡å¼å’Œæœ€ä½³å®è·µæ€»ç»“ï¼ˆåº•å±‚æ€»ç»“ï¼‰">
    <header class="cube-excerpt-header">
        <h1><a href="/2020/04/08/React/React-%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F%E5%92%8C%E6%9C%80%E4%BD%B3%E5%AE%9E%E8%B7%B5%E6%80%BB%E7%BB%93/">Reactè®¾è®¡æ¨¡å¼å’Œæœ€ä½³å®è·µæ€»ç»“ï¼ˆåº•å±‚æ€»ç»“ï¼‰</a></h1>
        <div class="cube-excerpt-header-msg">
            <div class="cube-excerpt-date">
                <i class="cube-icon cube-icon-date" aria-hidden="true"></i>
                2020-04-08
            </div>
            <div class="cube-excerpt-tags">
                <i class="cube-icon cube-icon-tag" aria-hidden="true"></i>
                
                <a href="/tags/React/" class="cube-excerpt-tag-link">#React</a>
                
            </div>
        </div>
    </header>
    <article class="cube-excerpt-entry cube-markdown">
        
        
           <h2 id="ä¸€ã€ç»„ä»¶å®è·µ"><a href="#ä¸€ã€ç»„ä»¶å®è·µ" class="headerlink" title="ä¸€ã€ç»„ä»¶å®è·µ"></a>ä¸€ã€ç»„ä»¶å®è·µ</h2><h3 id="1-1-è®¾è®¡åŸåˆ™"><a href="#1-1-è®¾è®¡åŸåˆ™" class="headerlink" title="1.1 è®¾è®¡åŸåˆ™"></a>1.1 è®¾è®¡åŸåˆ™</h3><ul>
<li>ä¿æŒæ¥å£å°ï¼Œ<code>props</code> æ•°é‡è¦å°‘</li>
<li>æ ¹æ®æ•°æ®è¾¹ç•Œæ¥åˆ’åˆ†ç»„ä»¶ï¼Œå……åˆ†åˆ©ç”¨ç»„åˆ</li>
<li>æŠŠ state å¾€ä¸Šå±‚ç»„ä»¶æå–ï¼Œè®©ä¸‹å±‚ç»„ä»¶åªéœ€è¦å®ç°ä¸ºçº¯å‡½æ•°</li>
</ul>
<h3 id="1-2-ç»„ä»¶åˆ’åˆ†"><a href="#1-2-ç»„ä»¶åˆ’åˆ†" class="headerlink" title="1.2 ç»„ä»¶åˆ’åˆ†"></a>1.2 ç»„ä»¶åˆ’åˆ†</h3><blockquote>
<p>ä»»ä½•ä¸€ä¸ªå¤æ‚ç»„ä»¶éƒ½æ˜¯ä»ç®€å•ç»„ä»¶å¼€å§‹çš„ï¼Œä¸€å¼€å§‹æˆ‘ä»¬åœ¨ render å‡½æ•°é‡Œå†™çš„ä»£ç ä¸å¤šï¼Œä½†æ˜¯éšç€é€»è¾‘çš„å¤æ‚ï¼ŒJSX ä»£ç è¶Šæ¥è¶Šå¤šï¼Œäºæ˜¯ï¼Œå°±éœ€è¦æ‹†åˆ†å‡½æ•°ä¸­çš„å†…å®¹</p>
</blockquote>
<ul>
<li>åœ¨ React ä¸­ï¼Œæœ‰ä¸€ä¸ªè¯¯åŒºï¼Œå°±æ˜¯æŠŠ render ä¸­çš„ä»£ç åˆ†æ‹†åˆ°å¤šä¸ª renderXXXX å‡½æ•°ä¸­å»ï¼Œæ¯”å¦‚ä¸‹é¢è¿™æ ·</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line">class StopWatch extends React.Component &#123;</span><br><span class="line">  render() &#123;</span><br><span class="line">    const majorClock = this.renderMajorClock();</span><br><span class="line">    const controlButtons = this.renderControlButtons();</span><br><span class="line">    const splitTimes = this.renderSplitTimes();</span><br><span class="line">    </span><br><span class="line">    return (</span><br><span class="line">       &lt;div&gt;</span><br><span class="line">          &#123;majorClock&#125;</span><br><span class="line">          &#123;controlButtons&#125;</span><br><span class="line">          &#123;splitTimes&#125;</span><br><span class="line">       &lt;/div&gt;</span><br><span class="line">    );</span><br><span class="line">  &#125;</span><br><span class="line">  </span><br><span class="line">  renderMajorClock() &#123;</span><br><span class="line">     //TODO: è¿”å›æ•°å­—æ—¶é’Ÿçš„JSX</span><br><span class="line">  &#125;</span><br><span class="line">  </span><br><span class="line">  renderControlButtons() &#123;</span><br><span class="line">     //TODO: è¿”å›ä¸¤ä¸ªæŒ‰é’®çš„JSX</span><br><span class="line">  &#125;</span><br><span class="line">  </span><br><span class="line">  renderSplitTimes() &#123;</span><br><span class="line">     //TODO: è¿”å›æ‰€æœ‰è®¡æ¬¡æ—¶é—´çš„JSX</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<blockquote>
<p>ç”¨ä¸Šé¢çš„æ–¹æ³•ç»„ç»‡ä»£ç ï¼Œå½“ç„¶æ¯”å†™ä¸€ä¸ªå·¨å¤§çš„ render å‡½æ•°è¦å¼ºï¼Œä½†æ˜¯ï¼Œå®ç°è¿™ä¹ˆå¤š renderXXXX å‡½æ•°å¹¶ä¸æ˜¯ä¸€ä¸ªæ˜æ™ºä¹‹ä¸¾ï¼Œå› ä¸ºè¿™äº› renderXXXX å‡½æ•°è®¿é—®çš„æ˜¯åŒæ ·çš„ props å’Œ stateï¼Œè¿™æ ·ä»£ç ä¾ç„¶è€¦åˆåœ¨äº†ä¸€èµ·ã€‚æ›´å¥½çš„æ–¹æ³•ï¼Œæ˜¯æŠŠè¿™äº› renderXXXX é‡æ„æˆå„è‡ªç‹¬ç«‹çš„ React ç»„ä»¶ï¼Œåƒä¸‹é¢è¿™æ ·</p>
</blockquote>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">class StopWatch extends React.Component &#123;</span><br><span class="line">  render() &#123;</span><br><span class="line">    return (</span><br><span class="line">       &lt;div&gt;</span><br><span class="line">          &lt;MajorClock&gt;</span><br><span class="line">          &lt;ControlButtons&gt;</span><br><span class="line">          &lt;SplitTimes&gt;</span><br><span class="line">       &lt;/div&gt;</span><br><span class="line">    );</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">const MajorClock = (props) =&gt; &#123;</span><br><span class="line">  //TODO: è¿”å›æ•°å­—æ—¶é’Ÿçš„JSX</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">const ControlButtons = (props) =&gt; &#123;</span><br><span class="line">  //TODO: è¿”å›ä¸¤ä¸ªæŒ‰é’®çš„JSX</span><br><span class="line">&#125;;</span><br><span class="line">  </span><br><span class="line">const SplitTimes = (props) =&gt; &#123;</span><br><span class="line">  //TODO: è¿”å›æ‰€æœ‰è®¡æ¬¡æ—¶é—´çš„JSX</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<blockquote>
<p>æˆ‘ä»¬åˆ›é€ äº† <code>MajorClock</code>ã€<code>ControlButtons</code> å’Œ <code>SplitTimes</code> è¿™ä¸‰ä¸ªç»„ä»¶ï¼Œç›®å‰ï¼Œæˆ‘ä»¬å¹¶ä¸çŸ¥é“å®ƒä»¬æ˜¯å¦åº”è¯¥æœ‰è‡ªå·±çš„ <code>state</code>ï¼Œä½†æ˜¯ä»ç®€å•å¼€å§‹ï¼Œé¦–å…ˆå‡è®¾å®ƒä»¬æ²¡æœ‰è‡ªå·±çš„ <code>state</code>ï¼Œå®šä¹‰ä¸ºå‡½æ•°å½¢å¼çš„æ— çŠ¶æ€ç»„ä»¶</p>
</blockquote>
<p><strong>ç»„ä»¶ props çš„è®¾è®¡</strong></p>
<blockquote>
<p>ä½¿ç”¨ propTypes æ¥å®šä¹‰ç»„ä»¶çš„ props</p>
</blockquote>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">const ControlButtons = (props) =&gt; &#123;</span><br><span class="line">  //TODO: è¿”å›ä¸¤ä¸ªæŒ‰é’®çš„JSX</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">ControlButtons.propTypes = &#123;</span><br><span class="line">  activated: PropTypes.bool,</span><br><span class="line">  onStart: PropTypes.func.isRquired,</span><br><span class="line">  onPause: PropTypes.func.isRquired,</span><br><span class="line">  onSplit: PropTypes.func.isRquired,</span><br><span class="line">  onReset: PropTypes.func.isRquired,</span><br><span class="line">  splits: PropTypes.arrayOf(PropTypes.number)</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<h3 id="1-3-ç»„ä»¶å†…éƒ¨å®ç°"><a href="#1-3-ç»„ä»¶å†…éƒ¨å®ç°" class="headerlink" title="1.3 ç»„ä»¶å†…éƒ¨å®ç°"></a>1.3 ç»„ä»¶å†…éƒ¨å®ç°</h3><ul>
<li>å°½é‡æ¯ä¸ªç»„ä»¶éƒ½æœ‰è‡ªå·±ä¸“å±çš„æºä»£ç æ–‡ä»¶</li>
<li>ç”¨è§£æ„èµ‹å€¼ï¼ˆdestructuring assignmentï¼‰çš„æ–¹æ³•è·å–å‚æ•° props çš„æ¯ä¸ªå±æ€§å€¼</li>
<li>åˆ©ç”¨å±æ€§åˆå§‹åŒ–ï¼ˆproperty initializerï¼‰æ¥å®šä¹‰ state å’Œæˆå‘˜å‡½æ•°</li>
</ul>
<p><strong>å±æ€§åˆå§‹åŒ–æ–¹æ³•</strong></p>
<blockquote>
<p>å°½é‡ä¸è¦åœ¨ JSX ä¸­å†™å†…è”å‡½æ•°ï¼ˆinline functionï¼‰ï¼Œæ¯”å¦‚è¿™æ ·å†™ï¼Œæ˜¯å¾ˆä¸æ°å½“çš„</p>
</blockquote>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">&lt;ControlButtons</span><br><span class="line">  activated=&#123;this.state.isStarted&#125;</span><br><span class="line">  onStart=&#123;() =&gt; &#123; /* TODO */&#125;&#125;</span><br><span class="line">  onPause=&#123;() =&gt; &#123; /* TODO */&#125;&#125;</span><br><span class="line">  onReset=&#123;() =&gt; &#123; /* TODO */&#125;&#125;</span><br><span class="line">  onSplit=&#123;() =&gt; &#123; /* TODO */&#125;&#125;</span><br><span class="line">/&gt;</span><br></pre></td></tr></table></figure>

<blockquote>
<p>å½“ç„¶ï¼ŒæŒ‰ç…§ä¸Šé¢é‚£ç§å†™æ³•ï¼Œä¹Ÿå¯ä»¥å®Œæˆç¨‹åºçš„åŠŸèƒ½ï¼Œä½†æ˜¯ï¼Œä¼šå¸¦æ¥æ€§èƒ½çš„ä»£ä»·ã€‚é¦–å…ˆï¼Œæ¯ä¸€æ¬¡æ¸²æŸ“è¿™æ®µ <code>JSX</code>ï¼Œéƒ½ä¼šäº§ç”Ÿå…¨æ–°çš„å‡½æ•°å¯¹è±¡ï¼Œè¿™æ˜¯ä¸€ç§æµªè´¹ï¼›å…¶æ¬¡ï¼Œå› ä¸ºæ¯ä¸€æ¬¡ä¼ ç»™ <code>ControlButtons</code> çš„éƒ½æ˜¯æ–°çš„ <code>props</code>ï¼Œè¿™æ · <code>ControlButtons</code> ä¹Ÿæ— æ³•é€šè¿‡ <code>shouldComponentUpdate</code> å¯¹ <code>props</code> çš„æ£€æŸ¥æ¥é¿å…é‡å¤æ¸²æŸ“</p>
</blockquote>
<h2 id="äºŒã€ç»„ä»¶è®¾è®¡æ¨¡å¼"><a href="#äºŒã€ç»„ä»¶è®¾è®¡æ¨¡å¼" class="headerlink" title="äºŒã€ç»„ä»¶è®¾è®¡æ¨¡å¼"></a>äºŒã€ç»„ä»¶è®¾è®¡æ¨¡å¼</h2><h3 id="2-1-é«˜é˜¶ç»„ä»¶"><a href="#2-1-é«˜é˜¶ç»„ä»¶" class="headerlink" title="2.1 é«˜é˜¶ç»„ä»¶"></a>2.1 é«˜é˜¶ç»„ä»¶</h3><ul>
<li>åœ¨å¼€å‘ React ç»„ä»¶è¿‡ç¨‹ä¸­ï¼Œå¾ˆå®¹æ˜“å‘ç°è¿™æ ·ä¸€ç§ç°è±¡ï¼ŒæŸäº›åŠŸèƒ½æ˜¯å¤šä¸ªç»„ä»¶é€šç”¨çš„ï¼Œå¦‚æœæ¯ä¸ªç»„ä»¶éƒ½é‡å¤å®ç°è¿™æ ·çš„é€»è¾‘ï¼Œè‚¯å®šååˆ†æµªè´¹ï¼Œè€Œä¸”è¿åäº†â€œä¸è¦é‡å¤è‡ªå·±â€ï¼ˆDRYï¼ŒDonâ€™t Repeat Yourself)çš„ç¼–ç åŸåˆ™ï¼Œæˆ‘ä»¬è‚¯å®šæƒ³è¦æŠŠè¿™éƒ¨åˆ†å…±ç”¨é€»è¾‘æå–å‡ºæ¥é‡ç”¨</li>
<li>æˆ‘ä»¬è¯´è¿‡ï¼Œåœ¨ React çš„ä¸–ç•Œé‡Œï¼Œç»„ä»¶æ˜¯ç¬¬ä¸€å…¬æ°‘ï¼Œé¦–å…ˆæƒ³åˆ°çš„æ˜¯å½“ç„¶æ˜¯æŠŠå…±ç”¨é€»è¾‘æå–ä¸ºä¸€ä¸ª React ç»„ä»¶ã€‚ä¸è¿‡ï¼Œæœ‰äº›æƒ…å†µä¸‹ï¼Œè¿™äº›å…±ç”¨é€»è¾‘è¿˜æ²¡æ³•æˆä¸ºä¸€ä¸ªç‹¬ç«‹ç»„ä»¶ï¼Œæ¢å¥è¯è¯´ï¼Œè¿™äº›å…±ç”¨é€»è¾‘å•ç‹¬æ— æ³•ä½¿ç”¨ï¼Œå®ƒä»¬åªæ˜¯å¯¹å…¶ä»–ç»„ä»¶çš„åŠŸèƒ½åŠ å¼º</li>
</ul>
<p><strong>é«˜é˜¶ç»„ä»¶çš„åŸºæœ¬å½¢å¼</strong></p>
<blockquote>
<p>â€œé«˜é˜¶ç»„ä»¶â€åä¸ºâ€œç»„ä»¶â€ï¼Œå…¶å®å¹¶ä¸æ˜¯ä¸€ä¸ªç»„ä»¶ï¼Œè€Œæ˜¯ä¸€ä¸ªå‡½æ•°ï¼Œåªä¸è¿‡è¿™ä¸ªå‡½æ•°æ¯”è¾ƒç‰¹æ®Šï¼Œå®ƒæ¥å—è‡³å°‘ä¸€ä¸ª React ç»„ä»¶ä¸ºå‚æ•°ï¼Œå¹¶ä¸”èƒ½å¤Ÿè¿”å›ä¸€ä¸ªå…¨æ–°çš„ React ç»„ä»¶ä½œä¸ºç»“æœï¼Œå½“ç„¶ï¼Œè¿™ä¸ªæ–°äº§ç”Ÿçš„ React ç»„ä»¶æ˜¯å¯¹ä½œä¸ºå‚æ•°çš„ç»„ä»¶çš„åŒ…è£…ï¼Œæ‰€ä»¥ï¼Œæœ‰æœºä¼šèµ‹äºˆæ–°ç»„ä»¶ä¸€äº›å¢å¼ºçš„â€œç¥åŠ›â€</p>
</blockquote>
<p>ä¸€ä¸ªæœ€ç®€å•çš„é«˜é˜¶ç»„ä»¶æ˜¯è¿™æ ·çš„å½¢å¼</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">const withDoNothing = (Component) =&gt; &#123;</span><br><span class="line">  const NewComponent = (props) =&gt; &#123;</span><br><span class="line">    return &lt;Component &#123;...props&#125; /&gt;;</span><br><span class="line">  &#125;;</span><br><span class="line">  return NewComponent;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<ul>
<li>ä¸Šé¢çš„å‡½æ•° withDoNothing å°±æ˜¯ä¸€ä¸ªé«˜é˜¶ç»„ä»¶ï¼Œä½œä¸ºä¸€é¡¹ä¸šç•Œé€šç”¨çš„ä»£ç è§„èŒƒï¼Œé«˜é˜¶ç»„ä»¶çš„å‘½åä¸€èˆ¬éƒ½å¸¦ with å‰ç¼€ï¼Œå‘½åä¸­åé¢çš„éƒ¨åˆ†ä»£è¡¨è¿™ä¸ªé«˜é˜¶ç»„ä»¶çš„åŠŸèƒ½</li>
</ul>
<blockquote>
<p>å°±å¦‚åŒ withDoNothing è¿™ä¸ªåå­—æ‰€è¯´çš„ä¸€æ ·ï¼Œè¿™ä¸ªé«˜é˜¶ç»„ä»¶ä»€ä¹ˆéƒ½æ²¡åšï¼Œä½†æ˜¯ä»ä¸­å¯ä»¥çœ‹å‡ºé«˜é˜¶ç»„ä»¶çš„åŸºæœ¬ä»£ç å¥—è·¯</p>
</blockquote>
<ul>
<li>é«˜é˜¶ç»„ä»¶ä¸èƒ½å»ä¿®æ”¹ä½œä¸ºå‚æ•°çš„ç»„ä»¶ï¼Œé«˜é˜¶ç»„ä»¶å¿…é¡»æ˜¯ä¸€ä¸ªçº¯å‡½æ•°ï¼Œä¸åº”è¯¥æœ‰ä»»ä½•å‰¯ä½œç”¨ã€‚</li>
<li>é«˜é˜¶ç»„ä»¶è¿”å›çš„ç»“æœå¿…é¡»æ˜¯ä¸€ä¸ªæ–°çš„ React ç»„ä»¶ï¼Œè¿™ä¸ªæ–°çš„ç»„ä»¶çš„ JSX éƒ¨åˆ†è‚¯å®šä¼šåŒ…å«ä½œä¸ºå‚æ•°çš„ç»„ä»¶</li>
<li>é«˜é˜¶ç»„ä»¶ä¸€èˆ¬éœ€è¦æŠŠä¼ ç»™è‡ªå·±çš„ props è½¬æ‰‹ä¼ é€’ç»™ä½œä¸ºå‚æ•°çš„ç»„ä»¶</li>
</ul>
<p><strong>ç”¨é«˜é˜¶ç»„ä»¶æŠ½å–å…±åŒé€»è¾‘</strong></p>
<blockquote>
<p>æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬å¯¹ withDoNothing è¿›è¡Œä¸€äº›æ”¹è¿›ï¼Œè®©å®ƒå®ç°â€œåªæœ‰åœ¨ç™»å½•æ—¶æ‰æ˜¾ç¤ºâ€è¿™ä¸ªåŠŸèƒ½</p>
</blockquote>
<p>å‡è®¾æˆ‘ä»¬å·²ç»æœ‰ä¸€ä¸ªå‡½æ•° getUserId èƒ½å¤Ÿä» cookies ä¸­è¯»å–ç™»å½•ç”¨æˆ·çš„ IDï¼Œå¦‚æœç”¨æˆ·æœªç™»å½•ï¼Œè¿™ä¸ª getUserId å°±è¿”å›ç©ºï¼Œé‚£ä¹ˆâ€œé€€å‡ºç™»å½•æŒ‰é’®â€œå°±éœ€è¦è¿™ä¹ˆå†™ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">const LogoutButton = () =&gt; &#123;</span><br><span class="line">  if (getUserId()) &#123;</span><br><span class="line">    return ...; // æ˜¾ç¤ºâ€é€€å‡ºç™»å½•â€œçš„JSX</span><br><span class="line">  &#125; else &#123;</span><br><span class="line">    return null;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<p>åŒæ ·ï¼Œè´­ç‰©è½¦çš„ä»£ç å°±æ˜¯è¿™æ ·</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">const ShoppintCart = () =&gt; &#123;</span><br><span class="line">  if (getUserId()) &#123;</span><br><span class="line">    return ...; // æ˜¾ç¤ºâ€è´­ç‰©è½¦â€œçš„JSX</span><br><span class="line">  &#125; else &#123;</span><br><span class="line">    return null;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<blockquote>
<p>ä¸Šé¢ä¸¤ä¸ªç»„ä»¶æ˜æ˜¾æœ‰é‡å¤çš„ä»£ç ï¼Œæˆ‘ä»¬å¯ä»¥æŠŠé‡å¤ä»£ç æŠ½å–å‡ºæ¥ï¼Œå½¢æˆ withLogin è¿™ä¸ªé«˜é˜¶ç»„ä»¶ï¼Œä»£ç å¦‚ä¸‹</p>
</blockquote>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">const withLogin = (Component) =&gt; &#123;</span><br><span class="line">  const NewComponent = (props) =&gt; &#123;</span><br><span class="line">    if (getUserId()) &#123;</span><br><span class="line">      return &lt;Component &#123;...props&#125; /&gt;;</span><br><span class="line">    &#125; else &#123;</span><br><span class="line">      return null;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  return NewComponent;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<blockquote>
<p>å¦‚æ­¤ä¸€æ¥ï¼Œæˆ‘ä»¬å°±åªéœ€è¦è¿™æ ·å®šä¹‰ LogoutButton å’Œ ShoppintCartï¼š</p>
</blockquote>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">const LogoutButton = withLogin((props) =&gt; &#123;</span><br><span class="line">  return ...; // æ˜¾ç¤ºâ€é€€å‡ºç™»å½•â€œçš„JSX</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">const ShoppingCart = withLogin(() =&gt; &#123;</span><br><span class="line">  return ...; // æ˜¾ç¤ºâ€è´­ç‰©è½¦â€œçš„JSX</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<blockquote>
<p>æˆ‘ä»¬é¿å…äº†é‡å¤ä»£ç ï¼Œä»¥åå¦‚æœè¦ä¿®æ”¹å¯¹ç”¨æˆ·æ˜¯å¦ç™»å½•çš„åˆ¤æ–­é€»è¾‘ï¼Œä¹Ÿåªéœ€è¦ä¿®æ”¹ <code>withLogin</code>ï¼Œè€Œä¸ç”¨ä¿®æ”¹æ¯ä¸ª React ç»„ä»¶</p>
</blockquote>
<p><strong>é«˜é˜¶ç»„ä»¶çš„é«˜çº§ç”¨æ³•</strong></p>
<ul>
<li>é«˜é˜¶ç»„ä»¶åªéœ€è¦è¿”å›ä¸€ä¸ª React ç»„ä»¶å³å¯ï¼Œæ²¡äººè§„å®šé«˜é˜¶ç»„ä»¶åªèƒ½æ¥å—ä¸€ä¸ª React ç»„ä»¶ä½œä¸ºå‚æ•°ï¼Œå®Œå…¨å¯ä»¥ä¼ å…¥å¤šä¸ª React ç»„ä»¶ç»™é«˜é˜¶ç»„ä»¶</li>
<li>æ¯”å¦‚ï¼Œæˆ‘ä»¬å¯ä»¥æ”¹è¿›ä¸Šé¢çš„ withLoginï¼Œè®©å®ƒæ¥å—ä¸¤ä¸ª React ç»„ä»¶ï¼Œæ ¹æ®ç”¨æˆ·æ˜¯å¦ç™»å½•é€‰æ‹©æ¸²æŸ“åˆé€‚çš„ç»„ä»¶</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">const withLoginAndLogout = (ComponentForLogin, ComponentForLogout) =&gt; &#123;</span><br><span class="line">  const NewComponent = (props) =&gt; &#123;</span><br><span class="line">    if (getUserId()) &#123;</span><br><span class="line">      return &lt;ComponentForLogin &#123;...props&#125; /&gt;;</span><br><span class="line">    &#125; else &#123;</span><br><span class="line">      return &lt;ComponentForLogout&#123;...props&#125; /&gt;;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  return NewComponent;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<blockquote>
<p>æœ‰äº†ä¸Šé¢çš„ withLoginAndLogoutï¼Œå°±å¯ä»¥äº§ç”Ÿæ ¹æ®ç”¨æˆ·ç™»å½•çŠ¶æ€æ˜¾ç¤ºä¸åŒçš„å†…å®¹</p>
</blockquote>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">const TopButtons = withLoginAndLogout(</span><br><span class="line">  LogoutButton,</span><br><span class="line">  LoginButton</span><br><span class="line">);</span><br></pre></td></tr></table></figure>

<p><strong>é“¾å¼è°ƒç”¨é«˜é˜¶ç»„ä»¶</strong></p>
<ul>
<li>é«˜é˜¶ç»„ä»¶æœ€å·§å¦™çš„ä¸€ç‚¹ï¼Œæ˜¯å¯ä»¥é“¾å¼è°ƒç”¨ã€‚</li>
<li>å‡è®¾ï¼Œä½ æœ‰ä¸‰ä¸ªé«˜é˜¶ç»„ä»¶åˆ†åˆ«æ˜¯ withOneã€withTwo å’Œ withThreeï¼Œé‚£ä¹ˆï¼Œå¦‚æœè¦èµ‹äºˆä¸€ä¸ªç»„ä»¶ X æŸä¸ªé«˜é˜¶ç»„ä»¶çš„è¶…èƒ½åŠ›ï¼Œé‚£ä¹ˆï¼Œä½ è¦åšçš„å°±æ˜¯æŒ¨ä¸ªä½¿ç”¨é«˜é˜¶ç»„ä»¶åŒ…è£…ï¼Œä»£ç å¦‚ä¸‹</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">const X1 = withOne(X);</span><br><span class="line">const X2 = withTwo(X1);</span><br><span class="line">const X3 = withThree(X2);</span><br><span class="line">const SuperX = X3; //æœ€ç»ˆçš„SuperXå…·å¤‡ä¸‰ä¸ªé«˜é˜¶ç»„ä»¶çš„è¶…èƒ½åŠ›</span><br></pre></td></tr></table></figure>

<p>å¾ˆè‡ªç„¶ï¼Œæˆ‘ä»¬å¯ä»¥é¿å…ä½¿ç”¨ä¸­é—´å˜é‡ X1 å’Œ X2ï¼Œç›´æ¥è¿ç»­è°ƒç”¨é«˜é˜¶ç»„ä»¶ï¼Œå¦‚ä¸‹</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">const SuperX = withThree(withTwo(withOne(X)));</span><br></pre></td></tr></table></figure>

<p>å¯¹äº X è€Œè¨€ï¼Œå®ƒè¢«é«˜é˜¶ç»„ä»¶åŒ…è£…äº†ï¼Œè‡³äºè¢«ä¸€ä¸ªé«˜é˜¶ç»„ä»¶åŒ…è£…ï¼Œè¿˜æ˜¯è¢« N ä¸ªé«˜é˜¶ç»„ä»¶åŒ…è£…ï¼Œæ²¡æœ‰ä»€ä¹ˆå·®åˆ«ã€‚è€Œé«˜é˜¶ç»„ä»¶æœ¬èº«å°±æ˜¯ä¸€ä¸ªçº¯å‡½æ•°ï¼Œçº¯å‡½æ•°æ˜¯å¯ä»¥ç»„åˆä½¿ç”¨çš„ï¼Œæ‰€ä»¥ï¼Œæˆ‘ä»¬å…¶å®å¯ä»¥æŠŠå¤šä¸ªé«˜é˜¶ç»„ä»¶ç»„åˆä¸ºä¸€ä¸ªé«˜é˜¶ç»„ä»¶ï¼Œç„¶åç”¨è¿™ä¸€ä¸ªé«˜é˜¶ç»„ä»¶å»åŒ…è£…Xï¼Œä»£ç å¦‚ä¸‹</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">const hoc = compose(withThree, withTwo, withOne);</span><br><span class="line">const SuperX = hoc(X);</span><br></pre></td></tr></table></figure>

<blockquote>
<p>ä¸Šé¢ä»£ç ä¸­ä½¿ç”¨çš„ composeï¼Œæ˜¯å‡½æ•°å¼ç¼–ç¨‹ä¸­å¾ˆåŸºç¡€çš„ä¸€ç§æ–¹æ³•ï¼Œä½œç”¨å°±æ˜¯æŠŠå¤šä¸ªå‡½æ•°ç»„åˆä¸ºä¸€ä¸ªå‡½æ•°ï¼Œåœ¨å¾ˆå¤šå¼€æºçš„ä»£ç åº“ä¸­éƒ½å¯ä»¥çœ‹åˆ°ï¼Œä¸‹é¢æ˜¯ä¸€ä¸ªå‚è€ƒå®ç°</p>
</blockquote>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">export default function compose(...funcs) &#123;</span><br><span class="line">  if (funcs.length === 0) &#123;</span><br><span class="line">    return arg =&gt; arg</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  if (funcs.length === 1) &#123;</span><br><span class="line">    return funcs[0]</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  return funcs.reduce((a, b) =&gt; (...args) =&gt; a(b(...args)))</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ul>
<li>React ç»„ä»¶å¯ä»¥å½“åšç§¯æœ¨ä¸€æ ·ç»„åˆä½¿ç”¨ï¼Œç°åœ¨æœ‰äº† composeï¼Œæˆ‘ä»¬å°±å¯ä»¥æŠŠé«˜é˜¶ç»„ä»¶ä¹Ÿå½“åšç§¯æœ¨ä¸€æ ·ç»„åˆï¼Œè¿›ä¸€æ­¥é‡ç”¨ä»£ç ã€‚</li>
<li>å‡å¦‚ä¸€ä¸ªåº”ç”¨ä¸­å¤šä¸ªç»„ä»¶éƒ½éœ€è¦åŒæ ·çš„å¤šä¸ªé«˜é˜¶ç»„ä»¶åŒ…è£…ï¼Œé‚£å°±å¯ä»¥ç”¨ compose ç»„åˆè¿™äº›é«˜é˜¶ç»„ä»¶ä¸ºä¸€ä¸ªé«˜é˜¶ç»„ä»¶ï¼Œè¿™æ ·åœ¨ä½¿ç”¨å¤šä¸ªé«˜é˜¶ç»„ä»¶çš„åœ°æ–¹å®é™…ä¸Šå°±åªéœ€è¦ä½¿ç”¨ä¸€ä¸ªé«˜é˜¶ç»„ä»¶äº†</li>
</ul>
<p><strong>ä¸è¦æ»¥ç”¨é«˜é˜¶ç»„ä»¶</strong></p>
<blockquote>
<p>é«˜é˜¶ç»„ä»¶è™½ç„¶å¯ä»¥ç”¨ä¸€ç§å¯é‡ç”¨çš„æ–¹å¼æ‰©å……ç°æœ‰ React ç»„ä»¶çš„åŠŸèƒ½ï¼Œä½†é«˜é˜¶ç»„ä»¶å¹¶ä¸æ˜¯ç»å¯¹å®Œç¾çš„</p>
</blockquote>
<p>é¦–å…ˆï¼Œé«˜é˜¶ç»„ä»¶ä¸å¾—ä¸å¤„ç† displayNameï¼Œä¸ç„¶ debug ä¼šå¾ˆç—›è‹¦ã€‚å½“ React æ¸²æŸ“å‡ºé”™çš„æ—¶å€™ï¼Œé ç»„ä»¶çš„ displayName é™æ€å±æ€§æ¥åˆ¤æ–­å‡ºé”™çš„ç»„ä»¶ç±»ï¼Œè€Œé«˜é˜¶ç»„ä»¶æ€»æ˜¯åˆ›é€ ä¸€ä¸ªæ–°çš„ React ç»„ä»¶ç±»ï¼Œæ‰€ä»¥ï¼Œæ¯ä¸ªé«˜é˜¶ç»„ä»¶éƒ½éœ€è¦å¤„ç†ä¸€ä¸‹ displayName</p>
<p>å¦‚æœè¦åšä¸€ä¸ªæœ€ç®€å•çš„ä»€ä¹ˆå¢å¼ºåŠŸèƒ½éƒ½æ²¡æœ‰çš„é«˜é˜¶ç»„ä»¶ï¼Œä¹Ÿå¿…é¡»è¦å†™ä¸‹é¢è¿™æ ·çš„ä»£ç </p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">const withExample = (Component) =&gt; &#123;</span><br><span class="line">  const NewComponent = (props) =&gt; &#123;</span><br><span class="line">    return &lt;Component &#123;...props&#125; /&gt;;</span><br><span class="line">  &#125;</span><br><span class="line">  </span><br><span class="line">  NewComponent.displayName = `withExample($&#123;Component.displayName || Component.name || &#x27;Component&#x27;&#125;)`;</span><br><span class="line">  </span><br><span class="line">  return NewCompoennt;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<p>æ¯ä¸ªé«˜é˜¶ç»„ä»¶éƒ½è¿™ä¹ˆå†™ï¼Œå°±ä¼šéå¸¸çš„éº»çƒ¦</p>
<p>å¯¹äº React ç”Ÿå‘½å‘¨æœŸå‡½æ•°ï¼Œé«˜é˜¶ç»„ä»¶ä¸ç”¨æ€ä¹ˆç‰¹æ®Šå¤„ç†ï¼Œä½†æ˜¯ï¼Œå¦‚æœå†…å±‚ç»„ä»¶åŒ…å«å®šåˆ¶çš„é™æ€å‡½æ•°ï¼Œè¿™äº›é™æ€å‡½æ•°çš„è°ƒç”¨åœ¨ React ç”Ÿå‘½å‘¨æœŸä¹‹å¤–ï¼Œé‚£ä¹ˆé«˜é˜¶ç»„ä»¶å°±å¿…é¡»è¦åœ¨æ–°äº§ç”Ÿçš„ç»„ä»¶ä¸­å¢åŠ è¿™äº›é™æ€å‡½æ•°çš„æ”¯æŒï¼Œè¿™æ›´åŠ éº»çƒ¦</p>
<blockquote>
<p>å…¶æ¬¡ï¼Œé«˜é˜¶ç»„ä»¶æ”¯æŒåµŒå¥—è°ƒç”¨ï¼Œè¿™æ˜¯å®ƒçš„ä¼˜åŠ¿ã€‚ä½†æ˜¯å¦‚æœçœŸçš„ä¸€å¤§é•¿ä¸²é«˜é˜¶ç»„ä»¶è¢«åº”ç”¨çš„è¯ï¼Œå½“ç»„ä»¶å‡ºé”™ï¼Œä½ çœ‹åˆ°çš„ä¼šæ˜¯ä¸€ä¸ªè¶…æ·±çš„ stack traceï¼Œååˆ†ç—›è‹¦</p>
</blockquote>
<blockquote>
<p>æœ€åï¼Œä½¿ç”¨é«˜é˜¶ç»„ä»¶ï¼Œä¸€å®šè¦éå¸¸å°å¿ƒï¼Œè¦é¿å…é‡å¤äº§ç”Ÿ React ç»„ä»¶ï¼Œæ¯”å¦‚ï¼Œä¸‹é¢çš„ä»£ç æ˜¯æœ‰é—®é¢˜çš„</p>
</blockquote>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">const Example = () =&gt; &#123;</span><br><span class="line">  const EnhancedFoo = withExample(Foo);</span><br><span class="line">  return &lt;EnhancedFoo /&gt;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>åƒä¸Šé¢è¿™æ ·å†™ï¼Œæ¯ä¸€æ¬¡æ¸²æŸ“ Exampleï¼Œéƒ½ä¼šç”¨é«˜é˜¶ç»„ä»¶äº§ç”Ÿä¸€ä¸ªæ–°çš„ç»„ä»¶ï¼Œè™½ç„¶éƒ½å«åš EnhancedFooï¼Œä½†æ˜¯å¯¹ React æ¥è¯´æ˜¯ä¸€ä¸ªå…¨æ–°çš„ä¸œè¥¿ï¼Œåœ¨é‡æ–°æ¸²æŸ“çš„æ—¶å€™ä¸ä¼šé‡ç”¨ä¹‹å‰çš„è™šæ‹Ÿ DOMï¼Œä¼šé€ æˆæå¤§çš„æµªè´¹</p>
<p>æ­£ç¡®çš„å†™æ³•æ˜¯ä¸‹é¢è¿™æ ·ï¼Œè‡ªå§‹è‡³ç»ˆåªæœ‰ä¸€ä¸ª EnhancedFoo ç»„ä»¶ç±»è¢«åˆ›å»º</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">const EnhancedFoo = withExample(Foo);</span><br><span class="line"></span><br><span class="line">const Example = () =&gt; &#123;</span><br><span class="line">  return &lt;EnhancedFoo /&gt;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="render-props-æ¨¡å¼"><a href="#render-props-æ¨¡å¼" class="headerlink" title="render props æ¨¡å¼"></a>render props æ¨¡å¼</h3><blockquote>
<p>æ‰€è°“ render propsï¼ŒæŒ‡çš„æ˜¯è®© React ç»„ä»¶çš„ props æ”¯æŒå‡½æ•°è¿™ç§æ¨¡å¼ã€‚å› ä¸ºä½œä¸º props ä¼ å…¥çš„å‡½æ•°å¾€å¾€è¢«ç”¨æ¥æ¸²æŸ“ä¸€éƒ¨åˆ†ç•Œé¢ï¼Œæ‰€ä»¥è¿™ç§æ¨¡å¼è¢«ç§°ä¸º render props</p>
</blockquote>
<p>ä¸€ä¸ªæœ€ç®€å•çš„ render props ç»„ä»¶ RenderAllï¼Œä»£ç å¦‚ä¸‹</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">const RenderAll = (props) =&gt; &#123;</span><br><span class="line">  return(</span><br><span class="line">     &lt;React.Fragment&gt;</span><br><span class="line">     	&#123;props.children(props)&#125;</span><br><span class="line">     &lt;/React.Fragment&gt;</span><br><span class="line">  );</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<blockquote>
<p>è¿™ä¸ª <code>RenderAll</code> é¢„æœŸå­ç»„ä»¶æ˜¯ä¸€ä¸ªå‡½æ•°ï¼Œå®ƒæ‰€åšçš„äº‹æƒ…å°±æ˜¯æŠŠå­ç»„ä»¶å½“åšå‡½æ•°è°ƒç”¨ï¼Œè°ƒç”¨å‚æ•°å°±æ˜¯ä¼ å…¥çš„ <code>props</code>ï¼Œç„¶åæŠŠè¿”å›ç»“æœæ¸²æŸ“å‡ºæ¥ï¼Œé™¤æ­¤ä¹‹å¤–ä»€ä¹ˆäº‹æƒ…éƒ½æ²¡æœ‰åš</p>
</blockquote>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&lt;RenderAll&gt;</span><br><span class="line">&#123;() =&gt; &lt;h1&gt;hello world&lt;/h1&gt;&#125;</span><br><span class="line">&lt;/RenderAll&gt;</span><br></pre></td></tr></table></figure>

<p>å¯ä»¥çœ‹åˆ°ï¼ŒRenderAll çš„å­ç»„ä»¶ï¼Œä¹Ÿå°±æ˜¯å¤¹åœ¨ RenderAll æ ‡ç­¾ä¹‹é—´çš„éƒ¨åˆ†ï¼Œå…¶å®æ˜¯ä¸€ä¸ªå‡½æ•°ã€‚è¿™ä¸ªå‡½æ•°æ¸²æŸ“å‡º <code>hello world</code>ï¼Œè¿™å°±æ˜¯ä¸Šé¢ä½¿ç”¨ RenderAll æ¸²æŸ“å‡ºæ¥çš„ç»“æœã€‚</p>
<p>å½“ç„¶ï¼Œè¿™ä¸ª RenderAll æ²¡åšä»»ä½•å®é™…å·¥ä½œï¼Œæ¥ä¸‹æ¥æˆ‘ä»¬çœ‹ render props çœŸæ­£å¼ºæ‚çš„ä½¿ç”¨æ–¹æ³•ã€‚</p>
<p><strong>ä¼ é€’ props</strong></p>
<blockquote>
<p>å’Œé«˜é˜¶ç»„ä»¶ä¸€æ ·ï¼Œrender props å¯ä»¥åšå¾ˆå¤šçš„å®šåˆ¶åŠŸèƒ½ï¼Œæˆ‘ä»¬è¿˜æ˜¯ä»¥æ ¹æ®æ˜¯å¦ç™»å½•çŠ¶æ€æ¥æ˜¾ç¤ºä¸€äº›ç•Œé¢å…ƒç´ ä¸ºä¾‹ï¼Œæ¥å®ç°ä¸€ä¸ª render props</p>
</blockquote>
<p>ä¸‹é¢æ˜¯å®ç° <code>render props</code> çš„ <code>Login</code> ç»„ä»¶ï¼Œå¯ä»¥çœ‹åˆ°ï¼Œ<code>render props</code> å’Œé«˜é˜¶ç»„ä»¶çš„ç¬¬ä¸€ä¸ªåŒºåˆ«ï¼Œå°±æ˜¯ <code>render props</code> æ˜¯çœŸæ­£çš„ <code>React</code> ç»„ä»¶ï¼Œè€Œä¸æ˜¯ä¸€ä¸ªè¿”å› React ç»„ä»¶çš„å‡½æ•°ã€‚</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">const Login = (props) =&gt; &#123;</span><br><span class="line">  const userName = getUserName();</span><br><span class="line"></span><br><span class="line">  if (userName) &#123;</span><br><span class="line">    const allProps = &#123;userName, ...props&#125;;</span><br><span class="line">    return (</span><br><span class="line">      &lt;React.Fragment&gt;</span><br><span class="line">        &#123;props.children(allProps)&#125;</span><br><span class="line">      &lt;/React.Fragment&gt;</span><br><span class="line">    );</span><br><span class="line">  &#125; else &#123;</span><br><span class="line">    return null;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<p>å½“ç”¨æˆ·å¤„äºç™»å½•çŠ¶æ€ï¼ŒgetUserName è¿”å›å½“å‰ç”¨æˆ·åï¼Œå¦åˆ™è¿”å›ç©ºï¼Œç„¶åæˆ‘ä»¬æ ¹æ®è¿™ä¸ªç»“æœå†³å®šæ˜¯å¦æ¸²æŸ“ props.children è¿”å›çš„ç»“æœã€‚</p>
<p>å½“ç„¶ï¼Œrender props å®Œå…¨å¯ä»¥å†³å®šå“ªäº› props å¯ä»¥ä¼ é€’ç»™ props.childrenï¼Œåœ¨ Login ä¸­ï¼Œæˆ‘ä»¬æŠŠ userName ä½œä¸ºå¢åŠ çš„ props ä¼ é€’ç»™ä¸‹å»ï¼Œè¿™æ ·å°±æ˜¯ Login çš„å¢å¼ºåŠŸèƒ½ã€‚</p>
<p>ä¸€ä¸ªä½¿ç”¨ä¸Šé¢ Login çš„ JSX ä»£ç ç¤ºä¾‹å¦‚ä¸‹</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&lt;Login&gt;</span><br><span class="line">&#123;(&#123;userName&#125;) =&gt; &lt;h1&gt;Hello &#123;userName&#125;&lt;/h1&gt;&#125;</span><br><span class="line">&lt;/Login&gt;</span><br></pre></td></tr></table></figure>

<p><strong>ä¸å±€é™äº children</strong></p>
<p>å®é™…ä¸Šï¼Œrender props è¿™ä¸ªæ¨¡å¼ä¸å¿…å±€é™äº children è¿™ä¸€ä¸ª propsï¼Œä»»ä½•ä¸€ä¸ª props éƒ½å¯ä»¥ä½œä¸ºå‡½æ•°ï¼Œä¹Ÿå¯ä»¥åˆ©ç”¨å¤šä¸ª props æ¥ä½œä¸ºå‡½æ•°ã€‚</p>
<p>æˆ‘ä»¬æ¥æ‰©å±• Loginï¼Œä¸å…‰åœ¨ç”¨æˆ·ç™»å½•æ—¶æ˜¾ç¤ºä¸€äº›ä¸œè¥¿ï¼Œä¹Ÿå¯ä»¥å®šåˆ¶ç”¨æˆ·æ²¡æœ‰ç™»å½•æ—¶æ˜¾ç¤ºçš„ä¸œè¥¿ï¼Œæˆ‘ä»¬æŠŠè¿™ä¸ªç»„ä»¶å«åš Authï¼Œå¯¹åº”ä»£ç å¦‚ä¸‹</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">const Auth= (props) =&gt; &#123;</span><br><span class="line">  const userName = getUserName();</span><br><span class="line"></span><br><span class="line">  if (userName) &#123;</span><br><span class="line">    const allProps = &#123;userName, ...props&#125;;</span><br><span class="line">    return (</span><br><span class="line">      &lt;React.Fragment&gt;</span><br><span class="line">        &#123;props.login(allProps)&#125;</span><br><span class="line">      &lt;/React.Fragment&gt;</span><br><span class="line">    );</span><br><span class="line">  &#125; else &#123;</span><br><span class="line">    &lt;React.Fragment&gt;</span><br><span class="line">      &#123;props.nologin(props)&#125;</span><br><span class="line">    &lt;/React.Fragment&gt;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<p>ä½¿ç”¨ Auth çš„è¯ï¼Œå¯ä»¥åˆ†åˆ«é€šè¿‡ login å’Œ nologin ä¸¤ä¸ª props æ¥æŒ‡å®šç”¨æˆ·ç™»å½•æˆ–è€…æ²¡ç™»å½•æ—¶æ˜¾ç¤ºä»€ä¹ˆï¼Œç”¨æ³•å¦‚ä¸‹</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&lt;Auth</span><br><span class="line">    login=&#123;(&#123;userName&#125;) =&gt; &lt;h1&gt;Hello &#123;userName&#125;&lt;/h1&gt;&#125;</span><br><span class="line">    nologin=&#123;() =&gt; &lt;h1&gt;Please login&lt;/h1&gt;&#125;</span><br><span class="line">/&gt;</span><br></pre></td></tr></table></figure>

<p><strong>ä¾èµ–æ³¨å…¥</strong></p>
<ul>
<li>render props å…¶å®å°±æ˜¯ React ä¸–ç•Œä¸­çš„â€œä¾èµ–æ³¨å…¥â€</li>
<li>æ‰€è°“ä¾èµ–æ³¨å…¥ï¼ŒæŒ‡çš„æ˜¯è§£å†³è¿™æ ·ä¸€ä¸ªé—®é¢˜ï¼šé€»è¾‘ A ä¾èµ–äºé€»è¾‘ Bï¼Œå¦‚æœè®© A ç›´æ¥ä¾èµ–äº Bï¼Œå½“ç„¶å¯è¡Œï¼Œä½†æ˜¯ A å°±æ²¡æ³•åšå¾—é€šç”¨äº†ã€‚ä¾èµ–æ³¨å…¥å°±æ˜¯æŠŠ B çš„é€»è¾‘ä»¥å‡½æ•°å½¢å¼ä¼ é€’ç»™ Aï¼ŒA å’Œ B ä¹‹é—´åªéœ€è¦å¯¹è¿™ä¸ªå‡½æ•°æ¥å£è¾¾æˆä¸€è‡´å°±è¡Œï¼Œå¦‚æ­¤ä¸€æ¥ï¼Œå†æ¥ä¸€ä¸ªé€»è¾‘ Cï¼Œä¹Ÿå¯ä»¥ç”¨ä¸€æ ·çš„æ–¹æ³•é‡ç”¨é€»è¾‘ A</li>
<li>åœ¨ä¸Šé¢çš„ä»£ç ç¤ºä¾‹ä¸­ï¼ŒLogin å’Œ Auth ç»„ä»¶å°±æ˜¯ä¸Šé¢æ‰€è¯´çš„é€»è¾‘ Aï¼Œè€Œä¼ é€’ç»™ç»„ä»¶çš„å‡½æ•°ç±»å‹ propsï¼Œå°±æ˜¯é€»è¾‘ B å’Œ C</li>
</ul>
<p><strong>render props å’Œé«˜é˜¶ç»„ä»¶çš„æ¯”è¾ƒ</strong></p>
<ul>
<li>é¦–å…ˆï¼Œrender props æ¨¡å¼çš„åº”ç”¨ï¼Œå°±æ˜¯åšä¸€ä¸ª React ç»„ä»¶ï¼Œè€Œé«˜é˜¶ç»„ä»¶ï¼Œè™½ç„¶åä¸ºâ€œç»„ä»¶â€ï¼Œå…¶å®åªæ˜¯ä¸€ä¸ªäº§ç”Ÿ React ç»„ä»¶çš„å‡½æ•°</li>
<li>render props ç›¸å¯¹äºé«˜é˜¶ç»„ä»¶è¿˜æœ‰ä¸€ä¸ªæ˜¾è‘—ä¼˜åŠ¿ï¼Œå°±æ˜¯å¯¹äºæ–°å¢çš„ props æ›´åŠ çµæ´»ã€‚è¿˜æ˜¯ä»¥ç™»å½•çŠ¶æ€ä¸ºä¾‹ï¼Œå‡å¦‚æˆ‘ä»¬æ‰©å±• withLogin çš„åŠŸèƒ½ï¼Œè®©å®ƒç»™è¢«åŒ…è£¹çš„ç»„ä»¶ä¼ é€’ç”¨æˆ·åè¿™ä¸ª propsï¼Œä»£ç å¦‚</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">const withLogin = (Component) =&gt; &#123;</span><br><span class="line">  const NewComponent = (props) =&gt; &#123;</span><br><span class="line">    const userName= getUserName();</span><br><span class="line">    if (userName) &#123;</span><br><span class="line">      return &lt;Component &#123;...props&#125; userName=&#123;userName&#125;/&gt;;</span><br><span class="line">    &#125; else &#123;</span><br><span class="line">      return null;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  return NewComponent;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<p>è¿™å°±è¦æ±‚è¢« withLogin åŒ…ä½çš„ç»„ä»¶è¦æ¥å— userName è¿™ä¸ªpropsã€‚å¯æ˜¯ï¼Œå‡å¦‚æœ‰ä¸€ä¸ªç°æˆçš„ React ç»„ä»¶ä¸æ¥å— userNameï¼Œå´æ¥å—åä¸º name çš„ props ä½œä¸ºç”¨æˆ·åï¼Œè¿™å°±éº»çƒ¦äº†ã€‚æˆ‘ä»¬å°±ä¸èƒ½ç›´æ¥ç”¨ withLogin åŒ…ä½è¿™ä¸ª React ç»„ä»¶ï¼Œè¿˜è¦å†é€ ä¸€ä¸ªç»„ä»¶æ¥åš userName åˆ° name çš„æ˜ å°„ï¼Œååˆ†è´¹äº‹</p>
<p>å¯¹äºåº”ç”¨ render props çš„ Loginï¼Œå°±ä¸å­˜åœ¨è¿™ä¸ªé—®é¢˜ï¼Œæ¥å— name ä¸æ¥å— userName æ˜¯å—ï¼Ÿè¿™æ ·å†™å°±å¥½äº†ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">&lt;Login&gt;</span><br><span class="line">  &#123;</span><br><span class="line">    (props) =&gt; &#123;</span><br><span class="line">      const &#123;userName&#125; = props;</span><br><span class="line">      return &lt;TheComponent &#123;...props&#125; name=&#123;userName&#125; /&gt;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&lt;/Login&gt;</span><br></pre></td></tr></table></figure>

<blockquote>
<p>æ‰€ä»¥ï¼Œå½“éœ€è¦é‡ç”¨ React ç»„ä»¶çš„é€»è¾‘æ—¶ï¼Œå»ºè®®é¦–å…ˆçœ‹è¿™ä¸ªåŠŸèƒ½æ˜¯å¦å¯ä»¥æŠ½è±¡ä¸ºä¸€ä¸ªç®€å•çš„ç»„ä»¶ï¼›å¦‚æœè¡Œä¸é€šçš„è¯ï¼Œè€ƒè™‘æ˜¯å¦å¯ä»¥åº”ç”¨ render props æ¨¡å¼ï¼›å†ä¸è¡Œçš„è¯ï¼Œæ‰è€ƒè™‘åº”ç”¨é«˜é˜¶ç»„ä»¶æ¨¡å¼ã€‚<br>è¿™å¹¶ä¸è¡¨ç¤ºé«˜é˜¶ç»„ä»¶æ— ç”¨æ­¦ä¹‹åœ°ï¼Œåœ¨åç»­ç« èŠ‚ï¼Œæˆ‘ä»¬ä¼šå¯¹ render props å’Œé«˜é˜¶ç»„ä»¶åˆ†åˆ«è®²è§£å…·ä½“çš„å®ä¾‹</p>
</blockquote>
<h3 id="2-2-æä¾›è€…æ¨¡å¼"><a href="#2-2-æä¾›è€…æ¨¡å¼" class="headerlink" title="2.2 æä¾›è€…æ¨¡å¼"></a>2.2 æä¾›è€…æ¨¡å¼</h3><p><strong>é—®é¢˜åœºæ™¯</strong></p>
<blockquote>
<p>åœ¨ React ä¸­ï¼Œprops æ˜¯ç»„ä»¶ä¹‹é—´é€šè®¯çš„ä¸»è¦æ‰‹æ®µï¼Œä½†æ˜¯ï¼Œæœ‰ä¸€ç§åœºæ™¯å•çº¯é  props æ¥é€šè®¯æ˜¯ä¸æ°å½“çš„ï¼Œé‚£å°±æ˜¯ä¸¤ä¸ªç»„ä»¶ä¹‹é—´é—´éš”ç€å¤šå±‚å…¶ä»–ç»„ä»¶ï¼Œä¸‹é¢æ˜¯ä¸€ä¸ªç®€å•çš„ç»„ä»¶æ ‘ç¤ºä¾‹å›¾å›¾</p>
</blockquote>
<p><img src="https://user-gold-cdn.xitu.io/2018/9/30/16627df7e8c08232" alt="img"></p>
<p>åœ¨ä¸Šå›¾ä¸­ï¼Œç»„ä»¶ A éœ€è¦ä¼ é€’ä¿¡æ¯ç»™ç»„ä»¶ Xï¼Œå¦‚æœé€šè¿‡ props çš„è¯ï¼Œé‚£ä¹ˆä»é¡¶éƒ¨çš„ç»„ä»¶ A å¼€å§‹ï¼Œè¦æŠŠ props ä¼ é€’ç»™ç»„ä»¶ Bï¼Œç„¶åç»„ä»¶ B ä¼ é€’ç»™ç»„ä»¶ Dï¼Œæœ€åç»„ä»¶ D å†ä¼ é€’ç»™ç»„ä»¶ Xã€‚</p>
<p>å…¶å®ç»„ä»¶ B å’Œç»„ä»¶ D å®Œå…¨ç”¨ä¸ä¸Šè¿™äº› propsï¼Œä½†æ˜¯åˆè¢«è¿«ä¼ é€’è¿™äº› propsï¼Œè¿™æ˜æ˜¾ä¸åˆç†ï¼Œè¦çŸ¥é“ç»„ä»¶æ ‘çš„ç»“æ„ä¼šå˜åŒ–çš„ï¼Œå°†æ¥å¦‚æœç»„ä»¶ B å’Œç»„ä»¶ D ä¹‹é—´å†æ’å…¥ä¸€å±‚æ–°çš„ç»„ä»¶ï¼Œè¿™ä¸ªç»„ä»¶ä¹Ÿéœ€è¦ä¼ é€’è¿™ä¸ª propsï¼Œè¿™å°±éº»çƒ¦æ— æ¯”ã€‚</p>
<p>å¯è§ï¼Œå¯¹äºè·¨çº§çš„ä¿¡æ¯ä¼ é€’ï¼Œæˆ‘ä»¬éœ€è¦ä¸€ä¸ªæ›´å¥½çš„æ–¹æ³•ã€‚</p>
<p>åœ¨ React ä¸­ï¼Œè§£å†³è¿™ä¸ªé—®é¢˜åº”ç”¨çš„å°±æ˜¯â€œæä¾›è€…æ¨¡å¼â€</p>
<p><strong>æä¾›è€…æ¨¡å¼</strong></p>
<ul>
<li>è™½ç„¶è¿™ä¸ªæ¨¡å¼å«åšâ€œæä¾›è€…æ¨¡å¼â€ï¼Œä½†æ˜¯å…¶å®æœ‰ä¸¤ä¸ªè§’è‰²ï¼Œä¸€ä¸ªå«â€œæä¾›è€…â€ï¼ˆProviderï¼‰ï¼Œå¦ä¸€ä¸ªå«â€œæ¶ˆè´¹è€…â€ï¼ˆConsumerï¼‰ï¼Œè¿™ä¸¤ä¸ªè§’è‰²éƒ½æ˜¯ React ç»„ä»¶ã€‚å…¶ä¸­â€œæä¾›è€…â€åœ¨ç»„ä»¶æ ‘ä¸Šå±…äºæ¯”è¾ƒé ä¸Šçš„ä½ç½®ï¼Œâ€œæ¶ˆè´¹è€…â€å¤„äºé ä¸‹çš„ä½ç½®ã€‚åœ¨ä¸Šé¢çš„ç»„ä»¶æ ‘ä¸­ï¼Œç»„ä»¶ A å¯ä»¥ä½œä¸ºæä¾›è€…ï¼Œç»„ä»¶ X å°±æ˜¯æ¶ˆè´¹è€…</li>
<li>æ—¢ç„¶åä¸ºâ€œæä¾›è€…â€ï¼Œå®ƒå¯ä»¥æä¾›ä¸€äº›ä¿¡æ¯ï¼Œè€Œä¸”è¿™äº›ä¿¡æ¯åœ¨å®ƒä¹‹ä¸‹çš„æ‰€æœ‰ç»„ä»¶ï¼Œæ— è®ºéš”äº†å¤šå°‘å±‚ï¼Œéƒ½å¯ä»¥ç›´æ¥è®¿é—®åˆ°ï¼Œè€Œä¸éœ€è¦é€šè¿‡ props å±‚å±‚ä¼ é€’ã€‚</li>
<li>é¿å… <code>props</code> é€çº§ä¼ é€’ï¼Œå³æ˜¯æä¾›è€…çš„ç”¨é€”ã€‚</li>
</ul>
<p><strong>å¦‚ä½•å®ç°æä¾›è€…æ¨¡å¼</strong></p>
<ul>
<li>å®ç°æä¾›è€…æ¨¡å¼ï¼Œéœ€è¦ React çš„ Context åŠŸèƒ½ï¼Œå¯ä»¥è¯´ï¼Œæä¾›è€…æ¨¡å¼åªä¸è¿‡æ˜¯è®© Context åŠŸèƒ½æ›´å¥½ç”¨ä¸€äº›è€Œå·²</li>
<li>æ‰€è°“ Context åŠŸèƒ½ï¼Œå°±æ˜¯èƒ½å¤Ÿåˆ›é€ ä¸€ä¸ªâ€œä¸Šä¸‹æ–‡â€ï¼Œåœ¨è¿™ä¸ªä¸Šä¸‹æ–‡ç¬¼ç½©ä¹‹ä¸‹çš„æ‰€æœ‰ç»„ä»¶éƒ½å¯ä»¥è®¿é—®åŒæ ·çš„æ•°æ®</li>
<li>åœ¨ React v16.3.0 ä¹‹å‰ï¼ŒReact è™½ç„¶æä¾›äº† Context åŠŸèƒ½ï¼Œä½†æ˜¯å®˜æ–¹æ–‡æ¡£ä¸Šéƒ½å»ºè®®å°½é‡ä¸è¦ä½¿ç”¨ï¼Œå› ä¸ºå¯¹åº”çš„ API ä»–ä»¬å¹¶ä¸æ»¡æ„ï¼Œè§‰å¾—è¿Ÿæ—©è¦åºŸå¼ƒæ‰ã€‚å³ä½¿å¦‚æ­¤ï¼Œä¾ç„¶æœ‰å¾ˆå¤šåº“å’Œåº”ç”¨ä½¿ç”¨ Context åŠŸèƒ½ï¼Œå¯è§å¯¹è¿™ä¸ªéœ€æ±‚çš„å‘¼å£°æœ‰å¤šå¤§</li>
<li>å½“ React å‘å¸ƒ v16.3.0 æ—¶ï¼Œç»ˆäºæä¾›äº†â€œæ­£å¼ç‰ˆæœ¬â€çš„ Context åŠŸèƒ½ APIï¼Œå’Œä¹‹å‰çš„æœ‰å¾ˆå¤§ä¸åŒï¼Œ</li>
<li>æä¾›è€…æ¨¡å¼çš„ä¸€ä¸ªå…¸å‹ç”¨ä¾‹å°±æ˜¯å®ç°â€œæ ·å¼ä¸»é¢˜â€ï¼ˆThemeï¼‰ï¼Œç”±é¡¶å±‚çš„æä¾›è€…ç¡®å®šä¸€ä¸ªä¸»é¢˜ï¼Œä¸‹é¢çš„æ ·å¼å°±å¯ä»¥ç›´æ¥ä½¿ç”¨å¯¹åº”ä¸»é¢˜é‡Œçš„æ ·å¼ã€‚è¿™æ ·ï¼Œå½“éœ€è¦åˆ‡æ¢æ ·å¼æ—¶ï¼Œåªéœ€è¦ä¿®æ”¹æä¾›è€…å°±è¡Œï¼Œå…¶ä»–ç»„ä»¶ä¸ç”¨ä¿®æ”¹ã€‚</li>
</ul>
<blockquote>
<p>ä¸ºäº†æ–¹ä¾¿æ¯”å¯¹ï¼Œè¿™é‡Œä¼šä»‹ç»æä¾›è€…æ¨¡å¼ç”¨ä¸åŒ Context API çš„å®ç°æ–¹æ³•ã€‚ä¸è¿‡ï¼Œä½ å¦‚æœå®Œå…¨ä¸åœ¨æ„è€ç‰ˆæœ¬ React å¦‚ä½•å®ç°çš„ï¼Œå¯ä»¥ç•¥è¿‡ä¸‹é¢ä¸€æ®µã€‚</p>
</blockquote>
<p><strong>React v16.3.0 ä¹‹å‰çš„æä¾›è€…æ¨¡å¼</strong></p>
<blockquote>
<p>åœ¨ React v16.3.0 ä¹‹å‰ï¼Œè¦å®ç°æä¾›è€…ï¼Œå°±è¦å®ç°ä¸€ä¸ª React ç»„ä»¶ï¼Œä¸è¿‡è¿™ä¸ªç»„ä»¶è¦åšä¸¤ä¸ªç‰¹æ®Šå¤„ç†</p>
</blockquote>
<ul>
<li>éœ€è¦å®ç° getChildContext æ–¹æ³•ï¼Œç”¨äºè¿”å›â€œä¸Šä¸‹æ–‡â€çš„æ•°æ®</li>
<li>éœ€è¦å®šä¹‰ childContextTypes å±æ€§ï¼Œå£°æ˜â€œä¸Šä¸‹æ–‡â€çš„ç»“æ„ã€‚</li>
</ul>
<p>ä¸‹é¢å°±æ˜¯ä¸€ä¸ªå®ç°â€œæä¾›è€…â€çš„ä¾‹å­ï¼Œç»„ä»¶åä¸º ThemeProviderï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">class ThemeProvider extends React.Component &#123;</span><br><span class="line">  getChildContext() &#123;</span><br><span class="line">    return &#123;</span><br><span class="line">      theme: this.props.value</span><br><span class="line">    &#125;;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  render() &#123;</span><br><span class="line">    return (</span><br><span class="line">      &lt;React.Fragment&gt;</span><br><span class="line">        &#123;this.props.children&#125;</span><br><span class="line">      &lt;/React.Fragment&gt;</span><br><span class="line">    );</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">ThemeProvider.childContextTypes = &#123;</span><br><span class="line">  theme: PropTypes.object</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<p>åœ¨ä¸Šé¢çš„ä¾‹å­ä¸­ï¼ŒgetChildContext åªæ˜¯ç®€å•è¿”å›åä¸º value çš„ props å€¼ï¼Œä½†æ˜¯ï¼Œå› ä¸º getChildContext æ˜¯ä¸€ä¸ªå‡½æ•°ï¼Œå®ƒå¯ä»¥æœ‰æ›´åŠ å¤æ‚çš„æ“ä½œï¼Œæ¯”å¦‚å¯ä»¥ä» state æˆ–è€…å…¶ä»–æ•°æ®æºè·å¾—æ•°æ®ã€‚</p>
<p>å¯¹äº ThemeProviderï¼Œæˆ‘ä»¬åˆ›é€ äº†ä¸€ä¸ªä¸Šä¸‹æ–‡ï¼Œè¿™ä¸ªä¸Šä¸‹æ–‡å°±æ˜¯ä¸€ä¸ªå¯¹è±¡ï¼Œç»“æ„æ˜¯è¿™æ ·</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  theme: &#123;</span><br><span class="line">    //ä¸€ä¸ªå¯¹è±¡</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬æ¥åšä¸¤ä¸ªæ¶ˆè´¹ï¼ˆä¹Ÿå°±æ˜¯ä½¿ç”¨ï¼‰è¿™ä¸ªâ€œä¸Šä¸‹æ–‡â€çš„ç»„ä»¶ï¼Œç¬¬ä¸€ä¸ªæ˜¯ Subjectï¼Œä»£è¡¨æ ‡é¢˜ï¼›ç¬¬äºŒä¸ªæ˜¯ Paragraphï¼Œä»£è¡¨ç« èŠ‚ã€‚</p>
<p>æˆ‘ä»¬æŠŠ Subject å®ç°ä¸ºä¸€ä¸ªç±»ï¼Œä»£ç å¦‚ä¸‹</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">class Subject extends React.Component &#123;</span><br><span class="line">  render() &#123;</span><br><span class="line">    const &#123;mainColor&#125; = this.context.theme;</span><br><span class="line">    return (</span><br><span class="line">      &lt;h1 style=&#123;&#123;color: mainColor&#125;&#125;&gt;</span><br><span class="line">        &#123;this.props.children&#125;</span><br><span class="line">      &lt;/h1&gt;</span><br><span class="line">    );</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">Subject.contextTypes = &#123;</span><br><span class="line">  theme: PropTypes.object</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>åœ¨ Subject çš„ render å‡½æ•°ä¸­ï¼Œå¯ä»¥é€šè¿‡ this.context è®¿é—®åˆ°â€œä¸Šä¸‹æ–‡â€æ•°æ®ï¼Œå› ä¸º ThemeProvider æä¾›çš„â€œä¸Šä¸‹æ–‡â€åŒ…å« theme å­—æ®µï¼Œæ‰€ä»¥å¯ä»¥ç›´æ¥è®¿é—® this.context.themeã€‚</p>
<p>åƒä¸‡ä¸è¦å¿˜äº† Subject å¿…é¡»å¢åŠ  contextTypes å±æ€§ï¼Œå¿…é¡»å’Œ ThemeProvider çš„ childContextTypes å±æ€§ä¸€è‡´ï¼Œä¸ç„¶ï¼Œthis.context å°±ä¸ä¼šå¾—åˆ°ä»»ä½•å€¼ã€‚</p>
<p>è¯»è€…å¯èƒ½ä¼šé—®äº†ï¼Œä¸ºä»€ä¹ˆè¿™ä¹ˆéº»çƒ¦å‘¢ï¼Ÿä¸ºä»€ä¹ˆè¦æ±‚â€œæä¾›è€…â€ç”¨ childContextTypes å®šä¹‰ä¸€æ¬¡ä¸Šä¸‹æ–‡ç»“æ„ï¼Œåˆè¦æ±‚â€œæ¶ˆè´¹è€…â€å†ç”¨ contextTypes å†é‡å¤å®šä¹‰ä¸€æ¬¡å‘¢ï¼Ÿè¿™ä¸æ˜¯å¾ˆæµªè´¹å—ï¼Ÿ</p>
<p>React è¿™ä¹ˆè¦æ±‚ï¼Œæ˜¯è€ƒè™‘åˆ°â€œä¸Šä¸‹æ–‡â€å¯èƒ½ä¼šåµŒå¥—ï¼Œå°±æ˜¯ä¸€ä¸ªâ€œæä¾›è€…â€å¥—ç€å¦ä¸€ä¸ªâ€œæä¾›è€…â€ï¼Œè¿™æ—¶å€™ï¼Œåº•å±‚çš„æ¶ˆè´¹è€…ç»„ä»¶åˆ°åº•æ¶ˆè´¹å“ªä¸€ä¸ªâ€œæä¾›è€…â€å‘¢ï¼Ÿé€šè¿‡è¿™ç§æ˜¾ç¤ºçš„æ–¹å¼æŒ‡å®šã€‚</p>
<p>ä¸è¿‡ï¼Œå®è¯å®è¯´ï¼Œè¿™æ ·çš„ API è®¾è®¡çš„ç¡®éº»çƒ¦äº†ä¸€ç‚¹ï¼Œéš¾æ€ª React å®˜æ–¹åœ¨æœ€åˆå°±ä¸å»ºè®®ä½¿ç”¨ã€‚</p>
<p>ä¸Šé¢çš„ Subject æ˜¯ä¸€ä¸ªç±»ï¼Œå…¶å®ä¹Ÿå¯ä»¥æŠŠæ¶ˆè´¹è€…å®ç°ä¸ºä¸€ä¸ªçº¯å‡½æ•°ç»„ä»¶ï¼Œåªä¸è¿‡è®¿é—®â€œä¸Šä¸‹æ–‡â€çš„æ–¹å¼æœ‰äº›ä¸åŒï¼Œæˆ‘ä»¬ç”¨çº¯å‡½æ•°çš„æ–¹å¼å®ç°å¦ä¸€ä¸ªæ¶ˆè´¹è€… Paragraphï¼Œä»£ç å¦‚ä¸‹ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">const Paragraph = (props, context) =&gt; &#123;</span><br><span class="line">  const &#123;textColor&#125; = context.theme;</span><br><span class="line">  return (</span><br><span class="line">    &lt;p style=&#123;&#123;color: textColor&#125;&#125;&gt;</span><br><span class="line">      &#123;props.children&#125;</span><br><span class="line">    &lt;/p&gt;</span><br><span class="line">  );</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">Paragraph.contextTypes = &#123;</span><br><span class="line">  theme: PropTypes.object</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<p>ä»ä¸Šé¢çš„ä»£ç å¯ä»¥çœ‹åˆ°ï¼Œå› ä¸º Paragraph æ˜¯ä¸€ä¸ªå‡½æ•°å½¢å¼ï¼Œæ‰€ä»¥ä¸å¯èƒ½è®¿é—® this.contextï¼Œä½†æ˜¯å‡½æ•°çš„ç¬¬äºŒä¸ªå‚æ•°å…¶å®å°±æ˜¯ contextã€‚</p>
<p>å½“ç„¶ï¼Œä¹Ÿä¸è¦å¿˜äº†è®¾å®š Paragraph çš„ contextTypesï¼Œä¸ç„¶å‚æ•° context ä¹Ÿä¸ä¼šæ˜¯ä¸Šä¸‹æ–‡ã€‚</p>
<p>æœ€åï¼Œæˆ‘ä»¬çœ‹å¦‚ä½•ç»“åˆâ€æä¾›è€…â€œå’Œâ€æ¶ˆè´¹è€…â€œã€‚</p>
<p>æˆ‘ä»¬åšä¸€ä¸ªç»„ä»¶æ¥ä½¿ç”¨ Subject å’Œ Paragraphï¼Œè¿™ä¸ªç»„ä»¶ä¸éœ€è¦å¸®åŠ©ä¼ é€’ä»»ä½• propsï¼Œä»£ç å¦‚ä¸‹ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">const Page = () =&gt; (</span><br><span class="line">  &lt;div&gt;</span><br><span class="line">    &lt;Subject&gt;è¿™æ˜¯æ ‡é¢˜&lt;/Subject&gt;</span><br><span class="line">    &lt;Paragraph&gt;</span><br><span class="line">      è¿™æ˜¯æ­£æ–‡</span><br><span class="line">    &lt;/Paragraph&gt;</span><br><span class="line">  &lt;/div&gt;</span><br><span class="line">);</span><br></pre></td></tr></table></figure>

<p>ä¸Šé¢çš„ç»„ä»¶ Page ä½¿ç”¨äº† Subject å’Œ Paragraphï¼Œç°åœ¨æˆ‘ä»¬æƒ³è¦å®šåˆ¶æ ·å¼ä¸»é¢˜ï¼Œåªéœ€è¦åœ¨ Page æˆ–è€…ä»»ä½•éœ€è¦åº”ç”¨è¿™ä¸ªä¸»é¢˜çš„ç»„ä»¶å¤–é¢åŒ…ä¸Š ThemeProviderï¼Œå¯¹åº”çš„ JSX ä»£ç å¦‚ä¸‹ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&lt;ThemeProvider value=&#123;&#123;mainColor: &#x27;green&#x27;, textColor: &#x27;red&#x27;&#125;&#125; &gt;</span><br><span class="line">  &lt;Page /&gt;</span><br><span class="line">&lt;/ThemeProvider&gt;</span><br></pre></td></tr></table></figure>

<p>å½“æˆ‘ä»¬éœ€è¦æ”¹å˜ä¸€ä¸ªæ ·å¼ä¸»é¢˜çš„æ—¶å€™ï¼Œæ”¹å˜ä¼ ç»™ ThemeProviderçš„ value å€¼å°±æå®šäº†</p>
<p><strong>React v16.3.0 ä¹‹åçš„æä¾›è€…æ¨¡å¼</strong></p>
<ul>
<li>åˆ°äº† React v16.3.0 çš„æ—¶å€™ï¼Œæ–°çš„ Context API å‡ºæ¥äº†ï¼Œè¿™å¥— API æ¯«ä¸æ©é¥°è‡ªå·±å°±æ˜¯â€œæä¾›è€…æ¨¡å¼â€çš„å®ç°ï¼Œå‘½åä¸Šå°±å¸¦ â€œProviderâ€ å’Œ â€œConsumerâ€ã€‚</li>
<li>è¿˜æ˜¯ä¸Šé¢çš„æ ·å¼ä¸»é¢˜çš„ä¾‹å­ï¼Œé¦–å…ˆï¼Œè¦ç”¨æ–°æä¾›çš„ createContext å‡½æ•°åˆ›é€ ä¸€ä¸ªâ€œä¸Šä¸‹æ–‡â€å¯¹è±¡</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">const ThemeContext = React.createContext();</span><br></pre></td></tr></table></figure>

<p>è¿™ä¸ªâ€œä¸Šä¸‹æ–‡â€å¯¹è±¡ ThemeContext æœ‰ä¸¤ä¸ªå±æ€§ï¼Œåˆ†åˆ«å°±æ˜¯â€”â€”å¯¹ï¼Œä½ æ²¡çŒœé”™â€”â€”Provider å’Œ Consumerã€‚</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">const ThemeProvider = ThemeContext.Provider;</span><br><span class="line">const ThemeConsumer = ThemeContext.Consumer;</span><br></pre></td></tr></table></figure>

<p>åˆ›é€ â€œæä¾›è€…â€æå¤§ç®€åŒ–äº†ï¼Œéƒ½ä¸éœ€è¦æˆ‘ä»¬åˆ›é€ ä¸€ä¸ª React ç»„ä»¶ç±»ã€‚</p>
<p>ä½¿ç”¨â€œæ¶ˆè´¹è€…â€ä¹ŸåŒæ ·ç®€å•ï¼Œè€Œä¸”åº”ç”¨äº†ä¸Šä¸€èŠ‚æˆ‘ä»¬ä»‹ç»çš„ render props æ¨¡å¼ï¼Œæ¯”å¦‚ï¼ŒSubject çš„ä»£ç å¦‚ä¸‹:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">class Subject extends React.Component &#123;</span><br><span class="line">  render() &#123;</span><br><span class="line">    return (</span><br><span class="line">      &lt;ThemeConsumer&gt;</span><br><span class="line">        &#123;</span><br><span class="line">          (theme) =&gt; (</span><br><span class="line">            &lt;h1 style=&#123;&#123;color: theme.mainColor&#125;&#125;&gt;</span><br><span class="line">              &#123;this.props.children&#125;</span><br><span class="line">            &lt;/h1&gt;</span><br><span class="line">          )</span><br><span class="line">        &#125;</span><br><span class="line">      &lt;/ThemeConsumer&gt;</span><br><span class="line">    );</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>ä¸Šé¢çš„ ThemeConsumer å…¶å®å°±æ˜¯ä¸€ä¸ªåº”ç”¨äº† render props æ¨¡å¼çš„ç»„ä»¶ï¼Œå®ƒè¦æ±‚å­ç»„ä»¶æ˜¯ä¸€ä¸ªå‡½æ•°ï¼Œä¼šæŠŠâ€œä¸Šä¸‹æ–‡â€çš„æ•°æ®ä½œä¸ºå‚æ•°ä¼ é€’ç»™è¿™ä¸ªå‡½æ•°ï¼Œè€Œè¿™ä¸ªå‡½æ•°é‡Œå°±å¯ä»¥é€šè¿‡å‚æ•°è®¿é—®â€œä¸Šä¸‹æ–‡â€å¯¹è±¡ã€‚</p>
<p>åœ¨æ–°çš„ API é‡Œï¼Œä¸éœ€è¦è®¾å®šç»„ä»¶çš„ childContextTypes æˆ–è€… contextTypes å±æ€§ï¼Œè¿™çœäº†ä¸å°‘äº‹ã€‚</p>
<p>å¯ä»¥æ³¨æ„åˆ°ï¼ŒSubject æ²¡æœ‰è‡ªå·±çš„çŠ¶æ€ï¼Œæ²¡å¿…è¦å®ç°ä¸ºç±»ï¼Œæˆ‘ä»¬ç”¨çº¯å‡½æ•°çš„å½¢å¼å®ç° Paragraphï¼Œä»£ç å¦‚ä¸‹ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">const Paragraph = (props, context) =&gt; &#123;</span><br><span class="line">  return (</span><br><span class="line">    &lt;ThemeConsumer&gt;</span><br><span class="line">      &#123;</span><br><span class="line">        (theme) =&gt; (</span><br><span class="line">          &lt;p style=&#123;&#123;color: theme.textColor&#125;&#125;&gt;</span><br><span class="line">            &#123;props.children&#125;</span><br><span class="line">          &lt;/p&gt;</span><br><span class="line">          )</span><br><span class="line">      &#125;</span><br><span class="line">    &lt;/ThemeConsumer&gt;</span><br><span class="line">  );</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<p>å®ç° Page çš„æ–¹å¼å¹¶æ²¡æœ‰å˜åŒ–ï¼Œè€Œåº”ç”¨ ThemeProvider çš„ä»£ç å’Œä¹‹å‰ä¹Ÿå®Œå…¨ä¸€æ ·</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&lt;ThemeProvider value=&#123;&#123;mainColor: &#x27;green&#x27;, textColor: &#x27;red&#x27;&#125;&#125; &gt;</span><br><span class="line">  &lt;Page /&gt;</span><br><span class="line">&lt;/ThemeProvider&gt;</span><br></pre></td></tr></table></figure>

<p><strong>ä¸¤ç§æä¾›è€…æ¨¡å¼å®ç°æ–¹å¼çš„æ¯”è¾ƒ</strong></p>
<ul>
<li>é€šè¿‡ä¸Šé¢çš„ä»£ç ï¼Œå¯ä»¥å¾ˆæ¸…æ¥šåœ°çœ‹åˆ°ï¼Œæ–°çš„ Context API æ›´ç®€æ´ï¼Œä½†æ˜¯ï¼Œä¹Ÿå¹¶ä¸æ˜¯åå…¨åç¾ã€‚</li>
<li>åœ¨è€ç‰ˆ Context API ä¸­ï¼Œâ€œä¸Šä¸‹æ–‡â€åªæ˜¯ä¸€ä¸ªæ¦‚å¿µï¼Œå¹¶ä¸å¯¹åº”ä¸€ä¸ªä»£ç ï¼Œä¸¤ä¸ªç»„ä»¶ä¹‹é—´è¾¾æˆä¸€ä¸ªåè®®ï¼Œå°±è¯ç”Ÿäº†â€œä¸Šä¸‹æ–‡â€ã€‚</li>
<li>åœ¨æ–°ç‰ˆ Context API ä¸­ï¼Œéœ€è¦ä¸€ä¸ªâ€œä¸Šä¸‹æ–‡â€å¯¹è±¡ï¼ˆä¸Šé¢çš„ä¾‹å­ä¸­å°±æ˜¯ ThemeContext)ï¼Œä½¿ç”¨â€œæä¾›è€…â€çš„ä»£ç å’Œâ€œæ¶ˆè´¹è€…â€çš„ä»£ç å¾€å¾€åˆ†å¸ƒåœ¨ä¸åŒçš„ä»£ç æ–‡ä»¶ä¸­ï¼Œé‚£ä¹ˆï¼Œè¿™ä¸ª ThemeContext å¯¹è±¡æ”¾åœ¨å“ªä¸ªä»£ç æ–‡ä»¶ä¸­å‘¢ï¼Ÿ</li>
<li>æœ€å¥½æ˜¯æ”¾åœ¨ä¸€ä¸ªç‹¬ç«‹çš„æ–‡ä»¶ä¸­ï¼Œè¿™ä¹ˆä¸€æ¥ï¼Œå°±å¤šå‡ºä¸€ä¸ªä»£ç æ–‡ä»¶ï¼Œè€Œä¸”æ‰€æœ‰å’Œè¿™ä¸ªâ€œä¸Šä¸‹æ–‡â€ç›¸å…³çš„ä»£ç ï¼Œéƒ½è¦ä¾èµ–äºè¿™ä¸ªâ€œä¸Šä¸‹æ–‡â€ä»£ç æ–‡ä»¶ï¼Œè™½ç„¶è¿™æ²¡ä»€ä¹ˆå¤§ä¸äº†çš„ï¼Œä½†æ˜¯çš„ç¡®å¤šäº†ä¸€å±‚ä¾èµ–å…³ç³»ã€‚</li>
<li>ä¸ºäº†é¿å…ä¾èµ–å…³ç³»å¤æ‚ï¼Œæ¯ä¸ªåº”ç”¨éƒ½ä¸è¦æ»¥ç”¨â€œä¸Šä¸‹æ–‡â€ï¼Œåº”è¯¥é™åˆ¶â€œä¸Šä¸‹æ–‡â€çš„ä½¿ç”¨ä¸ªæ•°ã€‚</li>
<li>ä¸ç®¡æ€ä¹ˆè¯´ï¼Œæ–°ç‰ˆæœ¬çš„ Context API æ‰æ˜¯æœªæ¥ï¼Œåœ¨ React v17 ä¸­ï¼Œå¯èƒ½å°±ä¼šåˆ é™¤å¯¹è€ç‰ˆ Context API çš„æ”¯æŒï¼Œæ‰€ä»¥ï¼Œç°åœ¨å¤§å®¶éƒ½åº”è¯¥ä½¿ç”¨ç¬¬äºŒç§å®ç°æ–¹å¼ã€‚</li>
</ul>
<h3 id="2-3-ç»„åˆç»„ä»¶"><a href="#2-3-ç»„åˆç»„ä»¶" class="headerlink" title="2.3 ç»„åˆç»„ä»¶"></a>2.3 ç»„åˆç»„ä»¶</h3><p><strong>é—®é¢˜æè¿°</strong></p>
<p>ä¸ºäº†è®©é—®é¢˜æ›´åŠ å…·ä½“ï¼Œæˆ‘ä»¬æ¥è§£å†³ä¸€ä¸ªå®ä¾‹ã€‚</p>
<p>å¾ˆå¤šç•Œé¢éƒ½æœ‰ Tab è¿™æ ·çš„å…ƒä»¶ï¼Œæˆ‘ä»¬éœ€è¦ä¸€ä¸ª Tabs ç»„ä»¶å’Œ TabItem ç»„ä»¶ï¼ŒTabs æ˜¯å®¹å™¨ï¼ŒTabItem æ˜¯ä¸€ä¸ªä¸€ä¸ªå•ç‹¬çš„ Tabï¼Œå› ä¸ºä¸€ä¸ªæ—¶åˆ»åªæœ‰ä¸€ä¸ª TabItem è¢«é€‰ä¸­ï¼Œå¾ˆè‡ªç„¶å¸Œæœ›è¢«é€‰ä¸­çš„ TabItem æ ·å¼ä¼šå’Œå…¶ä»– TabItem ä¸åŒã€‚</p>
<p>è¿™å¹¶ä¸æ˜¯ä¸€ä¸ªå¾ˆéš¾çš„åŠŸèƒ½ï¼Œé¦–å…ˆæˆ‘ä»¬æƒ³åˆ°çš„å°±æ˜¯ï¼Œç”¨ Tabs ä¸­ä¸€ä¸ª state è®°å½•å½“å‰è¢«é€‰ä¸­çš„ Tabitem åºå·ï¼Œç„¶åæ ¹æ®è¿™ä¸ª state ä¼ é€’ props ç»™ TabItemï¼Œå½“ç„¶ï¼Œè¿˜è¦ä¼ é€’ä¸€ä¸ª onClick äº‹ä»¶è¿›å»ï¼Œæ•è·ç‚¹å‡»é€‰æ‹©äº‹ä»¶ã€‚</p>
<p>æŒ‰ç…§è¿™æ ·çš„è®¾è®¡ï¼ŒTabs ä¸­å¦‚æœè¦æ˜¾ç¤º Oneã€Twoã€Three ä¸‰ä¸ª TabItemï¼ŒJSX ä»£ç å¤§è‡´è¿™ä¹ˆå†™ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&lt;TabItem active=&#123;true&#125; onClick=&#123;this.onClick&#125;&gt;One&lt;/TabItem&gt;</span><br><span class="line">&lt;TabItem active=&#123;false&#125; onClick=&#123;this.onClick&#125;&gt;Two&lt;/TabItem&gt;</span><br><span class="line">&lt;TabItem active=&#123;false&#125; onClick=&#123;this.onClick&#125;&gt;Three&lt;/TabItem&gt;</span><br></pre></td></tr></table></figure>

<blockquote>
<p>ä¸Šé¢çš„ TabItem ç»„ä»¶æ¥å— active è¿™ä¸ª propsï¼Œå¦‚æœ true ä»£è¡¨å½“å‰æ˜¯é€‰ä¸­çŠ¶æ€ï¼Œå½“ç„¶å¯ä»¥å·¥ä½œï¼Œä½†æ˜¯ï¼Œä¹Ÿå­˜åœ¨å¤§é—®é¢˜</p>
</blockquote>
<ul>
<li>æ¯æ¬¡ä½¿ç”¨ TabItem éƒ½è¦ä¼ é€’ä¸€å † propsï¼Œå¥½éº»çƒ¦ï¼›</li>
<li>æ¯å¢åŠ ä¸€ä¸ªæ–°çš„ TabItemï¼Œéƒ½è¦å¢åŠ å¯¹åº”çš„ propsï¼Œæ›´éº»çƒ¦ï¼›</li>
<li>å¦‚æœè¦å¢åŠ  TabItemï¼Œå°±è¦å»ä¿®æ”¹ Tabs çš„ JSX ä»£ç ï¼Œè¶…éº»çƒ¦ã€‚</li>
</ul>
<p>æˆ‘ä»¬ä¸æƒ³è¦è¿™ä¹ˆéº»çƒ¦ï¼Œç†æƒ³æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬å¸Œæœ›å¯ä»¥éšæ„å¢åŠ å‡å°‘ TabItem å®ä¾‹ï¼Œä¸ç”¨ä¼ é€’ä¸€å † propsï¼Œä¹Ÿä¸ç”¨å»ä¿®æ”¹ Tabs çš„ä»£ç ï¼Œæœ€å¥½ä»£ç å°±è¿™æ ·ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&lt;Tabs&gt;</span><br><span class="line">  &lt;TabItem&gt;One&lt;/TabItem&gt;</span><br><span class="line">  &lt;TabItem&gt;Two&lt;/TabItem&gt;</span><br><span class="line">  &lt;TabItem&gt;Three&lt;/TabItem&gt;</span><br><span class="line">&lt;/Tabs&gt;</span><br></pre></td></tr></table></figure>

<p>å¦‚æœèƒ½åƒä¸Šé¢ä¸€æ ·å†™ä»£ç ï¼Œé‚£å°±è¾¾åˆ°ç›®çš„äº†ã€‚</p>
<blockquote>
<p>åƒä¸Šé¢è¿™æ ·ï¼ŒTabs å’Œ TabItem ä¸é€šè¿‡è¡¨é¢çš„ props ä¼ é€’ä¹Ÿèƒ½å¿ƒæœ‰çµçŠ€ï¼ŒäºŒè€…ä¹‹é—´æœ‰æŸç§ç¥ç§˜çš„â€œç»„åˆâ€ï¼Œå°±æ˜¯æˆ‘ä»¬æ‰€è¯´çš„â€œç»„åˆç»„ä»¶â€ã€‚</p>
</blockquote>
<p><strong>å®ç°æ–¹å¼</strong></p>
<p>ä¸Šé¢æˆ‘ä»¬è¯´è¿‡ï¼Œåˆ©ç”¨ Context APIï¼Œå¯ä»¥å®ç°ç»„åˆç»„ä»¶ï¼Œä½†æ˜¯é‚£æ · TabItem éœ€è¦åº”ç”¨ render propsï¼Œè‡³äºå¦‚ä½•å®ç°ï¼Œè¯»è€…å¯ä»¥å‚ç…§ä¸Šä¸€èŠ‚çš„ä»‹ç»è‡ªå·±å°è¯•ã€‚</p>
<p>åœ¨è¿™é‡Œï¼Œæˆ‘ä»¬ç”¨ä¸€ç§æ›´å·§å¦™çš„æ–¹å¼æ¥å®ç°ç»„åˆç»„ä»¶ï¼Œå¯ä»¥é¿å… TabItem çš„å¤æ‚åŒ–ã€‚</p>
<p>æˆ‘ä»¬å…ˆå†™å‡º TabItem çš„ä»£ç ï¼Œå¦‚ä¸‹</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">const TabItem = (props) =&gt; &#123;</span><br><span class="line">  const &#123;active, onClick&#125; = props;</span><br><span class="line">  const tabStyle = &#123;</span><br><span class="line">    &#x27;max-width&#x27;: &#x27;150px&#x27;,</span><br><span class="line">    color: active ? &#x27;red&#x27; : &#x27;green&#x27;,</span><br><span class="line">    border: active ? &#x27;1px red solid&#x27; : &#x27;0px&#x27;,</span><br><span class="line">  &#125;;</span><br><span class="line">  return (</span><br><span class="line">    &lt;h1 style=&#123;tabStyle&#125; onClick=&#123;onClick&#125;&gt;</span><br><span class="line">      &#123;props.children&#125;</span><br><span class="line">    &lt;/h1&gt;</span><br><span class="line">  );</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<p>TabItem æœ‰ä¸¤ä¸ªé‡è¦çš„ propsï¼šactive ä»£è¡¨è‡ªå·±æ˜¯å¦è¢«æ¿€æ´»ï¼ŒonClick æ˜¯è‡ªå·±è¢«ç‚¹å‡»æ—¶åº”è¯¥è°ƒç”¨çš„å›è°ƒå‡½æ•°ï¼Œè¿™å°±è¶³å¤Ÿäº†ã€‚TabItem æ‰€åšçš„å°±æ˜¯æ ¹æ®è¿™ä¸¤ä¸ª props æ¸²æŸ“å‡º props.childrenï¼Œæ²¡æœ‰ä»»ä½•å¤æ‚é€»è¾‘ï¼Œæ˜¯ä¸€ä¸ªæ´»è„±è„±çš„â€œå‚»ç“œç»„ä»¶â€ï¼Œæ‰€ä»¥ï¼Œç”¨ä¸€ä¸ªçº¯å‡½æ•°å®ç°å°±å¯ä»¥äº†ã€‚</p>
<p>æ¥ä¸‹æ¥è¦åšçš„ï¼Œå°±çœ‹ Tabs å¦‚ä½•æŠŠ active å’Œ onClick ä¼ é€’ç»™ TabItemã€‚</p>
<p>æˆ‘ä»¬å†æ¥çœ‹ä¸€ä¸‹ä½¿ç”¨ç»„åˆç»„ä»¶çš„ JSX ä»£ç ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&lt;Tabs&gt;</span><br><span class="line">  &lt;TabItem&gt;One&lt;/TabItem&gt;</span><br><span class="line">  &lt;TabItem&gt;Two&lt;/TabItem&gt;</span><br><span class="line">  &lt;TabItem&gt;Three&lt;/TabItem&gt;</span><br><span class="line">&lt;/Tabs&gt;</span><br></pre></td></tr></table></figure>

<p>æ²¡æœ‰ props çš„ä¼ é€’å•Šï¼Œæ€ä¹ˆæ‚„æ— å£°æ¯åœ°æŠŠ active å’Œ onClick ä¼ é€’ç»™ TabItem å‘¢ï¼Ÿ</p>
<p>Tabs è™½ç„¶å¯ä»¥è®¿é—®åˆ°ä½œä¸º props çš„ childrenï¼Œä½†æ˜¯åˆ°æ‰‹çš„ children å·²ç»æ˜¯åˆ›é€ å¥½çš„å…ƒç´ ï¼Œè€Œä¸”æ˜¯ä¸å¯æ”¹å˜çš„ï¼ŒTabs æ˜¯ä¸å¯èƒ½æŠŠåˆ›é€ å¥½çš„å…ƒç´ å†å¼ºå¡ç»™ children çš„ã€‚</p>
<p>æ€ä¹ˆåŠï¼Ÿ</p>
<p>åŠæ³•è¿˜æ˜¯æœ‰çš„ï¼Œå¦‚æœ Tabs å¹¶ä¸å»æ¸²æŸ“ childrenï¼Œè€Œæ˜¯æŠŠ children æ‹·è´ä¸€ä»½ï¼Œå°±æœ‰æœºä¼šå»ç¯¡æ”¹è¿™ä»½æ‹·è´ï¼Œæœ€åæ¸²æŸ“è¿™ä»½æ‹·è´å°±å¥½äº†ã€‚</p>
<p>æˆ‘ä»¬æ¥çœ‹ Tabs çš„å®ç°ä»£ç </p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">class Tabs extends React.Component &#123;</span><br><span class="line">  state = &#123;</span><br><span class="line">    activeIndex:  0</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  render() &#123;</span><br><span class="line">    const newChildren = React.Children.map(this.props.children, (child, index) =&gt; &#123;</span><br><span class="line">      if (child.type) &#123;</span><br><span class="line">        return React.cloneElement(child, &#123;</span><br><span class="line">          active: this.state.activeIndex === index,</span><br><span class="line">          onClick: () =&gt; this.setState(&#123;activeIndex: index&#125;)</span><br><span class="line">        &#125;);</span><br><span class="line">      &#125; else &#123;</span><br><span class="line">        return child;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;);</span><br><span class="line"></span><br><span class="line">    return (</span><br><span class="line">      &lt;Fragment&gt;</span><br><span class="line">        &#123;newChildren&#125;</span><br><span class="line">      &lt;/Fragment&gt;</span><br><span class="line">    );</span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure>

<p>åœ¨ render å‡½æ•°ä¸­ï¼Œæˆ‘ä»¬ç”¨äº† React ä¸­ä¸å¸¸ç”¨çš„ä¸¤ä¸ª APIï¼š</p>
<ul>
<li><code>React.Children.map</code></li>
<li><code>React.cloneElement</code></li>
</ul>
<p>ä½¿ç”¨ React.Children.mapï¼Œå¯ä»¥éå† children ä¸­æ‰€æœ‰çš„å…ƒç´ ï¼Œå› ä¸º children å¯èƒ½æ˜¯ä¸€ä¸ªæ•°ç»„å˜›ã€‚</p>
<p>ä½¿ç”¨ React.cloneElement å¯ä»¥å¤åˆ¶æŸä¸ªå…ƒç´ ã€‚è¿™ä¸ªå‡½æ•°ç¬¬ä¸€ä¸ªå‚æ•°å°±æ˜¯è¢«å¤åˆ¶çš„å…ƒç´ ï¼Œç¬¬äºŒä¸ªå‚æ•°å¯ä»¥å¢åŠ æ–°äº§ç”Ÿå…ƒç´ çš„ propsï¼Œæˆ‘ä»¬å°±æ˜¯åˆ©ç”¨è¿™ä¸ªæœºä¼šï¼ŒæŠŠ active å’Œ onClick æ·»åŠ äº†è¿›å»ã€‚</p>
<p>è¿™ä¸¤ä¸ª API åŒå‰‘åˆç’§ï¼Œå°±èƒ½å®ç°ä¸é€šè¿‡è¡¨é¢çš„ props ä¼ é€’ï¼Œå®Œæˆä¸¤ä¸ªç»„ä»¶çš„â€œç»„åˆâ€</p>
<p><strong>å®é™…åº”ç”¨</strong></p>
<ul>
<li>ä»ä¸Šé¢çš„ä»£ç å¯ä»¥çœ‹å‡ºæ¥ï¼Œå¯¹äºç»„åˆç»„ä»¶è¿™ç§å®ç°æ–¹å¼ï¼ŒTabItem éå¸¸ç®€åŒ–ï¼›Tabs ç¨å¾®éº»çƒ¦äº†ä¸€ç‚¹ï¼Œä½†æ˜¯å¥½å¤„å°±æ˜¯æŠŠå¤æ‚åº¦éƒ½å°è£…èµ·æ¥äº†ï¼Œä»ä½¿ç”¨è€…è§’åº¦ï¼Œè¿ props éƒ½çœ‹ä¸è§ã€‚</li>
<li>æ‰€ä»¥ï¼Œåº”ç”¨ç»„åˆç»„ä»¶çš„å¾€å¾€æ˜¯å…±äº«ç»„ä»¶åº“ï¼ŒæŠŠä¸€äº›å¸¸ç”¨çš„åŠŸèƒ½å°è£…åœ¨ç»„ä»¶é‡Œï¼Œè®©åº”ç”¨å±‚ç›´æ¥ç”¨å°±è¡Œã€‚åœ¨ antd å’Œ bootstrap è¿™æ ·çš„å…±äº«åº“ä¸­ï¼Œéƒ½ä½¿ç”¨äº†ç»„åˆç»„ä»¶è¿™ç§æ¨¡å¼ã€‚</li>
<li>å¦‚æœä½ çš„æŸä¸¤ä¸ªç»„ä»¶å¹¶ä¸éœ€è¦é‡ç”¨ï¼Œé‚£ä¹ˆå°±è¦è°¨æ…ä½¿ç”¨ç»„åˆç»„ä»¶æ¨¡å¼ï¼Œæ¯•ç«Ÿè¿™è®©ä»£ç å¤æ‚äº†ä¸€äº›ã€‚</li>
</ul>
<h2 id="ä¸‰ã€React-å•å…ƒæµ‹è¯•"><a href="#ä¸‰ã€React-å•å…ƒæµ‹è¯•" class="headerlink" title="ä¸‰ã€React å•å…ƒæµ‹è¯•"></a>ä¸‰ã€React å•å…ƒæµ‹è¯•</h2><h3 id="3-1-æµ‹è¯•çš„ç›®çš„"><a href="#3-1-æµ‹è¯•çš„ç›®çš„" class="headerlink" title="3.1 æµ‹è¯•çš„ç›®çš„"></a>3.1 æµ‹è¯•çš„ç›®çš„</h3><p>æµ‹è¯•å¯¹äºè½¯ä»¶å¼€å‘éå¸¸é‡è¦ï¼Œç®€å•æ¥è¯´ï¼Œæµ‹è¯•å°±æ˜¯å°½åŠ›å‘ç°è½¯ä»¶ä¸­çš„ç¼ºé™·ï¼ˆä¿—ç§° bugï¼‰ï¼Œå½“æˆ‘ä»¬å‘ç°ä¸äº†æ›´å¤šçš„ bug æ—¶ï¼Œè¯´æ˜è¿™ä¸ªè½¯ä»¶è´¨é‡å¯ä»¥æ¥å—äº†ã€‚</p>
<p>ç„¶è€Œï¼Œæ²¡æœ‰ bug çš„è½¯ä»¶æˆ‘è¿˜æ²¡è§è¿‡å‘¢ã€‚</p>
<p>åœ¨äº’è”ç½‘æ—¶ä»£ï¼Œæˆ‘ä»¬æ›´æ˜¯ä¸å¯èƒ½ç­‰åˆ°æ‰€æœ‰ bug éƒ½ä¿®å¤äº†æ‰ä¸Šçº¿ï¼Œé‚£æ ·é»„èŠ±èœéƒ½å‡‰äº†ï¼Œç¨å¾®æœ‰ä¸€äº›å·¥ä½œç»éªŒçš„äººéƒ½ä¼šæœ‰è¿™æ ·çš„ä½“ä¼šã€‚</p>
<p>æ‰€ä»¥ï¼Œäº‹å®ä¸Šï¼Œæµ‹è¯•æ˜¯å°½åŠ›å‘ç°è½¯ä»¶ä¸­çš„ bugã€‚å½“æˆ‘ä»¬å‘ç° bug æ•°é‡å’Œä¸¥é‡ç¨‹åº¦å‘ˆç¨³å®šçš„ä¸‹é™è¶‹åŠ¿ï¼Œç›´åˆ°ä½äºä¸€ä¸ªé—¨æ§›ï¼ˆæ— é¡»é™ä½ä¸º 0ï¼Œåªéœ€è¦é™ä½åˆ°å¯æ¥å—çš„ç¨‹åº¦ï¼‰ï¼Œæ²¡æœ‰æ›´å¤šæ›´ä¸¥é‡çš„ bug å‡ºç°ï¼Œå°±è¯´æ˜è¿™ä¸ªè½¯ä»¶çš„è´¨é‡å¯ä»¥æ¥å—ï¼Œå¯ä»¥ä¸Šçº¿äº†ã€‚</p>
<p>è¿™æ ·å½“ç„¶è¦æ¯”è¾¾åˆ°â€œé›¶ bug è½¯ä»¶â€è¦å®¹æ˜“å¤šäº†ï¼Œä½†æ˜¯ï¼Œä¸è¦å› æ­¤ä»¥ä¸ºè¿™å°±æ˜¯ä¸€ä»¶æ²¡æœ‰å›°éš¾çš„ä»»åŠ¡ã€‚ä¸ºäº†è®© bug çš„æ•°é‡å’Œä¸¥é‡ç¨‹åº¦è¶³å¤Ÿä½ï¼Œæˆ‘ä»¬å¼€å‘è€…å¿…é¡»ä¸¥æ ¼è¦æ±‚è‡ªå·±ï¼Œåªæœ‰ä¿è¯æˆ‘ä»¬å†™çš„æ¯ä¸€å°å—ä»£ç éƒ½ç»å—ä½æµ‹è¯•çš„è€ƒéªŒï¼Œè¿™äº›å°å—ä»£ç é›†åˆåœ¨ä¸€èµ·çš„æ—¶å€™æ‰å¯èƒ½ï¼ˆåªæ˜¯æœ‰å¯èƒ½ï¼‰ä¸ä¼šå‡ºå¾ˆå¤š bugï¼Œå¦‚æœæˆ‘ä»¬å†™çš„å°å—ä»£ç è´¨é‡éƒ½æ— æ³•ä¿è¯ï¼Œé‚£å¤§é¡¹ç›®çš„ä»£ç æ ¹æœ¬æ— æ³•ä¿è¯</p>
<h2 id="å››ã€å•å…ƒæµ‹è¯•"><a href="#å››ã€å•å…ƒæµ‹è¯•" class="headerlink" title="å››ã€å•å…ƒæµ‹è¯•"></a>å››ã€å•å…ƒæµ‹è¯•</h2><p><strong>Jest</strong></p>
<p>åœ¨ JavaScript çš„ä¸–ç•Œé‡Œï¼Œå•å…ƒæµ‹è¯•çš„æ¡†æ¶å¾ˆå¤šï¼Œå“ç‰Œæœ€è€åæ°”æœ€å“çš„æ˜¯ Mocha ï¼Œä¸è¿‡ï¼Œä¸è¦çº ç»“äºåæ°”ï¼Œè¯·ä½¿ç”¨ Jest ã€‚ä½ ä¸ä¼šåæ‚”çš„ï¼Œæ¥ä¸‹æ¥æˆ‘å‘Šè¯‰ä½ ä¸ºä»€ä¹ˆã€‚</p>
<p>æˆ‘ä»¬å…ˆå‡è®¾ï¼Œä½œä¸ºå¼€å‘è€…ï¼Œä½ æ˜¯åœ¨å›¢é˜Ÿä¸­å·¥ä½œã€‚æ‰€è°“å›¢é˜Ÿï¼Œå°±æ˜¯æœ‰å¾ˆå¤šäººä¸€èµ·å·¥ä½œï¼Œè€Œä¸”éšç€ä¸šåŠ¡å’Œå›¢é˜Ÿçš„å‘å±•ï¼Œäººä¼šè¶Šæ¥è¶Šå¤šï¼Œæ½œå°è¯å°±æ˜¯â€”â€”ä¸ç¡®å®šå› ç´ è¶Šæ¥è¶Šå¤šã€‚</p>
<p>äººå’Œäººä¹‹é—´äº¤æµä¼šå‡ºç°åå·®ï¼Œäººçš„æ°´å¹³æœ‰é«˜ä½ä¹‹åˆ†ï¼Œäººä¹Ÿä¼šçŠ¯é”™ï¼Œæ€»ä¹‹ï¼Œä½ ä¸èƒ½æŒ‡æœ›æ‰€æœ‰äººéƒ½æŠŠäº‹æƒ…åšå¾—å°½å–„å°½ç¾ã€‚</p>
<p>å…·ä½“åˆ°å•å…ƒæµ‹è¯•è¿™ä»¶äº‹ä¸Šæ¥ï¼Œâ€œæµ‹è¯•é©±åŠ¨â€æ˜¯å¼€å‘å–Šäº†è¿™ä¹ˆå¤šå¹´ï¼Œä¸ºä»€ä¹ˆçœŸæ­£åšåˆ°è¿™ä¸€ç‚¹çš„å›¢é˜Ÿä¾ç„¶ä¸å¤šå‘¢ï¼Ÿå› ä¸ºï¼Œå½“å›¢é˜Ÿå˜å¤§ä¹‹åï¼Œå¾ˆå¤šé—®é¢˜ä¹Ÿå°±å‡ºç°äº†</p>
<p>1ã€å•å…ƒæµ‹è¯•ç”¨ä¾‹åºå¤§ï¼Œæ‰§è¡Œæ—¶é—´è¿‡é•¿ã€‚</p>
<p>æƒ³è±¡ä¸€ä¸‹ï¼Œä¸€ä¸ªä»£ç åº“é‡Œå‡è®¾æœ‰ä¸€åƒä¸ªå•å…ƒæµ‹è¯•ç”¨ä¾‹ï¼Œå³ä½¿æ¯ä¸ªå•å…ƒæµ‹è¯•ç”¨ä¾‹å¹³å‡åªéœ€è¦ 10 æ¯«ç§’ï¼Œé‚£æ€»æ—¶é—´ä¹Ÿå°±éœ€è¦ 10 ç§’é’Ÿã€‚å¥½ï¼Œå‡è®¾ä»£ç åº“è¿›ä¸€æ­¥æ‰©å¤§ï¼Œæœ‰äº†ä¸€ä¸‡ä¸ªå•å…ƒæµ‹è¯•ç”¨ä¾‹ï¼Œé‚£å°±è·‘ä¸€éå°±éœ€è¦ 100 ç§’ï¼Œå·²ç»è¶…è¿‡äº†ä¸€åˆ†é’Ÿã€‚è¿™è¿˜åªæ˜¯ä¿å®ˆä¼°è®¡ï¼Œå®é™…ä¸Šå•å…ƒæµ‹è¯•ç”¨ä¾‹çš„è¿è¡Œæ—¶é—´åªä¼šæ¯”è¿™é•¿ã€‚å¼€å‘è€…å¦‚æœæ¯æ¬¡ä¿®æ”¹éƒ½éœ€è¦ç­‰å¾…è¿™ä¹ˆæ¼«é•¿çš„å•å…ƒæµ‹è¯•è¿è¡Œæ—¶é—´ï¼Œè‚¯å®šä¼šä¸‰å¿ƒäºŒæ„ä¸Šç½‘å»çœ‹å…¶ä»–ä¸œè¥¿ã€‚</p>
<p>2ã€ å•å…ƒæµ‹è¯•ç”¨ä¾‹ä¹‹é—´ç›¸äº’å½±å“ã€‚</p>
<p>ä½ å¯èƒ½ä¹Ÿæœ‰è¿™æ ·çš„ä½“éªŒï¼Œä»£ç åº“ä¸­çš„å•å…ƒæµ‹è¯•çªç„¶å¤±è´¥äº†ï¼Œä½†æ˜¯ä½ ä¿®æ”¹çš„ä»£ç æ ¹æœ¬ä¸ä¼šå–å½±å“å¤±è´¥çš„é‚£ä¸ªå•å…ƒæµ‹è¯•ç”¨ä¾‹ï¼Œæ€ä¹ˆå›äº‹ï¼Ÿè¿™å¾€å¾€æ˜¯å› ä¸ºæŸä¸ªæˆå‘˜ä»¥å‰çš„ä»£ç å†™å¾—ä¸å¥½ï¼Œå½±å“äº†ä¸€ä¸ªå…¨å±€å˜é‡ã€‚å½“ç„¶ï¼Œè°éƒ½çŸ¥é“å•å…ƒæµ‹è¯•åº”è¯¥åœ¨ setup æ—¶åˆ›å»ºç¯å¢ƒï¼Œåœ¨ teardown æ—¶æ¢å¤ç¯å¢ƒï¼Œå¯æ˜¯ï¼Œæ€»ä¼šæœ‰äººæœ‰é©¬è™å¤§æ„çš„æƒ…å†µï¼Œè¿™æ—¶å€™ä½ æ€ä¹ˆåŠï¼Ÿè¦ä¹ˆä½ åªå¥½å»ä¿®å¤ä¸€ä¸ªæœ¬ä¸æ˜¯ä½ æ”¹åçš„ä»£ç ï¼Œè¦ä¹ˆä½ å¹²è„†åˆ æ‰é‚£æ®µä¸å¯é çš„å•å…ƒæµ‹è¯•ä»£ç ï¼Œä¸ç®¡æ€æ ·ï¼Œè¿™éƒ½ä¼šæ‰“å‡»ä½ æ”¯æŒâ€œæµ‹è¯•é©±åŠ¨å¼€å‘â€çš„å†³å¿ƒã€‚</p>
<p>Jest è¾ƒå¥½åœ°è§£å†³äº†ä¸Šé¢è¯´çš„é—®é¢˜ï¼Œå› ä¸º Jest æœ€é‡è¦çš„ä¸€ä¸ªç‰¹æ€§ï¼Œå°±æ˜¯æ”¯æŒå¹¶è¡Œæ‰§è¡Œ</p>
<p>Mocha ä¹‹ç±»è€ç‰Œå•å…ƒæµ‹è¯•æ¡†æ¶ï¼ŒæŠŠæ‰€æœ‰çš„å•å…ƒæµ‹è¯•éƒ½æ”¾åœ¨ä¸€ä¸ªç¯å¢ƒä¸­æ‰§è¡Œï¼Œè¿™å°±ä½¿æ‰€æœ‰å•å…ƒæµ‹è¯•è®¿é—®çš„æ˜¯åŒæ ·ä¸€ä¸ªå…¨å±€å˜é‡ç©ºé—´ï¼Œæ‰€ä»¥åªè¦æµ‹è¯•ä»£ç æ²¡å†™å¥½ï¼Œå°±ä¼šäº’ç›¸å½±å“ã€‚è€Œä¸”ï¼Œä¸ºäº†ä¿è¯æ‰§è¡Œæ­£å¸¸ï¼Œæ‰€æœ‰çš„å•å…ƒæµ‹è¯•å¿…é¡»ä¸€ä¸ªæ¥ä¸€ä¸ªåœ°æ‰§è¡Œï¼Œè¿™æ˜¯ä½“ç³»æ¶æ„å†³å®šçš„ï¼Œæ²¡æœ‰åŠæ³•ã€‚</p>
<p>Jest ä¸åŒï¼ŒJest ä¸ºæ¯ä¸€ä¸ªå•å…ƒæµ‹è¯•æ–‡ä»¶åˆ›é€ ä¸€ä¸ªç‹¬ç«‹çš„è¿è¡Œç¯å¢ƒï¼Œæ¢å¥è¯è¯´ï¼ŒJest ä¼šå¯åŠ¨ä¸€ä¸ªè¿›ç¨‹æ‰§è¡Œä¸€ä¸ªå•å…ƒæµ‹è¯•æ–‡ä»¶ï¼Œè¿è¡Œç»“æŸä¹‹åï¼Œå°±æŠŠè¿™ä¸ªæ‰§è¡Œè¿›ç¨‹åºŸå¼ƒäº†ï¼Œè¿™ä¸ªå•å…ƒæµ‹è¯•æ–‡ä»¶å³ä½¿å†™å¾—æ¯”è¾ƒå·®ï¼ŒæŠŠå…¨å±€å˜é‡æ±¡æŸ“å¾—ä¸€å›¢ç³Ÿï¼Œä¹Ÿä¸ä¼šå½±å“å…¶ä»–å•å…ƒæµ‹è¯•æ–‡ä»¶ï¼Œå› ä¸ºå…¶ä»–å•å…ƒæµ‹è¯•æ–‡ä»¶æ˜¯ç”¨å¦ä¸€ä¸ªè¿›ç¨‹æ¥æ‰§è¡Œ</p>
<p>æ›´å¦™çš„æ˜¯ï¼Œå› ä¸ºæ¯ä¸ªå•å…ƒæµ‹è¯•æ–‡ä»¶ä¹‹é—´å†æ— çº è‘›ï¼ŒJest å¯ä»¥å¯åŠ¨å¤šä¸ªè¿›ç¨‹åŒæ—¶è¿è¡Œä¸åŒçš„æ–‡ä»¶ï¼Œè¿™æ ·å°±å……åˆ†åˆ©ç”¨äº†ç”µè„‘çš„å¤š CPU å¤šæ ¸ï¼Œå•è¿›ç¨‹ 100 ç§’æ‰å®Œæˆçš„æµ‹è¯•æ‰§è¡Œè¿‡ç¨‹ï¼Œ8 æ ¸åªéœ€è¦ 12.5 ç§’ï¼Œé€Ÿåº¦å¿«äº†å¾ˆå¤šã€‚</p>
<p>Jest è¿˜æœ‰å¾ˆå¤šå…¶ä»–å‹å¥½çš„ç‰¹æ€§ï¼Œå¤§å®¶å¯ä»¥è‡ªå·±å»å‘æ˜ï¼Œè¿™é‡ŒåºŸè¯ä¸å¤šè¯´ï¼Œåªæƒ³å®‰åˆ©å„ä½ï¼Œæµ‹è¯• React æˆ–è€… JavaScript ä»£ç ï¼Œç”¨ Jestï¼</p>
<p>ä½¿ç”¨ create-react-app äº§ç”Ÿçš„é¡¹ç›®è‡ªå¸¦ Jest ä½œä¸ºæµ‹è¯•æ¡†æ¶ï¼Œä¸å¥‡æ€ªï¼Œå› ä¸º Jest å’Œ React ä¸€æ ·éƒ½æ˜¯å‡ºè‡ª Facebookã€‚</p>
<p>è¿è¡Œä¸‹é¢çš„å‘½ä»¤ï¼Œå°±å¯ä»¥è¿›å…¥äº¤äº’å¼çš„â€æµ‹è¯•é©±åŠ¨å¼€å‘â€œæ¨¡å¼ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm test</span><br></pre></td></tr></table></figure>

<p><strong>Enzyme</strong></p>
<p>è™½ç„¶æœ€å¥½çš„ React æµ‹è¯•æ¡†æ¶å‡ºè‡ª Facebook å®¶ï¼Œæœ€å—æ¬¢è¿çš„ React æµ‹è¯•å·¥å…·åº“å´å‡ºè‡ª Airbnbï¼Œè¿™ä¸ªå·¥å…·åº“å«åš Enzymeã€‚Enzyme è¿™ä¸ªå•è¯çš„å«ä¹‰æ˜¯â€œé…¶â€ï¼Œè‡³äºå‘½ååŸå› å·²ç»æ— æ³•è€ƒæ®ï¼Œå¯èƒ½å¯“æ„ç€å¿«é€Ÿåˆ†è§£ã€‚</p>
<p>ä¸è¿‡å› ä¸º Enzyme ä¸æ˜¯ Facebook å®¶å‡ºå“ï¼Œæ‰€ä»¥ä½¿ç”¨ Enzyme è¿˜çœŸç¨å¾®æœ‰äº›éº»çƒ¦â€”â€”åœ¨ create-react-app äº§ç”Ÿçš„åº”ç”¨ä¸­å¹¶ä¸åŒ…å« Enzymeï¼Œéœ€è¦æˆ‘ä»¬è‡ªå·±æ¥æ·»åŠ ã€‚</p>
<p>åœ¨é¡¹ç›®ç›®å½•ä¸‹ï¼Œé€šè¿‡ä¸‹é¢çš„å‘½ä»¤æ¥å®‰è£… enzyme</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm i --save-dev enzyme enzyme-adapter-react-16</span><br></pre></td></tr></table></figure>

<p>å¯ä»¥æ³¨æ„åˆ°ï¼Œæˆ‘ä»¬ä¸å…‰è¦å®‰è£… enzymeï¼Œè¿˜è¦å®‰è£… enzyme-adapter-react-16ï¼Œè¿™ä¸ªåº“æ˜¯ç”¨æ¥ä½œä¸ºé€‚é…å™¨çš„ã€‚å› ä¸ºä¸åŒ React ç‰ˆæœ¬æœ‰å„è‡ªç‰¹ç‚¹ï¼Œæ‰€ç”¨çš„é€‚é…å™¨ä¹Ÿä¼šä¸åŒï¼Œæˆ‘ä»¬çš„é¡¹ç›®ä¸­ä½¿ç”¨çš„æ˜¯ 16.4 ä¹‹åçš„ç‰ˆæœ¬ï¼Œæ‰€ä»¥ç”¨ enzyme-adapter-react-16ï¼›å¦‚æœç”¨ 16.3 ç‰ˆæœ¬ï¼Œéœ€è¦ç”¨ enzyme-adapter-react-16.3ï¼›å¦‚æœç”¨ 16.2 ç‰ˆæœ¬ï¼Œéœ€è¦ç”¨ enzyme-adapter-react-16.2ï¼›å¦‚æœç”¨æ›´è€çš„ç‰ˆæœ¬ 15.5ï¼Œéœ€è¦ç”¨ enzyme-adapter-react-15ã€‚å…·ä½“å„ä¸ª React ç‰ˆæœ¬å¯¹åº”ä»€ä¹ˆæ ·çš„ Adapterï¼Œè¯·å‚è€ƒ enzymeå®˜æ–¹æ–‡æ¡£ã€‚</p>
<p>ç°åœ¨ï¼Œå¯ä»¥åœ¨æµ‹è¯•ä»£ç ä¸­ä½¿ç”¨ enzyme äº†ã€‚æˆ‘ä»¬ä»¥ä¹‹å‰ç§’è¡¨åº”ç”¨ä¸­çš„ ControlButtons ç»„ä»¶ä¸ºä¾‹ï¼Œæ¥è¯´æ˜å¦‚ä½•åšå•å…ƒæµ‹è¯•ã€‚</p>
<p>æˆ‘ä»¬åˆ›é€ ä¸€ä¸ª ControlButtons.test.jsï¼Œæ¥å®¹çº³å¯¹åº”çš„æµ‹è¯•ç”¨ä¾‹ï¼Œå› ä¸ºæ‰€æœ‰åç¼€ä¸º .test.js çš„æ–‡ä»¶éƒ½ä¼šè¢« Jest è®¤ä½œæ˜¯æµ‹è¯•ç”¨ä¾‹æ–‡ä»¶ã€‚</p>
<p>åœ¨ä»£ç ä¸­ï¼Œéœ€è¦ä½¿ç”¨ Adapterï¼Œä»£ç å¦‚ä¸‹</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">import &#123;configure&#125; from &#x27;enzyme&#x27;;</span><br><span class="line">import Adapter from &#x27;enzyme-adapter-react-16&#x27;;</span><br><span class="line">configure(&#123;adapter: new Adapter()&#125;);</span><br></pre></td></tr></table></figure>

<p>æˆ‘ä»¬å¯¹ ControlButtons ç»„ä»¶çš„æµ‹è¯•ï¼Œå°±æ˜¯è¦æ¸²æŸ“å®ƒä¸€æ¬¡ï¼Œçœ‹çœ‹æ¸²æŸ“ç»“æœå¦‚ä½•ï¼Œenzyme å°±èƒ½å¸®åŠ©æˆ‘ä»¬åšè¿™ä»¶äº‹ã€‚</p>
<p>æ¯”å¦‚ï¼Œæˆ‘ä»¬æƒ³è¦ä¿è¯æ¸²æŸ“å‡ºæ¥çš„å†…å®¹å¿…é¡»åŒ…å«ä¸¤ä¸ªæŒ‰é’®ï¼Œå…¶ä¸­ä¸€ä¸ªæŒ‰é’®çš„ class åæ˜¯ left-btnï¼Œå¦ä¸€ä¸ªæ˜¯ right-btnï¼Œé‚£ä¹ˆæˆ‘ä»¬å°±éœ€è¦ä¸‹é¢çš„å•å…ƒæµ‹è¯•ç”¨ä¾‹ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">import &#123;shallow&#125; from &#x27;enzyme&#x27;;</span><br><span class="line"></span><br><span class="line">it(&#x27;renders without crashing&#x27;, () =&gt; &#123;</span><br><span class="line">  const wrapper = shallow(&lt;ControlButtons /&gt;);</span><br><span class="line">  expect(wrapper.find(&#x27;.left-btn&#x27;)).toHaveLength(1);</span><br><span class="line">  expect(wrapper.find(&#x27;.right-btn&#x27;)).toHaveLength(1);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<p>åœ¨è¿™é‡Œæˆ‘ä»¬ä½¿ç”¨äº† shallowï¼Œå…¶å®ä¹Ÿå¯ä»¥ä½¿ç”¨ mountã€‚</p>
<p>shallow å’Œ mount çš„åŒºåˆ«ï¼Œå°±æ˜¯ shallow åªä¼šæ¸²æŸ“è¢«æµ‹è¯•çš„ React ç»„ä»¶è¿™ä¸€å±‚ï¼Œä¸ä¼šæ¸²æŸ“å­ç»„ä»¶ï¼›è€Œ mount åˆ™æ˜¯å®Œæ•´åœ°æ¸²æŸ“ React ç»„ä»¶åŒ…æ‹¬å…¶æ‰€æœ‰å­ç»„ä»¶ï¼ŒåŒ…æ‹¬è§¦å‘ componentDidMount ç”Ÿå‘½å‘¨æœŸå‡½æ•°ã€‚</p>
<p>åŸåˆ™ä¸Šï¼Œèƒ½ç”¨ shallow å°±å°½é‡ç”¨ shallowï¼Œé¦–å…ˆæ˜¯ä¸ºäº†æµ‹è¯•æ€§èƒ½è€ƒè™‘ï¼Œå…¶æ¬¡æ˜¯å¯ä»¥å‡å°‘ç»„ä»¶ä¹‹é—´çš„å½±å“ï¼Œæ¯”å¦‚ï¼Œä¸€ä¸ªç»„ä»¶ Foo æœ‰å­ç»„ä»¶ Barï¼Œå¦‚ä¸‹</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">const Foo = () =&gt; ()</span><br><span class="line">    &lt;div&gt;</span><br><span class="line">       &#123;/* other logic */</span><br><span class="line">       &lt;Bar /&gt;</span><br><span class="line">    &lt;/div&gt;</span><br><span class="line">)</span><br></pre></td></tr></table></figure>

<p>å¦‚æœç”¨ mount å»æ¸²æŸ“ Fooï¼Œä¼šè¿å¸¦ Bar ä¸€èµ·å®Œå…¨æ¸²æŸ“ï¼Œå¦‚æœ Bar å‡ºäº†ä»€ä¹ˆæ¯›ç—…ï¼Œé‚£ Foo çš„å•å…ƒæµ‹è¯•ä¹Ÿè¿‡ä¸äº†ï¼›å¦‚æœç”¨ shallowï¼ŒåªçŸ¥é“ Bar æ›¾ç»è¢«ç”¨ï¼Œå³ä½¿ Bar å“ªé‡Œå‡ºäº†é—®é¢˜ï¼Œä¹Ÿä¸å½±å“ Foo çš„å•å…ƒæµ‹è¯•ã€‚</p>
<p>è¿™å¹¶ä¸æ˜¯è¯´æˆ‘ä»¬å°±ä¸ç®¡ Barï¼ŒBar çš„è´¨é‡ä¼šç”±å®ƒè‡ªå·±çš„å•å…ƒæµ‹è¯•æ¥æ£€éªŒï¼Œè¿™å°±å¼•å‡ºä¸‹ä¸€ä¸ªè¯é¢˜â€”â€”ä»£ç è¦†ç›–ç‡ã€‚</p>
<p><strong>ä»£ç è¦†ç›–ç‡</strong></p>
<p>ä½ ä¸èƒ½ç»™è‡ªå·±çš„ç¨‹åºéšä¾¿å†™å‡ ä¸ªå•å…ƒæµ‹è¯•ï¼Œå°±è¯´è‡ªå·±çš„ä»£ç å·²ç»æµ‹è¯•å¥½äº†ï¼Œå°±åƒä¸Šé¢æˆ‘åªç»™ ControlButtons ç»„ä»¶å†™äº†ä¸€ä¸ªæµ‹è¯•ç”¨ä¾‹ï¼Œæˆ‘å¹¶ä¸èƒ½è¯´æ•´ä¸ªç§’è¡¨åº”ç”¨å·²ç»é€šè¿‡äº†æµ‹è¯•ã€‚</p>
<p>ä½ çš„ä»£ç æµ‹è¯•è¦†ç›–ç‡åªæœ‰è¾¾åˆ°ä¸€å®šç¨‹åº¦ï¼Œæ‰å¥½è¯´è‡ªå·±çš„ä»£ç å·²ç»è¢«æµ‹è¯•äº†ã€‚</p>
<p>å‰©ä¸‹æ¥å°±æ˜¯ä¸€ä¸ªçº ç»“çš„é—®é¢˜ï¼šä»£ç æµ‹è¯•çš„è¦†ç›–ç‡åº”è¯¥è¾¾åˆ°å¤šå°‘æ‰ç®—å¤Ÿï¼Ÿ</p>
<p>ä»¥æˆ‘ä¸ªäººçš„ç»éªŒï¼Œä»£ç è¦†ç›–ç‡å¿…é¡»è¾¾åˆ° 100%ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œä¸€ä¸ªåº”ç”¨ä¸å…‰æ‰€æœ‰çš„å•å…ƒæµ‹è¯•éƒ½è¦é€šè¿‡ï¼Œè€Œä¸”æ‰€æœ‰å•å…ƒæµ‹è¯•éƒ½å¿…é¡»è¦†ç›–åˆ°ä»£ç  100% çš„è§’è½ã€‚</p>
<p>å¦‚æœå¯¹è¦†ç›–ç‡çš„è¦æ±‚ä½äº 100%ï¼Œæ—¶é—´ä¸€é•¿ï¼Œè´¨é‡å¿…å®šä¼šè¶Šæ¥è¶Šä¸‹æ»‘ã€‚</p>
<p>é‡åˆ°ä¸€ä¸ªä¸å¥½æµ‹è¯•çš„ä»£ç ï¼Œå¼€å‘è€…å€¾å‘äºä¸å»è€ƒè™‘å¦‚ä½•é‡æ„ä»£ç æé«˜å¯æµ‹è¯•æ€§ï¼Œè€Œæ˜¯ç›´æ¥å¿½ç•¥è¿™éƒ¨åˆ†ä»£ç ä¸å»æµ‹è¯•ï¼Œåæ­£ä¸è¦æ±‚ 100% å˜›ï¼›é‡åˆ°å·¥æœŸæ¯”è¾ƒç´§çš„æ—¶å€™ï¼Œç”šè‡³ä¼šè¿›ä¸€æ­¥é™ä½ä»£ç è¦†ç›–ç‡è¦æ±‚ï¼Œç”¨ç‰ºç‰²è´¨é‡æ¥åŠ å¿«å¼€å‘é€Ÿåº¦ï¼Œåæ­£ä¸è¦æ±‚ 100% å˜›ã€‚</p>
<p>æ‰€ä»¥ï¼Œå¦‚æœä½ çœŸçš„å¯¹ä»£ç è´¨é‡è®¤çœŸè´Ÿè´£çš„è¯ï¼Œè¯·åšå®ˆ 100% ä»£ç è¦†ç›–ç‡çš„åº•çº¿ï¼</p>
<p>åœ¨ create-react-app åˆ›é€ çš„åº”ç”¨ä¸­ï¼Œå·²ç»è‡ªå¸¦äº†ä»£ç è¦†ç›–ç‡çš„æ”¯æŒï¼Œè¿è¡Œä¸‹é¢çš„å‘½ä»¤ï¼Œä¸å…‰ä¼šè¿è¡Œæ‰€æœ‰å•å…ƒæµ‹è¯•ï¼Œä¹Ÿä¼šå¾—åˆ°è¦†ç›–ç‡æ±‡æŠ¥</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm test -- --coverage</span><br></pre></td></tr></table></figure>

<blockquote>
<p>ä»£ç è¦†ç›–ç‡åŒ…å«å››ä¸ªæ–¹é¢ï¼š</p>
</blockquote>
<ul>
<li>è¯­å¥è¦†ç›–ç‡</li>
<li>é€»è¾‘åˆ†æ”¯è¦†ç›–ç‡</li>
<li>å‡½æ•°è¦†ç›–ç‡</li>
<li>ä»£ç è¡Œè¦†ç›–ç‡</li>
</ul>
<p>åªæœ‰å››ä¸ªæ–¹é¢éƒ½æ˜¯ 100%ï¼Œæ‰ç®—çœŸçš„ 100%ã€‚</p>
<h2 id="äº”ã€React-çŠ¶æ€ç®¡ç†"><a href="#äº”ã€React-çŠ¶æ€ç®¡ç†" class="headerlink" title="äº”ã€React çŠ¶æ€ç®¡ç†"></a>äº”ã€React çŠ¶æ€ç®¡ç†</h2><h3 id="5-1-ç»„ä»¶çŠ¶æ€"><a href="#5-1-ç»„ä»¶çŠ¶æ€" class="headerlink" title="5.1 ç»„ä»¶çŠ¶æ€"></a>5.1 ç»„ä»¶çŠ¶æ€</h3><p>React å…¶å®å°±æ˜¯è¿™æ ·ä¸€ä¸ªå…¬å¼</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">UI = f(data)</span><br></pre></td></tr></table></figure>

<blockquote>
<p>f çš„å‚æ•° dataï¼Œé™¤äº† propsï¼Œå°±æ˜¯ stateã€‚props æ˜¯ç»„ä»¶å¤–ä¼ é€’è¿›æ¥çš„æ•°æ®ï¼Œstate ä»£è¡¨çš„å°±æ˜¯ React ç»„ä»¶çš„å†…éƒ¨çŠ¶</p>
</blockquote>
<p><strong>ä¸ºä»€ä¹ˆè¦äº†è§£ React ç»„ä»¶è‡ªèº«çŠ¶æ€ç®¡ç†</strong></p>
<ul>
<li>å› ä¸º React ç»„ä»¶è‡ªèº«çš„çŠ¶æ€ç®¡ç†æ˜¯åŸºç¡€ï¼Œå…¶ä»–ç¬¬ä¸‰æ–¹å·¥å…·éƒ½æ˜¯åœ¨è¿™ä¸ªåŸºç¡€ä¸Šæ„ç­‘çš„ï¼Œè¿åŸºç¡€éƒ½ä¸äº†è§£ï¼Œæ— æ³•çœŸæ­£ç†è§£ç¬¬ä¸‰æ–¹å·¥å…·</li>
<li>å¯¹äºå¾ˆå¤šåº”ç”¨åœºæ™¯ï¼ŒReact ç»„ä»¶è‡ªèº«çš„çŠ¶æ€ç®¡ç†å°±è¶³å¤Ÿè§£å†³é—®é¢˜ï¼ŒçŠ¯ä¸ä¸ŠåŠ¨ç”¨ Redux å’Œ MobX è¿™æ ·çš„å¤§æ€å™¨ï¼Œç®€å•é—®é¢˜ç®€å•å¤„ç†ï¼Œå¯ä»¥è®©ä»£ç æ›´å®¹æ˜“ç»´æŠ¤</li>
</ul>
<p><strong>ç»„ä»¶è‡ªèº«çŠ¶æ€ state</strong></p>
<p>ä»€ä¹ˆæ•°æ®æ”¾åœ¨ state ä¸­</p>
<p>å¯¹äº React ç»„ä»¶è€Œè¨€ï¼Œæ•°æ®åˆ†ä¸ºä¸¤ç§</p>
<ul>
<li><code>props</code></li>
<li><code>state</code></li>
</ul>
<p>äºŒè€…çš„åŒºåˆ«æ˜¾è€Œæ˜“è§ï¼Œç®€å•è¯´å°±æ˜¯ï¼Œprops æ˜¯å¤–éƒ¨ä¼ ç»™ç»„ä»¶çš„æ•°æ®ï¼Œè€Œ state æ˜¯ç»„ä»¶è‡ªå·±ç»´æŠ¤çš„æ•°æ®ï¼Œå¯¹å¤–éƒ¨æ˜¯ä¸å¯è§çš„ã€‚</p>
<p>æ‰€ä»¥ï¼Œåˆ¤æ–­æŸä¸ªæ•°æ®ä»¥ props æ–¹å¼å­˜åœ¨ï¼Œè¿˜æ˜¯ä»¥ state æ–¹å¼å­˜åœ¨ï¼Œå¹¶ä¸éš¾ï¼Œåªéœ€è¦åˆ¤æ–­è¿™ä¸ªçŠ¶æ€æ˜¯å¦æ˜¯ç»„ä»¶å†…éƒ¨çŠ¶æ€ã€‚</p>
<p>ä¸€ä¸ªç»å¸¸è¢«é—®åˆ°çš„é—®é¢˜ï¼Œå°±æ˜¯ä¸ºä»€ä¹ˆä¸æŠŠç»„ä»¶çš„æ•°æ®ç›´æ¥å­˜æ”¾åœ¨ç»„ä»¶ç±»çš„æˆå‘˜å˜é‡ä¸­ï¼Ÿæ¯”å¦‚åƒä¸‹é¢è¿™æ ·ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">class Foo extends React.Component &#123;</span><br><span class="line">  foo = &#x27;foo&#x27;</span><br><span class="line">  </span><br><span class="line">  render() &#123;</span><br><span class="line">    return (</span><br><span class="line">      &lt;React.Fragment&gt;&#123;this.foo&#125;&lt;/React.Fragment&gt;</span><br><span class="line">    );</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<blockquote>
<p>åƒä¸Šé¢ï¼Œæ•°æ®å­˜åœ¨ this.foo ä¸­ï¼Œè€Œä¸æ˜¯å­˜åœ¨ this.state.foo ä¸­ï¼Œå½“è¿™ä¸ªç»„ä»¶æ¸²æŸ“çš„æ—¶å€™ï¼Œå½“ç„¶ this.foo çš„å€¼ä¹Ÿå°±è¢«æ¸²æŸ“å‡ºæ¥äº†ï¼Œé—®é¢˜æ˜¯ï¼Œæ›´æ–° this.foo å¹¶ä¸ä¼šå¼•å‘ç»„ä»¶çš„é‡æ–°æ¸²æŸ“ï¼Œè¿™å¾ˆå¯èƒ½ä¸æ˜¯æˆ‘ä»¬æƒ³è¦çš„ã€‚</p>
</blockquote>
<p>æ‰€ä»¥ï¼Œåˆ¤æ–­ä¸€ä¸ªæ•°æ®åº”è¯¥æ”¾åœ¨å“ªé‡Œï¼Œç”¨ä¸‹é¢çš„åŸåˆ™</p>
<ul>
<li>å¦‚æœæ•°æ®ç”±å¤–éƒ¨ä¼ å…¥ï¼Œæ”¾åœ¨ props ä¸­</li>
<li>å¦‚æœæ˜¯ç»„ä»¶å†…éƒ¨çŠ¶æ€ï¼Œæ˜¯å¦è¿™ä¸ªçŠ¶æ€æ›´æ”¹åº”è¯¥ç«‹åˆ»å¼•å‘ä¸€æ¬¡ç»„ä»¶é‡æ–°æ¸²æŸ“ï¼Ÿå¦‚æœæ˜¯ï¼Œæ”¾åœ¨ state ä¸­ï¼›ä¸æ˜¯ï¼Œæ”¾åœ¨æˆå‘˜å˜é‡ä¸­</li>
</ul>
<p><strong>ä¿®æ”¹ state çš„æ­£ç¡®æ–¹å¼</strong></p>
<p>ç»„ä»¶è‡ªèº«çš„çŠ¶æ€å¯ä»¥é€šè¿‡ this.state è¯»åˆ°ï¼Œthis.state æœ¬èº«å°±æ˜¯ä¸€ä¸ªå¯¹è±¡ï¼Œä½†æ˜¯ä¿®æ”¹çŠ¶æ€ä¸åº”è¯¥é€šè¿‡ç›´æ¥ä¿®æ”¹ this.state å¯¹è±¡æ¥å®Œæˆã€‚å› ä¸ºï¼Œæˆ‘ä»¬ä¿®æ”¹ stateï¼Œå½“ç„¶ä¸åªæ˜¯æƒ³ä¿®æ”¹è¿™ä¸ªå¯¹è±¡çš„å€¼ï¼Œè€Œæ˜¯æƒ³å¼•å‘ React ç»„ä»¶çš„é‡æ–°æ¸²æŸ“ã€‚</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">this.state.foo = &#x27;bar&#x27;; //é”™è¯¯çš„æ–¹å¼</span><br><span class="line"></span><br><span class="line">this.setState(&#123;foo:&#x27;bar&#x27;&#125;); //æ­£ç¡®çš„æ–¹å¼</span><br></pre></td></tr></table></figure>

<p>å¦‚ä¸Šé¢ä»£ç æ‰€ç¤ºï¼Œå¦‚æœåªæ˜¯ä¿®æ”¹ this.stateï¼Œé‚£æ”¹äº†ä¹Ÿå°±åªæ˜¯æ”¹äº†è¿™ä¸ªå¯¹è±¡ï¼Œå…¶ä»–çš„ä»€ä¹ˆéƒ½ä¸ä¼šå‘ç”Ÿï¼›å¦‚æœä½¿ç”¨ setState å‡½æ•°ï¼Œé‚£ä¸å…‰ä¿®æ”¹ stateï¼Œè¿˜èƒ½å¼•å‘ç»„ä»¶çš„é‡æ–°æ¸²æŸ“ï¼Œåœ¨é‡æ–°æ¸²æŸ“ä¸­å°±ä¼šä½¿ç”¨ä¿®æ”¹åçš„ stateï¼Œè¿™ä¹Ÿå°±æ˜¯è¾¾åˆ°æ ¹æ® state æ”¹å˜å…¬å¼å·¦ä¾§ UI çš„ç›®çš„ã€‚</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">UI = f(state)</span><br></pre></td></tr></table></figure>

<p>state æ”¹å˜å¼•å‘é‡æ–°æ¸²æŸ“çš„æ—¶æœº</p>
<p>ç°åœ¨æˆ‘ä»¬çŸ¥é“åº”è¯¥ç”¨ setState å‡½æ•°æ¥ä¿®æ”¹ç»„ä»¶ stateï¼Œè€Œä¸”å¯ä»¥å¼•å‘ç»„ä»¶é‡æ–°æ¸²æŸ“ï¼Œæœ‰æ„æ€çš„æ˜¯ï¼Œå¹¶ä¸æ˜¯ä¸€æ¬¡ setState è°ƒç”¨è‚¯å®šä¼šå¼•å‘ä¸€æ¬¡é‡æ–°æ¸²æŸ“ã€‚</p>
<p>è¿™æ˜¯ React çš„ä¸€ç§æ€§èƒ½ä¼˜åŒ–ç­–ç•¥ï¼Œå¦‚æœ React å¯¹æ¯ä¸€æ¬¡ setState éƒ½ç«‹åˆ»åšä¸€æ¬¡ç»„ä»¶é‡æ–°æ¸²æŸ“ï¼Œé‚£ä»£ä»·æœ‰ç‚¹å¤§ï¼Œæ¯”å¦‚ä¸‹é¢çš„ä»£ç ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">this.setState(&#123;count: 1&#125;);</span><br><span class="line">this.setState(&#123;caption: &#x27;foo&#x27;&#125;);</span><br><span class="line">this.setState(&#123;count: 2&#125;);</span><br></pre></td></tr></table></figure>

<p>è¿ç»­çš„åŒæ­¥è°ƒç”¨ setStateï¼Œç¬¬ä¸‰æ¬¡è¿˜è¦†ç›–äº†ç¬¬ä¸€æ¬¡è°ƒç”¨çš„æ•ˆæœï¼Œä½†æ˜¯æ•ˆæœåªç›¸å½“äºè°ƒç”¨äº†ä¸‹é¢è¿™æ ·ä¸€æ¬¡</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">this.setState(&#123;count: 2, caption: &#x27;foo&#x27;&#125;);</span><br></pre></td></tr></table></figure>

<p>è™½ç„¶æ˜æ™ºçš„å¼€å‘è€…ä¸ä¼šæ•…æ„è¿ç»­å†™ä¸‰ä¸ª setState è°ƒç”¨ï¼Œä½†æ˜¯ä»£ç ä¸€æ—¦å†™å¾—å¤æ‚ï¼Œå¯èƒ½æœ‰å¤šä¸ª setState åˆ†å¸ƒåœ¨ä¸€æ¬¡æ‰§è¡Œçš„ä¸åŒä»£ç ç‰‡æ®µä¸­ï¼Œè¿˜æ˜¯ä¼šåŒæ­¥è¿ç»­è°ƒç”¨ setStateï¼Œè¿™æ—¶å€™ï¼Œå¦‚æœçœŸçš„æ¯ä¸ª setState éƒ½å¼•å‘ä¸€æ¬¡é‡æ–°æ¸²æŸ“ï¼Œå®åœ¨å¤ªæµªè´¹äº†ã€‚</p>
<p>React éå¸¸å·§å¦™åœ°ç”¨ä»»åŠ¡é˜Ÿåˆ—è§£å†³äº†è¿™ä¸ªé—®é¢˜ï¼Œå¯ä»¥ç†è§£ä¸ºæ¯æ¬¡ setState å‡½æ•°è°ƒç”¨éƒ½ä¼šå¾€ React çš„ä»»åŠ¡é˜Ÿåˆ—é‡Œæ”¾ä¸€ä¸ªä»»åŠ¡ï¼Œå¤šæ¬¡ setState è°ƒç”¨è‡ªç„¶ä¼šå¾€é˜Ÿåˆ—é‡Œæ”¾å¤šä¸ªä»»åŠ¡ã€‚React ä¼šé€‰æ‹©æ—¶æœºå»æ‰¹é‡å¤„ç†é˜Ÿåˆ—é‡Œæ‰§è¡Œä»»åŠ¡ï¼Œå½“æ‰¹é‡å¤„ç†å¼€å§‹æ—¶ï¼ŒReact ä¼šåˆå¹¶å¤šä¸ª setState çš„æ“ä½œï¼Œæ¯”å¦‚ä¸Šé¢çš„ä¸‰ä¸ª setState å°±è¢«åˆå¹¶ä¸ºåªæ›´æ–° state ä¸€æ¬¡ï¼Œä¹Ÿåªå¼•å‘ä¸€æ¬¡é‡æ–°æ¸²æŸ“ã€‚</p>
<p>å› ä¸ºè¿™ä¸ªä»»åŠ¡é˜Ÿåˆ—çš„å­˜åœ¨ï¼ŒReact å¹¶ä¸ä¼šåŒæ­¥æ›´æ–° stateï¼Œæ‰€ä»¥ï¼Œåœ¨ React ä¸­ï¼ŒsetState ä¹Ÿä¸ä¿è¯åŒæ­¥æ›´æ–° state ä¸­çš„æ•°æ®ã€‚</p>
<p><strong>state ä¸ä¼šè¢«åŒæ­¥ä¿®æ”¹</strong></p>
<p>ç®€å•è¯´æ¥ï¼Œè°ƒç”¨ setState ä¹‹åçš„ä¸‹ä¸€è¡Œä»£ç ï¼Œè¯»å– this.state å¹¶ä¸æ˜¯ä¿®æ”¹ä¹‹åçš„ç»“æœ</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">console.log(this.state.count);// ä¿®æ”¹ä¹‹å‰this.state.countä¸º0</span><br><span class="line">this.setState(&#123;count: 1&#125;)</span><br><span class="line">console.log(this.state.count);// åœ¨è¿™é‡Œthis.state.countä¾ç„¶ä¸º0</span><br></pre></td></tr></table></figure>

<p>è¿™ä¹çœ‹æ˜¯å¾ˆè®©äººè´¹è§£çš„ç»“æœï¼Œä½†æ˜¯å¦‚æœä½ ç†è§£äº†ä¸Šé¢ React ä»»åŠ¡é˜Ÿåˆ—çš„è®¾è®¡ï¼Œä¸€åˆ‡ä¹Ÿä¸éš¾ç†è§£ã€‚</p>
<p>setState åªæ˜¯ç»™ä»»åŠ¡é˜Ÿåˆ—é‡Œå¢åŠ äº†ä¸€ä¸ªä¿®æ”¹ this.state çš„ä»»åŠ¡ï¼Œè¿™ä¸ªä»»åŠ¡å¹¶æ²¡æœ‰ç«‹å³æ‰§è¡Œï¼Œæ‰€ä»¥ this.state å¹¶ä¸ä¼šç«‹åˆ»æ”¹å˜ã€‚</p>
<p>å¥½å§ï¼Œå…¶å®é—®é¢˜ä¹Ÿæ²¡æœ‰é‚£ä¹ˆç®€å•ï¼Œä¸Šé¢æˆ‘æ‰€ä¸¾çš„ä¾‹å­ä¸­ï¼Œéƒ½å‡è®¾ setState æ˜¯ç”± React çš„ç”Ÿå‘½å‘¨æœŸå‡½æ•°æˆ–è€…äº‹ä»¶å¤„ç†å‡½æ•°ä¸­åŒæ­¥è°ƒç”¨ï¼Œè¿™ç§æƒ…å†µä¸‹ setState ä¸ä¼šç«‹å³åŒæ­¥æ›´æ–° state å’Œé‡æ–°æ¸²æŸ“ï¼Œä½†æ˜¯ï¼Œå¦‚æœè°ƒç”¨ setState ç”±å…¶ä»–æ¡ä»¶å¼•å‘ï¼Œå°±ä¸æ˜¯è¿™æ ·äº†ã€‚</p>
<p>çœ‹ä¸‹é¢çš„ä»£ç ï¼Œç»“æœå¯èƒ½ä¼šå‡ºä¹ä½ çš„æ‰€æ–™ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">setTimeout(() =&gt; &#123;</span><br><span class="line">  this.setState(&#123;count: 2&#125;); //è¿™ä¼šç«‹åˆ»å¼•å‘é‡æ–°æ¸²æŸ“</span><br><span class="line">  console.log(this.state.count); //è¿™é‡Œè¯»å–çš„countå°±æ˜¯2</span><br><span class="line">&#125;, 0);</span><br></pre></td></tr></table></figure>

<p>ä¸ºä»€ä¹ˆ setTimeout èƒ½å¤Ÿå¼ºè¿« setState åŒæ­¥æ›´æ–° state å‘¢ï¼Ÿ</p>
<p>å¯ä»¥è¿™ä¹ˆç†è§£ï¼Œå½“ React è°ƒç”¨æŸä¸ªç»„ä»¶çš„ç”Ÿå‘½å‘¨æœŸå‡½æ•°æˆ–è€…äº‹ä»¶å¤„ç†å‡½æ•°æ—¶ï¼ŒReact ä¼šæƒ³ï¼šâ€œå—¯ï¼Œè¿™ä¸€æ¬¡å‡½æ•°å¯èƒ½è°ƒç”¨å¤šæ¬¡ setStateï¼Œæˆ‘ä¼šå…ˆæ‰“å¼€ä¸€ä¸ªæ ‡è®°ï¼Œåªè¦è¿™ä¸ªæ ‡è®°æ˜¯æ‰“å¼€çš„ï¼Œæ‰€æœ‰çš„ setState è°ƒç”¨éƒ½æ˜¯å¾€ä»»åŠ¡é˜Ÿåˆ—é‡Œæ”¾ä»»åŠ¡ï¼Œå½“è¿™ä¸€æ¬¡å‡½æ•°è°ƒç”¨ç»“æŸçš„æ—¶å€™ï¼Œæˆ‘å†å»æ‰¹é‡å¤„ç†ä»»åŠ¡é˜Ÿåˆ—ï¼Œç„¶åæŠŠè¿™ä¸ªæ ‡è®°å…³é—­ã€‚â€</p>
<p>å› ä¸º setTimeout æ˜¯ä¸€ä¸ª JavaScript å‡½æ•°ï¼Œå’Œ React æ— å…³ï¼Œå¯¹äº setTimeout çš„ç¬¬ä¸€ä¸ªå‡½æ•°å‚æ•°ï¼Œè¿™ä¸ªå‡½æ•°å‚æ•°çš„æ‰§è¡Œæ—¶æœºï¼Œå·²ç»ä¸æ˜¯ React èƒ½å¤Ÿæ§åˆ¶çš„äº†ï¼Œæ¢å¥è¯è¯´ï¼ŒReact ä¸çŸ¥é“ä»€ä¹ˆæ—¶å€™è¿™ä¸ªå‡½æ•°å‚æ•°ä¼šè¢«æ‰§è¡Œï¼Œæ‰€ä»¥é‚£ä¸ªâ€œæ ‡è®°â€ä¹Ÿæ²¡æœ‰æ‰“å¼€ã€‚</p>
<p>å½“é‚£ä¸ªâ€œæ ‡è®°â€æ²¡æœ‰æ‰“å¼€æ—¶ï¼ŒsetState å°±ä¸ä¼šç»™ä»»åŠ¡åˆ—è¡¨é‡Œå¢åŠ ä»»åŠ¡ï¼Œè€Œæ˜¯å¼ºè¡Œç«‹åˆ»æ›´æ–° state å’Œå¼•å‘é‡æ–°æ¸²æŸ“ã€‚è¿™ç§æƒ…å†µä¸‹ï¼ŒReact è®¤ä¸ºï¼šâ€œè¿™ä¸ª setState å‘ç”Ÿåœ¨è‡ªå·±æ§åˆ¶èƒ½åŠ›ä¹‹å¤–ï¼Œä¹Ÿè®¸å¼€å‘è€…å°±æ˜¯æƒ³è¦å¼ºè¡ŒåŒæ­¥æ›´æ–°å‘¢ï¼Œå®æ»¥å‹¿ç¼ºï¼Œé‚£å°±åŒæ­¥æ›´æ–°äº†å§ã€‚â€</p>
<p>çŸ¥é“è¿™ä¸ªâ€œæŠ€å·§â€ä¹‹åï¼Œå¯èƒ½ä¼šæœ‰å¼€å‘è€…è¯´ï¼šå¥½å•Šï¼Œé‚£ä¹ˆä»¥åæˆ‘å°±ç”¨ setTimeout æ¥è°ƒç”¨ setState å§ï¼Œèƒ½å¤Ÿç«‹åˆ»æ›´æ–° stateï¼Œå¤šå¥½ï¼</p>
<p>æˆ‘åŠä½ ä¸è¦è¿™ä¹ˆåšã€‚</p>
<p>å°±åƒä¸Šé¢æ‰€è¯´ï¼ŒReact é€‰æ‹©ä¸åŒæ­¥æ›´æ–° stateï¼Œæ˜¯ä¸€ç§æ€§èƒ½ä¼˜åŒ–ï¼Œå¦‚æœä½ ç”¨ä¸Š setTimeoutï¼Œå°±æ²¡æœºä¼šè®© React ä¼˜åŒ–äº†ã€‚</p>
<p>è€Œä¸”ï¼Œæ¯å½“ä½ è§‰å¾—éœ€è¦åŒæ­¥æ›´æ–° state çš„æ—¶å€™ï¼Œå¾€å¾€è¯´æ˜ä½ çš„ä»£ç è®¾è®¡å­˜åœ¨é—®é¢˜ï¼Œç»å¤§éƒ¨åˆ†æƒ…å†µä¸‹ï¼Œä½ æ‰€éœ€è¦çš„ï¼Œå¹¶ä¸æ˜¯â€œstate ç«‹åˆ»æ›´æ–°â€ï¼Œè€Œæ˜¯ï¼Œâ€œç¡®å®š state æ›´æ–°ä¹‹åæˆ‘è¦åšä»€ä¹ˆâ€ï¼Œè¿™å°±å¼•å‡ºäº† setState å¦ä¸€ä¸ªåŠŸèƒ½</p>
<p><strong>setState çš„ç¬¬äºŒä¸ªå‚æ•°</strong></p>
<blockquote>
<p>setState çš„ç¬¬äºŒä¸ªå‚æ•°å¯ä»¥æ˜¯ä¸€ä¸ªå›è°ƒå‡½æ•°ï¼Œå½“ state çœŸçš„è¢«ä¿®æ”¹æ—¶ï¼Œè¿™ä¸ªå›è°ƒå‡½æ•°ä¼šè¢«è°ƒç”¨</p>
</blockquote>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">console.log(this.state.count); // 0</span><br><span class="line">this.setState(&#123;count: 1&#125;, () =&gt; &#123;</span><br><span class="line">    console.log(this.state.count); // è¿™é‡Œå°±æ˜¯1äº†</span><br><span class="line">&#125;)</span><br><span class="line">console.log(this.state.count); // ä¾ç„¶ä¸º0</span><br></pre></td></tr></table></figure>

<p>å½“ setState çš„ç¬¬äºŒä¸ªå‚æ•°è¢«è°ƒç”¨æ—¶ï¼ŒReact å·²ç»å¤„ç†å®Œäº†ä»»åŠ¡åˆ—è¡¨ï¼Œæ‰€ä»¥ this.state å°±æ˜¯æ›´æ–°åçš„æ•°æ®ã€‚</p>
<p>å¦‚æœéœ€è¦åœ¨ state æ›´æ–°ä¹‹ååšç‚¹ä»€ä¹ˆï¼Œè¯·åˆ©ç”¨ç¬¬äºŒä¸ªå‚æ•°ã€‚</p>
<p><strong>å‡½æ•°å¼ setState</strong></p>
<p>ä¸ç®¡æ€ä¹ˆè¯´ï¼ŒsetState ä¸èƒ½åŒæ­¥æ›´æ–°çš„ç¡®ä¼šå¸¦æ¥ä¸€äº›éº»çƒ¦ï¼Œå°¤å…¶æ˜¯å¤šä¸ª setState è°ƒç”¨ä¹‹é—´æœ‰ä¾èµ–å…³ç³»çš„æ—¶å€™ï¼Œå¾ˆå®¹æ˜“å†™é”™ä»£ç ã€‚</p>
<p>ä¸€ä¸ªå¾ˆå…¸å‹çš„ä¾‹å­ï¼Œå½“æˆ‘ä»¬ä¸æ–­å¢åŠ ä¸€ä¸ª state çš„å€¼æ—¶ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">this.setState(&#123;count: this.state.count + 1&#125;);</span><br><span class="line">this.setState(&#123;count: this.state.count + 1&#125;);</span><br><span class="line">this.setState(&#123;count: this.state.count + 1&#125;);</span><br></pre></td></tr></table></figure>

<p>ä¸Šé¢çš„ä»£ç è¡¨é¢ä¸Šçœ‹ä¼šè®© this.state.count å¢åŠ  3ï¼Œå®é™…ä¸Šåªå¢åŠ äº† 1ï¼Œå› ä¸º setState æ²¡æœ‰åŒæ­¥æ›´æ–° this.state å•Šï¼Œæ‰€ä»¥ç»™ä»»åŠ¡é˜Ÿåˆ—åŠ çš„ä¸‰ä¸ªä»»åŠ¡éƒ½æ˜¯ç»™ this.state.count åŒä¸€ä¸ªå€¼è€Œå·²ã€‚</p>
<p>é¢å¯¹è¿™ç§æƒ…å†µï¼Œæˆ‘ä»¬å¾ˆè‡ªç„¶åœ°æƒ³åˆ°ï¼Œå¦‚æœä»»åŠ¡åˆ—è¡¨ä¸­çš„ä»»åŠ¡ä¸åªæ˜¯ç»™ state ä¸€ä¸ªå›ºå®šæ•°æ®ï¼Œå¦‚æœä»»åŠ¡åˆ—è¡¨é‡Œçš„â€œä»»åŠ¡â€æ˜¯ä¸€ä¸ªå‡½æ•°ï¼Œèƒ½å¤Ÿæ ¹æ®å½“å‰ state è®¡ç®—æ–°çš„çŠ¶æ€ï¼Œé‚£è¯¥å¤šå¥½ï¼</p>
<p>å®é™…ä¸Šï¼ŒsetState å·²ç»æ”¯æŒè¿™ç§åŠŸèƒ½ï¼Œåˆ°ç°åœ¨ä¸ºæ­¢æˆ‘ä»¬ç»™ setState çš„ç¬¬ä¸€ä¸ªå‚æ•°éƒ½æ˜¯å¯¹è±¡ï¼Œå…¶å®ä¹Ÿå¯ä»¥ä¼ å…¥ä¸€ä¸ªå‡½æ•°ã€‚</p>
<p>å½“ setState çš„ç¬¬ä¸€ä¸ªå‚æ•°ä¸ºå‡½æ•°æ—¶ï¼Œä»»åŠ¡åˆ—è¡¨ä¸Šå¢åŠ çš„å°±æ˜¯ä¸€ä¸ªå¯æ‰§è¡Œçš„ä»»åŠ¡å‡½æ•°äº†ï¼ŒReact æ¯å¤„ç†å®Œä¸€ä¸ªä»»åŠ¡ï¼Œéƒ½ä¼šæ›´æ–° this.stateï¼Œç„¶åæŠŠæ–°çš„ state ä¼ é€’ç»™è¿™ä¸ªä»»åŠ¡å‡½æ•°ã€‚</p>
<p>setState ç¬¬ä¸€ä¸ªå‚æ•°çš„å½¢å¼å¦‚ä¸‹ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">function increment(state, props) &#123;</span><br><span class="line">  return &#123;count: state.count + 1&#125;;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>å¯ä»¥çœ‹åˆ°ï¼Œè¿™æ˜¯ä¸€ä¸ªçº¯å‡½æ•°ï¼Œä¸å…‰æ¥å—å½“å‰çš„ stateï¼Œè¿˜æ¥å—ç»„ä»¶çš„ propsï¼Œåœ¨è¿™ä¸ªå‡½æ•°ä¸­å¯ä»¥æ ¹æ® state å’Œ props ä»»æ„è®¡ç®—ï¼Œè¿”å›çš„ç»“æœä¼šç”¨äºä¿®æ”¹ this.stateã€‚</p>
<p>å¦‚æ­¤ä¸€æ¥ï¼Œæˆ‘ä»¬å°±å¯ä»¥è¿™æ ·è¿ç»­è°ƒç”¨ setStateï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">this.setState(increment);</span><br><span class="line">this.setState(increment);</span><br><span class="line">this.setState(increment);</span><br></pre></td></tr></table></figure>

<blockquote>
<p>ç”¨è¿™ç§å‡½æ•°å¼æ–¹å¼è¿ç»­è°ƒç”¨ setStateï¼Œå°±çœŸçš„èƒ½å¤Ÿè®© this.state.count å¢åŠ  3ï¼Œè€Œä¸åªæ˜¯å¢åŠ  1ã€‚</p>
</blockquote>
<h3 id="5-2-Mobx-ä½¿ç”¨æ¨¡å¼"><a href="#5-2-Mobx-ä½¿ç”¨æ¨¡å¼" class="headerlink" title="5.2 Mobx ä½¿ç”¨æ¨¡å¼"></a>5.2 Mobx ä½¿ç”¨æ¨¡å¼</h3><p><strong>ç†è§£ Mobx</strong></p>
<blockquote>
<p>è™½ç„¶ Mobx å’Œ Redux æœ‰å¾ˆå¤§ä¸åŒï¼Œä½†æ˜¯è‡³å°‘è¿˜æœ‰ä¸€ä¸ªå…±åŒç‚¹â€”â€”è¿™ä¸¤ä¸ªå·¥å…·éƒ½å’Œ React æ²¡æœ‰ä»»ä½•ç›´æ¥å…³ç³»ï¼Œåªä¸è¿‡å‡‘å·§ React ç¤¾åŒºå¤§é‡ä½¿ç”¨å®ƒä»¬ç½¢äº†ã€‚ä»æŠ€æœ¯ä¸Šè¯´ï¼ŒMobx å’Œ Redux éƒ½æ˜¯ä¸­ç«‹çš„çŠ¶æ€ç®¡ç†å·¥å…·ï¼Œä»–ä»¬èƒ½å¤Ÿåº”ç”¨äº Reactï¼Œä¹Ÿå¯ä»¥ç”¨äºå…¶ä»–éœ€è¦çŠ¶æ€ç®¡ç†çš„åœºæ™¯</p>
</blockquote>
<p>æˆ‘ä»¬ç”¨ Mobx æ¥å®ç°ä¸€ä¸ªå¾ˆç®€å•çš„è®¡æ•°å·¥å…·ï¼Œé¦–å…ˆï¼Œéœ€è¦æœ‰ä¸€ä¸ªå¯¹è±¡æ¥è®°å½•è®¡æ•°å€¼ï¼Œä»£ç å¦‚ä¸‹ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">import &#123;observable&#125; from &#x27;mobx&#x27;;</span><br><span class="line"></span><br><span class="line">const counter = observable(&#123;</span><br><span class="line">  count: 0</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<p>åœ¨ä¸Šé¢çš„ä»£ç ä¸­ï¼Œcounter æ˜¯ä¸€ä¸ªå¯¹è±¡ï¼Œå…¶å®å°±æ˜¯ç”¨ observable å‡½æ•°åŒ…ä½ä¸€ä¸ªæ™®é€š JavaScript å¯¹è±¡ï¼Œä½†æ˜¯ observable çš„ä»‹å…¥ï¼Œè®© counter å¯¹è±¡æ‹¥æœ‰äº†ç¥åŠ›ã€‚</p>
<p>æˆ‘ä»¬ç”¨æœ€ç®€å•çš„ä»£ç æ¥å±•ç¤ºè¿™ç§â€œç¥åŠ›â€ï¼Œä»£ç å¦‚ä¸‹ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">import &#123;autorun&#125; from &#x27;mobx&#x27;;</span><br><span class="line"></span><br><span class="line">window.counter = counter;</span><br><span class="line"></span><br><span class="line">autorun(() =&gt; &#123;</span><br><span class="line">  console.log(&#x27;#count&#x27;, counter.count);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<p>æŠŠ counter èµ‹å€¼ç»™ window.counterï¼Œæ˜¯ä¸ºäº†è®©æˆ‘ä»¬åœ¨ Chrome çš„å¼€å‘è€…ç•Œé¢å¯ä»¥è®¿é—®ã€‚ç”¨ autorun åŒ…ä½äº†ä¸€ä¸ªå‡½æ•°ï¼Œè¿™ä¸ªå‡½æ•°è¾“å‡º counter.count çš„å€¼ï¼Œè¿™æ®µä»£ç çš„ä½œç”¨ï¼Œæˆ‘ä»¬å¾ˆå¿«å°±èƒ½çœ‹åˆ°ã€‚</p>
<p>åœ¨ Chrome çš„å¼€å‘è€…ç•Œé¢ï¼Œæˆ‘ä»¬å¯ä»¥ç›´æ¥è®¿é—® window.counter.countï¼Œç¥å¥‡ä¹‹å¤„æ˜¯ï¼Œå¦‚æœæˆ‘ä»¬ç›´æ¥ä¿®æ”¹ window.counter.count çš„å€¼ï¼Œå¯ä»¥ç›´æ¥è§¦å‘ autorun çš„å‡½æ•°å‚æ•°ï¼</p>
<p><img src="https://user-gold-cdn.xitu.io/2018/10/29/166bf8e6c419c97e" alt="img"></p>
<p>è¿™ä¸ªç°è±¡è¯´æ˜ï¼Œmobx çš„ observable æ‹¥æœ‰æŸç§â€œç¥åŠ›â€ï¼Œä»»ä½•å¯¹è¿™ä¸ªå¯¹è±¡çš„ä¿®æ”¹ï¼Œéƒ½ä¼šç«‹åˆ»å¼•å‘æŸäº›å‡½æ•°è¢«è°ƒç”¨ã€‚å’Œ observable è¿™ä¸ªåå­—ä¸€æ ·ï¼Œè¢«åŒ…è£…çš„å¯¹è±¡å˜æˆäº†â€œè¢«è§‚å¯Ÿè€…â€ï¼Œè€Œè¢«è°ƒç”¨çš„å‡½æ•°å°±æ˜¯â€œè§‚å¯Ÿè€…â€ï¼Œåœ¨ä¸Šé¢çš„ä¾‹å­ä¸­ï¼Œautorun çš„å‡½æ•°å‚æ•°å°±æ˜¯â€œè§‚å¯Ÿè€…â€ã€‚</p>
<p>Mobx è¿™æ ·çš„åŠŸèƒ½ï¼Œç­‰äºå®ç°äº†è®¾è®¡æ¨¡å¼ä¸­çš„â€œè§‚å¯Ÿè€…æ¨¡å¼â€ï¼ˆObserver Patternï¼‰ï¼Œé€šè¿‡å»ºç«‹ observer å’Œ observable ä¹‹é—´çš„å…³è”ï¼Œè¾¾åˆ°æ•°æ®è”åŠ¨ã€‚ä¸è¿‡ï¼Œä¼ ç»Ÿçš„â€œè§‚å¯Ÿè€…æ¨¡å¼â€è¦æ±‚æˆ‘ä»¬å†™ä»£ç å»ºç«‹ä¸¤è€…çš„å…³è”ï¼Œä¹Ÿå°±æ˜¯å†™ç±»ä¼¼ä¸‹é¢çš„ä»£ç ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">observable.register(observer);</span><br></pre></td></tr></table></figure>

<p>Mobx æœ€äº†ä¸èµ·ä¹‹å¤„ï¼Œåœ¨äºä¸éœ€è¦å¼€å‘è€…å†™ä¸Šé¢çš„å…³è”ä»£ç ï¼ŒMobxè‡ªå·±é€šè¿‡è§£æä»£ç å°±èƒ½å¤Ÿè‡ªåŠ¨å‘ç° observer å’Œ observable ä¹‹é—´çš„å…³ç³»ã€‚</p>
<p>æˆ‘ä»¬å¾ˆè‡ªç„¶æƒ³åˆ°ï¼Œå¦‚æœè®©æˆ‘ä»¬çš„æ•°æ®æ‹¥æœ‰è¿™æ ·çš„â€œç¥åŠ›â€ï¼Œé‚£æˆ‘ä»¬å°±ä¸ç”¨åœ¨ä¿®æ”¹å®Œæ•°æ®ä¹‹åï¼Œå†è´¹å¿ƒå»è°ƒç”¨æŸäº›å‡½æ•°ä½¿ç”¨è¿™äº›æ•°æ®äº†ï¼Œæ•°æ®ç®¡ç†ä¼šå˜å¾—ååˆ†è½»æ¾ã€‚</p>
<p><strong>decorator</strong></p>
<p>å› ä¸º Mobx çš„ä½œç”¨å°±æ˜¯æŠŠç®€å•çš„å¯¹è±¡èµ‹äºˆç¥åŠ›ï¼Œæ€»è¦æœ‰ä¸€ç§æ–¹æ³•èƒ½å¤Ÿåœ¨ä¸æ”¹å˜å¯¹è±¡ä»£ç çš„å‰æï¼Œå»æ”¹å˜å¯¹è±¡çš„è¡Œä¸ºï¼Œè¿™å°±ç”¨å¾—ä¸Šâ€œè£…é¥°è€…æ¨¡å¼â€ï¼ˆDecorator Patternï¼‰ã€‚</p>
<p>å•ç‹¬è¯´â€œè£…é¥°è€…æ¨¡å¼â€ï¼Œè¿™åªæ˜¯é¢å‘å¯¹è±¡ç¼–ç¨‹æ€æƒ³ä¸‹çš„ä¸€ç§æ¨¡å¼ï¼Œä¸è¿‡å¯¹ JavaScript è¯­è¨€è€Œè¨€ï¼Œå°±ä¸åªæ˜¯ä¸€ç§æ¨¡å¼ï¼Œè€Œæ˜¯ä¸€ç§è¯­è¨€ç‰¹æ€§ï¼Œå®ƒåœ¨è¯­æ³•ä¸Šå¯¹è¿™ç§æ¨¡å¼æä¾›äº†å¼ºå¤§çš„æ”¯æŒï¼Œæ‰€è°“å¼ºå¤§ï¼Œå°±æ˜¯æŒ‡ä½¿ç”¨èµ·æ¥ä»£ç æå…¶ç®€æ´ã€‚</p>
<p>æ ¹æ® JavaScript è¯­æ³•ï¼Œæˆ‘ä»¬å¯ä»¥è¿™æ ·åˆ›é€ ä¸€ä¸ª decoratorï¼Œå«åš logï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">function log(target, name, descriptor) &#123;</span><br><span class="line">  console.log(&#x27;#target&#x27;, target);</span><br><span class="line">  console.log(&#x27;#name&#x27;, name);</span><br><span class="line">  console.log(&#x27;#descriptor&#x27;, descriptor);</span><br><span class="line">  return descriptor;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>å½“ç„¶ï¼Œå¾ˆæ˜æ˜¾è¿™ä¸ª decorator ä»€ä¹ˆå®è´¨çš„äº‹æƒ…éƒ½æ²¡åšï¼Œåªæ˜¯ç”¨ console.log è¾“å‡ºäº†ä¸‰ä¸ªå‚æ•°ç§€äº†ä¸€ä¸‹å­˜åœ¨æ„Ÿï¼Œæœ€åè¿”å›çš„ descriptorï¼Œå°±æ˜¯è¢«è¿™ä¸ªã€è£…é¥°è€…ã€æ‰€ã€è£…é¥°ã€çš„å¯¹è±¡ã€‚</p>
<p>ä¸‹é¢æ˜¯ä½¿ç”¨è¿™ä¸ª decorator çš„ä»£ç ç¤ºä¾‹ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">@log</span><br><span class="line">class Bar &#123;</span><br><span class="line">  @log</span><br><span class="line">  bar() &#123;</span><br><span class="line">    console.log(&#x27;bar&#x27;);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>å¯ä»¥çœ‹åˆ°ï¼Œ@ ç¬¦å·å°±æ˜¯ä½¿ç”¨ decorator çš„æ ‡å¿—ï¼Œå°† @log ä½œç”¨äºä¸€ä¸ªç±» Barï¼Œé‚£ä¹ˆæœ€åå¾—åˆ°çš„ Bar å…¶å®æ˜¯è°ƒç”¨ log å‡½æ•°è¿”å›çš„ç»“æœï¼›å°† @log ä½œç”¨äºä¸€ä¸ªç±»æˆå‘˜ @barï¼Œæœ€åå¾—åˆ°çš„ bar åŒæ ·æ˜¯è°ƒç”¨ log å‡½æ•°ä¹‹åå¾—åˆ°çš„ç»“æœã€‚å¯è§ï¼Œå¦‚æœæˆ‘ä»¬å·§å¦™åœ°ç¼–å†™ log å‡½æ•°ï¼Œæ§åˆ¶è¿”å›çš„ç»“æœï¼Œå°±å¯ä»¥æ“çºµè¢«ã€è£…é¥°ã€çš„ç±»æˆ–è€…æˆå‘˜ã€‚</p>
<p>ç¼–å†™ decorator æ˜¯ä¸€ä¸ªå¤æ‚çš„è¿‡ç¨‹ï¼Œä¹Ÿè¶…å‡ºäº†è¿™æœ¬å°å†Œçš„èŒƒå›´ï¼Œæœ‰å…´è¶£çš„è¯»è€…å¯ä»¥è‡ªè¡Œç ”ç©¶ã€‚åœ¨è¿™é‡Œï¼Œè¯»è€…åªéœ€è¦çŸ¥é“ï¼Œè™½ç„¶ä½¿ç”¨ Mobx å¹¶ä¸æ˜¯å¿…é¡»ä½¿ç”¨ decoratorï¼Œä½†æ˜¯ä½¿ç”¨ decorator ä¼šè®© Mobx çš„åº”ç”¨ä»£ç ç®€æ´æ˜“è¯»å¾ˆå¤š</p>
<p><strong>ç”¨ decorator æ¥ä½¿ç”¨ Mobx</strong></p>
<p>è¿˜æ˜¯ä»¥ Counter ä¸ºä¾‹ï¼Œçœ‹å¦‚ä½•ç”¨ decorator ä½¿ç”¨ Mobxï¼Œæˆ‘ä»¬å…ˆçœ‹ä»£ç ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line">import &#123;observable&#125; from &#x27;mobx&#x27;;</span><br><span class="line">import &#123;observer&#125; from &#x27;mobx-react&#x27;;</span><br><span class="line"></span><br><span class="line">@observer</span><br><span class="line">class Counter extends React.Component &#123;</span><br><span class="line">  @observable count = 0;</span><br><span class="line"></span><br><span class="line">  onIncrement = () =&gt; &#123;</span><br><span class="line">    this.count ++;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  onDecrement = () =&gt; &#123;</span><br><span class="line">    this.count --;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  componentWillUpdate() &#123;</span><br><span class="line">    console.log(&#x27;#enter componentWillUpdate&#x27;);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  render() &#123;</span><br><span class="line">    return(</span><br><span class="line">      &lt;CounterView</span><br><span class="line">        caption=&quot;With decorator&quot;</span><br><span class="line">        count=&#123;this.count&#125;</span><br><span class="line">        onIncrement=&#123;this.onIncrement&#125;</span><br><span class="line">        onDecrement=&#123;this.onDecrement&#125;</span><br><span class="line">        /&gt;</span><br><span class="line">    );</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>åœ¨ä¸Šé¢çš„ä»£ç ä¸­ï¼ŒCounter è¿™ä¸ª React ç»„ä»¶è‡ªèº«æ˜¯ä¸€ä¸ª observerï¼Œè€Œ observable æ˜¯ Counter çš„ä¸€ä¸ªæˆå‘˜å˜é‡ countã€‚</p>
<p>æ³¨æ„ observer è¿™ ä¸ªdecorator æ¥è‡ªäº mobx-reactï¼Œå®ƒæ˜¯ Mobx ä¸–ç•Œå’Œ React çš„æ¡¥æ¢ï¼Œè¢«å®ƒâ€œè£…é¥°â€çš„ç»„ä»¶ï¼Œåªè¦ç”¨åˆ°æŸä¸ªè¢« Mobx çš„ observable â€œè£…é¥°â€è¿‡çš„æ•°æ®ï¼Œè‡ªç„¶ä¼šå¯¹è¿™æ ·çš„æ•°æ®äº§ç”Ÿååº”ã€‚æ‰€ä»¥ï¼Œåªè¦ Counter çš„ count æˆå‘˜å˜é‡ä¸€å˜åŒ–ï¼Œå°±ä¼šå¼•å‘ Counter ç»„ä»¶çš„é‡æ–°æ¸²æŸ“ã€‚</p>
<p>å¯ä»¥æ³¨æ„åˆ°ï¼ŒCounter çš„ä»£ç ä¸­å¹¶æ²¡æœ‰è‡ªå·±çš„ stateï¼Œå…¶å®ï¼Œè¢« observer ä¿®é¥°è¿‡ä¹‹åï¼ŒCounter è¢«å¼ºè¡Œâ€æ³¨å…¥â€äº† stateï¼Œåªä¸è¿‡æˆ‘ä»¬çœ‹ä¸è§è€Œå·²ã€‚</p>
<p><strong>ç‹¬ç«‹çš„ Store</strong></p>
<p>è™½ç„¶æŠŠ observer å’Œ observable é›†ä¸­åœ¨ä¸€ä¸ª React ç»„ä»¶ä¸­å¯è¡Œï¼Œä½†æ˜¯ï¼Œè¿™ä¹Ÿè®© observable çš„çŠ¶æ€è¢«å°å­˜åœ¨äº† React ç»„ä»¶å†…ï¼Œé‚£æˆ‘ä»¬ç›´æ¥ç”¨ React è‡ªèº«çš„ state ç®¡ç†ä¹Ÿèƒ½è§£å†³é—®é¢˜ï¼Œæ‰€ä»¥ï¼Œè¿™æ ·ä½¿ç”¨ Mobx æ„ä¹‰ä¸å¤§ã€‚</p>
<p>æ›´å¤šé€‚ç”¨äº Mobx çš„åœºåˆï¼Œå°±å’Œé€‚ç”¨äº Redux çš„åœºåˆä¸€æ ·ï¼Œæ˜¯ä¸€ä¸ªçŠ¶æ€éœ€è¦å¤šä¸ªç»„ä»¶å…±äº«ï¼Œæ‰€ä»¥ observable ä¸€èˆ¬æ˜¯åœ¨ React ç»„ä»¶ä¹‹å¤–ã€‚</p>
<p>æˆ‘ä»¬é‡å†™ä¸€é Counter ç»„ä»¶ï¼Œä»£ç å¦‚ä¸‹ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line">const store = observable(&#123;</span><br><span class="line">  count: 0</span><br><span class="line">&#125;);</span><br><span class="line">store.increment = function() &#123;</span><br><span class="line">  this.count ++;</span><br><span class="line">&#125;;</span><br><span class="line">store.decrement = function() &#123;</span><br><span class="line">  this.count --;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">@observer // this decorator is must</span><br><span class="line">class Counter extends React.Component &#123;</span><br><span class="line">  onIncrement = () =&gt; &#123;</span><br><span class="line">    store.increment();</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  onDecrement = () =&gt; &#123;</span><br><span class="line">    store.decrement();</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  render() &#123;</span><br><span class="line">    return(</span><br><span class="line">      &lt;CounterView</span><br><span class="line">        caption=&quot;With external state&quot;</span><br><span class="line">        count=&#123;store.count&#125;</span><br><span class="line">        onIncrement=&#123;this.onIncrement&#125;</span><br><span class="line">        onDecrement=&#123;this.onDecrement&#125;</span><br><span class="line">        /&gt;</span><br><span class="line">    );</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<blockquote>
<p>å¯ä»¥çœ‹åˆ°ï¼Œæˆ‘ä»¬æŠŠ count æåˆ°ç»„ä»¶ä¹‹å¤–ï¼Œç”šè‡³å°±æŠŠå®ƒå«åš storeï¼Œè¿™å»¶ç»­çš„æ˜¯ Redux çš„å‘½åæ–¹æ³•</p>
</blockquote>
<p><strong>æ€»ç»“</strong></p>
<ul>
<li>Mobx çš„åŸºæœ¬åŠŸèƒ½å°±æ˜¯â€œè§‚å¯Ÿè€…æ¨¡å¼â€</li>
<li>decorator æ˜¯â€œè£…é¥°è€…æ¨¡å¼â€åœ¨ JavaScript è¯­è¨€ä¸­çš„å®ç°</li>
<li>Mobx é€šå¸¸åˆ©ç”¨ decorator æ¥ä½¿ç”¨</li>
</ul>
<h3 id="5-3-ä¸åŒæ–¹å¼å¯¹æ¯”"><a href="#5-3-ä¸åŒæ–¹å¼å¯¹æ¯”" class="headerlink" title="5.3 ä¸åŒæ–¹å¼å¯¹æ¯”"></a>5.3 ä¸åŒæ–¹å¼å¯¹æ¯”</h3><p><strong>Mobx å’Œ Redux çš„æ¯”è¾ƒ</strong></p>
<p>Mobx å’Œ Redux çš„ç›®æ ‡éƒ½æ˜¯ç®¡ç†å¥½åº”ç”¨çŠ¶æ€ï¼Œä½†æ˜¯æœ€æ ¹æœ¬çš„åŒºåˆ«åœ¨äºå¯¹æ•°æ®çš„å¤„ç†æ–¹å¼ä¸åŒã€‚</p>
<p>Redux è®¤ä¸ºï¼Œæ•°æ®çš„ä¸€è‡´æ€§å¾ˆé‡è¦ï¼Œä¸ºäº†ä¿æŒæ•°æ®çš„ä¸€è‡´æ€§ï¼Œè¦æ±‚Store ä¸­çš„æ•°æ®å°½é‡èŒƒå¼åŒ–ï¼Œä¹Ÿå°±æ˜¯å‡å°‘ä¸€åˆ‡ä¸å¿…è¦çš„å†—ä½™ï¼Œä¸ºäº†é™åˆ¶å¯¹æ•°æ®çš„ä¿®æ”¹ï¼Œè¦æ±‚ Store ä¸­æ•°æ®æ˜¯ä¸å¯æ”¹çš„ï¼ˆImmutableï¼‰ï¼Œåªèƒ½é€šè¿‡ action è§¦å‘ reducer æ¥æ›´æ–° Storeã€‚</p>
<p>Mobx ä¹Ÿè®¤ä¸ºæ•°æ®çš„ä¸€è‡´æ€§å¾ˆé‡è¦ï¼Œä½†æ˜¯å®ƒè®¤ä¸ºè§£å†³é—®é¢˜çš„æ ¹æœ¬æ–¹æ³•ä¸æ˜¯è®©æ•°æ®èŒƒå¼åŒ–ï¼Œè€Œæ˜¯ä¸è¦ç»™æœºä¼šè®©æ•°æ®å˜å¾—ä¸ä¸€è‡´ã€‚æ‰€ä»¥ï¼ŒMobx é¼“åŠ±æ•°æ®å¹²è„†å°±â€œåèŒƒå¼åŒ–â€ï¼Œæœ‰å†—ä½™æ²¡é—®é¢˜ï¼Œåªè¦æ‰€æœ‰æ•°æ®ä¹‹é—´ä¿æŒè”åŠ¨ï¼Œæ”¹äº†ä¸€å¤„ï¼Œå¯¹åº”ä¾èµ–è¿™å¤„çš„æ•°æ®è‡ªåŠ¨æ›´æ–°ï¼Œé‚£å°±ä¸ä¼šå‘ç”Ÿæ•°æ®ä¸ä¸€è‡´çš„é—®é¢˜ã€‚</p>
<p>å€¼å¾—ä¸€æçš„æ˜¯ï¼Œè™½ç„¶ Mobx æœ€åˆçš„ä¸€ä¸ªå–ç‚¹å°±æ˜¯ç›´æ¥ä¿®æ”¹æ•°æ®ï¼Œä½†æ˜¯å®è·µä¸­å¤§å®¶è¿˜æ˜¯å‘ç°è¿™æ ·æ— ç»„ç»‡æ— çºªå¾‹ä¸å¥½ï¼Œæ‰€ä»¥åæ¥ Mobx è¿˜æ˜¯æä¾›äº† action çš„æ¦‚å¿µã€‚å’Œ Redux çš„ action æœ‰ç‚¹ä¸åŒï¼ŒMobx ä¸­çš„ action å…¶å®å°±æ˜¯ä¸€ä¸ªå‡½æ•°ï¼Œä¸éœ€è¦åš dispatchï¼Œè°ƒç”¨å°±ä¿®æ”¹å¯¹åº”æ•°æ®ï¼Œåœ¨ä¸Šé¢çš„ä»£ç ä¸­ï¼Œincrement å’Œ decrement å°±æ˜¯ actionã€‚</p>
<p>å¦‚æœæƒ³å¼ºåˆ¶è¦æ±‚ä½¿ç”¨ actionï¼Œç¦æ­¢ç›´æ¥ä¿®æ”¹ observable æ•°æ®ï¼Œä½¿ç”¨ Mobx çš„ configureï¼Œå¦‚ä¸‹ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">import &#123;configure&#125; from &#x27;mobx&#x27;;</span><br><span class="line"></span><br><span class="line">configure(&#123;enforceActions: true&#125;);</span><br></pre></td></tr></table></figure>

<p><strong>æ€»ç»“ä¸€ä¸‹ Redux å’Œ Mobx çš„åŒºåˆ«ï¼ŒåŒ…æ‹¬è¿™äº›æ–¹é¢ï¼š</strong></p>
<ul>
<li>Redux é¼“åŠ±ä¸€ä¸ªåº”ç”¨åªç”¨ä¸€ä¸ª Storeï¼ŒMobx é¼“åŠ±ä½¿ç”¨å¤šä¸ª Storeï¼›</li>
<li>Redux ä½¿ç”¨â€œæ‹‰â€çš„æ–¹å¼ä½¿ç”¨æ•°æ®ï¼Œè¿™ä¸€ç‚¹å’Œ Reactæ˜¯ä¸€è‡´çš„ï¼Œä½† Mobx ä½¿ç”¨â€œæ¨â€çš„æ–¹å¼ä½¿ç”¨æ•°æ®ï¼Œå’Œ RxJS è¿™æ ·çš„å·¥å…·èµ°å¾—æ›´è¿‘ï¼›</li>
<li>Redux é¼“åŠ±æ•°æ®èŒƒå¼åŒ–ï¼Œå‡å°‘å†—ä½™ï¼ŒMobx å®¹è®¸æ•°æ®å†—ä½™ï¼Œä½†åŒæ ·èƒ½ä¿æŒæ•°æ®ä¸€è‡´ã€‚</li>
</ul>
<h2 id="å…­ã€React-Router"><a href="#å…­ã€React-Router" class="headerlink" title="å…­ã€React Router"></a>å…­ã€React Router</h2><p>éšç€ AJAX æŠ€æœ¯çš„æˆç†Ÿï¼Œç°åœ¨å•é¡µåº”ç”¨ï¼ˆSingle Page Applicationï¼‰å·²ç»æ˜¯å‰ç«¯ç½‘é¡µç•Œçš„æ ‡é…ï¼Œåä¸ºâ€œå•é¡µâ€ï¼Œå…¶å®åœ¨è®¾è®¡æ¦‚å¿µä¸Šä¾ç„¶æ˜¯å¤šé¡µçš„ç•Œé¢ï¼Œåªä¸è¿‡ä»æŠ€æœ¯å±‚é¢ä¸Šé¡µä¹‹é—´çš„åˆ‡æ¢æ˜¯æ²¡æœ‰æ•´ä½“ç½‘é¡µåˆ·æ–°çš„ï¼Œåªéœ€è¦åšå±€éƒ¨æ›´æ–°ã€‚</p>
<p>è¦å®ç°â€œå•é¡µåº”ç”¨â€ï¼Œä¸€ä¸ªæœ€è¦ç´§çš„é—®é¢˜å°±æ˜¯åšå¥½â€œè·¯ç”±â€ï¼ˆRouting)ï¼Œä¹Ÿå°±æ˜¯å¤„ç†å¥½ä¸‹é¢ä¸¤ä»¶äº‹ï¼š</p>
<ul>
<li>æŠŠ URL æ˜ å°„åˆ°å¯¹åº”çš„é¡µé¢æ¥å¤„ç†ï¼›</li>
<li>é¡µé¢ä¹‹é—´åˆ‡æ¢åšåˆ°åªéœ€å±€éƒ¨æ›´æ–°ã€‚</li>
</ul>
<p><strong>react router v4 çš„åŠ¨æ€è·¯ç”±</strong></p>
<ul>
<li>æˆ‘ä»¬ç°åœ¨è¯´åˆ° react-routerï¼ŒåŸºæœ¬ä¸Šéƒ½æ˜¯åœ¨è¯´ react-router çš„ç¬¬ 4 ç‰ˆï¼Œä¹Ÿå°±æ˜¯ v4ã€‚è¿™ä¸ª v4 å¾ˆæœ‰æ„æ€ï¼Œå®ƒå®Œå…¨æ¨ç¿»äº†ä¹‹å‰ v3 çš„åšæ³•ã€‚å¯ä»¥è¯´ï¼Œreact-router çš„ v3 å’Œ v4 ç‰ˆå®Œå®Œå…¨å…¨æ˜¯ä¸åŒçš„ä¸¤ä¸ªå·¥å…·ï¼Œä¸¤è€…å·®è·å®åœ¨å¤ªå¤§ã€‚</li>
<li>å…¶å®å½“åˆ v3 ä¹Ÿå·²ç»å¾ˆä¼˜ç§€å¾ˆçƒ­é—¨äº†ï¼Œä½†æ˜¯ react-router çš„å¼€å‘è€…ä¸æ»¡æ„ï¼Œä»–ä»¬è®¤ä¸º v3 è¿˜æ˜¯è½å…¥äº†â€œé™æ€è·¯ç”±â€çš„çª è‡¼ï¼Œæ‰€ä»¥åœ¨ v4 ä¸­ react-router åšåˆ°äº†â€œåŠ¨æ€è·¯ç”±â€çš„åŠŸèƒ½ã€‚</li>
<li>æ‰€è°“â€œé™æ€è·¯ç”±â€ï¼Œå°±æ˜¯è¯´è·¯ç”±è§„åˆ™æ˜¯å›ºå®šçš„ï¼Œæ— è®º expressã€Angular è¿˜æ˜¯ Rails ç­‰ä¸šç•Œå“å½“å½“çš„æ¡†æ¶ï¼Œéƒ½ç”¨çš„æ˜¯é™æ€è·¯ç”±ã€‚ä»¥ express ä¸ºä¾‹ï¼Œè·¯ç”±è§„åˆ™å·®ä¸å¤šæ˜¯è¿™ä¹ˆå†™çš„ï¼š</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">app.get(&#x27;/&#x27;, Home);</span><br><span class="line">app.get(&#x27;/product/:id&#x27;, Product);</span><br><span class="line">app.get(&#x27;/about&#x27;, About);</span><br></pre></td></tr></table></figure>

<p>å¯¹äºå¤§éƒ¨åˆ†åº”ç”¨ï¼Œæ”¯æŒè¿™æ ·çš„è·¯ç”±è§„åˆ™çœŸçš„æ˜¯è¶³å¤Ÿäº†ï¼Œä½†æ˜¯ï¼Œreact-router çš„å¼€å‘è€…è§‰å¾—è¿™æ ·è¿˜ä¸å¤Ÿå¥½ï¼Œè¦æ”¯æŒâ€œåŠ¨æ€è·¯ç”±â€æ‰æ˜¯æœ€å¥½ã€‚</p>
<p>æ‰€è°“åŠ¨æ€è·¯ç”±ï¼ŒæŒ‡çš„æ˜¯è·¯ç”±è§„åˆ™ä¸æ˜¯é¢„å…ˆç¡®å®šçš„ï¼Œè€Œæ˜¯åœ¨æ¸²æŸ“è¿‡ç¨‹ä¸­ç¡®å®šçš„ã€‚å› ä¸º react-router çš„å®šä½å°±æ˜¯ä¸“ä¾› React åº”ç”¨æœåŠ¡ï¼Œè€Œ React çš„ä¸–ç•Œä¸­ä¸€åˆ‡çš†ä¸ºç»„ä»¶ï¼Œæ‰€ä»¥ react-router v4 å°±å®Œå…¨ç”¨ React ç»„ä»¶æ¥å®ç°è·¯ç”±åŠŸèƒ½ã€‚</p>
<p>ä¸å¾—ä¸æ‰¿è®¤ï¼Œè™½ç„¶ react-router çš„å¼€å‘è€…æ˜¯æŒºæŠ˜è…¾çš„ï¼Œä½†æ˜¯ä»–ä»¬çš„ç¡®æ˜¯é¢†æ‚Ÿäº† React çš„ç²¾é«“ï¼Œè€Œä¸”åœ¨ react-router ä¸­æŠŠ React çš„å“²å­¦å‘æŒ¥åˆ°äº†æè‡´ã€‚</p>
<p>æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬é€šè¿‡ä¸€ä¸ªå¾ˆç®€å•çš„ä¾‹å­æ¥è¯´æ˜ react-router v4 å¦‚ä½•å·¥ä½œçš„ï¼Œç„¶ååœ¨è¿™ä¸ªä¾‹å­çš„åŸºç¡€ä¸Šä»‹ç»â€œåŠ¨æ€è·¯ç”±â€ã€‚</p>
<p><strong>React Router å®ä¾‹</strong></p>
<p>å®‰è£…åŒ… react-router-dom</p>
<p>create-react-app äº§ç”Ÿçš„åº”ç”¨é»˜è®¤ä¸ºä¸æ”¯æŒå¤šä¸ªé¡µé¢ï¼Œä½†è¿˜æ˜¯åœ¨ README æ–‡ä»¶ä¸­å‹æƒ…æ¨èäº†ä¸€ä¸‹ react-router æ¥å¢å¼ºåŠŸèƒ½ï¼Œå¯è§ react-router å½±å“åŠ›ä¹‹å¤§ã€‚</p>
<p>ä¸è¿‡ï¼Œæˆ‘ä»¬å¹¶ä¸éœ€è¦å®‰è£… react-router è¿™ä¸ª npm åŒ…ï¼Œå› ä¸º react-router ä¸ºäº†æ”¯æŒ Web å’Œ React Native å‡ºäº†ä¸¤ä¸ªåŒ…â€”â€” react-router-dom å’Œ react-router-native ï¼Œæˆ‘ä»¬åªå…³å¿ƒ Webï¼Œæ‰€ä»¥åªéœ€è¦å®‰è£… react-router-dom ã€‚è¿™ä¸ª react-router-dom ä¾èµ–äº react-router ï¼Œæ‰€ä»¥ react-router ä¹Ÿä¼šè¢«è‡ªåŠ¨å®‰è£…ä¸Š</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm install react-router-dom</span><br></pre></td></tr></table></figure>

<p><strong>HashRouter è¿˜æ˜¯ BrowserRouter</strong></p>
<p>react-router çš„å·¥ä½œæ–¹å¼ï¼Œæ˜¯åœ¨ç»„ä»¶æ ‘é¡¶å±‚æ”¾ä¸€ä¸ª Router ç»„ä»¶ï¼Œç„¶ååœ¨ç»„ä»¶æ ‘ä¸­æ•£è½ç€å¾ˆå¤š Route ç»„ä»¶ï¼ˆæ³¨æ„æ¯” Router å°‘ä¸€ä¸ªâ€œrâ€ï¼‰ï¼Œé¡¶å±‚çš„ Router ç»„ä»¶è´Ÿè´£åˆ†æç›‘å¬ URL çš„å˜åŒ–ï¼Œåœ¨å®ƒä¿æŠ¤ä¼ä¹‹ä¸‹çš„ Route ç»„ä»¶å¯ä»¥ç›´æ¥è¯»å–è¿™äº›ä¿¡æ¯ã€‚</p>
<p>å¾ˆæ˜æ˜¾ï¼ŒRouter å’Œ Route çš„é…åˆï¼Œå°±æ˜¯ä¹‹å‰æˆ‘ä»¬ä»‹ç»è¿‡çš„â€œæä¾›è€…æ¨¡å¼â€ï¼ŒRouter æ˜¯â€œæä¾›è€…â€ï¼ŒRouteæ˜¯â€œæ¶ˆè´¹è€…â€ã€‚</p>
<p>æ›´è¿›ä¸€æ­¥ï¼ŒRouter å…¶å®ä¹Ÿæ˜¯ä¸€å±‚æŠ½è±¡ï¼Œè®©ä¸‹é¢çš„ Route æ— éœ€å„ç§ä¸åŒ URL è®¾è®¡çš„ç»†èŠ‚ï¼Œä¸è¦ä»¥ä¸º URL å°±ä¸€ç§è®¾è®¡æ–¹æ³•ï¼Œè‡³å°‘å¯ä»¥åˆ†ä¸ºä¸¤ç§ã€‚</p>
<p>ç¬¬ä¸€ç§å¾ˆè‡ªç„¶ï¼Œæ¯”å¦‚ &#x2F; å¯¹åº” Home é¡µï¼Œ&#x2F;about å¯¹åº” About é¡µï¼Œä½†æ˜¯è¿™æ ·çš„è®¾è®¡éœ€è¦æœåŠ¡å™¨ç«¯æ¸²æŸ“ï¼Œå› ä¸ºç”¨æˆ·å¯èƒ½ç›´æ¥è®¿é—®ä»»ä½•ä¸€ä¸ª URLï¼ŒæœåŠ¡å™¨ç«¯å¿…é¡»èƒ½å¯¹ &#x2F;çš„è®¿é—®è¿”å› HTMLï¼Œä¹Ÿè¦å¯¹ &#x2F;about çš„è®¿é—®è¿”å› HTMLã€‚</p>
<p>ç¬¬äºŒç§çœ‹èµ·æ¥ä¸è‡ªç„¶ï¼Œä½†æ˜¯å®ç°æ›´ç®€å•ã€‚åªæœ‰ä¸€ä¸ªè·¯å¾„ &#x2F;ï¼Œé€šè¿‡ URL åé¢çš„ # éƒ¨åˆ†æ¥å†³å®šè·¯ç”±ï¼Œ&#x2F;#&#x2F; å¯¹åº” Home é¡µï¼Œ&#x2F;#&#x2F;about å¯¹åº” About é¡µã€‚å› ä¸º URL ä¸­#ä¹‹åçš„éƒ¨åˆ†æ˜¯ä¸ä¼šå‘é€ç»™æœåŠ¡å™¨çš„ï¼Œæ‰€ä»¥ï¼Œæ— è®ºå“ªä¸ª URLï¼Œæœ€åéƒ½æ˜¯è®¿é—®æœåŠ¡å™¨çš„ &#x2F; è·¯å¾„ï¼ŒæœåŠ¡å™¨ä¹Ÿåªéœ€è¦è¿”å›åŒæ ·ä¸€ä»½ HTML å°±å¯ä»¥ï¼Œç„¶åç”±æµè§ˆå™¨ç«¯è§£æ # åçš„éƒ¨åˆ†ï¼Œå®Œæˆæµè§ˆå™¨ç«¯æ¸²æŸ“ã€‚</p>
<p>åœ¨ react-routerï¼Œæœ‰ BrowserRouter æ”¯æŒç¬¬ä¸€ç§ URLï¼Œæœ‰ HashRouter æ”¯æŒç¬¬äºŒç§ URLã€‚</p>
<p>å› ä¸º create-react-app äº§ç”Ÿçš„åº”ç”¨é»˜è®¤ä¸æ”¯æŒæœåŠ¡å™¨ç«¯æ¸²æŸ“ï¼Œä¸ºäº†ç®€å•èµ·è§ï¼Œæˆ‘ä»¬åœ¨ä¸‹é¢çš„ä¾‹å­ä¸­ä½¿ç”¨ HashRouterï¼Œåœ¨å®é™…äº§å“ä¸­ï¼Œå…¶å®æœ€å¥½è¿˜æ˜¯ç”¨ BrowserRouterï¼Œè¿™æ ·ç”¨æˆ·ä½“éªŒæ›´å¥½ã€‚</p>
<p>ä¿®æ”¹index.jsæ–‡ä»¶ï¼Œå¢åŠ ä¸‹é¢çš„ä»£ç ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">import &#123;HashRouter&#125; from &#x27;react-router-dom&#x27;;</span><br><span class="line"></span><br><span class="line">ReactDOM.render(</span><br><span class="line">  &lt;HashRouter&gt;</span><br><span class="line">    &lt;App /&gt;</span><br><span class="line">  &lt;/HashRouter&gt;,</span><br><span class="line">  document.getElementById(&#x27;root&#x27;)</span><br><span class="line">);</span><br></pre></td></tr></table></figure>

<p>æŠŠ Router ç”¨åœ¨ React ç»„ä»¶æ ‘çš„æœ€é¡¶å±‚ï¼Œè¿™æ˜¯æœ€ä½³å®è·µã€‚å› ä¸ºå°†æ¥æˆ‘ä»¬å¦‚æœæƒ³æŠŠ HashRouter æ¢æˆ BrowserRouterï¼Œç»„ä»¶ App ä»¥ä¸‹å‡ ä¹ä¸ç”¨ä»»ä½•æ”¹å˜ã€‚</p>
<p><strong>ä½¿ç”¨ Link</strong></p>
<p>å¯¹äºå•é¡µåº”ç”¨ï¼Œéœ€è¦åœ¨ä¸åŒâ€œé¡µé¢â€ä¹‹é—´åˆ‡æ¢ï¼Œå¾€å¾€éœ€è¦ä¸€ä¸ªâ€œå¯¼èˆªæ â€ï¼Œæˆ‘ä»¬åœ¨è¿™é‡Œä¹Ÿå®ç°ä¸€ä¸ªç®€å•çš„å¯¼èˆªæ ã€‚</p>
<p>åœ¨App.jsä¸­ï¼Œæˆ‘ä»¬è®©ç½‘é¡µç”±ä¸¤ä¸ªç»„ä»¶ Navigation å’Œ Content ç»„æˆï¼Œ Navigation å°±æ˜¯å¯¼èˆªæ ï¼Œè€Œ Content æ˜¯å…·ä½“å†…å®¹ã€‚</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">class App extends Component &#123;</span><br><span class="line">  render() &#123;</span><br><span class="line">    return (</span><br><span class="line">      &lt;div className=&quot;App&quot;&gt;</span><br><span class="line">        &lt;Navigation /&gt;</span><br><span class="line">        &lt;Content /&gt;</span><br><span class="line">      &lt;/div&gt;</span><br><span class="line">    );</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ul>
<li>æˆ‘ä»¬è®¡åˆ’åªå¢åŠ ä¸¤ä¸ªé¡µé¢ï¼Œåœ¨ Navigation ä¸­å°±åº”è¯¥æœ‰ä¸¤ä¸ªé“¾æ¥ï¼Œä½†æ˜¯ï¼Œå¦‚æœæˆ‘ä»¬ç®€å•ä½¿ç”¨ HTML çš„ æ ‡ç­¾é‚£å°±é”™äº†ï¼Œç”¨æˆ·ç‚¹å‡» æ ‡ç­¾ç¼ºçœè¡Œä¸ºæ˜¯ç½‘é¡µè·³è½¬ï¼Œè¿™è¿èƒŒäº†â€œå•é¡µåº”ç”¨â€çš„åŸåˆ™ã€‚è™½ç„¶å¯¹äº HashRouter ä½¿ç”¨çš„æ˜¯æ²¡æœ‰ç½‘é¡µè·³è½¬çš„ #ï¼Œä½†æ˜¯ä¸ºäº†å°†æ¥å¯ä»¥æ— ç¼åˆ‡æ¢ä¸º BrowserRouter ï¼Œæˆ‘ä»¬ä¹Ÿä¸èƒ½ä½¿ç”¨ <code>[</code>](#about) è¿™æ ·çš„æ ‡ç­¾ã€‚</li>
<li>æ­£ç¡®çš„è§£æ³•æ˜¯ç”¨ react-router æä¾›çš„ Link ç»„ä»¶ï¼Œè™½ç„¶ Link æœ€ç»ˆè¿˜æ˜¯æ¸²æŸ“ä¸º æ ‡ç­¾ï¼Œä½†è¿™æ˜¯æœ‰ç¥åŠ›çš„ æ ‡ç­¾ï¼Œç”¨æˆ·ç‚¹å‡»æ—¶ï¼Œreact-router å¯ä»¥çŸ¥æ™“è¿™æ˜¯ä¸€ä¸ªå•é¡µåº”ç”¨çš„é“¾æ¥ï¼Œä¸ç”¨ç½‘é¡µè·³è½¬åªåšå±€éƒ¨é¡µé¢æ›´æ–°ã€‚</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">const ulStyle = &#123;</span><br><span class="line">  &#x27;list-style-type&#x27;: &#x27;none&#x27;,</span><br><span class="line">  margin: 0,</span><br><span class="line">  padding: 0,</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">const liStyle = &#123;</span><br><span class="line">  display: &#x27;inline-block&#x27;,</span><br><span class="line">  width: &#x27;60px&#x27;,</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">const Navigation = () =&gt; (</span><br><span class="line">  &lt;header&gt;</span><br><span class="line">    &lt;nav&gt;</span><br><span class="line">      &lt;ul style=&#123;ulStyle&#125;&gt;</span><br><span class="line">        &lt;li style=&#123;liStyle&#125;&gt;&lt;Link to=&#x27;/&#x27;&gt;Home&lt;/Link&gt;&lt;/li&gt;</span><br><span class="line">        &lt;li style=&#123;liStyle&#125;&gt;&lt;Link to=&#x27;/about&#x27;&gt;About&lt;/Link&gt;&lt;/li&gt;</span><br><span class="line">      &lt;/ul&gt;</span><br><span class="line">    &lt;/nav&gt;</span><br><span class="line">  &lt;/header&gt;</span><br><span class="line">)</span><br></pre></td></tr></table></figure>

<p><strong>ä½¿ç”¨ Route å’Œ Switch</strong></p>
<p>æˆ‘ä»¬æ¥çœ‹ Content è¿™ä¸ªç»„ä»¶ï¼Œè¿™é‡Œä¼šç”¨åˆ° react-router æœ€å¸¸ç”¨çš„ä¸¤ä¸ªç»„ä»¶ Route å’Œ Switchã€‚</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">const Content = () =&gt; (</span><br><span class="line">  &lt;main&gt;</span><br><span class="line">    &lt;Switch&gt;</span><br><span class="line">      &lt;Route exact path=&#x27;/&#x27; component=&#123;Home&#125;/&gt;</span><br><span class="line">      &lt;Route path=&#x27;/about&#x27; component=&#123;About&#125;/&gt;</span><br><span class="line">    &lt;/Switch&gt;</span><br><span class="line">  &lt;/main&gt;</span><br><span class="line">)</span><br></pre></td></tr></table></figure>

<p>Route ç»„ä»¶çš„ path å±æ€§ç”¨äºåŒ¹é…è·¯å¾„ï¼Œå› ä¸ºæˆ‘ä»¬éœ€è¦åŒ¹é… &#x2F; åˆ° Homeï¼ŒåŒ¹é… &#x2F;about åˆ° Aboutï¼Œæ‰€ä»¥è‚¯å®šéœ€è¦ä¸¤ä¸ª Routeï¼Œä½†æ˜¯ï¼Œæˆ‘ä»¬ä¸èƒ½è¿™ä¹ˆå†™ã€‚</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">&lt;Route path=&#x27;/&#x27; component=&#123;Home&#125;/&gt;</span><br><span class="line">&lt;Route path=&#x27;/about&#x27; component=&#123;About&#125;/&gt;</span><br></pre></td></tr></table></figure>

<p>å¦‚æœæŒ‰ç…§ä¸Šé¢è¿™ä¹ˆå†™ï¼Œå½“è®¿é—® &#x2F;about é¡µé¢æ—¶ï¼Œä¸å…‰åŒ¹é… &#x2F;aboutï¼Œä¹Ÿé…ä¸­ &#x2F;ï¼Œç•Œé¢ä¸Šä¼šæŠŠ Home å’Œ About éƒ½æ¸²æŸ“å‡ºæ¥çš„ã€‚</p>
<p>è§£å†³æ–¹æ³•ï¼Œå¯ä»¥åœ¨æƒ³è¦ç²¾ç¡®åŒ¹é…çš„ Route ä¸ŠåŠ ä¸€ä¸ªå±æ€§ exactï¼Œæˆ–è€…ä½¿ç”¨ Switch ç»„ä»¶ã€‚</p>
<p>å¯ä»¥æŠŠ Switch ç»„ä»¶çœ‹åšæ˜¯ JavaScript çš„ switch è¯­å¥ï¼Œåƒè¿™æ ·ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">switch (æ¡ä»¶) &#123;</span><br><span class="line">  case 1: æ¸²æŸ“1; break;</span><br><span class="line">  case 2: æ¸²æŸ“2; break;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>ä»ä¸Šå¾€ä¸‹æ‰¾ç¬¬ä¸€ä¸ªåŒ¹é…çš„ Routeï¼ŒåŒ¹é…ä¸­äº†ä¹‹åï¼Œç«‹åˆ»å°± breakï¼Œä¸ç»§ç»­è¿™ä¸ª Switch ä¸‹å…¶ä»–çš„ Route åŒ¹é…äº†ã€‚</p>
<p>å¯ä»¥çœ‹åˆ°ï¼Œreact-router å·§å¦™åœ°ç”¨ React ç»„ä»¶å®ç°äº†è·¯ç”±çš„æ‰€æœ‰é€»è¾‘ï¼Œå°è¯äº†é‚£å¥è¯ï¼šReact ä¸–ç•Œé‡Œä¸€åˆ‡éƒ½æ˜¯ç»„ä»¶ã€‚</p>
<p><strong>åŠ¨æ€è·¯ç”±</strong></p>
<p>åœ¨äº†è§£äº† react-routerçš„åŸºæœ¬è·¯ç”±åŠŸèƒ½ä¹‹åï¼Œå†æ¥ç†è§£â€œåŠ¨æ€è·¯ç”±â€å°±å®¹æ˜“äº†ã€‚</p>
<p>å‡è®¾ï¼Œæˆ‘ä»¬å¢åŠ ä¸€ä¸ªæ–°çš„é¡µé¢å« Productï¼Œå¯¹åº”è·¯å¾„ä¸º &#x2F;productï¼Œä½†æ˜¯åªæœ‰ç”¨æˆ·ç™»å½•äº†ä¹‹åæ‰æ˜¾ç¤ºã€‚å¦‚æœç”¨é™æ€è·¯ç”±ï¼Œæˆ‘ä»¬åœ¨æ¸²æŸ“ä¹‹å‰å°±ç¡®å®šè¿™æ¡è·¯ç”±è§„åˆ™ï¼Œè¿™æ ·å³ä½¿ç”¨æˆ·æ²¡æœ‰ç™»å½•ï¼Œä¹Ÿå¯ä»¥è®¿é—® productï¼Œæˆ‘ä»¬è¿˜ä¸å¾—ä¸åœ¨ Product ç»„ä»¶ä¸­åšç”¨æˆ·æ˜¯å¦ç™»å½•çš„æ£€æŸ¥ã€‚</p>
<p>å¦‚æœç”¨åŠ¨æ€è·¯ç”±ï¼Œåˆ™åªéœ€è¦åœ¨ä»£ç ä¸­çš„ä¸€å¤„æ¶‰åŠè¿™ä¸ªé€»è¾‘ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">&lt;Switch&gt;</span><br><span class="line">  &lt;Route exact path=&#x27;/&#x27; component=&#123;Home&#125;/&gt;</span><br><span class="line">  &#123;</span><br><span class="line">    isUserLogin() &amp;&amp;</span><br><span class="line">    &lt;Route exact path=&#x27;/product&#x27; component=&#123;Product&#125;/&gt;,</span><br><span class="line">  &#125;  </span><br><span class="line">  &lt;Route path=&#x27;/about&#x27; component=&#123;About&#125;/&gt;</span><br><span class="line">&lt;/Switch&gt;</span><br></pre></td></tr></table></figure>

<blockquote>
<p>å¯ä»¥ç”¨ä»»ä½•æ¡ä»¶å†³å®š <code>Route</code> ç»„ä»¶å®ä¾‹æ˜¯å¦æ¸²æŸ“ï¼Œæ¯”å¦‚ï¼Œå¯ä»¥æ ¹æ®é¡µé¢å®½åº¦ã€è®¾å¤‡ç±»å‹å†³å®šè·¯ç”±è§„åˆ™ï¼ŒåŠ¨æ€è·¯ç”±æœ‰äº†æœ€å¤§çš„è‡ªç”±åº¦</p>
</blockquote>
<h2 id="ä¸ƒã€æœåŠ¡å™¨ç«¯æ¸²æŸ“"><a href="#ä¸ƒã€æœåŠ¡å™¨ç«¯æ¸²æŸ“" class="headerlink" title="ä¸ƒã€æœåŠ¡å™¨ç«¯æ¸²æŸ“"></a>ä¸ƒã€æœåŠ¡å™¨ç«¯æ¸²æŸ“</h2><h3 id="7-1-åŸºæœ¬å¥—è·¯"><a href="#7-1-åŸºæœ¬å¥—è·¯" class="headerlink" title="7.1 åŸºæœ¬å¥—è·¯"></a>7.1 åŸºæœ¬å¥—è·¯</h3><p><strong>ä¸ºä»€ä¹ˆè¦æœåŠ¡å™¨ç«¯æ¸²æŸ“</strong></p>
<p>æœ€è¿‘å‡ å¹´æµè§ˆå™¨ç«¯æ¡†æ¶å¾ˆç¹è£ï¼Œä»¥è‡³äºå¾ˆå¤šæ–°å…¥è¡Œçš„å¼€å‘è€…åªçŸ¥é“æµè§ˆå™¨ç«¯æ¸²æŸ“æ¡†æ¶ï¼Œéƒ½ä¸çŸ¥é“å­˜åœ¨æœåŠ¡å™¨ç«¯æ¸²æŸ“è¿™å›äº‹ï¼Œå…¶å®ï¼Œç½‘ç«™åº”ç”¨æœ€åˆå…¨éƒ½æ˜¯æœåŠ¡å™¨ç«¯æ¸²æŸ“ï¼Œç”±æœåŠ¡å™¨ç«¯ç”¨ PHPã€Java æˆ–è€… Python ç­‰å…¶ä»–è¯­è¨€äº§ç”Ÿ HTML æ¥ç»™æµè§ˆå™¨ç«¯è§£æã€‚</p>
<p>ç›¸æ¯”äºæµè§ˆå™¨ç«¯æ¸²æŸ“ï¼ŒæœåŠ¡å™¨ç«¯æ¸²æŸ“çš„å¥½å¤„æ˜¯ï¼š</p>
<p>1ã€å¯ä»¥ç¼©çŸ­â€œç¬¬ä¸€æœ‰æ„ä¹‰æ¸²æŸ“æ—¶é—´â€ï¼ˆFirst-Meaningful-Paint-Timeï¼‰ã€‚</p>
<p>å¦‚æœå®Œå…¨ä¾èµ–äºæµè§ˆå™¨ç«¯æ¸²æŸ“ï¼Œé‚£ä¹ˆæœåŠ¡å™¨ç«¯è¿”å›çš„ HTML å°±æ˜¯ä¸€ä¸ªç©ºè¡è¡çš„æ¡†æ¶å’Œå¯¹ JavaScript çš„åº”ç”¨ï¼Œç„¶åæµè§ˆå™¨ä¸‹è½½ JavaScriptï¼Œå†æ ¹æ® JavaScript ä¸­çš„ AJAX è°ƒç”¨è·å–æœåŠ¡å™¨ç«¯æ•°æ®ï¼Œå†æ¸²æŸ“å‡º DOM æ¥å¡«å……ç½‘é¡µå†…å®¹ï¼Œæ€»å…±éœ€è¦ä¸‰ä¸ª HTTP æˆ– HTTPS è¯·æ±‚ã€‚</p>
<p>å¦‚æœä½¿ç”¨æœåŠ¡å™¨ç«¯æ¸²æŸ“ï¼Œç¬¬ä¸€ä¸ª HTTP&#x2F;HTTPS è¯·æ±‚è¿”å›çš„ HTML é‡Œå°±åŒ…å«å¯ä»¥æ¸²æŸ“çš„å†…å®¹äº†ï¼Œè¿™æ ·ç”¨æˆ·ç¬¬ä¸€æ—¶é—´å°±ä¼šæ„Ÿè§‰åˆ°â€œæœ‰ä¸œè¥¿ç”»å‡ºæ¥äº†â€ï¼Œè¿™æ ·çš„æ„ŸçŸ¥æ€§èƒ½æ›´å¥½ã€‚</p>
<p>2ã€æ›´å¥½çš„æœç´¢å¼•æ“ä¼˜åŒ–ï¼ˆSearch-Engine-Optimizationï¼ŒSEOï¼‰</p>
<p>å¤§éƒ¨åˆ†ç½‘ç«™éƒ½å¸Œæœ›è‡ªå·±èƒ½å¤Ÿå‡ºç°åœ¨æœç´¢å¼•æ“çš„æœç´¢é¡µå‰åˆ—ï¼Œè¿™ä¸ªå‰æå°±æ˜¯ç½‘é¡µå†…å®¹è¦èƒ½å¤Ÿè¢«æœç´¢å¼•æ“çš„çˆ¬è™«æ­£ç¡®æŠ“å–åˆ°ã€‚è™½ç„¶ Google è¿™æ ·çš„æœç´¢å¼•æ“å·²ç»å¯ä»¥æ£€ç´¢æµè§ˆå™¨ç«¯æ¸²æŸ“çš„ç½‘é¡µï¼Œä½†æ¯•ç«Ÿä¸æ˜¯å…¨éƒ¨æœç´¢å¼•æ“éƒ½èƒ½åšåˆ°ï¼Œå¦‚æœæœç´¢å¼•æ“çš„çˆ¬è™«åªèƒ½æ‹¿åˆ°æœåŠ¡å™¨ç«¯æ¸²æŸ“çš„å†…å®¹ï¼Œå®Œå…¨æµè§ˆå™¨ç«¯æ¸²æŸ“å°±è¡Œä¸é€šäº†ã€‚</p>
<p>å³ä½¿å¯¹äº Googleï¼Œç½‘é¡µæ€§èƒ½ä¹Ÿæ˜¯æœç´¢æ’åçš„é‡è¦æŒ‡æ ‡ï¼Œå¦‚æœé€šè¿‡æœåŠ¡å™¨ç«¯æ¸²æŸ“æé«˜ç½‘é¡µæ€§èƒ½ï¼Œç½‘é¡µçš„æ’åæ›´å¯èƒ½é å‰ã€‚</p>
<p>ä¸Šé¢ä¸¤ç‚¹ï¼Œå°±æ˜¯æœåŠ¡å™¨ç«¯æ¸²æŸ“çš„ä¸»è¦æ„ä¹‰ã€‚</p>
<p><strong>React å¯¹æœåŠ¡å™¨ç«¯æ¸²æŸ“çš„æ”¯æŒ</strong></p>
<p>å› ä¸º React æ˜¯å£°æ˜å¼æ¡†æ¶ï¼Œæ‰€ä»¥ï¼Œåœ¨æ¸²æŸ“ä¸Šå¯¹æœåŠ¡å™¨ç«¯æ¸²æŸ“éå¸¸å‹å¥½ã€‚</p>
<p>å‡è®¾æˆ‘ä»¬æˆ‘ä»¬è¦æ¸²æŸ“ä¸€ä¸ªä»¥ App ä¸ºæœ€æ ¹èŠ‚ç‚¹çš„ç»„ä»¶æ ‘ï¼Œæµè§ˆå™¨ç«¯æ¸²æŸ“çš„ä»£ç å¦‚ä¸‹ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">import React from &#x27;react&#x27;;</span><br><span class="line">import ReactDOM from &#x27;react-dom&#x27;;</span><br><span class="line"></span><br><span class="line">ReactDOM.render(&lt;App /&gt;, document.getElementById(&#x27;root&#x27;));</span><br></pre></td></tr></table></figure>

<p>ç°åœ¨æˆ‘ä»¬æƒ³è¦åœ¨æœåŠ¡å™¨ç«¯æ¸²æŸ“ Appï¼Œå¦‚æœä½¿ç”¨ React v16 ä¹‹å‰çš„ç‰ˆæœ¬ï¼Œä»£ç æ˜¯è¿™æ ·ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">import React from &#x27;react&#x27;;</span><br><span class="line">import ReactDOMServer from &#x27;react-dom/server&#x27;;</span><br><span class="line"></span><br><span class="line">// æŠŠäº§ç”Ÿhtmlè¿”å›ç»™æµè§ˆå™¨ç«¯</span><br><span class="line">const html = ReactDOMServer.renderToString(&lt;Hello /&gt;);</span><br></pre></td></tr></table></figure>

<p>ä» React v16 å¼€å§‹ï¼Œä¸Šé¢çš„æœåŠ¡å™¨ç«¯ä»£ç ä¾ç„¶å¯ä»¥ä½¿ç”¨ï¼Œä½†æ˜¯ä¹Ÿå¯ä»¥æŠŠ renderToString æ›¿æ¢ä¸º renderToNodeStreamï¼Œä»£ç å¦‚ä¸‹ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">import React from &#x27;react&#x27;;</span><br><span class="line">import ReactDOMServer from &#x27;react-dom/server&#x27;;</span><br><span class="line"></span><br><span class="line">// æŠŠæ¸²æŸ“å†…å®¹ä»¥æµçš„å½¢å¼å¡ç»™response</span><br><span class="line">ReactDOMServer.renderToNodeStream(&lt;Hello /&gt;).pipe(response);</span><br></pre></td></tr></table></figure>

<p>æ­¤å¤–ï¼Œæµè§ˆå™¨ç«¯ä»£ç ä¹Ÿæœ‰ä¸€ç‚¹å˜åŒ–ï¼ŒReactDOM.render ä¾ç„¶å¯ä»¥ä½¿ç”¨ï¼Œä½†æ˜¯å®˜æ–¹å»ºè®®æ›¿æ¢ä¸º ReactDOM.hydrateï¼ŒåŸæ¥çš„ ReactDOM.render å°†æ¥ä¼šè¢«åºŸå¼ƒæ‰ã€‚</p>
<p>renderToString çš„åŠŸèƒ½æ˜¯ä¸€å£æ°”åŒæ­¥äº§ç”Ÿæœ€ç»ˆ HTMLï¼Œå¦‚æœ React ç»„ä»¶æ ‘å¾ˆåºå¤§ï¼Œè¿™æ ·ä¸€ä¸ªåŒæ­¥è¿‡ç¨‹å¯èƒ½æ¯”è¾ƒè€—æ—¶ã€‚å‡è®¾æ¸²æŸ“å®Œæ•´ HTML éœ€è¦ 500 æ¯«ç§’ï¼Œé‚£ä¹ˆä¸€ä¸ª HTTP&#x2F;HTTPS è¯·æ±‚è¿‡æ¥ï¼Œ500 æ¯«ç§’ä¹‹åæ‰è¿”å› HTMLï¼Œæ˜¾å¾—ä¸å¤§åˆé€‚ï¼Œè¿™ä¹Ÿæ˜¯ä¸ºä»€ä¹ˆ v16 æä¾›äº† renderToNodeStream è¿™ä¸ªæ–° API çš„åŸå› ã€‚</p>
<p>renderToNodeStream æŠŠæ¸²æŸ“ç»“æœä»¥â€œæµâ€çš„å½¢å¼å¡ç»™ response å¯¹è±¡ï¼ˆè¿™é‡Œçš„ response æ˜¯ express æˆ–è€… koa çš„æ¦‚å¿µï¼‰ï¼Œè¿™æ„å‘³ç€ä¸ç”¨ç­‰åˆ°æ‰€æœ‰ HTML éƒ½æ¸²æŸ“å‡ºæ¥äº†æ‰ç»™æµè§ˆå™¨ç«¯è¿”å›ç»“æœï¼Œä¹Ÿè®¸ 10 æ¯«ç§’å†…å°±æ¸²æŸ“å‡ºæ¥äº†ç½‘é¡µå¤´éƒ¨ï¼Œé‚£å°±æ²¡å¿…è¦ç­‰åˆ° 500 æ¯«ç§’å…¨éƒ¨ç½‘é¡µéƒ½å‡ºæ¥äº†æ‰æ¨ç»™æµè§ˆå™¨ï¼Œâ€œæµâ€çš„ä½œç”¨å°±æ˜¯æœ‰å¤šå°‘å†…å®¹ç»™å¤šå°‘å†…å®¹ï¼Œè¿™æ ·ç”¨æˆ·åªéœ€è¦ 10 æ¯«ç§’å¤šä¸€ç‚¹çš„å»¶è¿Ÿå°±å¯ä»¥çœ‹åˆ°ç½‘é¡µå†…å®¹ï¼Œè¿›ä¸€æ­¥æ”¹è¿›äº†â€œç¬¬ä¸€æœ‰æ„ä¹‰æ¸²æŸ“æ—¶é—´â€</p>
<p><strong>æœåŠ¡å™¨ç«¯æ¸²æŸ“çš„éš¾ç‚¹</strong></p>
<p>çœ‹åˆ°è¿™é‡Œï¼Œä½ å¯èƒ½è§‰å¾—æœåŠ¡å™¨ç«¯æ¸²æŸ“ä¹Ÿå¤ªç®€å•äº†ï¼Œçš„ç¡®ï¼Œå› ä¸º React ç»„ä»¶å¯ä»¥ä¸å¿…å…³å¿ƒè‡ªå·±æ˜¯åœ¨å“ªä¸ªç«¯æ¸²æŸ“ï¼Œå¯ä»¥åšåˆ°ä»£ç ä¸€æ¬¡ç¼–å†™ï¼Œåˆ°å¤„éƒ½å¯ä»¥æ‰§è¡Œã€‚ä½†æ˜¯ï¼ŒçœŸçš„è¿™ä¹ˆç®€å•å—ï¼Ÿ</p>
<p>ä¸ºäº†ç®€åŒ–é—®é¢˜ï¼Œä¸Šé¢çš„ä»£ç ç¤ºä¾‹æœ‰æ„å¿½ç•¥äº†ä¸€ä¸ªäº‹å®ï¼Œé‚£å°±æ˜¯ï¼Œåº”ç”¨å¾€å¾€éœ€è¦å¤–éƒ¨æœåŠ¡å™¨è·å–æ•°æ®å•Šï¼</p>
<p>é™¤éä½ çš„ç½‘é¡µåº”ç”¨æ ¹æœ¬æ²¡æœ‰åŠ¨æ€å†…å®¹ï¼Œä¸ç„¶ä½ å¿…é¡»è¦è€ƒè™‘åœ¨æœåŠ¡å™¨ç«¯æ€ä¹ˆç»™ React ç»„ä»¶è·å–æ•°æ®ã€‚</p>
<p>æ¯”å¦‚ï¼Œä½ ç°åœ¨çœ‹åˆ°çš„æ˜é‡‘å°å†Œï¼Œä¸ºäº†æ¸²æŸ“ä½ æ‰€çœ‹åˆ°çš„é¡µé¢ï¼Œéœ€è¦è°ƒç”¨æ˜é‡‘å°å†Œçš„æœåŠ¡å™¨ API æ¥è·å–è¿™ç¯‡æ–‡ç« çš„å†…å®¹ã€‚å¯¹äºæµè§ˆå™¨ç«¯æ¸²æŸ“ï¼Œåœ¨ componentDidMount é‡Œè°ƒç”¨ AJAX å°±å¥½äº†ï¼›å¯¹äºæœåŠ¡å™¨ç«¯æ¸²æŸ“ï¼Œè¦æƒ³äº§ç”Ÿ HTML çš„åŒ…å«å†…å®¹ï¼Œå¿…é¡»äº‹å…ˆæŠŠæ•°æ®å‡†å¤‡å¥½ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œä»£ç è¦æ˜¯è¿™æ ·æ‰è¡Œï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">import React from &#x27;react&#x27;;</span><br><span class="line">import ReactDOMServer from &#x27;react-dom/server&#x27;;</span><br><span class="line"></span><br><span class="line">callAPI().then(result =&gt; &#123;</span><br><span class="line">  const props = result;</span><br><span class="line">  ReactDOMServer.renderToNodeStream(&lt;Hello &#123;...props&#125;/&gt;).pipe(response);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<p>æœ€å¤§çš„é—®é¢˜æ¥äº†ï¼Œå¦‚ä½•ç»™ç»„ä»¶è·å–å’Œæä¾›æ•°æ®å‘¢ï¼Ÿ</p>
<p>è§£å†³äº†è¿™ä¸ªé—®é¢˜ï¼Œæ‰ç®—çœŸçš„è§£å†³äº†æœåŠ¡å™¨ç«¯æ¸²æŸ“çš„é—®é¢˜ã€‚</p>
<p><strong>â€œè„±æ°´â€å’Œâ€œæ³¨æ°´â€8</strong></p>
<p>React æœ‰ä¸€ä¸ªç‰¹ç‚¹ï¼Œå°±æ˜¯æŠŠå†…å®¹å±•ç¤ºå’ŒåŠ¨æ€åŠŸèƒ½é›†ä¸­åœ¨ä¸€ä¸ªç»„ä»¶ä¸­ã€‚æ¯”å¦‚ï¼Œä¸€ä¸ª Counter ç»„ä»¶æ—¢è´Ÿè´£æ€ä¹ˆç”»å‡ºå†…å®¹ï¼Œä¹Ÿè¦è´Ÿè´£æ€ä¹ˆå“åº”æŒ‰é”®ç‚¹å‡»ï¼Œè¿™å½“ç„¶ç¬¦åˆè½¯ä»¶é«˜å†…èšæ€§çš„åŸåˆ™ï¼Œä½†æ˜¯ä¹Ÿç»™æœåŠ¡å™¨ç«¯æ¸²æŸ“å¸¦æ¥æ›´å¤šçš„å·¥ä½œã€‚</p>
<p>è®¾æƒ³ä¸€ä¸‹ï¼Œå¦‚æœåªä½¿ç”¨æœåŠ¡å™¨ç«¯æ¸²æŸ“ï¼Œé‚£ä¹ˆäº§ç”Ÿçš„åªæœ‰ HTMLï¼Œè™½ç„¶èƒ½å¤Ÿè®©æµè§ˆå™¨ç«¯ç”»å‡ºå†…å®¹ï¼Œä½†æ˜¯ï¼Œæ²¡æœ‰ JavaScript çš„è¾…åŠ©æ˜¯æ— æ³•å“åº”ç”¨æˆ·äº¤äº’äº‹ä»¶çš„ã€‚å¯¹åº” Counter çš„ä¾‹å­ï¼Œä¸€ä¸ª Counter ç»„ä»¶åœ¨æµè§ˆå™¨ä¸­ä¹Ÿå°±æ¸²æŸ“å‡ºä¸€ä¸ªæ•°å­—ä¸¤ä¸ªæŒ‰é’®ï¼Œç”¨æˆ·ç‚¹å‡» + æŒ‰é’®æˆ–è€… - æŒ‰é’®ï¼Œä»€ä¹ˆéƒ½ä¸ä¼šå‘ç”Ÿã€‚</p>
<p>å¾ˆæ˜¾ç„¶æˆ‘ä»¬å¿…é¡»è¦åœ¨æµè§ˆå™¨ç«¯èµ‹äºˆ Counter ç»„ä»¶ä¸€äº›â€œç¥åŠ›â€ï¼Œè®©å®ƒèƒ½å¤Ÿå“åº”äº‹ä»¶ã€‚é‚£ä¹ˆæ€ä¹ˆèµ‹äºˆ Counter ç»„ä»¶â€œç¥åŠ›â€å‘¢ï¼Ÿå…¶å®æˆ‘ä»¬å·²ç»åšè¿‡è¿™ä»¶äº‹äº†ï¼ŒCounter ç»„ä»¶é‡Œé¢å·²ç»æœ‰å¯¹æŒ‰é’®äº‹ä»¶çš„å¤„ç†ï¼Œæˆ‘ä»¬æ‰€è¦åšçš„åªæ˜¯è®© Counter ç»„ä»¶åœ¨æµè§ˆå™¨ç«¯é‡æ–°æ‰§è¡Œä¸€éï¼Œä¹Ÿå°±æ˜¯ mount ä¸€éå°±å¯ä»¥äº†ã€‚</p>
<blockquote>
<p>ä¹Ÿå°±æ˜¯è¯´ï¼Œå¦‚æœæƒ³è¦åŠ¨æ€äº¤äº’æ•ˆæœï¼Œä½¿ç”¨ React æœåŠ¡å™¨ç«¯æ¸²æŸ“ï¼Œå¿…é¡»ä¹Ÿé…åˆä½¿ç”¨æµè§ˆå™¨ç«¯æ¸²æŸ“ã€‚</p>
</blockquote>
<p>ç°åœ¨é—®é¢˜å˜å¾—æ›´åŠ æœ‰è¶£äº†ï¼Œåœ¨æœåŠ¡å™¨ç«¯æˆ‘ä»¬ç»™ Counter ä¸€ä¸ªåˆå§‹å€¼ï¼ˆè¿™ä¸ªå€¼å¯ä»¥ä¸æ˜¯ç¼ºçœçš„ 0ï¼‰ï¼Œè®© Counter æ¸²æŸ“äº§ç”Ÿ HTMLï¼Œè¿™äº› HTML è¦ä¼ é€’ç»™æµè§ˆå™¨ç«¯ï¼Œä¸ºäº†è®© Counter çš„ HTMLâ€œæ´»â€èµ·æ¥ç‚¹å‡»ç›¸åº”äº‹ä»¶ï¼Œå¿…é¡»è¦åœ¨æµè§ˆå™¨ç«¯é‡æ–°æ¸²æŸ“ä¸€é Counter ç»„ä»¶ã€‚åœ¨æµè§ˆå™¨ç«¯æ¸²æŸ“ Counter ä¹‹å‰ï¼Œç”¨æˆ·å°±å¯ä»¥çœ‹è§ Counter ç»„ä»¶çš„å†…å®¹ï¼Œä½†æ˜¯æ— æ³•ç‚¹å‡»äº¤äº’ï¼Œè¦æƒ³ç‚¹å‡»äº¤äº’ï¼Œå°±å¿…é¡»è¦ç­‰åˆ°æµè§ˆå™¨ç«¯ä¹Ÿæ¸²æŸ“ä¸€æ¬¡ Counter ä¹‹åã€‚</p>
<p>æ¥ä¸‹æ¥çš„ä¸€ä¸ªé—®é¢˜ï¼Œå¦‚æœæœåŠ¡å™¨ç«¯å¡ç»™ Counter çš„æ•°æ®å’Œæµè§ˆå™¨ç«¯å¡ç»™ Counter çš„æ•°æ®ä¸ä¸€æ ·å‘¢ï¼Ÿ</p>
<p>åœ¨ React v16 ä¹‹å‰ï¼ŒReact åœ¨æµè§ˆå™¨ç«¯æ¸²æŸ“ä¹‹åï¼Œä¼šæŠŠå†…å®¹å’ŒæœåŠ¡å™¨ç«¯ç»™çš„ HTML åšä¸€ä¸ªæ¯”å¯¹ã€‚å¦‚æœå®Œå…¨ä¸€æ ·ï¼Œé‚£æœ€å¥½ï¼Œæ¥ç€ç”¨æœåŠ¡å™¨ç«¯ HTML å°±å¥½äº†ï¼›å¦‚æœæœ‰ä¸€ä¸ç‚¹ä¸ä¸€æ ·ï¼Œå°±ä¼šç«‹åˆ»ä¸¢æ‰æœåŠ¡å™¨ç«¯çš„ HTMLï¼Œé‡æ–°æ¸²æŸ“æµè§ˆå™¨ç«¯äº§ç”Ÿçš„å†…å®¹ï¼Œç»“æœå°±æ˜¯ç”¨æˆ·å¯ä»¥çœ‹åˆ°ç•Œé¢é—ªçƒã€‚å› ä¸º React æŠ›å¼ƒçš„æ˜¯æ•´ä¸ªæœåŠ¡å™¨ç«¯æ¸²æŸ“å†…å®¹ï¼Œç»„ä»¶æ ‘è¶Šå¤§ï¼Œè¿™ä¸ªé—ªçƒæ•ˆæœè¶Šæ˜æ˜¾ã€‚</p>
<p>React åœ¨ v16 ä¹‹åï¼Œåšäº†ä¸€äº›æ”¹è¿›ï¼Œä¸å†è¦æ±‚æ•´ä¸ªç»„ä»¶æ ‘ä¸¤ç«¯æ¸²æŸ“ç»“æœåˆ†æ¯«ä¸å·®ï¼Œä½†æ˜¯å¦‚æœå‘ç”Ÿä¸ä¸€è‡´ï¼Œä¾ç„¶ä¼šæŠ›å¼ƒå±€éƒ¨æœåŠ¡å™¨ç«¯æ¸²æŸ“ç»“æœã€‚</p>
<blockquote>
<p>æ€»ä¹‹ï¼Œå¦‚æœç”¨æœåŠ¡å™¨ç«¯æ¸²æŸ“ï¼Œä¸€å®šè¦è®©æœåŠ¡å™¨ç«¯å¡ç»™ React ç»„ä»¶çš„æ•°æ®å’Œæµè§ˆå™¨ç«¯ä¸€è‡´ã€‚</p>
</blockquote>
<p>ä¸ºäº†è¾¾åˆ°è¿™ä¸€ç›®çš„ï¼Œå¿…é¡»æŠŠä¼ ç»™ React ç»„ä»¶çš„æ•°æ®ç»™ä¿ç•™ä½ï¼Œéšç€ HTML ä¸€èµ·ä¼ é€’ç»™æµè§ˆå™¨ç½‘é¡µï¼Œè¿™ä¸ªè¿‡ç¨‹ï¼Œå«åšâ€œè„±æ°´â€ï¼ˆDehydrateï¼‰ï¼›åœ¨æµè§ˆå™¨ç«¯ï¼Œå°±ç›´æ¥æ‹¿è¿™ä¸ªâ€œè„±æ°´â€æ•°æ®æ¥åˆå§‹åŒ– React ç»„ä»¶ï¼Œè¿™ä¸ªè¿‡ç¨‹å«â€œæ³¨æ°´â€ï¼ˆHydrateï¼‰ã€‚</p>
<p>å‰é¢æåˆ°è¿‡ React v16 ä¹‹åç”¨ React.hydrate æ›¿æ¢ React.renderï¼Œè¿™ä¸ª hydrate å°±æ˜¯â€œæ³¨æ°´â€ã€‚</p>
<p><img src="https://user-gold-cdn.xitu.io/2018/11/2/166d20bf04d0775d" alt="img"></p>
<blockquote>
<p>æ€»ä¹‹ï¼Œä¸ºäº†å®ç°Reactçš„æœåŠ¡å™¨ç«¯æ¸²æŸ“ï¼Œå¿…é¡»è¦å¤„ç†å¥½è¿™ä¸¤ä¸ªé—®é¢˜ï¼š</p>
</blockquote>
<ul>
<li>è„±æ°´</li>
<li>æ³¨æ°´</li>
</ul>
<p><strong>Facebook æœªä½¿ç”¨æœåŠ¡å™¨ç«¯æ¸²æŸ“</strong></p>
<p>å€¼å¾—ä¸€æçš„æ˜¯ï¼Œè™½ç„¶ React ä»æœ€åˆç‰ˆæœ¬å°±æ”¯æŒâ€œæœåŠ¡å™¨ç«¯æ¸²æŸ“â€ï¼Œå¹¶ä¸” React çš„åˆ›å»ºè€… Facebook ä¹Ÿå…¨åŠ›åœ¨è‡ªå·±çš„ç½‘ç«™äº§å“ä¸­ä½¿ç”¨ Reactï¼Œä½†ä»–ä»¬è‡ªå·±å´æ²¡æœ‰ä½¿ç”¨ React çš„æœåŠ¡å™¨ç«¯æ¸²æŸ“åŠŸèƒ½ã€‚ç†ç”±æ˜¯ï¼ŒFacebook å·²ç»åœ¨ PHP ä¸ŠæŠ•å…¥äº†å¾ˆå¤šèµ„æºï¼Œä¸æ‰“ç®—æ”¾å¼ƒè¿™äº›æŠ•å…¥ã€‚</p>
<p>è¿™é‡Œæˆ‘å½“ç„¶ä¸æ˜¯æ‰¹è¯„ Facebookï¼Œå®é™…ä¸Šï¼ŒFacebook å¯¹ React çš„æ”¯æŒæ˜¯çœŸå¿ƒçš„ï¼Œå®ƒåœ¨è‡ªå·±çš„ç½‘ç«™ä¸Šå¤§èŒƒå›´ä½¿ç”¨ Reactï¼Œè€Œä¸åªæ˜¯åšå‡ºæ¥åè®©å¤–éƒ¨ä½¿ç”¨è€…å½“å°ç™½é¼ ï¼Œè¿™ç§å…¨åŠ›æŠ•å…¥ä¹Ÿç»™äº† React ä½¿ç”¨è€…å¾ˆå¤§ä¿¡å¿ƒã€‚ä½†å¦ä¸€æ–¹é¢ï¼Œå› ä¸º Facebook è‡ªå·±ä¸ç”¨ React çš„æœåŠ¡å™¨ç«¯æ¸²æŸ“ï¼Œå¦‚ä½•åˆ©ç”¨è¿™ä¸ªåŠŸèƒ½ï¼Œå°±ç¼ºä¹ä¸€ä¸ªå®˜æ–¹å‚è€ƒæ ‡å‡†äº†ã€‚</p>
<p>ä¹Ÿè®¸å°±æ˜¯å› ä¸ºç¼ºä¹ Facebook çš„å®˜æ–¹æ ‡å‡†ï¼Œä¸šç•Œå¯¹æœåŠ¡å™¨ç«¯æ¸²æŸ“çš„è§£å†³æ–¹æ³•å±‚å‡ºä¸ç©·ï¼Œä¸è¿‡ï¼Œåˆ°ç›®å‰çœ‹æ¥ï¼Œnext.js è¿˜æ˜¯æœ€ä½³æ–¹æ¡ˆ</p>
<h3 id="7-2-ç†è§£-Next-js"><a href="#7-2-ç†è§£-Next-js" class="headerlink" title="7.2 ç†è§£ Next.js"></a>7.2 ç†è§£ Next.js</h3><p>æˆ‘ä»¬å·²ç»çŸ¥é“äº†æœåŠ¡å™¨ç«¯æ¸²æŸ“çš„åŸç†ï¼Œä½ åªéœ€è¦æ­å»ºä¸€ä¸ª Express æœåŠ¡å™¨ï¼Œåœ¨æœåŠ¡å™¨ç«¯æ‰‹å·¥æ‰“é€ ã€è„±æ°´ã€ï¼Œåœ¨æµè§ˆå™¨ç«¯åšã€æ³¨æ°´ã€ï¼Œå®ŒæˆæŸä¸ªé¡µé¢çš„æœåŠ¡å™¨ç«¯æ¸²æŸ“å¹¶ä¸éš¾ã€‚</p>
<p>ä¸è¿‡ï¼ŒæœåŠ¡å™¨ç«¯æ¸²æŸ“çš„é—®é¢˜å¹¶ä¸è¿™ä¹ˆç®€å•ï¼Œä¸€ä¸ªæœ€ç›´æ¥çš„é—®é¢˜ï¼Œå°±æ˜¯æ€ä¹ˆå¤„ç†å¤šä¸ªé¡µé¢çš„ã€å•é¡µåº”ç”¨ã€ï¼ˆSingle-Page-Applicationï¼‰ï¼Ÿ</p>
<p>æ‰€ä»¥å•é¡µåº”ç”¨ï¼Œå°±æ˜¯è™½ç„¶ç”¨æˆ·æ„Ÿè§‰æœ‰å¤šä¸ªé¡µé¢ï¼Œä½†æ˜¯å®ç°ä¸Šåªæœ‰ä¸€ä¸ªé¡µé¢ï¼Œç”¨æˆ·æ„Ÿè§‰åˆ°é¡µé¢å¯ä»¥æ¥å›åˆ‡æ¢ï¼Œä½†å…¶å®åªæ˜¯ä¸€ä¸ªé¡µé¢å¹¶æ²¡æœ‰å®Œå…¨åˆ·æ–°ï¼Œåªæ˜¯å±€éƒ¨ç•Œé¢æ›´æ–°è€Œå·²ã€‚</p>
<p>å‡è®¾ä¸€ä¸ªå•é¡µåº”ç”¨æœ‰ä¸‰ä¸ªé¡µé¢ Homeã€Prodcut å’Œ Aboutï¼Œåˆ†åˆ«å¯¹åº”çš„çš„è·¯å¾„æ˜¯ &#x2F;homeã€&#x2F;product å’Œ &#x2F;aboutï¼Œè€Œä¸”ä¸‰ä¸ªé¡µé¢éƒ½ä¾èµ–äº API è°ƒç”¨æ¥è·å–å¤–éƒ¨æ•°æ®ã€‚</p>
<p>ç°åœ¨æˆ‘ä»¬è¦åšæœåŠ¡å™¨ç«¯æ¸²æŸ“ï¼Œå¦‚æœåªè€ƒè™‘ç”¨æˆ·ç›´æ¥åœ¨åœ°å€æ è¾“å…¥ &#x2F;homeã€&#x2F;product å’Œ &#x2F;about çš„åœºæ™¯ï¼Œå¾ˆå®¹æ˜“æ»¡è¶³ï¼ŒæŒ‰ç…§ä¸Šé¢è¯´çš„å¥—è·¯åšå°±æ˜¯äº†ã€‚ä½†æ˜¯ï¼Œè¿™æ˜¯ä¸€ä¸ªå•é¡µåº”ç”¨ï¼Œç”¨æˆ·å¯ä»¥åœ¨ Home é¡µé¢ç‚¹å‡»é“¾æ¥æ— ç¼åˆ‡æ¢åˆ° Productï¼Œè¿™æ—¶å€™ Product è¦åšå®Œå…¨çš„æµè§ˆå™¨ç«¯æ¸²æŸ“ã€‚æ¢å¥è¯è¯´ï¼Œæ¯ä¸ªé¡µé¢éƒ½éœ€è¦æ—¢æ”¯æŒæœåŠ¡å™¨ç«¯æ¸²æŸ“ï¼Œåˆæ”¯æŒå®Œå…¨çš„æµè§ˆå™¨ç«¯æ¸²æŸ“ï¼Œæ›´é‡è¦çš„æ˜¯ï¼Œå¯¹äºå¼€å‘è€…æ¥è¯´ï¼Œè‚¯å®šä¸å¸Œæœ›ä¸ºäº†è¿™ä¸ªé¡µé¢å®ç°ä¸¤å¥—ç¨‹åºï¼Œæ‰€ä»¥å¿…é¡»æœ‰åŒæ—¶æ»¡è¶³æœåŠ¡å™¨ç«¯æ¸²æŸ“å’Œæµè§ˆå™¨ç«¯æ¸²æŸ“çš„ä»£ç è¡¨ç¤ºæ–¹å¼ã€‚</p>
<p>è¯»è€…å¯ä»¥æ€è€ƒä¸€ä¸‹ä»€ä¹ˆæ ·çš„ä»£ç è¡¨ç¤ºåˆé€‚ï¼Œä¹Ÿå¯ä»¥ç›´æ¥å¾€ä¸‹ï¼Œçœ‹çœ‹ä¸šç•Œå…¬è®¤æœ€ç§‘å­¦çš„å®ç°æ–¹å¼ Next.js æ˜¯å¦‚ä½•åšçš„ã€‚</p>
<p><strong>å¿«é€Ÿåˆ›å»º Next.js é¡¹ç›®</strong></p>
<p>åœ¨è¯´æ˜ Next.js çš„å·¥ä½œåŸç†ä¹‹å‰ï¼Œæˆ‘ä»¬å…ˆçœ‹æ€ä¹ˆå¿«é€Ÿåˆ›å»º Next.js é¡¹ç›®ï¼Œè¿™ä¸ªé—®é¢˜ç”¨ä»£ç æ¥è¯´æ˜ä¼šæ›´é¡ºç•…ã€‚</p>
<p>æˆ‘ä»¬ä¹Ÿå¯ä»¥æ‰‹å·¥åˆ›å»º Next.js é¡¹ç›®ï¼Œä¸è¿‡æ›´ç®€å•çš„æ–¹å¼æ˜¯ç”¨è‡ªåŠ¨åŒ–å·¥å…· create-next-appï¼Œè¿™ä¸ª create-next-app ç±»ä¼¼äº create-react-appï¼Œä¸€ä¸ªå‘½ä»¤å°±åˆ›å»ºä¸€ä¸ªå¯ä»¥è¿è¡Œçš„åº”ç”¨ã€‚</p>
<p>é¦–å…ˆå®‰è£… create-next-appã€‚</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm install -g create-next-app</span><br></pre></td></tr></table></figure>

<p>ç„¶åï¼Œå°±å¯ä»¥åœ¨ä½ ä¸“é—¨å­˜æ”¾é¡¹ç›®çš„ç›®å½•ä¸‹æ‰§è¡Œ create-next-appï¼Œäº§ç”Ÿä¸€ä¸ªä½¿ç”¨ Next.js çš„ React åº”ç”¨ï¼Œä¸‹é¢çš„å‘½ä»¤åˆ›å»ºä¸€ä¸ªå« next_demo çš„åº”ç”¨ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">create-next-app next_demo</span><br></pre></td></tr></table></figure>

<p>è¿›å…¥æ–°ç”Ÿæˆçš„é¡¹ç›®ç›®å½• next_demo é‡Œæ£€æŸ¥ä¸€ä¸‹ï¼Œå¯ä»¥çœ‹åˆ°æ–‡ä»¶ç»“æ„éå¸¸ç®€æ´ï¼Œpages ç›®å½•ä¸‹æ˜¯é¡µé¢æ–‡ä»¶ï¼Œpackage.json ä¸­å·®ä¸æ˜¯ä¸‹é¢è¿™æ ·ï¼Œæ²¡æœ‰ç¹å†—çš„ webpack å’Œ babel ä¾èµ–åŒ…ï¼Œå› ä¸ºä¸€åˆ‡éƒ½è¢« Next.js å°è£…èµ·æ¥äº†</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  &quot;name&quot;: &quot;create-next-example-app&quot;,</span><br><span class="line">  &quot;scripts&quot;: &#123;</span><br><span class="line">    &quot;dev&quot;: &quot;next&quot;,</span><br><span class="line">    &quot;build&quot;: &quot;next build&quot;,</span><br><span class="line">    &quot;start&quot;: &quot;next start&quot;</span><br><span class="line">  &#125;,</span><br><span class="line">  &quot;dependencies&quot;: &#123;</span><br><span class="line">    &quot;next&quot;: &quot;^6.0.3&quot;,</span><br><span class="line">    &quot;react&quot;: &quot;^16.5.2&quot;,</span><br><span class="line">    &quot;react-dom&quot;: &quot;^16.5.2&quot;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>è™½ç„¶æœ‰ä¸å°‘æ¡†æ¶éƒ½è¡¨ç¤ºè‡ªå·±çš„åŠŸèƒ½å¾ˆå¼ºå¤§ï¼Œä½†å…¶ä¸­æœ‰å¾ˆå¤šæ¡†æ¶çš„è®¾è®¡å¹¶ä¸ä¸­ç«‹ï¼Œç”¨è¿™äº›æ¡†æ¶å»å¼€å‘æŸäº›ç‰¹å®šåº”ç”¨æˆ–è®¸è¿˜è¡Œï¼Œå¦‚æœæ”¾åˆ°ä¸€ä¸ªæ›´å¤§èŒƒå›´çš„åº”ç”¨ç±»å‹ä¸­ï¼Œå°±ä¼šå‘ç°æ— æ³•æ»¡è¶³è¦æ±‚ï¼Œè¿™æ ·çš„æ¡†æ¶é€šç”¨æ€§ä¸è¶³ï¼Œå¼€å‘è€…ä¸€å®šè¦è°¨æ…ä½¿ç”¨ã€‚</p>
<p>è®²è‰¯å¿ƒè¯ï¼ŒNext.js çœŸçš„æ˜¯ä¸€ä¸ªé€šç”¨æ€§éå¸¸é«˜çš„æ¡†æ¶ï¼Œå› ä¸º Next.js å®Œå…¨éµä»äº† React çš„æŠ€æœ¯å“²å­¦ï¼šä¸€åˆ‡çš†ä¸ºç»„ä»¶ã€‚</p>
<p>åœ¨ Next.js ä¸­ï¼Œåˆ›é€ ä¸€ä¸ªé¡µé¢ï¼Œå…¶å®å°±æ˜¯åˆ›é€ ä¸€ä¸ª React ç»„ä»¶ï¼Œæ¥ä¸‹æ¥æˆ‘ä»¬çœ‹çœ‹å¦‚ä½•åˆ›å»ºä¸€ä¸ªé¡µé¢ã€‚</p>
<p><strong>ç¼–å†™é¡µé¢</strong></p>
<p>ä½¿ç”¨ä¸‹é¢çš„å‘½ä»¤å¯åŠ¨ Next.js åº”ç”¨ï¼Œè¿›å…¥çš„æ˜¯å¼€å‘è€…æ¨¡å¼ï¼Œè¿™æ—¶å€™å¯¹ä»£ç çš„æ”¹å˜ï¼Œä¼šç«‹åˆ»ä½“ç°åœ¨ç½‘é¡µä¸Šã€‚</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm run dev</span><br></pre></td></tr></table></figure>

<p>è¯·æ³¨æ„ï¼Œè¿™ä¸€ç‚¹ä¸Š Next.js çš„ä¹ æƒ¯ç”¨æ³•å’Œ create-react-app äº§ç”Ÿçš„åº”ç”¨ä¸ä¸€æ ·ã€‚åœ¨ create-react-app äº§ç”Ÿçš„åº”ç”¨ä¸­ï¼Œ npm run start å¯åŠ¨æ˜¯å¼€å‘è€…æ¨¡å¼ï¼Œä½†åœ¨ Next.js åº”ç”¨ä¸­ï¼Œä¹ æƒ¯ä¸Š npm run start ä»¥äº§å“æ¨¡å¼å¯åŠ¨ï¼Œæ‰€ä»¥è¦å…ˆè¿è¡Œ npm run build ç„¶åæ‰èƒ½è¿è¡Œ npm run startã€‚</p>
<p>Next.js éµä»ã€åå®šä¼˜äºé…ç½®ã€ï¼ˆconvention over configurationï¼‰çš„è®¾è®¡åŸåˆ™ï¼Œæ ¹æ®ã€åå®šã€ï¼Œåœ¨ pages ä¸­æ¯ä¸ªæ–‡ä»¶å¯¹åº”ä¸€ä¸ªç½‘é¡µæ–‡ä»¶ï¼Œæ–‡ä»¶åå¯¹åº”çš„å°±æ˜¯ç½‘é¡µçš„è·¯å¾„åï¼Œæ¯”å¦‚ pages&#x2F;home.js æ–‡ä»¶å¯¹åº”çš„å°±æ˜¯ &#x2F;home è·¯å¾„çš„é¡µé¢ï¼Œå½“ç„¶ pages&#x2F;index.js æ¯”è¾ƒç‰¹æ®Šï¼Œå¯¹åº”çš„æ˜¯é»˜è®¤æ ¹è·¯å¾„ &#x2F; çš„é¡µé¢ã€‚</p>
<p>æˆ‘ä»¬ä¿®æ”¹ pages&#x2F;index.jsï¼Œè®©å®ƒæ›´ç®€å•ä¸€äº›ï¼Œå¦‚ä¸‹ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">import React from &#x27;react&#x27;</span><br><span class="line"></span><br><span class="line">const Home = (props) =&gt; (</span><br><span class="line">  &lt;h1&gt;</span><br><span class="line">    Hello World</span><br><span class="line">  &lt;/h1&gt;</span><br><span class="line">)</span><br><span class="line"></span><br><span class="line">export default Home</span><br></pre></td></tr></table></figure>

<p>è¿™æ ·ä¼šåœ¨é¡µé¢ä¸Šæ˜¾ç¤ºå‡ºä¸€ä¸ª Hello Worldï¼Œè€Œè¿™ä¸ªé¡µé¢ä»£ç å°±æ˜¯ä¸€ä¸ªæ™®é€šçš„ React ç»„ä»¶è€Œå·²ã€‚</p>
<p>é¡µé¢éƒ½æ˜¯ React ç»„ä»¶ï¼Œè¿™å°±æ˜¯ Next.js çš„å“²å­¦ã€‚</p>
<p><strong>getInitialProps</strong></p>
<p>æˆ‘ä»¬è¿˜æ˜¯è¦å›åˆ°æœ¬æ¥çš„è¯é¢˜ï¼Œå¦‚ä½•ä¼˜é›…åœ°å®ç°æœåŠ¡å™¨ç«¯æ¸²æŸ“ï¼Œä¸Šé¢çš„ Home é¡µé¢è™½ç„¶èƒ½å¤Ÿæ¸²æŸ“å‡ºå®Œæ•´åŒ…å« Hello World çš„ HTMLï¼Œä½†æ˜¯å¹¶æ²¡æœ‰è°ƒç”¨ä»»ä½•å¤–éƒ¨ API èµ„æºï¼Œæ‰€ä»¥ä¹Ÿæ²¡æœ‰å¼‚æ­¥æ“ä½œï¼Œå¹¶ä¸èƒ½ä½“ç°æœåŠ¡å™¨ç«¯æ¸²æŸ“çš„éš¾åº¦ã€‚</p>
<p>æˆ‘ä»¬ç”¨ä¸€ä¸ªå‡½æ•°æ¥å®ç°å¼‚æ­¥æ“ä½œï¼Œä»¥æ­¤æ¨¡æ‹Ÿè°ƒç”¨ API çš„å»¶è¿Ÿæ•ˆæœï¼Œå¦‚ä¸‹ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">const timeout = (ms, result) =&gt; &#123;</span><br><span class="line">  return new Promise(resolve =&gt; setTimeout(() =&gt; resolve(result), ms));</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<blockquote>
<p>ç„¶åï¼Œæˆ‘ä»¬åˆ©ç”¨è¿™ä¸ª timeout æ¥è·å¾—å±•ç¤ºç½‘é¡µæ‰€éœ€çš„æ•°æ®ã€‚æ¯”å¦‚è¯´ï¼Œè·å–ç”¨æˆ·åï¼Œé‚£ä¹ˆæˆ‘ä»¬çš„ Home ç»„ä»¶å°±è¦æ¢ä¸€ä¸ªå†™æ³•ï¼Œåƒä¸‹é¢é‚£æ ·ï¼Œå¢åŠ  getInitialProps çš„å®šä¹‰ï¼š</p>
</blockquote>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">const Home = (props) =&gt; (</span><br><span class="line">  &lt;h1&gt;</span><br><span class="line">    Hello &#123;props.userName&#125;</span><br><span class="line">  &lt;/h1&gt;</span><br><span class="line">)</span><br><span class="line"></span><br><span class="line">Home.getInitialProps = async () =&gt; &#123;</span><br><span class="line">  return await timeout(200, &#123;userName: &#x27;Morgan&#x27;&#125;);</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<p>è¿™ä¸ª getiInitialProps æ˜¯ Next.js æœ€ä¼Ÿå¤§çš„å‘æ˜ï¼Œå®ƒç¡®å®šäº†ä¸€ä¸ªè§„èŒƒï¼Œä¸€ä¸ªé¡µé¢ç»„ä»¶åªè¦æŠŠè®¿é—® API å¤–éƒ¨èµ„æºçš„ä»£ç æ”¾åœ¨ getInitialProps ä¸­å°±è¶³å¤Ÿï¼Œå…¶ä½™çš„ä¸ç”¨ç®¡ï¼ŒNext.js è‡ªç„¶ä¼šåœ¨æœåŠ¡å™¨ç«¯æˆ–è€…æµè§ˆå™¨ç«¯è°ƒç”¨ getInitialProps æ¥è·å–å¤–éƒ¨èµ„æºï¼Œå¹¶æŠŠå¤–éƒ¨èµ„æºä»¥ props çš„æ–¹å¼ä¼ é€’ç»™é¡µé¢ç»„ä»¶ã€‚</p>
<p>æ³¨æ„ getInitialProps æ˜¯é¡µé¢ç»„ä»¶çš„é™æ€æˆå‘˜å‡½æ•°ï¼Œå¯ä»¥ç”¨ä¸‹é¢çš„æ–¹æ³•å®šä¹‰ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Home.getInitialProps = async () = &#123;...&#125;;</span><br></pre></td></tr></table></figure>

<p>ä¹Ÿå¯ä»¥åœ¨ç»„ä»¶ç±»ä¸­åŠ ä¸Š static å…³é”®å­—å®šä¹‰ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">class Home extends React.Component &#123;</span><br><span class="line">  static async getInitialProps() &#123;</span><br><span class="line">     ...</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>é€šè¿‡ä¸Šé¢çš„ä»£ç ï¼Œæˆ‘ä¹ˆä¹Ÿå¯ä»¥æ³¨æ„åˆ°ï¼ŒgetInitialProps æ˜¯ä¸€ä¸ª async å‡½æ•°ï¼Œæ‰€ä»¥ï¼Œåœ¨ getInitialProps å‡½æ•°ä¸­å¯ä»¥ä½¿ç”¨ await å…³é”®å­—ï¼Œç”¨åŒæ­¥çš„æ–¹å¼ç¼–å†™å¼‚æ­¥é€»è¾‘ã€‚</p>
<p>æˆ‘ä»¬å¯ä»¥è¿™æ ·æ¥çœ‹å¾… getInitialPropsï¼Œå®ƒå°±æ˜¯ Next.js å¯¹ä»£è¡¨é¡µé¢çš„ React ç»„ä»¶ç”Ÿå‘½å‘¨æœŸçš„æ‰©å……ã€‚React ç»„ä»¶çš„ç”Ÿå‘½å‘¨æœŸå‡½æ•°ç¼ºä¹å¯¹å¼‚æ­¥æ“ä½œçš„æ”¯æŒï¼Œæ‰€ä»¥ Next.js å¹²è„†å®šä¹‰å‡ºä¸€ä¸ªæ–°çš„ç”Ÿå‘½å‘¨æœŸå‡½æ•° getInitialPropsï¼Œåœ¨è°ƒç”¨ React åŸç”Ÿçš„æ‰€æœ‰ç”Ÿå‘½å‘¨æœŸå‡½æ•°ä¹‹å‰ï¼ŒNext.js ä¼šè°ƒç”¨ getInitialProps æ¥è·å–æ•°æ®ï¼Œç„¶åæŠŠè·å¾—æ•°æ®ä½œä¸º props æ¥å¯åŠ¨ React ç»„ä»¶çš„åŸç”Ÿç”Ÿå‘½å‘¨æœŸè¿‡ç¨‹ã€‚</p>
<p><strong>è¿™ä¸ªç”Ÿå‘½å‘¨æœŸå‡½æ•°çš„æ‰©å……ååˆ†å·§å¦™ï¼Œå› ä¸ºï¼š</strong></p>
<ul>
<li>æ²¡æœ‰ä¾µå…¥ React åŸç”Ÿç”Ÿå‘½å‘¨æœŸå‡½æ•°ï¼Œä»¥å‰çš„ React ç»„ä»¶è¯¥æ€ä¹ˆå†™è¿˜æ˜¯æ€ä¹ˆå†™ï¼›</li>
<li>getInitialProps åªè´Ÿè´£è·å–æ•°æ®çš„è¿‡ç¨‹ï¼Œå¼€å‘è€…ä¸ç”¨æ“å¿ƒä»€ä¹ˆæ—¶å€™è°ƒç”¨ getInitialPropsï¼Œä¾ç„¶æ˜¯ React å“²å­¦çš„å£°æ˜å¼ç¼–ç¨‹æ–¹å¼ï¼›</li>
<li>getInitialProps æ˜¯ async å‡½æ•°ï¼Œå¯ä»¥åˆ©ç”¨ JavaScript è¯­è¨€çš„æ–°ç‰¹æ€§ï¼Œç”¨åŒæ­¥çš„æ–¹å¼å®ç°å¼‚æ­¥åŠŸèƒ½ã€‚</li>
</ul>
<p><strong>Next.js çš„â€œè„±æ°´â€å’Œâ€œæ³¨æ°´â€</strong></p>
<p>æˆ‘ä»¬è¯´è¿‡æœåŠ¡å™¨ç«¯æ¸²æŸ“çš„å…³é”®æ˜¯å¦‚ä½•â€œè„±æ°´â€å’Œâ€œæ³¨æ°´â€ï¼Œå¦‚æœä½ å¯¹ Next.js å¦‚ä½•å®ç°è¿™ä¸¤ä¸ªå…³é”®ç‚¹å¥½å¥‡ï¼ˆå®é™…ä¸Šä½ ç¡®å®åº”è¯¥æ„Ÿåˆ°å¥½å¥‡ï¼‰ï¼Œé‚£ä¹ˆåœ¨æµè§ˆå™¨ä¸­ä½¿ç”¨â€œæ˜¾ç¤ºç½‘é¡µæºä»£ç â€å°±å¯ä»¥è®©ä½ ä¸€ç›®äº†ç„¶ã€‚</p>
<p>åœ¨ç½‘é¡µçš„ HTML ä¸­ï¼Œå¯ä»¥çœ‹åˆ°ç±»ä¼¼ä¸‹é¢çš„å†…å®¹ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">&lt;script&gt;</span><br><span class="line">  __NEXT_DATA__ = &#123;</span><br><span class="line">    &quot;props&quot;:&#123;</span><br><span class="line">      &quot;pageProps&quot;: &#123;&quot;userName&quot;:&quot;Morgan&quot;&#125;&#125;,</span><br><span class="line">      &quot;page&quot;:&quot;/&quot;,&quot;pathname&quot;:&quot;/&quot;,&quot;query&quot;:&#123;&#125;,&quot;buildId&quot;:&quot;-&quot;,&quot;assetPrefix&quot;:&quot;&quot;,&quot;nextExport&quot;:false,&quot;err&quot;:null,&quot;chunks&quot;:[]&#125;</span><br><span class="line">&lt;/script&gt;</span><br></pre></td></tr></table></figure>

<p>Next.js åœ¨åšæœåŠ¡å™¨ç«¯æ¸²æŸ“çš„æ—¶å€™ï¼Œé¡µé¢å¯¹åº”çš„ React ç»„ä»¶çš„ getInitialProps å‡½æ•°è¢«è°ƒç”¨ï¼Œå¼‚æ­¥ç»“æœå°±æ˜¯â€œè„±æ°´â€æ•°æ®çš„é‡è¦éƒ¨åˆ†ï¼Œé™¤äº†ä¼ ç»™é¡µé¢ React ç»„ä»¶å®Œæˆæ¸²æŸ“ï¼Œè¿˜æ”¾åœ¨å†…åµŒ script çš„ <strong>NEXT_DATA</strong> ä¸­ï¼Œè¿™æ ·ï¼Œåœ¨æµè§ˆå™¨ç«¯æ¸²æŸ“çš„æ—¶å€™ï¼Œæ˜¯ä¸ä¼šå»è°ƒç”¨ getInitialProps çš„ï¼Œç›´æ¥é€šè¿‡ <strong>NEXT_DATA</strong> ä¸­çš„â€œè„±æ°´â€æ•°æ®æ¥å¯åŠ¨é¡µé¢ React ç»„ä»¶çš„æ¸²æŸ“ã€‚</p>
<p>è¿™æ ·ä¸€æ¥ï¼Œå¦‚æœ getInitialProps ä¸­æœ‰è°ƒç”¨ API çš„å¼‚æ­¥æ“ä½œï¼Œåªåœ¨æœåŠ¡å™¨ç«¯åšä¸€æ¬¡ï¼Œæµè§ˆå™¨ç«¯å°±ä¸ç”¨åšäº†ã€‚</p>
<p>é‚£ä¹ˆï¼ŒgetInitialProps ä»€ä¹ˆæ—¶å€™ä¼šåœ¨æµè§ˆå™¨ç«¯è°ƒç”¨å‘¢ï¼Ÿ</p>
<p>å½“åœ¨å•é¡µåº”ç”¨ä¸­åšé¡µé¢åˆ‡æ¢çš„æ—¶å€™ï¼Œæ¯”å¦‚ä» Home é¡µåˆ‡æ¢åˆ° Product é¡µï¼Œè¿™æ—¶å€™å®Œå…¨å’ŒæœåŠ¡å™¨ç«¯æ²¡å…³ç³»ï¼Œåªèƒ½é æµè§ˆå™¨ç«¯è‡ªå·±äº†ï¼ŒProducté¡µé¢çš„ getInitialProps å‡½æ•°å°±ä¼šåœ¨æµè§ˆå™¨ç«¯è¢«è°ƒç”¨ï¼Œå¾—åˆ°çš„æ•°æ®ç”¨æ¥å¼€å¯é¡µé¢çš„ React åŸç”Ÿç”Ÿå‘½å‘¨æœŸè¿‡ç¨‹ã€‚</p>
<p>å…³é”®ç‚¹æ˜¯ï¼Œæµè§ˆå™¨å¯èƒ½ä¼šç›´æ¥è®¿é—® &#x2F;home æˆ–è€… &#x2F;productï¼Œä¹Ÿå¯èƒ½é€šè¿‡ç½‘é¡µåˆ‡æ¢è®¿é—®è¿™ä¸¤ä¸ªé¡µé¢ï¼Œä¹Ÿå°±æ˜¯è¯´ Home æˆ–è€… Product éƒ½å¯èƒ½è¢«æœåŠ¡å™¨ç«¯æ¸²æŸ“ï¼Œä¹Ÿå¯èƒ½å®Œå…¨åªæœ‰æµè§ˆå™¨ç«¯æ¸²æŸ“ï¼Œä¸è¿‡ï¼Œè¿™å¯¹åº”ç”¨å¼€å‘è€…æ¥è¯´æ— æ‰€è°“ï¼Œåº”ç”¨å¼€å‘è€…åªè¦å†™å¥½ getInitialPropsï¼Œè‡³äºè°ƒç”¨ getInitialProps çš„æ—¶æœºï¼Œäº¤ç»™ Next.js å¤„ç†å°±å¥½äº†ã€‚</p>
<p>ä½ å¯ä»¥å‘æ˜è‡ªå·±çš„æœåŠ¡å™¨ç«¯æ¡†æ¶ï¼Œä½†å¾ˆå¯èƒ½æœ€åä½ å‘ç°ï¼Œå¦‚æœè¦åšå¾—é€šç”¨æ€§å¥½ï¼Œæœ€åéƒ½ä¼šåšåˆ°å’Œ Next.js ä¸€æ ·çš„æ¨¡å¼ä¸Šæ¥ã€‚</p>
<p>å€¼å¾—ä¸€æçš„æ˜¯ï¼ŒgetInitialProps è¿”å›çš„åº”è¯¥æ˜¯â€œçº¯æ•°æ®â€ï¼Œä¹Ÿå°±æ˜¯ä¸è¦è¿”å›ä¸€ä¸ªå®šåˆ¶ç±»çš„å®ä¾‹ã€‚æ¯”å¦‚ï¼Œæœ‰ä¸€ä¸ªç±» Foo æœ‰ä¸€ä¸ªæˆå‘˜å‡½æ•° barï¼Œä¸è¦åœ¨ getInitialProps è¿”å›ä¸€ä¸ª Foo å®ä¾‹ã€‚ä¸ç„¶ï¼Œç»è¿‡â€œè„±æ°´â€å’Œâ€œæ³¨æ°´â€è¿‡ç¨‹ï¼Œç½‘é¡µç»„ä»¶è·å¾—çš„é‚£ä¸ªâ€œFoo å®ä¾‹â€ä¸å†æ˜¯ä½ æƒ³çš„é‚£ä¸ª Foo å®ä¾‹äº†ï¼Œå®ƒå˜æˆäº†ä¸€ä¸ªçº¯ç²¹çš„æ•°æ®ï¼Œä¸ä¼šåŒ…å«æˆå‘˜å‡½æ•° barçš„ã€‚</p>
<h2 id="å…«ã€React-çš„æœªæ¥ï¼ˆ1ï¼‰ï¼š-æ‹¥æŠ±å¼‚æ­¥æ¸²æŸ“"><a href="#å…«ã€React-çš„æœªæ¥ï¼ˆ1ï¼‰ï¼š-æ‹¥æŠ±å¼‚æ­¥æ¸²æŸ“" class="headerlink" title="å…«ã€React çš„æœªæ¥ï¼ˆ1ï¼‰ï¼š æ‹¥æŠ±å¼‚æ­¥æ¸²æŸ“"></a>å…«ã€React çš„æœªæ¥ï¼ˆ1ï¼‰ï¼š æ‹¥æŠ±å¼‚æ­¥æ¸²æŸ“</h2><p><strong>åŒæ­¥æ¸²æŸ“çš„é—®é¢˜</strong></p>
<p>é•¿æœŸä»¥æ¥ï¼ŒReact ä¸€ç›´ç”¨çš„æ˜¯åŒæ­¥æ¸²æŸ“ï¼Œè¿™æ ·å¯¹ React å®ç°éå¸¸ç›´è§‚æ–¹ä¾¿ï¼Œä½†æ˜¯ä¼šå¸¦æ¥æ€§èƒ½é—®é¢˜ã€‚</p>
<p>å‡è®¾æœ‰ä¸€ä¸ªè¶…å¤§çš„ React ç»„ä»¶æ ‘ç»“æ„ï¼Œæœ‰ 1000 ä¸ªç»„ä»¶ï¼Œæ¯ä¸ªç»„ä»¶å¹³å‡ä½¿ç”¨ 1 æ¯«ç§’ï¼Œé‚£ä¹ˆï¼Œè¦åšä¸€æ¬¡å®Œæ•´çš„æ¸²æŸ“å°±è¦èŠ±è´¹ 1000 æ¯«ç§’ä¹Ÿå°±æ˜¯ 1 ç§’é’Ÿï¼Œç„¶è€Œ JavaScript è¿è¡Œç¯å¢ƒæ˜¯å•çº¿ç¨‹çš„ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼ŒReact ç”¨åŒæ­¥æ¸²æŸ“æ–¹å¼ï¼Œæ¸²æŸ“æœ€æ ¹éƒ¨ç»„ä»¶çš„æ—¶å€™ï¼Œä¼šåŒæ­¥å¼•å‘æ¸²æŸ“å­ç»„ä»¶ï¼Œå†åŒæ­¥æ¸²æŸ“å­ç»„ä»¶çš„å­ç»„ä»¶â€¦â€¦æœ€åå®Œæˆæ•´ä¸ªç»„ä»¶æ ‘ã€‚åœ¨è¿™ 1 ç§’é’Ÿå†…ï¼ŒåŒæ­¥æ¸²æŸ“éœ¸å  JavaScript å”¯ä¸€çš„çº¿ç¨‹ï¼Œå…¶ä»–çš„æ“ä½œä»€ä¹ˆéƒ½åšä¸äº†ï¼Œåœ¨è¿™ 1 ç§’é’Ÿå†…ï¼Œå¦‚æœç”¨æˆ·è¦ç‚¹å‡»ä»€ä¹ˆæŒ‰é’®ï¼Œæˆ–è€…åœ¨æŸä¸ªè¾“å…¥æ¡†é‡Œé¢æŒ‰é”®ï¼Œéƒ½ä¸ä¼šçœ‹åˆ°ç«‹å³çš„ç•Œé¢ååº”ï¼Œè¿™ä¹Ÿå°±æ˜¯ä¿—è¯è¯´çš„â€œå¡é¡¿â€ã€‚</p>
<p>åœ¨åŒæ­¥æ¸²æŸ“ä¸‹ï¼Œè¦è§£å†³â€œå¡é¡¿â€çš„é—®é¢˜ï¼Œåªèƒ½æ˜¯å°½é‡ç¼©å°ç»„ä»¶æ ‘çš„å¤§å°ï¼Œä»¥æ­¤ç¼©çŸ­æ¸²æŸ“æ—¶é—´ï¼Œä½†æ˜¯ï¼Œåº”ç”¨çš„è§„æ¨¡æ€»æ˜¯åœ¨å¢å¤§çš„ï¼Œä¸æ˜¯è¯´ç¼©å°å°±èƒ½ç¼©å°çš„ï¼Œè™½ç„¶æˆ‘ä»¬åˆ©ç”¨å®šä¹‰ shouldComponentUpdate çš„æ–¹æ³•å¯ä»¥å‡å°‘ä¸å¿…è¦çš„æ¸²æŸ“ï¼Œä½†æ˜¯è¿™ä¹Ÿæ— æ³•ä»æ ¹æœ¬ä¸Šè§£å†³å¤§é‡åŒæ­¥æ¸²æŸ“å¸¦æ¥çš„â€œå¡é¡¿â€é—®é¢˜ã€‚</p>
<p><strong>å¼‚æ­¥æ¸²æŸ“ï¼šä¸¤é˜¶æ®µæ¸²æŸ“</strong></p>
<p>React Fiber å¼•å…¥äº†å¼‚æ­¥æ¸²æŸ“ï¼Œæœ‰äº†å¼‚æ­¥æ¸²æŸ“ä¹‹åï¼ŒReact ç»„ä»¶çš„æ¸²æŸ“è¿‡ç¨‹æ˜¯åˆ†æ—¶é—´ç‰‡çš„ï¼Œä¸æ˜¯ä¸€å£æ°”ä»å¤´åˆ°å°¾æŠŠå­ç»„ä»¶å…¨éƒ¨æ¸²æŸ“å®Œï¼Œè€Œæ˜¯æ¯ä¸ªæ—¶é—´ç‰‡æ¸²æŸ“ä¸€ç‚¹ï¼Œç„¶åæ¯ä¸ªæ—¶é—´ç‰‡çš„é—´éš”éƒ½å¯å»çœ‹çœ‹æœ‰æ²¡æœ‰æ›´ç´§æ€¥çš„ä»»åŠ¡ï¼ˆæ¯”å¦‚ç”¨æˆ·æŒ‰é”®ï¼‰ï¼Œå¦‚æœæœ‰ï¼Œå°±å»å¤„ç†ç´§æ€¥ä»»åŠ¡ï¼Œå¦‚æœæ²¡æœ‰é‚£å°±ç»§ç»­ç…§å¸¸æ¸²æŸ“ã€‚</p>
<p>æ ¹æ® React Fiber çš„è®¾è®¡ï¼Œä¸€ä¸ªç»„ä»¶çš„æ¸²æŸ“è¢«åˆ†ä¸ºä¸¤ä¸ªé˜¶æ®µï¼šç¬¬ä¸€ä¸ªé˜¶æ®µï¼ˆä¹Ÿå«åš render é˜¶æ®µï¼‰æ˜¯å¯ä»¥è¢« React æ‰“æ–­çš„ï¼Œä¸€æ—¦è¢«æ‰“æ–­ï¼Œè¿™é˜¶æ®µæ‰€åšçš„æ‰€æœ‰äº‹æƒ…éƒ½è¢«åºŸå¼ƒï¼Œå½“ React å¤„ç†å®Œç´§æ€¥çš„äº‹æƒ…å›æ¥ï¼Œä¾ç„¶ä¼šé‡æ–°æ¸²æŸ“è¿™ä¸ªç»„ä»¶ï¼Œè¿™æ—¶å€™ç¬¬ä¸€é˜¶æ®µçš„å·¥ä½œä¼šé‡åšä¸€éï¼›ç¬¬äºŒä¸ªé˜¶æ®µå«åš commit é˜¶æ®µï¼Œä¸€æ—¦å¼€å§‹å°±ä¸èƒ½ä¸­æ–­ï¼Œä¹Ÿå°±æ˜¯è¯´ç¬¬äºŒä¸ªé˜¶æ®µçš„å·¥ä½œä¼šç¨³ç¨³å½“å½“åœ°åšåˆ°è¿™ä¸ªç»„ä»¶çš„æ¸²æŸ“ç»“æŸã€‚</p>
<p>ä¸¤ä¸ªé˜¶æ®µçš„åˆ†ç•Œç‚¹ï¼Œå°±æ˜¯ render å‡½æ•°ã€‚render å‡½æ•°ä¹‹å‰çš„æ‰€æœ‰ç”Ÿå‘½å‘¨æœŸå‡½æ•°ï¼ˆåŒ…æ‹¬ render)éƒ½å±äºç¬¬ä¸€é˜¶æ®µï¼Œä¹‹åçš„éƒ½å±äºç¬¬äºŒé˜¶æ®µã€‚</p>
<p>å¼€å¯å¼‚æ­¥æ¸²æŸ“ï¼Œè™½ç„¶æˆ‘ä»¬è·å¾—äº†æ›´å¥½çš„æ„ŸçŸ¥æ€§èƒ½ï¼Œä½†æ˜¯è€ƒè™‘åˆ°ç¬¬ä¸€é˜¶æ®µçš„çš„ç”Ÿå‘½å‘¨æœŸå‡½æ•°å¯èƒ½ä¼šè¢«é‡å¤è°ƒç”¨ï¼Œä¸å¾—ä¸å¯¹å†å²ä»£ç åšä¸€äº›è°ƒæ•´ã€‚</p>
<blockquote>
<p>åœ¨ React v16.3 ä¹‹å‰ï¼Œrender ä¹‹å‰çš„ç”Ÿå‘½å‘¨æœŸå‡½æ•°ï¼ˆä¹Ÿå°±æ˜¯ç¬¬ä¸€é˜¶æ®µç”Ÿå‘½å‘¨æœŸå‡½æ•°ï¼‰åŒ…æ‹¬è¿™äº›ï¼š</p>
</blockquote>
<ul>
<li><code>componentWillReceiveProps</code></li>
<li><code>shouldComponentUpdate</code></li>
<li><code>componentWillUpdate</code></li>
<li><code>componentWillMount</code></li>
<li><code>render</code></li>
</ul>
<blockquote>
<p>ä¸‹å›¾æ˜¯ React v16.3 ä¹‹å‰çš„å®Œæ•´çš„ç”Ÿå‘½å‘¨æœŸå‡½æ•°å›¾ï¼š</p>
</blockquote>
<p><img src="https://user-gold-cdn.xitu.io/2018/11/14/1670f0f2d4d06575" alt="img"></p>
<p>React å®˜æ–¹å‘Šè¯«å¼€å‘è€…ï¼Œè™½ç„¶ç›®å‰æ‰€æœ‰çš„ä»£ç éƒ½å¯ä»¥ç…§å¸¸ä½¿ç”¨ï¼Œä½†æ˜¯æœªæ¥ç‰ˆæœ¬ä¸­ä¼šåºŸå¼ƒæ‰ï¼Œä¸ºäº†å°†æ¥ï¼Œä½¿ç”¨ React çš„ç¨‹åºåº”è¯¥å¿«ç‚¹å»æ‰è¿™äº›åœ¨ç¬¬ä¸€é˜¶æ®µç”Ÿå‘½å‡½æ•°ä¸­æœ‰å‰¯ä½œç”¨çš„åŠŸèƒ½ã€‚ä¸å¾—ä¸è¯´ React çœŸçš„å¾ˆå¤Ÿæ„æ€ï¼Œæå‰è¿™ä¹ˆä¹…å‘Šè¯‰å¤§å®¶è¿™ä¸ªäº‹æƒ…ï¼Œè®©å¤§å®¶æœ‰è¶³å¤Ÿçš„æ—¶é—´å»ä¿®æ”¹è‡ªå·±çš„ä»£ç ã€‚</p>
<p>ä¸€ä¸ªå…¸å‹çš„é”™è¯¯ç”¨ä¾‹ï¼Œä¹Ÿæ˜¯æˆ‘è¢«é—®åˆ°åšå¤šçš„é—®é¢˜ä¹‹ä¸€ï¼šä¸ºä»€ä¹ˆä¸åœ¨ componentWillMount é‡Œå»åšAJAXï¼ŸcomponentWillMount å¯æ˜¯æ¯” componentDidMount æ›´æ—©è°ƒç”¨å•Šï¼Œæ›´æ—©è°ƒç”¨æ„å‘³ç€æ›´æ—©è¿”å›ç»“æœï¼Œé‚£æ ·æ€§èƒ½ä¸æ˜¯æ›´é«˜å—ï¼Ÿ</p>
<p>é¦–å…ˆï¼Œä¸€ä¸ªç»„ä»¶çš„ componentWillMount æ¯” componentDidMount ä¹Ÿæ—©è°ƒç”¨ä¸äº†å‡ å¾®ç§’ï¼Œæ€§èƒ½æ²¡å•¥æé«˜ï¼›è€Œä¸”ï¼Œç­‰åˆ°å¼‚æ­¥æ¸²æŸ“å¼€å¯çš„æ—¶å€™ï¼ŒcomponentWillMount å°±å¯èƒ½è¢«ä¸­é€”æ‰“æ–­ï¼Œä¸­æ–­ä¹‹åæ¸²æŸ“åˆè¦é‡åšä¸€éï¼Œæƒ³ä¸€æƒ³ï¼Œåœ¨ componentWillMount ä¸­åš AJAX è°ƒç”¨ï¼Œä»£ç é‡Œçœ‹åˆ°åªæœ‰è°ƒç”¨ä¸€æ¬¡ï¼Œä½†æ˜¯å®é™…ä¸Šå¯èƒ½è°ƒç”¨ N å¤šæ¬¡ï¼Œè¿™æ˜æ˜¾ä¸åˆé€‚ã€‚ç›¸åï¼Œè‹¥æŠŠ AJAX æ”¾åœ¨ componentDidMountï¼Œå› ä¸º componentDidMount åœ¨ç¬¬äºŒé˜¶æ®µï¼Œæ‰€ä»¥ç»å¯¹ä¸ä¼šå¤šæ¬¡é‡å¤è°ƒç”¨ï¼Œè¿™æ‰æ˜¯ AJAX åˆé€‚çš„ä½ç½®ï¼ˆå½“ç„¶ï¼ŒReact æœªæ¥æœ‰æ›´å¥½çš„åŠæ³•ï¼Œåœ¨ä¸‹ä¸€å°èŠ‚ Suspense ä¸­å¯ä»¥è®²åˆ°ï¼‰ã€‚</p>
<p><strong>getDerivedStateFromProps</strong></p>
<blockquote>
<p>åˆ°äº† React v16.3ï¼ŒReact å¹²è„†å¼•å…¥äº†ä¸€ä¸ªæ–°çš„ç”Ÿå‘½å‘¨æœŸå‡½æ•° getDerivedStateFromPropsï¼Œè¿™ä¸ªç”Ÿå‘½å‘¨æœŸå‡½æ•°æ˜¯ä¸€ä¸ª static å‡½æ•°ï¼Œåœ¨é‡Œé¢æ ¹æœ¬ä¸èƒ½é€šè¿‡ this è®¿é—®åˆ°å½“å‰ç»„ä»¶ï¼Œè¾“å…¥åªèƒ½é€šè¿‡å‚æ•°ï¼Œå¯¹ç»„ä»¶æ¸²æŸ“çš„å½±å“åªèƒ½é€šè¿‡è¿”å›å€¼ã€‚æ²¡é”™ï¼ŒgetDerivedStateFromProps åº”è¯¥æ˜¯ä¸€ä¸ªçº¯å‡½æ•°ï¼ŒReact å°±æ˜¯é€šè¿‡è¦æ±‚è¿™ç§çº¯å‡½æ•°ï¼Œå¼ºåˆ¶å¼€å‘è€…ä»¬å¿…é¡»é€‚åº”å¼‚æ­¥æ¸²æŸ“ã€‚</p>
</blockquote>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">static getDerivedStateFromProps(nextProps, prevState) &#123;</span><br><span class="line">  //æ ¹æ®nextPropså’ŒprevStateè®¡ç®—å‡ºé¢„æœŸçš„çŠ¶æ€æ”¹å˜ï¼Œè¿”å›ç»“æœä¼šè¢«é€ç»™setState</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>åˆ°äº† React v16.3ï¼ŒReact ç”Ÿå‘½å‘¨æœŸå‡½æ•°å…¨å›¾å¦‚ä¸‹:</p>
<p><img src="https://user-gold-cdn.xitu.io/2018/11/14/1670f0fc08e10440" alt="img"></p>
<p>æ³¨æ„ï¼Œä¸Šå›¾ä¸­å¹¶åŒ…å«å…¨éƒ¨Reactç”Ÿå‘½å‘¨æœŸå‡½æ•°ï¼Œåœ¨React v16å‘å¸ƒæ—¶ï¼Œè¿˜å¢åŠ äº†ä¸€ä¸ªcomponentDidCatchï¼Œå½“å¼‚å¸¸å‘ç”Ÿæ—¶ï¼Œä¸€ä¸ªå¯ä»¥æ•æ‰åˆ°å¼‚å¸¸çš„componentDidCatchå°±æ’ä¸Šç”¨åœºäº†ã€‚ä¸è¿‡ï¼Œå¾ˆå¿«Reactè§‰ç€è¿™è¿˜ä¸å¤Ÿï¼Œåœ¨v16.6.0åˆæ¨å‡ºäº†ä¸€ä¸ªæ–°çš„æ•æ‰å¼‚å¸¸çš„ç”Ÿå‘½å‘¨æœŸå‡½æ•°getDerivedStateFromErrorã€‚</p>
<p>å¦‚æœå¼‚å¸¸å‘ç”Ÿåœ¨ç¬¬ä¸€é˜¶æ®µï¼ˆrenderé˜¶æ®µï¼‰ï¼ŒReactå°±ä¼šè°ƒç”¨getDerivedStateFromErrorï¼Œå¦‚æœå¼‚å¸¸å‘ç”Ÿåœ¨ç¬¬äºŒé˜¶æ®µï¼ˆcommité˜¶æ®µï¼‰ï¼ŒReactä¼šè°ƒç”¨componentDidCatchã€‚è¿™ä¸ªåŒºåˆ«ä¹Ÿä½“ç°å‡ºä¸¤ä¸ªé˜¶æ®µçš„åŒºåˆ†å¯¹å¾…ã€‚</p>
<p><strong>é€‚åº”å¼‚æ­¥æ¸²æŸ“çš„ç»„ä»¶åŸåˆ™</strong></p>
<blockquote>
<p>æ˜ç™½äº†å¼‚æ­¥æ¸²æŸ“çš„æ¥é¾™å»è„‰ä¹‹åï¼Œå¼€å‘è€…å°±åº”è¯¥æ˜ç™½ï¼Œç°åœ¨å†™ä»£ç å¿…é¡»è¦ä¸ºæœªæ¥çš„æŸä¸€æ¬¡ React ç‰ˆæœ¬å‡çº§åšå¥½å‡†å¤‡ï¼Œå½“ React å¼€å¯å¼‚æ­¥æ¸²æŸ“çš„æ—¶å€™ï¼Œä½ çš„ä»£ç åº”è¯¥åšåˆ°åœ¨ render ä¹‹å‰æœ€å¤šåªèƒ½è¿™äº›å‡½æ•°è¢«è°ƒç”¨ï¼š</p>
</blockquote>
<ul>
<li>æ„é€ å‡½æ•°</li>
<li><code>getDerivedStateFromProps</code></li>
<li><code>shouldComponentUpdate</code></li>
</ul>
<p>å¹¸å­˜çš„è¿™äº›ç¬¬ä¸€é˜¶æ®µå‡½æ•°ï¼Œé™¤äº†æ„é€ å‡½æ•°ï¼Œå…¶ä½™ä¸¤ä¸ªå…¨éƒ½å¿…é¡»æ˜¯çº¯å‡½æ•°ï¼Œä¹Ÿå°±æ˜¯ä¸åº”è¯¥åšä»»ä½•æœ‰å‰¯ä½œç”¨çš„æ“ä½œã€‚</p>
<p>å®é™…ä¸Šï¼Œå¦‚æœä¹‹å‰ä½ çš„ç”¨æ³•è§„èŒƒï¼Œé™¤äº† shouldComponentUpdate ä¸æ€ä¹ˆä½¿ç”¨ç¬¬ä¸€é˜¶æ®µç”Ÿå‘½å‘¨æœŸå‡½æ•°ï¼Œä½ è¿˜ä¼šå‘ç°ä¸æ€ä¹ˆéœ€è¦æ”¹åŠ¨ä»£ç ï¼Œæ¯”å¦‚ componentWillMount ä¸­çš„ä»£ç ç§»åˆ°æ„é€ å‡½æ•°ä¸­å°±å¯ä»¥äº†ã€‚ä½†æ˜¯å¦‚æœç”¨æ³•é”™ä¹±ï¼Œæ¯”å¦‚æ»¥ç”¨componentWillReceivePropsï¼Œé‚£å°±ä¸å¾—ä¸å…·ä½“æƒ…å†µå…·ä½“åˆ†æï¼Œä»è€Œå†³å®šè¿™äº›ä»£ç ç§»åˆ°ä»€ä¹ˆä½ç½®ã€‚</p>
<p>å¼€å‘è€…ä¸­ä¸€ä¸ªæ™®éçš„è¯¯åŒºï¼Œå°±æ˜¯æ€»æƒ³æŠŠä»»åŠ¡å¾€å‰æï¼Œæåˆ°é å‰çš„ç”Ÿå‘½å‘¨æœŸå‡½æ•°å»ï¼Œå°±åƒæˆ‘å‰é¢è¯´è¿‡çš„åœ¨ componentWillMount ä¸­åš AJAXã€‚æ­£ç¡®çš„åšæ³•æ˜¯æ ¹æ®å„å‡½æ•°çš„è¯­ä¹‰æ¥æ”¾ç½®ä»£ç ï¼Œå¹¶ä¸æ˜¯è¶Šå¾€å‰è¶Šå¥½ã€‚</p>
<h2 id="ä¹ã€React-çš„æœªæ¥ï¼ˆ2ï¼‰ï¼šSuspense-å¸¦æ¥çš„å¼‚æ­¥æ“ä½œé©å‘½"><a href="#ä¹ã€React-çš„æœªæ¥ï¼ˆ2ï¼‰ï¼šSuspense-å¸¦æ¥çš„å¼‚æ­¥æ“ä½œé©å‘½" class="headerlink" title="ä¹ã€React çš„æœªæ¥ï¼ˆ2ï¼‰ï¼šSuspense å¸¦æ¥çš„å¼‚æ­¥æ“ä½œé©å‘½"></a>ä¹ã€React çš„æœªæ¥ï¼ˆ2ï¼‰ï¼šSuspense å¸¦æ¥çš„å¼‚æ­¥æ“ä½œé©å‘½</h2><p>ä¸Šä¸€èŠ‚æˆ‘ä»¬ä»‹ç»äº† Fiber æ¶æ„ä¸‹çš„å¼‚æ­¥æ¸²æŸ“æœºåˆ¶ï¼Œæˆ‘ä»¬çŸ¥é“ç”Ÿå‘½å‘¨æœŸå‡½æ•°çš„ä¿®æ”¹æ˜¯åŠ¿åœ¨å¿…è¡Œï¼Œé‚£ä¹ˆï¼Œæ¥ä¸‹æ¥å‘¢ï¼Ÿæ¥ä¸‹æ¥ React ä¼šæœ‰ä»€ä¹ˆâ€œå¤§äº‹â€å‘¢ï¼Ÿ</p>
<p>è¿™ä¸ªç­”æ¡ˆä¼°è®¡è¿ React çš„æ ¸å¿ƒå¼€å‘è€…ä¹Ÿåœ¨è®¨è®ºä¸­ï¼Œä¸è¿‡ä»å„ç§æ¸ é“ä¿¡æ¯çœ‹æ¥ï¼Œè‡³å°‘æœ‰ä¸¤ä»¶â€œå¤§äº‹â€åœ¨ä¼šåœ¨çœ‹å¾—è§çš„æœªæ¥å‘ç”Ÿï¼Œé‚£å°±æ˜¯ï¼š</p>
<ul>
<li><code>Suspense</code></li>
<li><code>Hooks</code></li>
</ul>
<p>å½“ç„¶ React å¢åŠ çš„åŠŸèƒ½è‚¯å®šè¿œä¸æ­¢è¿™ç‚¹ï¼Œå°†è¿™ä¸¤ä»¶â€œå¤§äº‹â€åœ¨è¿™é‡Œæå‡ºæ¥ï¼Œæ˜¯å› ä¸ºå®ƒä»¬å¯¹æˆ‘ä»¬ä½¿ç”¨å¼€å‘è€…çš„å½±å“æœ€å¤§ï¼Œä¼šå½»åº•æ”¹å˜æˆ‘ä»¬çš„ä»£ç æ¨¡å¼ã€‚</p>
<p>åœ¨å†™è¿™æœ¬å°å†Œæ—¶ï¼ŒReact æ­£å¼ç‰ˆæ˜¯ v16.6.0ï¼Œè¿˜åªæ˜¯ alpha é˜¶æ®µï¼Œä¹Ÿè®¸å½“ä½ è¯»åˆ°è¿™æœ¬å°å†Œæ—¶ï¼ŒReact å·²ç»èµ°å¾—æ›´è¿œï¼Œä½†æ˜¯ä½ ä¾ç„¶åº”è¯¥é˜…è¯»è¿™ä¸€å°èŠ‚ï¼Œå› ä¸ºä½œä¸ºå¼€å‘è€…ä½ åº”è¯¥è¦æ˜ç™½æŠ€æœ¯æ¼”åŒ–çš„æ¥é¾™å»è„‰ã€‚</p>
<p>æˆ‘ä»¬é¦–å…ˆæ¥äº†è§£ Suspenseã€‚Suspense åº”ç”¨çš„åœºåˆå°±æ˜¯å¼‚æ­¥æ•°æ®å¤„ç†ï¼Œæœ€å¸¸è§çš„ä¾‹å­ï¼Œå°±æ˜¯é€šè¿‡ AJAX ä»æœåŠ¡å™¨è·å–æ•°æ®ï¼Œæ¯ä¸€ä¸ª React å¼€å‘è€…éƒ½æ›¾ä¸ºè¿™ä¸ªé—®é¢˜çº ç»“ã€‚</p>
<p>å¦‚æœç”¨ä¸€å¥è¯æ¦‚æ‹¬ Suspense çš„åŠŸç”¨ï¼Œé‚£å°±æ˜¯ï¼šç”¨åŒæ­¥çš„ä»£ç æ¥å®ç°å¼‚æ­¥æ“ä½œã€‚</p>
<p>è€Œè¦ç†è§£ Suspenseï¼Œæˆ‘ä»¬å…ˆæ¥ä½“ä¼šä¸€ä¸‹ React ä¸­åš AJAX ä¹‹ç±»å¼‚æ­¥æ“ä½œçš„ç—›è‹¦</p>
<p><strong>React åŒæ­¥æ“ä½œçš„ä¸è¶³</strong></p>
<p>ä¸Šä¸€èŠ‚ä»‹ç»è¿‡ï¼ŒReact æœ€åˆçš„è®¾è®¡ï¼Œæ•´ä¸ªæ¸²æŸ“è¿‡ç¨‹éƒ½æ˜¯åŒæ­¥çš„ã€‚åŒæ­¥çš„æ„æ€æ˜¯ï¼Œå½“ä¸€ä¸ªç»„ä»¶å¼€å§‹æ¸²æŸ“ä¹‹åï¼Œå°±å¿…é¡»ä¸€å£æ°”æ¸²æŸ“å®Œï¼Œä¸èƒ½ä¸­æ–­ï¼Œå¯¹äºç‰¹åˆ«åºå¤§çš„ç»„ä»¶æ ‘ï¼Œè¿™ä¸ªæ¸²æŸ“è¿‡ç¨‹ä¼šå¾ˆè€—æ—¶ï¼Œè€Œä¸”ï¼Œè¿™ç§åŒæ­¥å¤„ç†ï¼Œä¹Ÿä¼šå¯¼è‡´æˆ‘ä»¬çš„ä»£ç æ¯”è¾ƒéº»çƒ¦ã€‚</p>
<p>å½“æˆ‘ä»¬å¼€å§‹æ¸²æŸ“æŸä¸ªç»„ä»¶çš„æ—¶å€™ï¼Œå‡è®¾è¿™ä¸ªç»„ä»¶éœ€è¦ä»æœåŠ¡å™¨è·å–æ•°æ®ï¼Œé‚£ä¹ˆï¼Œè¦ä¹ˆç”±è¿™ä¸ªç»„ä»¶çš„çˆ¶ç»„ä»¶æƒ³åŠæ³•æ‹¿åˆ°æœåŠ¡å™¨çš„æ•°æ®ï¼Œç„¶åé€šè¿‡ props ä¼ é€’è¿›æ¥ï¼Œè¦ä¹ˆå°±è¦é è¿™ä¸ªç»„ä»¶è‡ªåŠ›æ›´ç”Ÿæ¥è·å–æ•°æ®ï¼Œä½†æ˜¯ï¼Œæ²¡æœ‰åŠæ³•é€šè¿‡ä¸€æ¬¡æ¸²æŸ“å®Œæˆè¿™ä¸ªè¿‡ç¨‹ï¼Œå› ä¸ºæ¸²æŸ“è¿‡ç¨‹æ˜¯åŒæ­¥çš„ï¼Œä¸å¯èƒ½è®© React ç­‰å¾…è¿™ä¸ªç»„ä»¶è°ƒç”¨ AJAX è·å–æ•°æ®ä¹‹åå†ç»§ç»­æ¸²æŸ“ã€‚</p>
<blockquote>
<p>å¸¸ç”¨çš„åšæ³•ï¼Œéœ€è¦ç»„ä»¶çš„ render å’Œ componentDidMount å‡½æ•°é…åˆã€‚</p>
</blockquote>
<ul>
<li>åœ¨ componentDidMount ä¸­ä½¿ç”¨ AJAXï¼Œåœ¨ AJAX æˆåŠŸä¹‹åï¼Œé€šè¿‡ setState ä¿®æ”¹è‡ªèº«çŠ¶æ€ï¼Œè¿™ä¼šå¼•å‘ä¸€æ¬¡æ–°çš„æ¸²æŸ“è¿‡ç¨‹ã€‚</li>
<li>åœ¨ render å‡½æ•°ä¸­ï¼Œå¦‚æœ state ä¸­æ²¡æœ‰éœ€è¦çš„æ•°æ®ï¼Œå°±ä»€ä¹ˆéƒ½ä¸æ¸²æŸ“æˆ–è€…æ¸²æŸ“ä¸€ä¸ªâ€œæ­£åœ¨è£…è½½â€ä¹‹ç±»æç¤ºï¼›å¦‚æœ state ä¸­å·²ç»æœ‰éœ€è¦çš„æ•°æ®ï¼Œå°±å¯ä»¥æ­£å¸¸æ¸²æŸ“äº†ï¼Œä½†è¿™ä¹Ÿå¿…å®šæ˜¯åœ¨ componentDidMount ä¿®æ”¹äº† state ä¹‹åï¼Œä¹Ÿå°±æ˜¯åªæœ‰åœ¨ç¬¬äºŒæ¬¡æ¸²æŸ“è¿‡ç¨‹ä¸­æ‰å¯ä»¥ã€‚</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">class Foo extends React.Component &#123;</span><br><span class="line">  state = &#123;</span><br><span class="line">     data: null</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  render() &#123;</span><br><span class="line">     if (!this.state.data) &#123;</span><br><span class="line">        return null;</span><br><span class="line">     &#125; else &#123;</span><br><span class="line">        return &lt;div&gt;this.state.data&lt;/div&gt;;</span><br><span class="line">     &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  </span><br><span class="line">  componentDidMount() &#123;</span><br><span class="line">     callAPI().then(result =&gt; &#123;</span><br><span class="line">       this.setState(&#123;data: result&#125;);</span><br><span class="line">     &#125;);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>è¿™ç§æ–¹å¼è™½ç„¶å¯è¡Œï¼Œæˆ‘ä»¬ä¹Ÿç…§è¿™ç§å¥—è·¯å†™è¿‡ä¸å°‘ä»£ç ï¼Œä½†å®ƒçš„ç¼ºç‚¹ä¹Ÿæ˜¯å¾ˆæ˜æ˜¾çš„ã€‚</p>
<p>ç»„ä»¶å¿…é¡»è¦æœ‰è‡ªå·±çš„ state å’Œ componentDidMount å‡½æ•°å®ç°ï¼Œä¹Ÿå°±ä¸å¯èƒ½åšæˆçº¯å‡½æ•°å½¢å¼çš„ç»„ä»¶ã€‚<br>éœ€è¦ä¸¤æ¬¡æ¸²æŸ“è¿‡ç¨‹ï¼Œç¬¬ä¸€æ¬¡æ˜¯ mount å¼•å‘çš„æ¸²æŸ“ï¼Œç”± componentDidMount è§¦å‘ AJAX ç„¶åä¿®æ”¹ stateï¼Œç„¶åç¬¬äºŒæ¬¡æ¸²æŸ“æ‰çœŸçš„æ¸²æŸ“å‡ºå†…å®¹ã€‚<br>ä»£ç å•°å—¦ï¼Œååˆ†å•°å—¦ã€‚</p>
<p><strong>ç†æƒ³ä¸­çš„ä»£ç å½¢å¼</strong></p>
<p>è€Œ Suspense å°±æ˜¯ä¸ºäº†å…‹æœä¸Šè¿° React çš„ç¼ºç‚¹ã€‚</p>
<p>åœ¨äº†è§£ Suspense æ€ä¹ˆè§£å†³è¿™äº›é—®é¢˜ä¹‹å‰ï¼Œæˆ‘ä»¬ä¸å¦¨è‡ªå·±æƒ³è±¡ä¸€ä¸‹ï¼Œå¦‚æœè¦åˆ©ç”¨ AJAX è·å–æ•°æ®ï¼Œä»£ç æ€æ ·å†™æœ€ç®€æ´é«˜æ•ˆï¼Ÿ</p>
<p>æˆ‘å…ˆæ¥è¯´ä¸€è¯´è‡ªå·±è®¾æƒ³çš„æœ€ä½³ä»£ç å½¢å¼ã€‚é¦–å…ˆï¼Œæˆ‘ä¸æƒ³å†™ä¸€ä¸ªæœ‰çŠ¶æ€çš„ç»„ä»¶ï¼Œå› ä¸ºé€šè¿‡ AJAX è·å–çš„æ•°æ®å¾€å¾€ä¹Ÿå°±åœ¨æ¸²æŸ“ç”¨ä¸€æ¬¡ï¼Œæ²¡å¿…è¦å­˜åœ¨ state é‡Œï¼›å…¶æ¬¡ï¼Œæƒ³è¦ä½¿æ•°æ®æ‹¿æ¥å°±ç”¨ï¼Œä¸éœ€è¦ç»è¿‡ componentDidMount èµ°ä¸€åœˆã€‚æ‰€ä»¥ï¼Œä»£ç æœ€å¥½æ˜¯ä¸‹é¢è¿™æ ·ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">const Foo = () =&gt; &#123;</span><br><span class="line">  const data = callAPI();</span><br><span class="line">  return &lt;div&gt;&#123;data&#125;&lt;/div&gt;;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>å¤Ÿç®€æ´å§ï¼Œå¯æ˜¯ç›®å‰çš„ React ç‰ˆæœ¬åšä¸åˆ°å•Šï¼</p>
<p>å› ä¸º callAPI è‚¯å®šæ˜¯ä¸€ä¸ªå¼‚æ­¥æ“ä½œï¼Œä¸å¯èƒ½è·å¾—åŒæ­¥æ•°æ®ï¼Œæ— æ³•åœ¨åŒæ­¥çš„ React æ¸²æŸ“è¿‡ç¨‹ä¸­ç«‹è¶³ã€‚</p>
<p>ä¸è¿‡ï¼Œç°åœ¨åšä¸åˆ°ï¼Œä¸ä»£è¡¨å°†æ¥åšä¸åˆ°ï¼Œå°†æ¥ React ä¼šæ”¯æŒè¿™æ ·çš„ä»£ç å½¢å¼ï¼Œè¿™ä¹Ÿå°±æ˜¯ Suspenseã€‚</p>
<p><strong>Suspense</strong></p>
<p>åœ¨ JsConf Iceland 2018 æŠ€æœ¯å¤§ä¼š ä¸Šï¼ŒReact çš„å¼€å‘è€…å±•ç¤ºäº†æœªæ¥ React ä¼šæ”¯æŒçš„æ–°ç‰¹æ€§ Suspenseï¼Œæœ‰äº† Suspenseï¼Œå°±å¯ä»¥åœ¨ React ä¸­ä»¥åŒæ­¥çš„å½¢å¼æ¥å†™å¼‚æ­¥ä»£ç ï¼Œä»£ç å½¢å¼ç±»ä¼¼ä¸‹é¢ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">const Foo = () =&gt; &#123;</span><br><span class="line">  const data = createFetcher(callAJAX).read();</span><br><span class="line">  return &lt;div&gt;&#123;data&#125;&lt;/div&gt;;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>åœ¨ React æ¨å‡º v16 çš„æ—¶å€™ï¼Œå°±å¢åŠ äº†ä¸€ä¸ªæ–°ç”Ÿå‘½å‘¨æœŸå‡½æ•° componentDidCatchã€‚å¦‚æœæŸä¸ªç»„ä»¶å®šä¹‰äº† componentDidCatchï¼Œé‚£ä¹ˆè¿™ä¸ªç»„ä»¶ä¸­æ‰€æœ‰çš„å­ç»„ä»¶åœ¨æ¸²æŸ“è¿‡ç¨‹ä¸­æŠ›å‡ºå¼‚å¸¸æ—¶ï¼Œè¿™ä¸ª componentDidCatch å‡½æ•°å°±ä¼šè¢«è°ƒç”¨ã€‚</p>
<p>å¯ä»¥è¿™ä¹ˆè®¾æƒ³ï¼ŒcomponentDidCatch å°±æ˜¯ JavaScript è¯­æ³•ä¸­çš„ catchï¼Œè€Œå¯¹åº”çš„ try è¦†ç›–æ‰€æœ‰çš„å­ç»„ä»¶ï¼Œå°±åƒä¸‹é¢è¿™æ ·:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">try &#123;</span><br><span class="line">  //æ¸²æŸ“å­ç»„ä»¶</span><br><span class="line">&#125; catch (error) &#123;</span><br><span class="line">  // componentDidCatchè¢«è°ƒç”¨</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>Suspense å°±æ˜¯å·§å¦™åˆ©ç”¨ componentDidCatch æ¥å®ç°åŒæ­¥å½¢å¼çš„å¼‚æ­¥å¤„ç†ã€‚</p>
<p>Suspense æä¾›çš„ createFetcher å‡½æ•°ä¼šå°è£…å¼‚æ­¥æ“ä½œï¼Œå½“å°è¯•ä» createFetcher è¿”å›çš„ç»“æœè¯»å–æ•°æ®æ—¶ï¼Œæœ‰ä¸¤ç§å¯èƒ½ï¼šä¸€ç§æ˜¯æ•°æ®å·²ç»å°±ç»ªï¼Œé‚£å°±ç›´æ¥è¿”å›ç»“æœï¼›è¿˜æœ‰ä¸€ç§å¯èƒ½æ˜¯å¼‚æ­¥æ“ä½œè¿˜æ²¡æœ‰ç»“æŸï¼Œæ•°æ®æ²¡æœ‰å°±ç»ªï¼Œè¿™æ—¶å€™ createFetcher ä¼šæŠ›å‡ºä¸€ä¸ªâ€œå¼‚å¸¸â€ã€‚</p>
<p>ä½ å¯èƒ½ä¼šè¯´ï¼ŒæŠ›å‡ºå¼‚å¸¸ï¼Œæ¸²æŸ“è¿‡ç¨‹ä¸å°±ä¸­æ–­äº†å—ï¼Ÿ</p>
<p>çš„ç¡®ä¼šä¸­æ–­ï¼Œä¸è¿‡ï¼ŒcreateFetcher æŠ›å‡ºçš„è¿™ä¸ªâ€œå¼‚å¸¸â€æ¯”è¾ƒç‰¹æ®Šï¼Œè¿™ä¸ªâ€œå¼‚å¸¸â€å®é™…ä¸Šæ˜¯ä¸€ä¸ª Promise å¯¹è±¡ï¼Œè¿™ä¸ª Promise å¯¹è±¡ä»£è¡¨çš„å°±æ˜¯å¼‚æ­¥æ“ä½œï¼Œæ“ä½œç»“æŸæ—¶ï¼Œä¹Ÿæ˜¯æ•°æ®å‡†å¤‡å¥½çš„æ—¶å€™ã€‚å½“ componentDidCatch æ•è·è¿™ä¸ª Promise ç±»å‹çš„â€œå¼‚å¸¸â€æ—¶ï¼Œå°±å¯ä»¥æ ¹æ®è¿™ä¸ª Promise å¯¹è±¡çš„çŠ¶æ€æ”¹å˜æ¥é‡æ–°æ¸²æŸ“å¯¹åº”ç»„ä»¶ï¼Œç¬¬äºŒæ¬¡æ¸²æŸ“ï¼Œè‚¯å®šå°±èƒ½å¤ŸæˆåŠŸã€‚</p>
<p>ä¸‹é¢æ˜¯ createFetcher çš„ä¸€ä¸ªç®€å•å®ç°æ–¹å¼</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">var NO_RESULT = &#123;&#125;;</span><br><span class="line"></span><br><span class="line">export const createFetcher = (task) =&gt; &#123;</span><br><span class="line">  let result = NO_RESULT;</span><br><span class="line"></span><br><span class="line">  return () =&gt; &#123;</span><br><span class="line">    const p = task();</span><br><span class="line"></span><br><span class="line">    p.then(res =&gt; &#123;</span><br><span class="line">      result = res;</span><br><span class="line">    &#125;);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    if (result === NO_RESULT) &#123;</span><br><span class="line">      throw p;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    return result;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>åœ¨ä¸Šé¢çš„ä»£ç ä¸­ï¼ŒcreateFetcher çš„å‚æ•° task è¢«è°ƒç”¨åº”è¯¥è¿”å›ä¸€ä¸ª Promise å¯¹è±¡ï¼Œè¿™ä¸ªå¯¹è±¡åœ¨ç¬¬ä¸€æ¬¡è°ƒç”¨æ—¶ä¼šè¢« throw å‡ºå»ï¼Œä½†æ˜¯ï¼Œåªè¦è¿™ä¸ªå¯¹è±¡å®Œç»“ï¼Œé‚£ä¹ˆ result å°±æœ‰å®é™…çš„å€¼ï¼Œä¸ä¼šå†è¢« throwã€‚</p>
<p>è¿˜éœ€è¦ä¸€ä¸ªå’Œ createFetcher é…åˆçš„ Suspenseï¼Œä»£ç å¦‚ä¸‹ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">class Suspense extends React.Component &#123;</span><br><span class="line">  state = &#123;</span><br><span class="line">    pending: false</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  componentDidCatch(error) &#123;</span><br><span class="line">    // easy way to detect Promise type</span><br><span class="line">    if (typeof error.then === &#x27;function&#x27;) &#123;</span><br><span class="line">      this.setState(&#123;pending: true&#125;);</span><br><span class="line"></span><br><span class="line">      error.then(() =&gt; this.setState(&#123;</span><br><span class="line">        pending: false</span><br><span class="line">      &#125;));</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  render() &#123;</span><br><span class="line">    return this.state.pending ? null : this.props.children;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>ä¸Šé¢çš„ Suspense ç»„ä»¶å®ç°äº† componentDidCatchï¼Œå¦‚æœæ•è·çš„ error æ˜¯ Promise ç±»å‹ï¼Œé‚£å°±è¯´æ˜å­ç»„ä»¶ç”¨ createFetcher è·å–å¼‚æ­¥æ•°æ®äº†ï¼Œå°±ä¼šç­‰åˆ°å®ƒå®Œç»“ä¹‹åé‡è®¾ stateï¼Œå¼•å‘ä¸€æ¬¡æ–°çš„æ¸²æŸ“è¿‡ç¨‹ï¼Œå› ä¸º createFetcher ä¸­ä¼šè®°å½•å¼‚æ­¥è¿”å›çš„ç»“æœï¼Œæ–°çš„æ¸²æŸ“å°±ä¸ä¼šæŠ›å‡ºå¼‚å¸¸äº†ã€‚</p>
<p>ä½¿ç”¨ createFetcher å’Œ Suspense çš„ç¤ºä¾‹ä»£ç å¦‚ä¸‹:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">const getName = () =&gt; new Promise((resolve) =&gt; &#123;</span><br><span class="line">  setTimeout(() =&gt; &#123;</span><br><span class="line">    resolve(&#x27;Morgan&#x27;);</span><br><span class="line">  &#125;, 1000);</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line">const fetcher = createFetcher(getName);</span><br><span class="line"></span><br><span class="line">const Greeting = () =&gt; &#123;</span><br><span class="line">  return &lt;div&gt;Hello &#123;fetcher()&#125;&lt;/div&gt;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">const SuspenseDemo = () =&gt; &#123;</span><br><span class="line">  return (</span><br><span class="line">    &lt;Suspense&gt;</span><br><span class="line">      &lt;Greeting /&gt;</span><br><span class="line">    &lt;/Suspense&gt;</span><br><span class="line">  );</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<p>ä¸Šé¢çš„ getName åˆ©ç”¨ setTimeout æ¨¡æ‹Ÿäº†å¼‚æ­¥ AJAX è·å–æ•°æ®ï¼Œç¬¬ä¸€æ¬¡æ¸²æŸ“ Greeting ç»„ä»¶æ—¶ï¼Œä¼šæœ‰ Promise ç±»å‹çš„å¼‚å¸¸æŠ›å‡ºï¼Œè¢« Suspense æ•è·ã€‚1 ç§’é’Ÿä¹‹åï¼Œå½“ getName è¿”å›å®é™…ç»“æœçš„æ—¶å€™ï¼ŒSuspense ä¼šå¼•å‘é‡æ–°æ¸²æŸ“ï¼Œè¿™ä¸€æ¬¡ Greeting ä¼šæ˜¾ç¤ºå‡º hello Morganã€‚</p>
<p>ä¸Šé¢çš„ createFetcher å’Œ Suspense æ˜¯ä¸€ä¸ªéå¸¸ç®€é™‹çš„å®ç°ï¼Œä¸»è¦ç”¨æ¥è®©è¯»è€…äº†è§£ Suspense çš„å·¥ä½œåŸç†ï¼Œæ­£å¼å‘å¸ƒçš„ Suspense è‚¯å®šä¼šå…·å¤‡æ›´å¼ºå¤§çš„åŠŸèƒ½ã€‚</p>
<p><strong>React v16.6.0 å¯¹ Suspense çš„æ”¯æŒ</strong></p>
<p>React å‘å¸ƒ v16.6.0 çš„æ—¶å€™ï¼Œæä¾›äº† Suspense ç»„ä»¶ï¼Œç›´æ¥æ”¯æŒ Suspense åŠŸèƒ½ï¼Œä½†æ˜¯è¿˜æ²¡æœ‰æ­£å¼æä¾› createFetcher çš„åŠŸèƒ½ï¼Œåªå‘å¸ƒäº†ä¸€ä¸ªç‹¬ç«‹ä½†ä¸ç¨³å®šçš„ react-cache åŒ…ã€‚è¿™ä¸ªåŒ…é‡Œçš„ unstable_createResource ç›¸å½“äºä¸Šé¢æè¿°çš„ createFetcherã€‚ç…§è¿™ä¸ªå‘½åæ¥çœ‹ï¼Œæ­£å¼å‘å¸ƒçš„æ—¶å€™è¿™ä¸ª API å¯èƒ½ä¼šå«åš createResource è€Œä¸æ˜¯å« createFetcherã€‚</p>
<p>æˆ‘ä»¬åˆ©ç”¨ React v16.6.0 å’Œä¸ç¨³å®šçš„ react-cache æ¥å®ç°ä¸Šè¿°åŠŸèƒ½ï¼Œä»£ç å¦‚ä¸‹ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">import React, &#123;Suspense&#125; from &#x27;react&#x27;;</span><br><span class="line"></span><br><span class="line">import &#123;unstable_createResource as createResource&#125; from &#x27;react-cache&#x27;;</span><br><span class="line"></span><br><span class="line">const getName = () =&gt; new Promise((resolve) =&gt; &#123;</span><br><span class="line">  setTimeout(() =&gt; &#123;</span><br><span class="line">    resolve(&#x27;Morgan&#x27;);</span><br><span class="line">  &#125;, 1000);</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line">const resource = createResource(getName);</span><br><span class="line"></span><br><span class="line">const Greeting = () =&gt; &#123;</span><br><span class="line">  return &lt;div&gt;hello &#123;resource.read()&#125;&lt;/div&gt;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">const SuspenseDemo = () =&gt; &#123;</span><br><span class="line">  return (</span><br><span class="line">    &lt;Suspense fallback=&#123;&lt;div&gt;loading...&lt;/div&gt;&#125; &gt;</span><br><span class="line">      &lt;Greeting /&gt;</span><br><span class="line">    &lt;/Suspense&gt;</span><br><span class="line">  );</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<p>åœ¨ä¸Šé¢çš„ä»£ç ä¸­ï¼Œæˆ‘ä»¬ä½¿ç”¨ React æä¾›çš„ Suspense ç»„ä»¶ï¼Œæ”¯æŒä¸€ä¸ª fallback å±æ€§ï¼Œè¿™ä¸ªå±æ€§å¯ä»¥ç”¨äºæ˜¾ç¤ºâ€œè£…è½½ä¸­â€ç•Œé¢ã€‚åœ¨ä¸Šé¢çš„ä¾‹å­ä¸­ï¼Œè¦ç­‰å¾… 1 ç§’é’Ÿæ—¶é—´æ‰å¾—åˆ°æ¨¡æ‹Ÿ API çš„ç»“æœï¼Œè¿™æ—¶å€™æ˜¾ç¤ºä¸€ä¸ªç©ºç™½é¡µé¢æ˜¯è‚¯å®šä¸åˆé€‚çš„ï¼Œåœ¨ç­‰å¾…çš„è¿™ 1 ç§’é’Ÿé‡Œï¼Œæ˜¾å¾—å°±æ˜¯ä¸€ä¸ªâ€œLoadingâ€¦â€å­—æ ·ã€‚</p>
<p>å¾ˆæ˜¾ç„¶ï¼Œéœ€è¦ä¸€ä¸ªæœ€ä½³å®è·µæ¥æ§åˆ¶ Suspense çš„èŒƒå›´ã€‚å¦‚æœæˆ‘ä»¬åªåœ¨ç»„ä»¶æ ‘æœ€é¡¶å±‚æ”¾ä¸€ä¸ª Suspense ç»„ä»¶ï¼Œé‚£ä¹ˆåœ¨ API è¿”å›ä¹‹å‰ï¼Œæ•´ä¸ªé¡µé¢åªæ˜¾ç¤ºâ€œè£…è½½ä¸­â€ï¼Œè¿™æ ·çš„ç”¨æˆ·ä½“éªŒå¹¶ä¸å¥½ã€‚æ­£ç¡®çš„åšæ³•ï¼Œæ˜¯å°†æ¯ä¸€ä¸ªç‹¬ç«‹ä¾èµ–æŸä¸ª API è°ƒç”¨çš„ç»„ä»¶ç”¨ä¸€ä¸ª Suspense åŒ…ä½ã€‚</p>
<p>ä¾‹å¦‚ï¼Œä¸€ä¸ªé¡µé¢ä¸­åŒ…æ‹¬å¤´éƒ¨çš„ Headerã€å·¦ä¾§çš„å¯¼èˆªæ  LeftPanel å’Œå³ä¾§çš„å†…å®¹ Contentï¼Œå…¶ä¸­åªæœ‰ Header çš„æ¸²æŸ“ä¸ä¾èµ–äº APIï¼Œé‚£ä¹ˆï¼ŒJSX å¯ä»¥è¿™æ ·å†™ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">&lt;div&gt;</span><br><span class="line">    &lt;Header /&gt;</span><br><span class="line">    &lt;Suspense fallback=&#123;&lt;LoadingSpin /&gt;&#125;&gt;</span><br><span class="line">        &lt;LeftPanel /&gt;</span><br><span class="line">    &lt;/Suspense&gt;</span><br><span class="line">    &lt;Suspense fallback=&#123;&lt;LoadingSpin /&gt;&#125;&gt;</span><br><span class="line">        &lt;Content /&gt;</span><br><span class="line">    &lt;/Suspense&gt;</span><br><span class="line">&lt;/div&gt;</span><br></pre></td></tr></table></figure>

<p>è¿™æ ·ï¼Œç½‘é¡µé¦–å…ˆæ˜¾ç¤º Headerï¼Œç„¶åæ— è®º LeftPanel è¿˜æ˜¯ Content ä¸­è°çš„ AJAX é¦–å…ˆè¿”å›ç»“æœï¼Œéƒ½å¯ä»¥ç«‹åˆ»æ˜¾ç¤ºå¯¹åº”æ¨¡å—ï¼Œè€Œä¸ç”¨ç­‰å¾…æ‰€æœ‰ AJAX éƒ½è¿”å›æ‰è®©ç”¨æˆ·çœ‹åˆ°æ›´æ–°ã€‚</p>
<p><strong>Suspense å¸¦æ¥çš„ React ä½¿ç”¨æ¨¡å¼æ”¹å˜</strong></p>
<p>Suspense è¢«æ¨å‡ºä¹‹åï¼Œå¯ä»¥æå¤§åœ°å‡å°‘å¼‚æ­¥æ“ä½œä»£ç çš„å¤æ‚åº¦ã€‚</p>
<p>ä¹‹å‰ï¼Œåªè¦æœ‰ AJAX è¿™æ ·çš„å¼‚æ­¥æ“ä½œï¼Œå°±å¿…é¡»è¦ç”¨ä¸¤æ¬¡æ¸²æŸ“æ¥æ˜¾ç¤º AJAX ç»“æœï¼Œè¿™å°±éœ€è¦ç”¨ç»„ä»¶çš„ state æ¥å­˜å‚¨ AJAX çš„ç»“æœï¼Œç”¨ state åˆæ„å‘³ç€è¦æŠŠç»„ä»¶å®ç°ä¸ºä¸€ä¸ª classã€‚æ€»ä¹‹ï¼Œæˆ‘ä»¬éœ€è¦åšè¿™äº›ï¼š</p>
<ul>
<li>å®ç°ä¸€ä¸ª classï¼›</li>
<li>class ä¸­éœ€è¦æœ‰ stateï¼›</li>
<li>éœ€è¦å®ç° componentDidMount å‡½æ•°ï¼›</li>
<li>render å¿…é¡»è¦æ ¹æ® this.state æ¥æ¸²æŸ“ä¸åŒå†…å®¹ã€‚</li>
<li>æœ‰äº† Suspense ä¹‹åï¼Œä¸éœ€è¦åšä¸Šé¢è¿™äº›æ‚äº‹ï¼Œåªè¦ä¸€ä¸ªå‡½æ•°å½¢å¼ç»„ä»¶å°±è¶³å¤Ÿäº†ã€‚</li>
</ul>
<p>åœ¨ä»‹ç» Redux æ—¶ï¼Œæˆ‘ä»¬æåˆ°è¿‡åœ¨ Suspense é¢å‰ï¼ŒRedux çš„ä¸€åˆ‡å¼‚æ­¥æ“ä½œæ–¹æ¡ˆéƒ½æ˜¾å¾—ç¹çï¼Œè¯»è€…ç°åœ¨åº”è¯¥èƒ½å¤Ÿé€šè¿‡ä»£ç ç†è§£è¿™ä¸€ç‚¹äº†ã€‚</p>
<p>å¾ˆå¯æƒœï¼Œç›®å‰ Suspense è¿˜ä¸æ”¯æŒæœåŠ¡å™¨ç«¯æ¸²æŸ“ï¼Œå½“ Suspense æ”¯æŒæœåŠ¡å™¨ç«¯æ¸²æŸ“çš„æ—¶å€™ï¼Œé‚£å°±çœŸçš„ä¼šå¯¹ React ç¤¾åŒºå¸¦æ¥é©å‘½æ€§å½±å“ã€‚</p>
<p><strong>æ€»ç»“</strong></p>
<ul>
<li>Suspense è§£å†³å¼‚æ­¥æ“ä½œçš„é—®é¢˜ï¼›</li>
<li>æœ‰äº† Supsense ä¹‹åï¼Œä¾èµ– AJAX çš„ç»„ä»¶ä¹Ÿå¯ä»¥æ˜¯å‡½æ•°å½¢å¼ï¼Œä¸éœ€è¦æ˜¯ classã€‚</li>
</ul>
<h2 id="åã€å‡½æ•°åŒ–çš„-Hooks"><a href="#åã€å‡½æ•°åŒ–çš„-Hooks" class="headerlink" title="åã€å‡½æ•°åŒ–çš„ Hooks"></a>åã€å‡½æ•°åŒ–çš„ Hooks</h2><p>React v16.7.0-alpha ä¸­ç¬¬ä¸€æ¬¡å¼•å…¥äº† Hooks çš„æ¦‚å¿µï¼Œå› ä¸ºè¿™æ˜¯ä¸€ä¸ª alpha ç‰ˆæœ¬ï¼Œä¸ç®—æ­£å¼å‘å¸ƒï¼Œæ‰€ä»¥ï¼Œå°†æ¥æ­£å¼å‘å¸ƒæ—¶ API å¯èƒ½ä¼šæœ‰å˜åŒ–ã€‚</p>
<blockquote>
<p>Hooks çš„ç›®çš„ï¼Œç®€è€Œè¨€ä¹‹å°±æ˜¯è®©å¼€å‘è€…ä¸éœ€è¦å†ç”¨ class æ¥å®ç°ç»„ä»¶</p>
</blockquote>
<p>è¿˜è®°å¾—ä¹‹å‰æˆ‘ä»¬ä»‹ç»çš„ç»å…¸ Counter ç»„ä»¶å—ï¼Ÿä¸è€ƒè™‘ç”¨ Redux æˆ–è€… Mobx æ¥ç®¡ç†çŠ¶æ€çš„è¯ï¼ŒCounter ç»„ä»¶å°±éœ€è¦æŠŠè®¡æ•°æ•°æ®æ”¾åœ¨ state é‡Œï¼Œè¦ç”¨ stateï¼Œå°±æ„å‘³ç€éœ€è¦å®šä¹‰ä¸€ä¸ª classã€‚</p>
<p>å¾ˆå¤šæ—¶å€™ï¼Œä¸€ä¸ªç®€å•ç»„ä»¶ä¹Ÿéœ€è¦å®ç°ä¸€ä¸ª classï¼Œçš„ç¡®æ˜¯ä¸€ä»¶å¾ˆçƒ¦çš„äº‹ï¼Œæœ‰äº† Hooks ä¹‹åï¼Œäº‹æƒ…å°±ç®€å•å¤šäº†ï¼Œæˆ‘ä»¬ç”¨å‡ ä¸ªå·²ç»å…¬å¼€çš„ Hooks API æ¥çœ‹çœ‹å¦‚ä½•é¿å…å†™ classã€‚</p>
<p><strong>useState</strong></p>
<blockquote>
<p>Hooks ä¼šæä¾›ä¸€ä¸ªå« useState çš„æ–¹æ³•ï¼Œå®ƒå¼€å¯äº†ä¸€æ‰‡æ–°çš„å®šä¹‰ state çš„é—¨ï¼Œå¯¹åº” Counter çš„ä»£ç å¯ä»¥è¿™ä¹ˆå†™ï¼š</p>
</blockquote>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">import &#123; useState &#125; from &#x27;react&#x27;;</span><br><span class="line"></span><br><span class="line">const Counter = () =&gt; &#123;</span><br><span class="line">  const [count, setCount] = useState(0);</span><br><span class="line"></span><br><span class="line">  return (</span><br><span class="line">    &lt;div&gt;</span><br><span class="line">       &lt;div&gt;&#123;count&#125;&lt;/div&gt;</span><br><span class="line">       &lt;button onClick=&#123;() =&gt; setCount(count + 1)&#125;&gt;+&lt;/button&gt;</span><br><span class="line">       &lt;button onClick=&#123;() =&gt; setCount(count - 1)&#125;&gt;-&lt;/button&gt;</span><br><span class="line">    &lt;/div&gt;</span><br><span class="line">  );</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<p>æ³¨æ„çœ‹ï¼ŒCounter æ‹¥æœ‰è‡ªå·±çš„â€œçŠ¶æ€â€ï¼Œä½†å®ƒåªæ˜¯ä¸€ä¸ªå‡½æ•°ï¼Œä¸æ˜¯ classã€‚</p>
<p>useState åªæ¥å—ä¸€ä¸ªå‚æ•°ï¼Œä¹Ÿå°±æ˜¯ state çš„åˆå§‹å€¼ï¼Œå®ƒè¿”å›ä¸€ä¸ªåªæœ‰ä¸¤ä¸ªå…ƒç´ çš„æ•°ç»„ï¼Œç¬¬ä¸€ä¸ªå…ƒç´ å°±æ˜¯ state çš„å€¼ï¼Œç¬¬äºŒä¸ªå…ƒç´ æ˜¯æ›´æ–° state çš„å‡½æ•°ã€‚</p>
<p>æˆ‘ä»¬åˆ©ç”¨è§£æ„èµ‹å€¼ï¼ˆdestructuring assignmentï¼‰æŠŠä¸¤ä¸ªå…ƒç´ åˆ†åˆ«èµ‹å€¼ç»™ count å’Œ setCountï¼Œç›¸å½“äºè¿™æ ·çš„ä»£ç ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">// ä¸‹é¢ä»£ç ç­‰åŒäºï¼š const [count, setCount] = useState(0);</span><br><span class="line">const result = useState(0);</span><br><span class="line">const count = result[0];</span><br><span class="line">const setCount = result[1];</span><br></pre></td></tr></table></figure>

<p>åˆ©ç”¨ count å¯ä»¥è¯»å–åˆ°è¿™ä¸ª stateï¼Œåˆ©ç”¨ setCount å¯ä»¥æ›´æ–°è¿™ä¸ª stateï¼Œè€Œä¸”æˆ‘ä»¬å®Œå…¨å¯ä»¥æ§åˆ¶è¿™ä¸¤ä¸ªå˜é‡çš„å‘½åï¼Œåªè¦é«˜å…´ï¼Œä½ å®Œå…¨å¯ä»¥è¿™ä¹ˆå†™</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">const [theCount, updateCount] = useState(0);</span><br></pre></td></tr></table></figure>

<p>å› ä¸º useState åœ¨ Counter è¿™ä¸ªå‡½æ•°ä½“ä¸­ï¼Œæ¯æ¬¡ Counter è¢«æ¸²æŸ“çš„æ—¶å€™ï¼Œè¿™ä¸ª useState è°ƒç”¨éƒ½ä¼šè¢«æ‰§è¡Œï¼ŒuseState è‡ªå·±è‚¯å®šä¸æ˜¯ä¸€ä¸ªçº¯å‡½æ•°ï¼Œå› ä¸ºå®ƒè¦åŒºåˆ†ç¬¬ä¸€æ¬¡è°ƒç”¨ï¼ˆç»„ä»¶è¢« mount æ—¶ï¼‰å’Œåç»­è°ƒç”¨ï¼ˆé‡å¤æ¸²æŸ“æ—¶ï¼‰ï¼Œåªæœ‰ç¬¬ä¸€æ¬¡æ‰ç”¨å¾—ä¸Šå‚æ•°çš„åˆå§‹å€¼ï¼Œè€Œåç»­çš„è°ƒç”¨å°±è¿”å›â€œè®°ä½â€çš„ state å€¼ã€‚</p>
<p>è¯»è€…çœ‹åˆ°è¿™é‡Œï¼Œå¿ƒé‡Œå¯èƒ½ä¼šæœ‰è¿™æ ·çš„ç–‘é—®ï¼šå¦‚æœç»„ä»¶ä¸­å¤šæ¬¡ä½¿ç”¨ useState æ€ä¹ˆåŠï¼ŸReact å¦‚ä½•â€œè®°ä½â€å“ªä¸ªçŠ¶æ€å¯¹åº”å“ªä¸ªå˜é‡ï¼Ÿ</p>
<p>React æ˜¯å®Œå…¨æ ¹æ® useState çš„è°ƒç”¨é¡ºåºæ¥â€œè®°ä½â€çŠ¶æ€å½’å±çš„ï¼Œå‡è®¾ç»„ä»¶ä»£ç å¦‚ä¸‹ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">const Counter = () =&gt; &#123;</span><br><span class="line">  const [count, setCount] = useState(0);</span><br><span class="line">  const [foo, updateFoo] = useState(&#x27;foo&#x27;);</span><br><span class="line">  </span><br><span class="line">  ...</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>æ¯ä¸€æ¬¡ Counter è¢«æ¸²æŸ“ï¼Œéƒ½æ˜¯ç¬¬ä¸€æ¬¡ useState è°ƒç”¨è·å¾— count å’Œ setCountï¼Œç¬¬äºŒæ¬¡ useState è°ƒç”¨è·å¾— foo å’Œ updateFooï¼ˆè¿™é‡Œæˆ‘æ•…æ„è®©å‘½åä¸ç”¨ set å‰ç¼€ï¼Œå¯è§å‡½æ•°åå¯ä»¥éšæ„ï¼‰ã€‚React æ˜¯æ¸²æŸ“è¿‡ç¨‹ä¸­çš„â€œä¸Šå¸â€ï¼Œæ¯ä¸€æ¬¡æ¸²æŸ“ Counter éƒ½è¦ç”± React å‘èµ·ï¼Œæ‰€ä»¥å®ƒæœ‰æœºä¼šå‡†å¤‡å¥½ä¸€ä¸ªå†…å­˜è®°å½•ï¼Œå½“å¼€å§‹æ‰§è¡Œçš„æ—¶å€™ï¼Œæ¯ä¸€æ¬¡ useState è°ƒç”¨å¯¹åº”å†…å­˜è®°å½•ä¸Šä¸€ä¸ªä½ç½®ï¼Œè€Œä¸”æ˜¯æŒ‰ç…§é¡ºåºæ¥è®°å½•çš„ã€‚React ä¸çŸ¥é“ä½ æŠŠ useState ç­‰ Hooks API è¿”å›çš„ç»“æœèµ‹å€¼ç»™ä»€ä¹ˆå˜é‡ï¼Œä½†æ˜¯å®ƒä¹Ÿä¸éœ€è¦çŸ¥é“ï¼Œå®ƒåªéœ€è¦æŒ‰ç…§ useState è°ƒç”¨é¡ºåºè®°å½•å°±å¥½äº†ã€‚</p>
<p>æ­£å› ä¸ºè¿™ä¸ªåŸå› ï¼ŒHooksï¼Œåƒä¸‡ä¸è¦åœ¨ if è¯­å¥æˆ–è€… for å¾ªç¯è¯­å¥ä¸­ä½¿ç”¨ï¼</p>
<p>åƒä¸‹é¢çš„ä»£ç ï¼Œè‚¯å®šä¼šå‡ºä¹±å­çš„ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">const Counter = () =&gt; &#123;</span><br><span class="line">    const [count, setCount] = useState(0);</span><br><span class="line">    if (count % 2 === 0) &#123;</span><br><span class="line">        const [foo, updateFoo] = useState(&#x27;foo&#x27;);</span><br><span class="line">    &#125;</span><br><span class="line">    const [bar, updateBar] = useState(&#x27;bar&#x27;);</span><br><span class="line">  ...</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>å› ä¸ºæ¡ä»¶åˆ¤æ–­ï¼Œè®©æ¯æ¬¡æ¸²æŸ“ä¸­ useState çš„è°ƒç”¨æ¬¡åºä¸ä¸€è‡´äº†ï¼Œäºæ˜¯ React å°±é”™ä¹±äº†ã€‚</p>
<p><strong>useEffect</strong></p>
<p>é™¤äº† useStateï¼ŒReact è¿˜æä¾› useEffectï¼Œç”¨äºæ”¯æŒç»„ä»¶ä¸­å¢åŠ å‰¯ä½œç”¨çš„æ”¯æŒã€‚</p>
<p>åœ¨ React ç»„ä»¶ç”Ÿå‘½å‘¨æœŸä¸­å¦‚æœè¦åšæœ‰å‰¯ä½œç”¨çš„æ“ä½œï¼Œä»£ç æ”¾åœ¨å“ªé‡Œï¼Ÿ</p>
<p>å½“ç„¶æ˜¯æ”¾åœ¨ componentDidMount æˆ–è€… componentDidUpdate é‡Œï¼Œä½†æ˜¯è¿™æ„å‘³ç€ç»„ä»¶å¿…é¡»æ˜¯ä¸€ä¸ª classã€‚</p>
<p>åœ¨ Counter ç»„ä»¶ï¼Œå¦‚æœæˆ‘ä»¬æƒ³è¦åœ¨ç”¨æˆ·ç‚¹å‡»â€œ+â€æˆ–è€…â€œ-â€æŒ‰é’®ä¹‹åæŠŠè®¡æ•°å€¼ä½“ç°åœ¨ç½‘é¡µæ ‡é¢˜ä¸Šï¼Œè¿™å°±æ˜¯ä¸€ä¸ªä¿®æ”¹ DOM çš„å‰¯ä½œç”¨æ“ä½œï¼Œæ‰€ä»¥å¿…é¡»æŠŠ Counter å†™æˆ classï¼Œè€Œä¸”æ·»åŠ ä¸‹é¢çš„ä»£ç </p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">componentDidMount() &#123;</span><br><span class="line">  document.title = `Count: $&#123;this.state.count&#125;`;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">componentDidUpdate() &#123;</span><br><span class="line">  document.title = `Count: $&#123;this.state.count&#125;`;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<blockquote>
<p>è€Œæœ‰äº† useEffectï¼Œæˆ‘ä»¬å°±ä¸ç”¨å†™ä¸€ä¸ª class äº†ï¼Œå¯¹åº”ä»£ç å¦‚ä¸‹ï¼š</p>
</blockquote>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">import &#123; useState, useEffect &#125; from &#x27;react&#x27;;</span><br><span class="line"></span><br><span class="line">const Counter = () =&gt; &#123;</span><br><span class="line">  const [count, setCount] = useState(0);</span><br><span class="line">  </span><br><span class="line">  useEffect(() =&gt; &#123;</span><br><span class="line">    document.title = `Count: $&#123;count&#125;`;</span><br><span class="line">  &#125;);</span><br><span class="line"></span><br><span class="line">  return (</span><br><span class="line">    &lt;div&gt;</span><br><span class="line">       &lt;div&gt;&#123;count&#125;&lt;/div&gt;</span><br><span class="line">       &lt;button onClick=&#123;() =&gt; setCount(count + 1)&#125;&gt;+&lt;/button&gt;</span><br><span class="line">       &lt;button onClick=&#123;() =&gt; setCount(count - 1)&#125;&gt;-&lt;/button&gt;</span><br><span class="line">    &lt;/div&gt;</span><br><span class="line">  );</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<p>useEffect çš„å‚æ•°æ˜¯ä¸€ä¸ªå‡½æ•°ï¼Œç»„ä»¶æ¯æ¬¡æ¸²æŸ“ä¹‹åï¼Œéƒ½ä¼šè°ƒç”¨è¿™ä¸ªå‡½æ•°å‚æ•°ï¼Œè¿™æ ·å°±è¾¾åˆ°äº† componentDidMount å’Œ componentDidUpdate ä¸€æ ·çš„æ•ˆæœã€‚</p>
<p>è™½ç„¶æœ¬è´¨ä¸Šï¼Œä¾ç„¶æ˜¯ componentDidMount å’Œ componentDidUpdate ä¸¤ä¸ªç”Ÿå‘½å‘¨æœŸè¢«è°ƒç”¨ï¼Œä½†æ˜¯ç°åœ¨æˆ‘ä»¬å…³å¿ƒçš„ä¸æ˜¯ mount æˆ–è€… update è¿‡ç¨‹ï¼Œè€Œæ˜¯â€œafter renderâ€äº‹ä»¶ï¼ŒuseEffect å°±æ˜¯å‘Šè¯‰ç»„ä»¶åœ¨â€œæ¸²æŸ“å®Œâ€ä¹‹ååšç‚¹ä»€ä¹ˆäº‹ã€‚</p>
<p>è¯»è€…å¯èƒ½ä¼šé—®ï¼Œç°åœ¨æŠŠ componentDidMount å’Œ componentDidUpdate æ··åœ¨äº†ä¸€èµ·ï¼Œé‚£å‡å¦‚æŸä¸ªåœºæ™¯ä¸‹æˆ‘åªåœ¨ mount æ—¶åšäº‹ä½† update ä¸åšäº‹ï¼Œç”¨ useEffect ä¸å°±ä¸è¡Œäº†å—ï¼Ÿ</p>
<p>å…¶å®ï¼Œç”¨ä¸€ç‚¹å°æŠ€å·§å°±å¯ä»¥è§£å†³ã€‚useEffect è¿˜æ”¯æŒç¬¬äºŒä¸ªå¯é€‰å‚æ•°ï¼Œåªæœ‰åŒä¸€ useEffect çš„ä¸¤æ¬¡è°ƒç”¨ç¬¬äºŒä¸ªå‚æ•°ä¸åŒæ—¶ï¼Œç¬¬ä¸€ä¸ªå‡½æ•°å‚æ•°æ‰ä¼šè¢«è°ƒç”¨ï¼Œæ‰€ä»¥ï¼Œå¦‚æœæƒ³æ¨¡æ‹Ÿ componentDidMountï¼Œåªéœ€è¦è¿™æ ·å†™ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">useEffect(() =&gt; &#123;</span><br><span class="line">  // è¿™é‡Œåªæœ‰mountæ—¶æ‰è¢«è°ƒç”¨ï¼Œç›¸å½“äºcomponentDidMount</span><br><span class="line">&#125;, [123]);</span><br></pre></td></tr></table></figure>

<blockquote>
<p>åœ¨ä¸Šé¢çš„ä»£ç ä¸­ï¼ŒuseEffect çš„ç¬¬äºŒä¸ªå‚æ•°æ˜¯ [123]ï¼Œå…¶å®ä¹Ÿå¯ä»¥æ˜¯ä»»ä½•ä¸€ä¸ªå¸¸æ•°ï¼Œå› ä¸ºå®ƒæ°¸è¿œä¸å˜ï¼Œæ‰€ä»¥ useEffect åªåœ¨ mount æ—¶è°ƒç”¨ç¬¬ä¸€ä¸ªå‡½æ•°å‚æ•°ä¸€æ¬¡ï¼Œè¾¾åˆ°äº† componentDidMount ä¸€æ ·çš„æ•ˆæœã€‚</p>
</blockquote>
<p><strong>useContext</strong></p>
<p>åœ¨å‰é¢ä»‹ç»â€œæä¾›è€…æ¨¡å¼â€ç« èŠ‚æˆ‘ä»¬ä»‹ç»è¿‡ React æ–°çš„ Context APIï¼Œè¿™ä¸ª API ä¸æ˜¯å®Œç¾çš„ï¼Œåœ¨å¤šä¸ª Context åµŒå¥—çš„æ—¶å€™å°¤å…¶éº»çƒ¦ã€‚</p>
<p>æ¯”å¦‚ï¼Œä¸€æ®µ JSX å¦‚æœæ—¢ä¾èµ–äº ThemeContext åˆä¾èµ–äº LanguageContextï¼Œé‚£ä¹ˆæŒ‰ç…§ React Context API åº”è¯¥è¿™ä¹ˆå†™</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">&lt;ThemeContext.Consumer&gt;</span><br><span class="line">    &#123;</span><br><span class="line">        theme =&gt; (</span><br><span class="line">            &lt;LanguageContext.Cosumer&gt;</span><br><span class="line">                language =&gt; &#123;</span><br><span class="line">                    //å¯ä»¥ä½¿ç”¨themeå’Œlanugageäº†</span><br><span class="line">                &#125;</span><br><span class="line">            &lt;/LanguageContext.Cosumer&gt;</span><br><span class="line">        )</span><br><span class="line">    &#125;</span><br><span class="line">&lt;/ThemeContext.Consumer&gt;</span><br></pre></td></tr></table></figure>

<p>å› ä¸º Context API è¦ç”¨ render propsï¼Œæ‰€ä»¥ç”¨ä¸¤ä¸ª Context å°±è¦ç”¨ä¸¤æ¬¡ render propsï¼Œä¹Ÿå°±ç”¨äº†ä¸¤ä¸ªå‡½æ•°åµŒå¥—ï¼Œè¿™æ ·çš„ç¼©æ ¼çœ‹èµ·æ¥ä¹Ÿçš„ç¡®è¿‡åˆ†äº†ä¸€ç‚¹ç‚¹ã€‚</p>
<p>ä½¿ç”¨ Hooks çš„ useContextï¼Œä¸Šé¢çš„ä»£ç å¯ä»¥ç¼©ç•¥ä¸ºä¸‹é¢è¿™æ ·</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">const theme = useContext(ThemeContext);</span><br><span class="line">const language = useContext(LanguageContext);</span><br><span class="line">// è¿™é‡Œå°±å¯ä»¥ç”¨themeå’Œlanguageäº†</span><br></pre></td></tr></table></figure>

<p>è¿™ä¸ªuseContextæŠŠä¸€ä¸ªéœ€è¦å¾ˆè´¹åŠ²æ‰èƒ½ç†è§£çš„ Context API ä½¿ç”¨å¤§å¤§ç®€åŒ–ï¼Œä¸éœ€è¦ç†è§£render propsï¼Œç›´æ¥ä¸€ä¸ªå‡½æ•°è°ƒç”¨å°±æå®šã€‚</p>
<p>ä½†æ˜¯ï¼ŒuseContextä¹Ÿå¹¶ä¸æ˜¯å®Œç¾çš„ï¼Œå®ƒä¼šé€ æˆæ„æƒ³ä¸åˆ°çš„é‡æ–°æ¸²æŸ“ï¼Œæˆ‘ä»¬çœ‹ä¸€ä¸ªå®Œæ•´çš„ä½¿ç”¨useContextçš„ç»„ä»¶ã€‚</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">const ThemedPage = () =&gt; &#123;</span><br><span class="line">    const theme = useContext(ThemeContext);</span><br><span class="line">    </span><br><span class="line">    return (</span><br><span class="line">       &lt;div&gt;</span><br><span class="line">            &lt;Header color=&#123;theme.color&#125; /&gt;</span><br><span class="line">            &lt;Content color=&#123;theme.color&#125;/&gt;</span><br><span class="line">            &lt;Footer color=&#123;theme.color&#125;/&gt;</span><br><span class="line">       &lt;/div&gt;</span><br><span class="line">    );</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<p>å› ä¸ºè¿™ä¸ªç»„ä»¶ThemedPageä½¿ç”¨äº†useContextï¼Œå®ƒå¾ˆè‡ªç„¶æˆä¸ºäº†Contextçš„ä¸€ä¸ªæ¶ˆè´¹è€…ï¼Œæ‰€ä»¥ï¼Œåªè¦Contextçš„å€¼å‘ç”Ÿäº†å˜åŒ–ï¼ŒThemedPageå°±ä¼šè¢«é‡æ–°æ¸²æŸ“ï¼Œè¿™å¾ˆè‡ªç„¶ï¼Œå› ä¸ºä¸é‡æ–°æ¸²æŸ“ä¹Ÿå°±æ²¡åŠæ³•é‡æ–°è·å¾—themeå€¼ï¼Œä½†ç°åœ¨æœ‰ä¸€ä¸ªå¤§é—®é¢˜ï¼Œå¯¹äºThemedPageæ¥è¯´ï¼Œå®é™…ä¸Šåªä¾èµ–äºthemeä¸­çš„colorå±æ€§ï¼Œå¦‚æœåªæ˜¯themeä¸­çš„sizeå‘ç”Ÿäº†å˜åŒ–ä½†æ˜¯colorå±æ€§æ²¡æœ‰å˜åŒ–ï¼ŒThemedPageä¾ç„¶ä¼šè¢«é‡æ–°æ¸²æŸ“ï¼Œå½“ç„¶ï¼Œæˆ‘ä»¬é€šè¿‡ç»™Headerã€Contentå’ŒFooterè¿™äº›ç»„ä»¶æ·»åŠ shouldComponentUpdateå®ç°å¯ä»¥å‡å°‘æ²¡æœ‰å¿…è¦çš„é‡æ–°æ¸²æŸ“ï¼Œä½†æ˜¯ä¸Šä¸€å±‚çš„ThemedPageä¸­çš„JSXé‡æ–°æ¸²æŸ“æ˜¯èº²ä¸è¿‡å»äº†ã€‚</p>
<p>è¯´åˆ°åº•ï¼ŒuseContextéœ€è¦ä¸€ç§è¡¨è¾¾æ–¹å¼å‘Šè¯‰Reactï¼šâ€œæˆ‘æ²¡æœ‰æ”¹å˜ï¼Œé‡ç”¨ä¸Šæ¬¡å†…å®¹å¥½äº†ã€‚â€</p>
<p>å¸Œæœ›Hooksæ­£å¼å‘å¸ƒçš„æ—¶å€™èƒ½å¤Ÿå¼¥è¡¥è¿™ä¸€ç¼ºé™·ã€‚</p>
<p><strong>Hooks å¸¦æ¥çš„ä»£ç æ¨¡å¼æ”¹å˜</strong></p>
<p>ä¸Šé¢æˆ‘ä»¬ä»‹ç»äº† useStateã€useEffect å’Œ useContext ä¸‰ä¸ªæœ€åŸºæœ¬çš„ Hooksï¼Œå¯ä»¥æ„Ÿå—åˆ°ï¼ŒHooks å°†å¤§å¤§ç®€åŒ–ä½¿ç”¨ React çš„ä»£ç ã€‚</p>
<p>é¦–å…ˆæˆ‘ä»¬å¯èƒ½ä¸å†éœ€è¦ classäº†ï¼Œè™½ç„¶ React å®˜æ–¹è¡¨ç¤º class ç±»å‹çš„ç»„ä»¶å°†ç»§ç»­æ”¯æŒï¼Œä½†æ˜¯ï¼Œä¸šç•Œå·²ç»æ™®éè¡¨ç¤ºä¼šè¿ç§»åˆ° Hooks å†™æ³•ä¸Šï¼Œä¹Ÿå°±æ˜¯æ”¾å¼ƒ classï¼Œåªç”¨å‡½æ•°å½¢å¼æ¥ç¼–å†™ç»„ä»¶ã€‚</p>
<p>å¯¹äº useContextï¼Œå®ƒå¹¶æ²¡æœ‰ä¸ºæ¶ˆé™¤ class åšè´¡çŒ®ï¼Œå´ä¸ºæ¶ˆé™¤ render props æ¨¡å¼åšäº†è´¡çŒ®ã€‚å¾ˆé•¿ä¸€æ®µæ—¶é—´ï¼Œé«˜é˜¶ç»„ä»¶å’Œ render props æ˜¯ç»„ä»¶ä¹‹é—´å…±äº«é€»è¾‘çš„ä¸¤ä¸ªæ­¦å™¨ï¼Œä½†å¦‚åŒæˆ‘å‰é¢ç« èŠ‚ä»‹ç»çš„é‚£æ ·ï¼Œè¿™ä¸¤ä¸ªæ­¦å™¨éƒ½ä¸æ˜¯åå…¨åç¾çš„ï¼Œç°åœ¨ Hooks çš„å‡ºç°ï¼Œä¹Ÿé¢„ç¤ºç€é«˜é˜¶ç»„ä»¶å’Œ render props å¯èƒ½è¦è¢«é€æ­¥å–ä»£ã€‚</p>
<p>ä½†è¯»è€…æœ‹å‹ï¼Œä¸è¦è§‰å¾—ä¹‹å‰å­¦ä¹ é«˜é˜¶ç»„ä»¶å’Œ render props æ˜¯æµªè´¹æ—¶é—´ï¼Œç›¸åï¼Œä½ åªæœ‰æ˜ç™½ React çš„ä½¿ç”¨å†å²ï¼Œæ‰èƒ½æ›´å¥½åœ°ç†è§£ Hooks çš„æ„ä¹‰ã€‚</p>
<p>å¯ä»¥é¢„æµ‹ï¼Œåœ¨ Hooks å…´èµ·ä¹‹åï¼Œå…±äº«ä»£ç ä¹‹é—´é€»è¾‘ä¼šç”¨å‡½æ•°å½¢å¼ï¼Œè€Œä¸”è¿™äº›å‡½æ•°ä¼šä»¥ use- å‰ç¼€ä¸ºçº¦å®šï¼Œé‡ç”¨è¿™äº›é€»è¾‘çš„æ–¹å¼ï¼Œå°±æ˜¯åœ¨å‡½æ•°å½¢å¼ç»„ä»¶ä¸­è°ƒç”¨è¿™äº› useXXX å‡½æ•°ã€‚</p>
<p>ä¾‹å¦‚ï¼Œæˆ‘ä»¬å¯ä»¥å†™è¿™æ ·ä¸€ä¸ªå…±äº« Hook useMountLogï¼Œç”¨äºåœ¨ mount æ—¶è®°å½•ä¸€ä¸ªæ—¥å¿—ï¼Œä»£ç å¦‚ä¸‹ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">const useMountLog = (name) =&gt; &#123;</span><br><span class="line">    useEffect(() =&gt; &#123;</span><br><span class="line">        console.log(`$&#123;name&#125; mounted`);    </span><br><span class="line">    &#125;, [123]);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>ä»»ä½•ä¸€ä¸ªå‡½æ•°å½¢å¼ç»„ä»¶éƒ½å¯ä»¥ç›´æ¥è°ƒç”¨è¿™ä¸ª useMountLog è·å¾—è¿™ä¸ªåŠŸèƒ½ï¼Œå¦‚ä¸‹</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">const Counter = () =&gt; &#123;</span><br><span class="line">    useMountLog(&#x27;Counter&#x27;);</span><br><span class="line">    </span><br><span class="line">    ...</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>å¯¹äº†ï¼Œæ‰€æœ‰çš„ Hooks API éƒ½åªèƒ½åœ¨å‡½æ•°ç±»å‹ç»„ä»¶ä¸­è°ƒç”¨ï¼Œclass ç±»å‹çš„ç»„ä»¶ä¸èƒ½ç”¨ï¼Œä»è¿™ç‚¹çœ‹ï¼Œå¾ˆæ˜¾ç„¶ï¼Œclass ç±»å‹ç»„ä»¶å°†ä¼šèµ°å‘æ¶ˆäº¡ã€‚</p>
<p><strong>æ€»ç»“</strong></p>
<ul>
<li>Hooks çš„æ„ä¹‰å°±æ˜¯å¯ä»¥æ·˜æ±° class ç±»å‹çš„ç»„ä»¶ï¼›</li>
<li>Hooks å°†æ”¹å˜é‡ç”¨ç»„ä»¶é€»è¾‘çš„æ¨¡å¼ï¼›</li>
<li>åœ¨æœªæ¥ï¼ŒHooks å°†æ˜¯ React ä½¿ç”¨çš„ä¸»æµ</li>
</ul>

        
    </article>
    <footer class="cube-excerpt-footer">
        <a class="cube-excerpt-more" href="/2020/04/08/React/React-%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F%E5%92%8C%E6%9C%80%E4%BD%B3%E5%AE%9E%E8%B7%B5%E6%80%BB%E7%BB%93/">Read More</a>
    </footer>
</div>

<div class="cube-excerpt" id="cube-excerpt-React-ç†è§£+ç‰¹æ€§">
    <header class="cube-excerpt-header">
        <h1><a href="/2020/04/05/React/React-%E7%90%86%E8%A7%A3+%E7%89%B9%E6%80%A7/">React-ç†è§£+ç‰¹æ€§</a></h1>
        <div class="cube-excerpt-header-msg">
            <div class="cube-excerpt-date">
                <i class="cube-icon cube-icon-date" aria-hidden="true"></i>
                2020-04-05
            </div>
            <div class="cube-excerpt-tags">
                <i class="cube-icon cube-icon-tag" aria-hidden="true"></i>
                
                <a href="/tags/React/" class="cube-excerpt-tag-link">#React</a>
                
            </div>
        </div>
    </header>
    <article class="cube-excerpt-entry cube-markdown">
        
        
           <h2 id="ä¸€ã€æ˜¯ä»€ä¹ˆ"><a href="#ä¸€ã€æ˜¯ä»€ä¹ˆ" class="headerlink" title="ä¸€ã€æ˜¯ä»€ä¹ˆ"></a>ä¸€ã€æ˜¯ä»€ä¹ˆ</h2><p>Reactï¼Œç”¨äºæ„å»ºç”¨æˆ·ç•Œé¢çš„ JavaScript åº“ï¼Œåªæä¾›äº† UI å±‚é¢çš„è§£å†³æ–¹æ¡ˆ</p>
<p>éµå¾ªç»„ä»¶è®¾è®¡æ¨¡å¼ã€å£°æ˜å¼ç¼–ç¨‹èŒƒå¼å’Œå‡½æ•°å¼ç¼–ç¨‹æ¦‚å¿µï¼Œä»¥ä½¿å‰ç«¯åº”ç”¨ç¨‹åºæ›´é«˜æ•ˆ</p>
<p>ä½¿ç”¨è™šæ‹Ÿ <code>DOM</code> æ¥æœ‰æ•ˆåœ°æ“ä½œ <code>DOM</code>ï¼Œéµå¾ªä»é«˜é˜¶ç»„ä»¶åˆ°ä½é˜¶ç»„ä»¶çš„å•å‘æ•°æ®æµ</p>
<p>å¸®åŠ©æˆ‘ä»¬å°†ç•Œé¢æˆäº†å„ä¸ªç‹¬ç«‹çš„å°å—ï¼Œæ¯ä¸€ä¸ªå—å°±æ˜¯ç»„ä»¶ï¼Œè¿™äº›ç»„ä»¶ä¹‹é—´å¯ä»¥ç»„åˆã€åµŒå¥—ï¼Œæ„æˆæ•´ä½“é¡µé¢</p>
<p><code>react</code> ç±»ç»„ä»¶ä½¿ç”¨ä¸€ä¸ªåä¸º <code>render()</code> çš„æ–¹æ³•æˆ–è€…å‡½æ•°ç»„ä»¶<code>return</code>ï¼Œæ¥æ”¶è¾“å…¥çš„æ•°æ®å¹¶è¿”å›éœ€è¦å±•ç¤ºçš„å†…å®¹</p>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">HelloMessage</span> <span class="keyword">extends</span> <span class="title class_ inherited__">React.Component</span> &#123;</span><br><span class="line">  <span class="title function_">render</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="language-xml"><span class="tag">&lt;<span class="name">div</span>&gt;</span>Hello &#123;this.props.name&#125;<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span>;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="title class_">ReactDOM</span>.<span class="title function_">render</span>(</span><br><span class="line">  <span class="language-xml"><span class="tag">&lt;<span class="name">HelloMessage</span> <span class="attr">name</span>=<span class="string">&quot;Taylor&quot;</span> /&gt;</span></span>,</span><br><span class="line">  <span class="variable language_">document</span>.<span class="title function_">getElementById</span>(<span class="string">&quot;hello-example&quot;</span>)</span><br><span class="line">);</span><br></pre></td></tr></table></figure>

<p>ä¸Šè¿°è¿™ç§ç±»ä¼¼ <code>XML</code> å½¢å¼å°±æ˜¯ <code>JSX</code>ï¼Œæœ€ç»ˆä¼šè¢« <code>babel</code> ç¼–è¯‘ä¸ºåˆæ³•çš„ <code>JS</code> è¯­å¥è°ƒç”¨</p>
<p>è¢«ä¼ å…¥çš„æ•°æ®å¯åœ¨ç»„ä»¶ä¸­é€šè¿‡ <code>this.props</code> åœ¨ <code>render()</code> è®¿é—®</p>
<h2 id="äºŒã€ç‰¹æ€§"><a href="#äºŒã€ç‰¹æ€§" class="headerlink" title="äºŒã€ç‰¹æ€§"></a>äºŒã€ç‰¹æ€§</h2><p><code>React</code> ç‰¹æ€§æœ‰å¾ˆå¤šï¼Œå¦‚ï¼š</p>
<ul>
<li>JSX è¯­æ³•</li>
<li>å•å‘æ•°æ®ç»‘å®š</li>
<li>è™šæ‹Ÿ DOM</li>
<li>å£°æ˜å¼ç¼–ç¨‹</li>
<li>Component</li>
</ul>
<p>ç€é‡ä»‹ç»ä¸‹å£°æ˜å¼ç¼–ç¨‹åŠ Component</p>
<h3 id="å£°æ˜å¼ç¼–ç¨‹"><a href="#å£°æ˜å¼ç¼–ç¨‹" class="headerlink" title="å£°æ˜å¼ç¼–ç¨‹"></a>å£°æ˜å¼ç¼–ç¨‹</h3><p>å£°æ˜å¼ç¼–ç¨‹æ˜¯ä¸€ç§ç¼–ç¨‹èŒƒå¼ï¼Œå®ƒå…³æ³¨çš„æ˜¯ä½ è¦åšä»€ä¹ˆï¼Œè€Œä¸æ˜¯å¦‚ä½•åš</p>
<p>å®ƒè¡¨è¾¾é€»è¾‘è€Œä¸æ˜¾å¼åœ°å®šä¹‰æ­¥éª¤ã€‚è¿™æ„å‘³ç€æˆ‘ä»¬éœ€è¦æ ¹æ®é€»è¾‘çš„è®¡ç®—æ¥å£°æ˜è¦æ˜¾ç¤ºçš„ç»„ä»¶</p>
<p>å¦‚å®ç°ä¸€ä¸ªæ ‡è®°çš„åœ°å›¾ï¼š</p>
<p>é€šè¿‡å‘½ä»¤å¼åˆ›å»ºåœ°å›¾ã€åˆ›å»ºæ ‡è®°ã€ä»¥åŠåœ¨åœ°å›¾ä¸Šæ·»åŠ çš„æ ‡è®°çš„æ­¥éª¤å¦‚ä¸‹ï¼š</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// åˆ›å»ºåœ°å›¾</span></span><br><span class="line"><span class="keyword">const</span> map = <span class="keyword">new</span> <span class="title class_">Map</span>.<span class="title function_">map</span>(<span class="variable language_">document</span>.<span class="title function_">getElementById</span>(<span class="string">&quot;map&quot;</span>), &#123;</span><br><span class="line">  <span class="attr">zoom</span>: <span class="number">4</span>,</span><br><span class="line">  <span class="attr">center</span>: &#123; lat, lng &#125;,</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="comment">// åˆ›å»ºæ ‡è®°</span></span><br><span class="line"><span class="keyword">const</span> marker = <span class="keyword">new</span> <span class="title class_">Map</span>.<span class="title function_">marker</span>(&#123;</span><br><span class="line">  <span class="attr">position</span>: &#123; lat, lng &#125;,</span><br><span class="line">  <span class="attr">title</span>: <span class="string">&quot;Hello Marker&quot;</span>,</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="comment">// åœ°å›¾ä¸Šæ·»åŠ æ ‡è®°</span></span><br><span class="line">marker.<span class="title function_">setMap</span>(map);</span><br></pre></td></tr></table></figure>

<p>è€Œç”¨ <code>React</code> å®ç°ä¸Šè¿°åŠŸèƒ½åˆ™å¦‚ä¸‹ï¼š</p>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&lt;<span class="title class_">Map</span> zoom=&#123;<span class="number">4</span>&#125; center=&#123;(lat, lng)&#125;&gt;</span><br><span class="line">  <span class="language-xml"><span class="tag">&lt;<span class="name">Marker</span> <span class="attr">position</span>=<span class="string">&#123;(lat,</span> <span class="attr">lng</span>)&#125; <span class="attr">title</span>=<span class="string">&#123;</span>&quot;<span class="attr">Hello</span> <span class="attr">Marker</span>&quot;&#125; /&gt;</span></span></span><br><span class="line">&lt;/<span class="title class_">Map</span>&gt;</span><br></pre></td></tr></table></figure>

<p>å£°æ˜å¼ç¼–ç¨‹æ–¹å¼ä½¿å¾— <code>React</code> ç»„ä»¶å¾ˆå®¹æ˜“ä½¿ç”¨ï¼Œæœ€ç»ˆçš„ä»£ç ç®€å•æ˜“äºç»´æŠ¤</p>
<h3 id="Component"><a href="#Component" class="headerlink" title="Component"></a>Component</h3><p>åœ¨ <code>React</code> ä¸­ï¼Œä¸€åˆ‡çš†ä¸ºç»„ä»¶ã€‚é€šå¸¸å°†åº”ç”¨ç¨‹åºçš„æ•´ä¸ªé€»è¾‘åˆ†è§£ä¸ºå°çš„å•ä¸ªéƒ¨åˆ†ã€‚ æˆ‘ä»¬å°†æ¯ä¸ªå•ç‹¬çš„éƒ¨åˆ†ç§°ä¸ºç»„ä»¶</p>
<p>ç»„ä»¶å¯ä»¥æ˜¯ä¸€ä¸ªå‡½æ•°æˆ–è€…æ˜¯ä¸€ä¸ªç±»ï¼Œæ¥å—æ•°æ®è¾“å…¥ï¼Œå¤„ç†å®ƒå¹¶è¿”å›åœ¨ <code>UI</code> ä¸­å‘ˆç°çš„ <code>React</code> å…ƒç´ </p>
<p>å‡½æ•°å¼ç»„ä»¶å¦‚ä¸‹ï¼š</p>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> <span class="title function_">Header</span> = (<span class="params"></span>) =&gt; &#123;</span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    <span class="language-xml"><span class="tag">&lt;<span class="name">Jumbotron</span> <span class="attr">style</span>=<span class="string">&#123;&#123;</span> <span class="attr">backgroundColor:</span> &quot;<span class="attr">orange</span>&quot; &#125;&#125;&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">h1</span>&gt;</span>TODO App<span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;/<span class="name">Jumbotron</span>&gt;</span></span></span><br><span class="line">  );</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<p>ç±»ç»„ä»¶ï¼ˆæœ‰çŠ¶æ€ç»„ä»¶ï¼‰å¦‚ä¸‹ï¼š</p>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Dashboard</span> <span class="keyword">extends</span> <span class="title class_ inherited__">React.Component</span> &#123;</span><br><span class="line">  <span class="title function_">constructor</span>(<span class="params">props</span>) &#123;</span><br><span class="line">    <span class="variable language_">super</span>(props);</span><br><span class="line"></span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">state</span> = &#123;&#125;;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="title function_">render</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> (</span><br><span class="line">      <span class="language-xml"><span class="tag">&lt;<span class="name">div</span> <span class="attr">className</span>=<span class="string">&quot;dashboard&quot;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;<span class="name">ToDoForm</span> /&gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;<span class="name">ToDolist</span> /&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line">    );</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>ä¸€ä¸ªç»„ä»¶è¯¥æœ‰çš„ç‰¹ç‚¹å¦‚ä¸‹ï¼š</p>
<ul>
<li>å¯ç»„åˆï¼šæ¯ä¸ªç»„ä»¶æ˜“äºå’Œå…¶å®ƒç»„ä»¶ä¸€èµ·ä½¿ç”¨ï¼Œæˆ–è€…åµŒå¥—åœ¨å¦ä¸€ä¸ªç»„ä»¶å†…éƒ¨</li>
<li>å¯é‡ç”¨ï¼šæ¯ä¸ªç»„ä»¶éƒ½æ˜¯å…·æœ‰ç‹¬ç«‹åŠŸèƒ½çš„ï¼Œå®ƒå¯ä»¥è¢«ä½¿ç”¨åœ¨å¤šä¸ª UI åœºæ™¯</li>
<li>å¯ç»´æŠ¤ï¼šæ¯ä¸ªå°çš„ç»„ä»¶ä»…ä»…åŒ…å«è‡ªèº«çš„é€»è¾‘ï¼Œæ›´å®¹æ˜“è¢«ç†è§£å’Œç»´æŠ¤</li>
</ul>
<h2 id="ä¸‰ã€ä¼˜åŠ¿"><a href="#ä¸‰ã€ä¼˜åŠ¿" class="headerlink" title="ä¸‰ã€ä¼˜åŠ¿"></a>ä¸‰ã€ä¼˜åŠ¿</h2><p>é€šè¿‡ä¸Šé¢çš„åˆæ­¥äº†è§£ï¼Œå¯ä»¥æ„Ÿå—åˆ° <code>React</code> å­˜åœ¨çš„ä¼˜åŠ¿ï¼š</p>
<ul>
<li>é«˜æ•ˆçµæ´»</li>
<li>å£°æ˜å¼çš„è®¾è®¡ï¼Œç®€å•ä½¿ç”¨</li>
<li>ç»„ä»¶å¼å¼€å‘ï¼Œæé«˜ä»£ç å¤ç”¨ç‡</li>
<li>å•å‘å“åº”çš„æ•°æ®æµä¼šæ¯”åŒå‘ç»‘å®šçš„æ›´å®‰å…¨ï¼Œé€Ÿåº¦æ›´å¿«</li>
</ul>

        
    </article>
    <footer class="cube-excerpt-footer">
        <a class="cube-excerpt-more" href="/2020/04/05/React/React-%E7%90%86%E8%A7%A3+%E7%89%B9%E6%80%A7/">Read More</a>
    </footer>
</div>

<div class="cube-excerpt" id="cube-excerpt-React-ç±»ç»„ä»¶å’Œå‡½æ•°ç»„ä»¶çš„åŒºåˆ«">
    <header class="cube-excerpt-header">
        <h1><a href="/2020/04/02/React/React-%E7%B1%BB%E7%BB%84%E4%BB%B6%E5%87%BD%E6%95%B0%E7%BB%84%E4%BB%B6%E7%9A%84%E5%8C%BA%E5%88%AB/">React-ç±»ç»„ä»¶å’Œå‡½æ•°ç»„ä»¶çš„åŒºåˆ«</a></h1>
        <div class="cube-excerpt-header-msg">
            <div class="cube-excerpt-date">
                <i class="cube-icon cube-icon-date" aria-hidden="true"></i>
                2020-04-02
            </div>
            <div class="cube-excerpt-tags">
                <i class="cube-icon cube-icon-tag" aria-hidden="true"></i>
                
                <a href="/tags/React/" class="cube-excerpt-tag-link">#React</a>
                
            </div>
        </div>
    </header>
    <article class="cube-excerpt-entry cube-markdown">
        
        
           <h2 id="ä¸€ã€ç±»ç»„ä»¶"><a href="#ä¸€ã€ç±»ç»„ä»¶" class="headerlink" title="ä¸€ã€ç±»ç»„ä»¶"></a>ä¸€ã€ç±»ç»„ä»¶</h2><p>ç±»ç»„ä»¶ï¼Œé¡¾åæ€ä¹‰ï¼Œä¹Ÿå°±æ˜¯é€šè¿‡ä½¿ç”¨<code>ES6</code>ç±»çš„ç¼–å†™å½¢å¼å»ç¼–å†™ç»„ä»¶ï¼Œè¯¥ç±»å¿…é¡»ç»§æ‰¿<code>React.Component</code></p>
<p>å¦‚æœæƒ³è¦è®¿é—®çˆ¶ç»„ä»¶ä¼ é€’è¿‡æ¥çš„å‚æ•°ï¼Œå¯é€šè¿‡<code>this.props</code>çš„æ–¹å¼å»è®¿é—®</p>
<p>åœ¨ç»„ä»¶ä¸­å¿…é¡»å®ç°<code>render</code>æ–¹æ³•ï¼Œåœ¨<code>return</code>ä¸­è¿”å›<code>React</code>å¯¹è±¡ï¼Œå¦‚ä¸‹ï¼š</p>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Welcome</span> <span class="keyword">extends</span> <span class="title class_ inherited__">React.Component</span> &#123;</span><br><span class="line">  <span class="title function_">constructor</span>(<span class="params">props</span>) &#123;</span><br><span class="line">    <span class="variable language_">super</span>(props)</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="title function_">render</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="language-xml"><span class="tag">&lt;<span class="name">h1</span>&gt;</span>Hello, &#123;this.props.name&#125;<span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="äºŒã€å‡½æ•°ç»„ä»¶"><a href="#äºŒã€å‡½æ•°ç»„ä»¶" class="headerlink" title="äºŒã€å‡½æ•°ç»„ä»¶"></a>äºŒã€å‡½æ•°ç»„ä»¶</h2><p>å‡½æ•°ç»„ä»¶ï¼Œé¡¾åæ€ä¹‰ï¼Œå°±æ˜¯é€šè¿‡å‡½æ•°ç¼–å†™çš„å½¢å¼å»å®ç°ä¸€ä¸ª<code>React</code>ç»„ä»¶ï¼Œæ˜¯<code>React</code>ä¸­å®šä¹‰ç»„ä»¶æœ€ç®€å•çš„æ–¹å¼</p>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">Welcome</span>(<span class="params">props</span>) &#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="language-xml"><span class="tag">&lt;<span class="name">h1</span>&gt;</span>Hello, &#123;props.name&#125;<span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>å‡½æ•°ç¬¬ä¸€ä¸ªå‚æ•°ä¸º<code>props</code>ç”¨äºæ¥æ”¶çˆ¶ç»„ä»¶ä¼ é€’è¿‡æ¥çš„å‚æ•°</p>
<h2 id="ä¸‰ã€åŒºåˆ«"><a href="#ä¸‰ã€åŒºåˆ«" class="headerlink" title="ä¸‰ã€åŒºåˆ«"></a>ä¸‰ã€åŒºåˆ«</h2><p>é’ˆå¯¹ä¸¤ç§<code>React</code>ç»„ä»¶ï¼Œå…¶åŒºåˆ«ä¸»è¦åˆ†æˆä»¥ä¸‹å‡ å¤§æ–¹å‘ï¼š</p>
<ul>
<li>ç¼–å†™å½¢å¼</li>
<li>çŠ¶æ€ç®¡ç†</li>
<li>ç”Ÿå‘½å‘¨æœŸ</li>
<li>è°ƒç”¨æ–¹å¼</li>
<li>è·å–æ¸²æŸ“çš„å€¼</li>
</ul>
<h3 id="ç¼–å†™å½¢å¼"><a href="#ç¼–å†™å½¢å¼" class="headerlink" title="ç¼–å†™å½¢å¼"></a>ç¼–å†™å½¢å¼</h3><p>ä¸¤è€…æœ€æ˜æ˜¾çš„åŒºåˆ«åœ¨äºç¼–å†™å½¢å¼çš„ä¸åŒï¼ŒåŒä¸€ç§åŠŸèƒ½çš„å®ç°å¯ä»¥åˆ†åˆ«å¯¹åº”ç±»ç»„ä»¶å’Œå‡½æ•°ç»„ä»¶çš„ç¼–å†™å½¢å¼</p>
<p>å‡½æ•°ç»„ä»¶ï¼š</p>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">Welcome</span>(<span class="params">props</span>) &#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="language-xml"><span class="tag">&lt;<span class="name">h1</span>&gt;</span>Hello, &#123;props.name&#125;<span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>ç±»ç»„ä»¶ï¼š</p>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Welcome</span> <span class="keyword">extends</span> <span class="title class_ inherited__">React.Component</span> &#123;</span><br><span class="line">  <span class="title function_">constructor</span>(<span class="params">props</span>) &#123;</span><br><span class="line">    <span class="variable language_">super</span>(props)</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="title function_">render</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="language-xml"><span class="tag">&lt;<span class="name">h1</span>&gt;</span>Hello, &#123;this.props.name&#125;<span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="çŠ¶æ€ç®¡ç†"><a href="#çŠ¶æ€ç®¡ç†" class="headerlink" title="çŠ¶æ€ç®¡ç†"></a>çŠ¶æ€ç®¡ç†</h3><p>åœ¨<code>hooks</code>å‡ºæ¥ä¹‹å‰ï¼Œå‡½æ•°ç»„ä»¶å°±æ˜¯æ— çŠ¶æ€ç»„ä»¶ï¼Œä¸èƒ½ä¿ç®¡ç»„ä»¶çš„çŠ¶æ€ï¼Œä¸åƒç±»ç»„ä»¶ä¸­è°ƒç”¨<code>setState</code></p>
<p>å¦‚æœæƒ³è¦ç®¡ç†<code>state</code>çŠ¶æ€ï¼Œå¯ä»¥ä½¿ç”¨<code>useState</code>ï¼Œå¦‚ä¸‹ï¼š</p>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> <span class="title function_">FunctionalComponent</span> = (<span class="params"></span>) =&gt; &#123;</span><br><span class="line">    <span class="keyword">const</span> [count, setCount] = <span class="title class_">React</span>.<span class="title function_">useState</span>(<span class="number">0</span>);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> (</span><br><span class="line">        <span class="language-xml"><span class="tag">&lt;<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">            <span class="tag">&lt;<span class="name">p</span>&gt;</span>count: &#123;count&#125;&lt;/p &gt;</span></span><br><span class="line"><span class="language-xml">            <span class="tag">&lt;<span class="name">button</span> <span class="attr">onClick</span>=<span class="string">&#123;()</span> =&gt;</span> setCount(count + 1)&#125;&gt;Click<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">    );</span></span><br><span class="line"><span class="language-xml">&#125;;</span></span><br></pre></td></tr></table></figure>

<p>åœ¨ä½¿ç”¨<code>hooks</code>æƒ…å†µä¸‹ï¼Œä¸€èˆ¬å¦‚æœå‡½æ•°ç»„ä»¶è°ƒç”¨<code>state</code>ï¼Œåˆ™éœ€è¦åˆ›å»ºä¸€ä¸ªç±»ç»„ä»¶æˆ–è€…<code>state</code>æå‡åˆ°ä½ çš„çˆ¶ç»„ä»¶ä¸­ï¼Œç„¶åé€šè¿‡<code>props</code>å¯¹è±¡ä¼ é€’åˆ°å­ç»„ä»¶</p>
<h3 id="ç”Ÿå‘½å‘¨æœŸ"><a href="#ç”Ÿå‘½å‘¨æœŸ" class="headerlink" title="ç”Ÿå‘½å‘¨æœŸ"></a>ç”Ÿå‘½å‘¨æœŸ</h3><p>åœ¨å‡½æ•°ç»„ä»¶ä¸­ï¼Œå¹¶ä¸å­˜åœ¨ç”Ÿå‘½å‘¨æœŸï¼Œè¿™æ˜¯å› ä¸ºè¿™äº›ç”Ÿå‘½å‘¨æœŸé’©å­éƒ½æ¥è‡ªäºç»§æ‰¿çš„<code>React.Component</code></p>
<p>æ‰€ä»¥ï¼Œå¦‚æœç”¨åˆ°ç”Ÿå‘½å‘¨æœŸï¼Œå°±åªèƒ½ä½¿ç”¨ç±»ç»„ä»¶</p>
<p>ä½†æ˜¯å‡½æ•°ç»„ä»¶ä½¿ç”¨<code>useEffect</code>ä¹Ÿèƒ½å¤Ÿå®Œæˆæ›¿ä»£ç”Ÿå‘½å‘¨æœŸçš„ä½œç”¨ï¼Œè¿™é‡Œç»™å‡ºä¸€ä¸ªç®€å•çš„ä¾‹å­ï¼š</p>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> <span class="title function_">FunctionalComponent</span> = (<span class="params"></span>) =&gt; &#123;</span><br><span class="line">    <span class="title function_">useEffect</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;Hello&quot;</span>);</span><br><span class="line">    &#125;, []);</span><br><span class="line">    <span class="keyword">return</span> <span class="language-xml"><span class="tag">&lt;<span class="name">h1</span>&gt;</span>Hello, World<span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span>;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<p>ä¸Šè¿°ç®€å•çš„ä¾‹å­å¯¹åº”ç±»ç»„ä»¶ä¸­çš„<code>componentDidMount</code>ç”Ÿå‘½å‘¨æœŸ</p>
<p>å¦‚æœåœ¨<code>useEffect</code>å›è°ƒå‡½æ•°ä¸­<code>return</code>ä¸€ä¸ªå‡½æ•°ï¼Œåˆ™<code>return</code>å‡½æ•°ä¼šåœ¨ç»„ä»¶å¸è½½çš„æ—¶å€™æ‰§è¡Œï¼Œæ­£å¦‚<code>componentWillUnmount</code></p>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> <span class="title function_">FunctionalComponent</span> = (<span class="params"></span>) =&gt; &#123;</span><br><span class="line"> <span class="title class_">React</span>.<span class="title function_">useEffect</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">   <span class="keyword">return</span> <span class="function">() =&gt;</span> &#123;</span><br><span class="line">     <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;Bye&quot;</span>);</span><br><span class="line">   &#125;;</span><br><span class="line"> &#125;, []);</span><br><span class="line"> <span class="keyword">return</span> <span class="language-xml"><span class="tag">&lt;<span class="name">h1</span>&gt;</span>Bye, World<span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span>;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<h3 id="è°ƒç”¨æ–¹å¼"><a href="#è°ƒç”¨æ–¹å¼" class="headerlink" title="è°ƒç”¨æ–¹å¼"></a>è°ƒç”¨æ–¹å¼</h3><p>å¦‚æœæ˜¯ä¸€ä¸ªå‡½æ•°ç»„ä»¶ï¼Œè°ƒç”¨åˆ™æ˜¯æ‰§è¡Œå‡½æ•°å³å¯ï¼š</p>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// ä½ çš„ä»£ç  </span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">SayHi</span>(<span class="params"></span>) &#123; </span><br><span class="line">    <span class="keyword">return</span> &lt;p&gt;Hello, React&lt;/p &gt; </span><br><span class="line">&#125; </span><br><span class="line">// Reactå†…éƒ¨ </span><br><span class="line">const result = SayHi(props) // Â» &lt;p&gt;Hello, React&lt;/p &gt;</span><br></pre></td></tr></table></figure>

<p>å¦‚æœæ˜¯ä¸€ä¸ªç±»ç»„ä»¶ï¼Œåˆ™éœ€è¦å°†ç»„ä»¶è¿›è¡Œå®ä¾‹åŒ–ï¼Œç„¶åè°ƒç”¨å®ä¾‹å¯¹è±¡çš„<code>render</code>æ–¹æ³•ï¼š</p>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// ä½ çš„ä»£ç  </span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">SayHi</span> <span class="keyword">extends</span> <span class="title class_ inherited__">React.Component</span> &#123; </span><br><span class="line">    <span class="title function_">render</span>(<span class="params"></span>) &#123; </span><br><span class="line">        <span class="keyword">return</span> &lt;p&gt;Hello, React&lt;/p &gt; </span><br><span class="line">    &#125; </span><br><span class="line">&#125; </span><br><span class="line">// Reactå†…éƒ¨ </span><br><span class="line">const instance = new SayHi(props) // Â» SayHi &#123;&#125; </span><br><span class="line">const result = instance.render() // Â» &lt;p&gt;Hello, React&lt;/p &gt;</span><br></pre></td></tr></table></figure>

<h3 id="è·å–æ¸²æŸ“çš„å€¼"><a href="#è·å–æ¸²æŸ“çš„å€¼" class="headerlink" title="è·å–æ¸²æŸ“çš„å€¼"></a>è·å–æ¸²æŸ“çš„å€¼</h3><p>é¦–å…ˆç»™å‡ºä¸€ä¸ªç¤ºä¾‹</p>
<p>å‡½æ•°ç»„ä»¶å¯¹åº”å¦‚ä¸‹ï¼š</p>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">ProfilePage</span>(<span class="params">props</span>) &#123;</span><br><span class="line">  <span class="keyword">const</span> <span class="title function_">showMessage</span> = (<span class="params"></span>) =&gt; &#123;</span><br><span class="line">    <span class="title function_">alert</span>(<span class="string">&#x27;Followed &#x27;</span> + props.<span class="property">user</span>);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">const</span> <span class="title function_">handleClick</span> = (<span class="params"></span>) =&gt; &#123;</span><br><span class="line">    <span class="built_in">setTimeout</span>(showMessage, <span class="number">3000</span>);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    <span class="language-xml"><span class="tag">&lt;<span class="name">button</span> <span class="attr">onClick</span>=<span class="string">&#123;handleClick&#125;</span>&gt;</span>Follow<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span></span><br><span class="line">  )</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>ç±»ç»„ä»¶å¯¹åº”å¦‚ä¸‹ï¼š</p>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">ProfilePage</span> <span class="keyword">extends</span> <span class="title class_ inherited__">React.Component</span> &#123;</span><br><span class="line">  <span class="title function_">showMessage</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="title function_">alert</span>(<span class="string">&#x27;Followed &#x27;</span> + <span class="variable language_">this</span>.<span class="property">props</span>.<span class="property">user</span>);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="title function_">handleClick</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="built_in">setTimeout</span>(<span class="variable language_">this</span>.<span class="property">showMessage</span>.<span class="title function_">bind</span>(<span class="variable language_">this</span>), <span class="number">3000</span>);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="title function_">render</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="language-xml"><span class="tag">&lt;<span class="name">button</span> <span class="attr">onClick</span>=<span class="string">&#123;this.handleClick.bind(this)&#125;</span>&gt;</span>Follow<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>ä¸¤è€…çœ‹èµ·æ¥å®ç°åŠŸèƒ½æ˜¯ä¸€è‡´çš„ï¼Œä½†æ˜¯åœ¨ç±»ç»„ä»¶ä¸­ï¼Œè¾“å‡º<code>this.props.user</code>ï¼Œ<code>Props</code>åœ¨ <code>React</code>ä¸­æ˜¯ä¸å¯å˜çš„æ‰€ä»¥å®ƒæ°¸è¿œä¸ä¼šæ”¹å˜ï¼Œä½†æ˜¯ <code>this</code> æ€»æ˜¯å¯å˜çš„ï¼Œä»¥ä¾¿æ‚¨å¯ä»¥åœ¨ <code>render</code> å’Œç”Ÿå‘½å‘¨æœŸå‡½æ•°ä¸­è¯»å–æ–°ç‰ˆæœ¬</p>
<p>å› æ­¤ï¼Œå¦‚æœæˆ‘ä»¬çš„ç»„ä»¶åœ¨è¯·æ±‚è¿è¡Œæ—¶æ›´æ–°ã€‚<code>this.props</code> å°†ä¼šæ”¹å˜ã€‚<code>showMessage</code>æ–¹æ³•ä»â€œæœ€æ–°â€çš„ <code>props</code> ä¸­è¯»å– <code>user</code></p>
<p>è€Œå‡½æ•°ç»„ä»¶ï¼Œæœ¬èº«å°±ä¸å­˜åœ¨<code>this</code>ï¼Œ<code>props</code>å¹¶ä¸å‘ç”Ÿæ”¹å˜ï¼Œå› æ­¤åŒæ ·æ˜¯ç‚¹å‡»ï¼Œ<code>alert</code>çš„å†…å®¹ä»æ—§æ˜¯ä¹‹å‰çš„å†…å®¹</p>
<h3 id="å°ç»“"><a href="#å°ç»“" class="headerlink" title="å°ç»“"></a>å°ç»“</h3><p>ä¸¤ç§ç»„ä»¶éƒ½æœ‰å„è‡ªçš„ä¼˜ç¼ºç‚¹</p>
<p>å‡½æ•°ç»„ä»¶è¯­æ³•æ›´çŸ­ã€æ›´ç®€å•ï¼Œè¿™ä½¿å¾—å®ƒæ›´å®¹æ˜“å¼€å‘ã€ç†è§£å’Œæµ‹è¯•</p>
<p>è€Œç±»ç»„ä»¶ä¹Ÿä¼šå› å¤§é‡ä½¿ç”¨ <code>this</code>è€Œè®©äººæ„Ÿåˆ°å›°æƒ‘</p>

        
    </article>
    <footer class="cube-excerpt-footer">
        <a class="cube-excerpt-more" href="/2020/04/02/React/React-%E7%B1%BB%E7%BB%84%E4%BB%B6%E5%87%BD%E6%95%B0%E7%BB%84%E4%BB%B6%E7%9A%84%E5%8C%BA%E5%88%AB/">Read More</a>
    </footer>
</div>

<div class="cube-excerpt" id="cube-excerpt-React-è¿‡æ¸¡åŠ¨ç”»">
    <header class="cube-excerpt-header">
        <h1><a href="/2020/03/29/React/React-%E8%BF%87%E6%B8%A1%E5%8A%A8%E7%94%BB/">React-è¿‡æ¸¡åŠ¨ç”»</a></h1>
        <div class="cube-excerpt-header-msg">
            <div class="cube-excerpt-date">
                <i class="cube-icon cube-icon-date" aria-hidden="true"></i>
                2020-03-29
            </div>
            <div class="cube-excerpt-tags">
                <i class="cube-icon cube-icon-tag" aria-hidden="true"></i>
                
                <a href="/tags/React/" class="cube-excerpt-tag-link">#React</a>
                
            </div>
        </div>
    </header>
    <article class="cube-excerpt-entry cube-markdown">
        
        
           <h2 id="ä¸€ã€æ˜¯ä»€ä¹ˆ"><a href="#ä¸€ã€æ˜¯ä»€ä¹ˆ" class="headerlink" title="ä¸€ã€æ˜¯ä»€ä¹ˆ"></a>ä¸€ã€æ˜¯ä»€ä¹ˆ</h2><p>åœ¨æ—¥å¸¸å¼€å‘ä¸­ï¼Œé¡µé¢åˆ‡æ¢æ—¶çš„è½¬åœºåŠ¨ç”»æ˜¯æ¯”è¾ƒåŸºç¡€çš„ä¸€ä¸ªåœºæ™¯</p>
<p>å½“ä¸€ä¸ªç»„ä»¶åœ¨æ˜¾ç¤ºä¸æ¶ˆå¤±è¿‡ç¨‹ä¸­å­˜åœ¨è¿‡æ¸¡åŠ¨ç”»ï¼Œå¯ä»¥å¾ˆå¥½çš„å¢åŠ ç”¨æˆ·çš„ä½“éªŒ</p>
<p>åœ¨<code>react</code>ä¸­å®ç°è¿‡æ¸¡åŠ¨ç”»æ•ˆæœä¼šæœ‰å¾ˆå¤šç§é€‰æ‹©ï¼Œå¦‚<code>react-transition-group</code>ï¼Œ<code>react-motion</code>ï¼Œ<code>Animated</code>ï¼Œä»¥åŠåŸç”Ÿçš„<code>CSS</code>éƒ½èƒ½å®Œæˆåˆ‡æ¢åŠ¨ç”»</p>
<h2 id="äºŒã€å¦‚ä½•å®ç°"><a href="#äºŒã€å¦‚ä½•å®ç°" class="headerlink" title="äºŒã€å¦‚ä½•å®ç°"></a>äºŒã€å¦‚ä½•å®ç°</h2><p>åœ¨<code>react</code>ä¸­ï¼Œ<code>react-transition-group</code>æ˜¯ä¸€ç§å¾ˆå¥½çš„è§£å†³æ–¹æ¡ˆï¼Œå…¶ä¸ºå…ƒç´ æ·»åŠ <code>enter</code>ï¼Œ<code>enter-active</code>ï¼Œ<code>exit</code>ï¼Œ<code>exit-active</code>è¿™ä¸€ç³»åˆ—å‹¾å­</p>
<p>å¯ä»¥å¸®åŠ©æˆ‘ä»¬æ–¹ä¾¿çš„å®ç°ç»„ä»¶çš„å…¥åœºå’Œç¦»åœºåŠ¨ç”»</p>
<p>å…¶ä¸»è¦æä¾›äº†ä¸‰ä¸ªä¸»è¦çš„ç»„ä»¶ï¼š</p>
<ul>
<li>CSSTransitionï¼šåœ¨å‰ç«¯å¼€å‘ä¸­ï¼Œç»“åˆ CSS æ¥å®Œæˆè¿‡æ¸¡åŠ¨ç”»æ•ˆæœ</li>
<li>SwitchTransitionï¼šä¸¤ä¸ªç»„ä»¶æ˜¾ç¤ºå’Œéšè—åˆ‡æ¢æ—¶ï¼Œä½¿ç”¨è¯¥ç»„ä»¶</li>
<li>TransitionGroupï¼šå°†å¤šä¸ªåŠ¨ç”»ç»„ä»¶åŒ…è£¹åœ¨å…¶ä¸­ï¼Œä¸€èˆ¬ç”¨äºåˆ—è¡¨ä¸­å…ƒç´ çš„åŠ¨ç”»</li>
</ul>
<h3 id="CSSTransition"><a href="#CSSTransition" class="headerlink" title="CSSTransition"></a>CSSTransition</h3><p>å…¶å®ç°åŠ¨ç”»çš„åŸç†åœ¨äºï¼Œå½“<code>CSSTransition</code>çš„<code>in</code>å±æ€§ç½®ä¸º<code>true</code>æ—¶ï¼Œ<code>CSSTransition</code>é¦–å…ˆä¼šç»™å…¶å­ç»„ä»¶åŠ ä¸Š<code>xxx-enter</code>ã€<code>xxx-enter-active</code>çš„<code>class</code>æ‰§è¡ŒåŠ¨ç”»</p>
<p>å½“åŠ¨ç”»æ‰§è¡Œç»“æŸåï¼Œä¼šç§»é™¤ä¸¤ä¸ª<code>class</code>ï¼Œå¹¶ä¸”æ·»åŠ <code>-enter-done</code>çš„<code>class</code></p>
<p>æ‰€ä»¥å¯ä»¥åˆ©ç”¨è¿™ä¸€ç‚¹ï¼Œé€šè¿‡<code>css</code>çš„<code>transition</code>å±æ€§ï¼Œè®©å…ƒç´ åœ¨ä¸¤ä¸ªçŠ¶æ€ä¹‹é—´å¹³æ»‘è¿‡æ¸¡ï¼Œä»è€Œå¾—åˆ°ç›¸åº”çš„åŠ¨ç”»æ•ˆæœ</p>
<p>å½“<code>in</code>å±æ€§ç½®ä¸º<code>false</code>æ—¶ï¼Œ<code>CSSTransition</code>ä¼šç»™å­ç»„ä»¶åŠ ä¸Š<code>xxx-exit</code>å’Œ<code>xxx-exit-active</code>çš„<code>class</code>ï¼Œç„¶åå¼€å§‹æ‰§è¡ŒåŠ¨ç”»ï¼Œå½“åŠ¨ç”»ç»“æŸåï¼Œç§»é™¤ä¸¤ä¸ª<code>class</code>ï¼Œç„¶åæ·»åŠ <code>-enter-done</code>çš„<code>class</code></p>
<p>å¦‚ä¸‹ä¾‹å­ï¼š</p>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="keyword">class</span> <span class="title class_">App2</span> <span class="keyword">extends</span> <span class="title class_ inherited__">React.PureComponent</span> &#123;</span><br><span class="line"></span><br><span class="line">  state = &#123;<span class="attr">show</span>: <span class="literal">true</span>&#125;;</span><br><span class="line"></span><br><span class="line">  onToggle = <span class="function">() =&gt;</span> <span class="variable language_">this</span>.<span class="title function_">setState</span>(&#123;<span class="attr">show</span>: !<span class="variable language_">this</span>.<span class="property">state</span>.<span class="property">show</span>&#125;);</span><br><span class="line"></span><br><span class="line">  <span class="title function_">render</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">const</span> &#123;show&#125; = <span class="variable language_">this</span>.<span class="property">state</span>;</span><br><span class="line">    <span class="keyword">return</span> (</span><br><span class="line">      <span class="language-xml"><span class="tag">&lt;<span class="name">div</span> <span class="attr">className</span>=<span class="string">&#123;</span>&#x27;<span class="attr">container</span>&#x27;&#125;&gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;<span class="name">div</span> <span class="attr">className</span>=<span class="string">&#123;</span>&#x27;<span class="attr">square-wrapper</span>&#x27;&#125;&gt;</span></span></span><br><span class="line"><span class="language-xml">          <span class="tag">&lt;<span class="name">CSSTransition</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">            <span class="attr">in</span>=<span class="string">&#123;show&#125;</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">            <span class="attr">timeout</span>=<span class="string">&#123;500&#125;</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">            <span class="attr">classNames</span>=<span class="string">&#123;</span>&#x27;<span class="attr">fade</span>&#x27;&#125;</span></span></span><br><span class="line"><span class="tag"><span class="language-xml">            <span class="attr">unmountOnExit</span>=<span class="string">&#123;true&#125;</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">          &gt;</span></span></span><br><span class="line"><span class="language-xml">            <span class="tag">&lt;<span class="name">div</span> <span class="attr">className</span>=<span class="string">&#123;</span>&#x27;<span class="attr">square</span>&#x27;&#125; /&gt;</span></span></span><br><span class="line"><span class="language-xml">          <span class="tag">&lt;/<span class="name">CSSTransition</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;<span class="name">Button</span> <span class="attr">onClick</span>=<span class="string">&#123;this.onToggle&#125;</span>&gt;</span>toggle<span class="tag">&lt;/<span class="name">Button</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line">    );</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>å¯¹åº”<code>css</code>æ ·å¼å¦‚ä¸‹ï¼š</p>
<figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-class">.fade-enter</span> &#123;</span><br><span class="line">  <span class="attribute">opacity</span>: <span class="number">0</span>;</span><br><span class="line">  <span class="attribute">transform</span>: <span class="built_in">translateX</span>(<span class="number">100%</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-class">.fade-enter-active</span> &#123;</span><br><span class="line">  <span class="attribute">opacity</span>: <span class="number">1</span>;</span><br><span class="line">  <span class="attribute">transform</span>: <span class="built_in">translateX</span>(<span class="number">0</span>);</span><br><span class="line">  <span class="attribute">transition</span>: all <span class="number">500ms</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-class">.fade-exit</span> &#123;</span><br><span class="line">  <span class="attribute">opacity</span>: <span class="number">1</span>;</span><br><span class="line">  <span class="attribute">transform</span>: <span class="built_in">translateX</span>(<span class="number">0</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-class">.fade-exit-active</span> &#123;</span><br><span class="line">  <span class="attribute">opacity</span>: <span class="number">0</span>;</span><br><span class="line">  <span class="attribute">transform</span>: <span class="built_in">translateX</span>(-<span class="number">100%</span>);</span><br><span class="line">  <span class="attribute">transition</span>: all <span class="number">500ms</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="SwitchTransition"><a href="#SwitchTransition" class="headerlink" title="SwitchTransition"></a>SwitchTransition</h3><p><code>SwitchTransition</code>å¯ä»¥å®Œæˆä¸¤ä¸ªç»„ä»¶ä¹‹é—´åˆ‡æ¢çš„ç‚«é…·åŠ¨ç”»</p>
<p>æ¯”å¦‚æœ‰ä¸€ä¸ªæŒ‰é’®éœ€è¦åœ¨<code>on</code>å’Œ<code>off</code>ä¹‹é—´åˆ‡æ¢ï¼Œæˆ‘ä»¬å¸Œæœ›çœ‹åˆ°<code>on</code>å…ˆä»å·¦ä¾§é€€å‡ºï¼Œ<code>off</code>å†ä»å³ä¾§è¿›å…¥</p>
<p><code>SwitchTransition</code>ä¸­ä¸»è¦æœ‰ä¸€ä¸ªå±æ€§<code>mode</code>ï¼Œå¯¹åº”ä¸¤ä¸ªå€¼ï¼š</p>
<ul>
<li>in-outï¼šè¡¨ç¤ºæ–°ç»„ä»¶å…ˆè¿›å…¥ï¼Œæ—§ç»„ä»¶å†ç§»é™¤ï¼›</li>
<li>out-inï¼šè¡¨ç¤ºå°±ç»„ä»¶å…ˆç§»é™¤ï¼Œæ–°ç»„å»ºå†è¿›å…¥</li>
</ul>
<p><code>SwitchTransition</code>ç»„ä»¶é‡Œé¢è¦æœ‰<code>CSSTransition</code>ï¼Œä¸èƒ½ç›´æ¥åŒ…è£¹ä½ æƒ³è¦åˆ‡æ¢çš„ç»„ä»¶</p>
<p>é‡Œé¢çš„<code>CSSTransition</code>ç»„ä»¶ä¸å†åƒä»¥å‰é‚£æ ·æ¥å—<code>in</code>å±æ€§æ¥åˆ¤æ–­å…ƒç´ æ˜¯ä½•ç§çŠ¶æ€ï¼Œå–è€Œä»£ä¹‹çš„æ˜¯<code>key</code>å±æ€§</p>
<p>ä¸‹é¢ç»™å‡ºä¸€ä¸ªæŒ‰é’®å…¥åœºå’Œå‡ºåœºçš„ç¤ºä¾‹ï¼Œå¦‚ä¸‹ï¼š</p>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; <span class="title class_">SwitchTransition</span>, <span class="title class_">CSSTransition</span> &#125; <span class="keyword">from</span> <span class="string">&quot;react-transition-group&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="keyword">class</span> <span class="title class_">SwitchAnimation</span> <span class="keyword">extends</span> <span class="title class_ inherited__">PureComponent</span> &#123;</span><br><span class="line">  <span class="title function_">constructor</span>(<span class="params">props</span>) &#123;</span><br><span class="line">    <span class="variable language_">super</span>(props);</span><br><span class="line"></span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">state</span> = &#123;</span><br><span class="line">      <span class="attr">isOn</span>: <span class="literal">true</span></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="title function_">render</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">const</span> &#123;isOn&#125; = <span class="variable language_">this</span>.<span class="property">state</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> (</span><br><span class="line">      <span class="language-xml"><span class="tag">&lt;<span class="name">SwitchTransition</span> <span class="attr">mode</span>=<span class="string">&quot;out-in&quot;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;<span class="name">CSSTransition</span> <span class="attr">classNames</span>=<span class="string">&quot;btn&quot;</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">                       <span class="attr">timeout</span>=<span class="string">&#123;500&#125;</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">                       <span class="attr">key</span>=<span class="string">&#123;isOn</span> ? &quot;<span class="attr">on</span>&quot; <span class="attr">:</span> &quot;<span class="attr">off</span>&quot;&#125;&gt;</span></span></span><br><span class="line"><span class="language-xml">          &#123;</span></span><br><span class="line"><span class="language-xml">          <span class="tag">&lt;<span class="name">button</span> <span class="attr">onClick</span>=<span class="string">&#123;this.btnClick.bind(this)&#125;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">            &#123;isOn ? &quot;on&quot;: &quot;off&quot;&#125;</span></span><br><span class="line"><span class="language-xml">          <span class="tag">&lt;/<span class="name">button</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">        &#125;</span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;/<span class="name">CSSTransition</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;/<span class="name">SwitchTransition</span>&gt;</span></span></span><br><span class="line">    )</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="title function_">btnClick</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="title function_">setState</span>(&#123;<span class="attr">isOn</span>: !<span class="variable language_">this</span>.<span class="property">state</span>.<span class="property">isOn</span>&#125;)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><code>css</code>æ–‡ä»¶å¯¹åº”å¦‚ä¸‹ï¼š</p>
<figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-class">.btn-enter</span> &#123;</span><br><span class="line">  <span class="attribute">transform</span>: <span class="built_in">translate</span>(<span class="number">100%</span>, <span class="number">0</span>);</span><br><span class="line">  <span class="attribute">opacity</span>: <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-class">.btn-enter-active</span> &#123;</span><br><span class="line">  <span class="attribute">transform</span>: <span class="built_in">translate</span>(<span class="number">0</span>, <span class="number">0</span>);</span><br><span class="line">  <span class="attribute">opacity</span>: <span class="number">1</span>;</span><br><span class="line">  <span class="attribute">transition</span>: all <span class="number">500ms</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-class">.btn-exit</span> &#123;</span><br><span class="line">  <span class="attribute">transform</span>: <span class="built_in">translate</span>(<span class="number">0</span>, <span class="number">0</span>);</span><br><span class="line">  <span class="attribute">opacity</span>: <span class="number">1</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-class">.btn-exit-active</span> &#123;</span><br><span class="line">  <span class="attribute">transform</span>: <span class="built_in">translate</span>(-<span class="number">100%</span>, <span class="number">0</span>);</span><br><span class="line">  <span class="attribute">opacity</span>: <span class="number">0</span>;</span><br><span class="line">  <span class="attribute">transition</span>: all <span class="number">500ms</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="TransitionGroup"><a href="#TransitionGroup" class="headerlink" title="TransitionGroup"></a>TransitionGroup</h3><p>å½“æœ‰ä¸€ç»„åŠ¨ç”»çš„æ—¶å€™ï¼Œå°±å¯å°†è¿™äº›<code>CSSTransition</code>æ”¾å…¥åˆ°ä¸€ä¸ª<code>TransitionGroup</code>ä¸­æ¥å®ŒæˆåŠ¨ç”»</p>
<p>åŒæ ·<code>CSSTransition</code>é‡Œé¢æ²¡æœ‰<code>in</code>å±æ€§ï¼Œç”¨åˆ°äº†<code>key</code>å±æ€§</p>
<p><code>TransitionGroup</code>åœ¨æ„ŸçŸ¥<code>children</code>å‘ç”Ÿå˜åŒ–çš„æ—¶å€™ï¼Œå…ˆä¿å­˜ç§»é™¤çš„èŠ‚ç‚¹ï¼Œå½“åŠ¨ç”»ç»“æŸåæ‰çœŸæ­£ç§»é™¤</p>
<p>å…¶å¤„ç†æ–¹å¼å¦‚ä¸‹ï¼š</p>
<ul>
<li>æ’å…¥çš„èŠ‚ç‚¹ï¼Œå…ˆæ¸²æŸ“domï¼Œç„¶åå†åšåŠ¨ç”»</li>
<li>åˆ é™¤çš„èŠ‚ç‚¹ï¼Œå…ˆåšåŠ¨ç”»ï¼Œç„¶åå†åˆ é™¤dom</li>
</ul>
<p>å¦‚ä¸‹ï¼š</p>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> <span class="title class_">React</span>, &#123; <span class="title class_">PureComponent</span> &#125; <span class="keyword">from</span> <span class="string">&#x27;react&#x27;</span></span><br><span class="line"><span class="keyword">import</span> &#123; <span class="title class_">CSSTransition</span>, <span class="title class_">TransitionGroup</span> &#125; <span class="keyword">from</span> <span class="string">&#x27;react-transition-group&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="keyword">class</span> <span class="title class_">GroupAnimation</span> <span class="keyword">extends</span> <span class="title class_ inherited__">PureComponent</span> &#123;</span><br><span class="line">  <span class="title function_">constructor</span>(<span class="params">props</span>) &#123;</span><br><span class="line">    <span class="variable language_">super</span>(props);</span><br><span class="line"></span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">state</span> = &#123;</span><br><span class="line">      <span class="attr">friends</span>: []</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="title function_">render</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> (</span><br><span class="line">      <span class="language-xml"><span class="tag">&lt;<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;<span class="name">TransitionGroup</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">          &#123;</span></span><br><span class="line"><span class="language-xml">            this.state.friends.map((item, index) =&gt; &#123;</span></span><br><span class="line"><span class="language-xml">              return (</span></span><br><span class="line"><span class="language-xml">                <span class="tag">&lt;<span class="name">CSSTransition</span> <span class="attr">classNames</span>=<span class="string">&quot;friend&quot;</span> <span class="attr">timeout</span>=<span class="string">&#123;300&#125;</span> <span class="attr">key</span>=<span class="string">&#123;index&#125;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">                  <span class="tag">&lt;<span class="name">div</span>&gt;</span>&#123;item&#125;<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">                <span class="tag">&lt;/<span class="name">CSSTransition</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">              )</span></span><br><span class="line"><span class="language-xml">            &#125;)</span></span><br><span class="line"><span class="language-xml">          &#125;</span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;/<span class="name">TransitionGroup</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;<span class="name">button</span> <span class="attr">onClick</span>=<span class="string">&#123;e</span> =&gt;</span> this.addFriend()&#125;&gt;+friend<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line">    )</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="title function_">addFriend</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="title function_">setState</span>(&#123;</span><br><span class="line">      <span class="attr">friends</span>: [...<span class="variable language_">this</span>.<span class="property">state</span>.<span class="property">friends</span>, <span class="string">&quot;coderwhy&quot;</span>]</span><br><span class="line">    &#125;)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>å¯¹åº”<code>css</code>å¦‚ä¸‹ï¼š</p>
<figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-class">.friend-enter</span> &#123;</span><br><span class="line">    <span class="attribute">transform</span>: <span class="built_in">translate</span>(<span class="number">100%</span>, <span class="number">0</span>);</span><br><span class="line">    <span class="attribute">opacity</span>: <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-class">.friend-enter-active</span> &#123;</span><br><span class="line">    <span class="attribute">transform</span>: <span class="built_in">translate</span>(<span class="number">0</span>, <span class="number">0</span>);</span><br><span class="line">    <span class="attribute">opacity</span>: <span class="number">1</span>;</span><br><span class="line">    <span class="attribute">transition</span>: all <span class="number">500ms</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-class">.friend-exit</span> &#123;</span><br><span class="line">    <span class="attribute">transform</span>: <span class="built_in">translate</span>(<span class="number">0</span>, <span class="number">0</span>);</span><br><span class="line">    <span class="attribute">opacity</span>: <span class="number">1</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-class">.friend-exit-active</span> &#123;</span><br><span class="line">    <span class="attribute">transform</span>: <span class="built_in">translate</span>(-<span class="number">100%</span>, <span class="number">0</span>);</span><br><span class="line">    <span class="attribute">opacity</span>: <span class="number">0</span>;</span><br><span class="line">    <span class="attribute">transition</span>: all <span class="number">500ms</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
        
    </article>
    <footer class="cube-excerpt-footer">
        <a class="cube-excerpt-more" href="/2020/03/29/React/React-%E8%BF%87%E6%B8%A1%E5%8A%A8%E7%94%BB/">Read More</a>
    </footer>
</div>

<div class="cube-excerpt" id="cube-excerpt-React-æ„å»ºç»„ä»¶çš„æ–¹å¼">
    <header class="cube-excerpt-header">
        <h1><a href="/2020/03/25/React/React-%E6%9E%84%E5%BB%BA%E7%BB%84%E4%BB%B6%E7%9A%84%E6%96%B9%E5%BC%8F/">React-æ„å»ºç»„ä»¶çš„æ–¹å¼</a></h1>
        <div class="cube-excerpt-header-msg">
            <div class="cube-excerpt-date">
                <i class="cube-icon cube-icon-date" aria-hidden="true"></i>
                2020-03-25
            </div>
            <div class="cube-excerpt-tags">
                <i class="cube-icon cube-icon-tag" aria-hidden="true"></i>
                
                <a href="/tags/React/" class="cube-excerpt-tag-link">#React</a>
                
            </div>
        </div>
    </header>
    <article class="cube-excerpt-entry cube-markdown">
        
        
           <h2 id="ä¸€ã€å¦‚ä½•æ„å»º"><a href="#ä¸€ã€å¦‚ä½•æ„å»º" class="headerlink" title="ä¸€ã€å¦‚ä½•æ„å»º"></a>ä¸€ã€å¦‚ä½•æ„å»º</h2><p>åœ¨<code>React</code>ç›®å‰æ¥è®²ï¼Œç»„ä»¶çš„åˆ›å»ºä¸»è¦åˆ†æˆäº†ä¸‰ç§æ–¹å¼ï¼š</p>
<ul>
<li>å‡½æ•°å¼åˆ›å»º</li>
<li>é€šè¿‡ React.createClass æ–¹æ³•åˆ›å»º</li>
<li>ç»§æ‰¿ React.Component åˆ›å»º</li>
</ul>
<h3 id="å‡½æ•°å¼åˆ›å»º"><a href="#å‡½æ•°å¼åˆ›å»º" class="headerlink" title="å‡½æ•°å¼åˆ›å»º"></a>å‡½æ•°å¼åˆ›å»º</h3><p>åœ¨<code>React Hooks</code>å‡ºæ¥ä¹‹å‰ï¼Œå‡½æ•°å¼ç»„ä»¶å¯ä»¥è§†ä¸ºæ— çŠ¶æ€ç»„ä»¶ï¼Œåªè´Ÿè´£æ ¹æ®ä¼ å…¥çš„<code>props</code>æ¥å±•ç¤ºè§†å›¾ï¼Œä¸æ¶‰åŠå¯¹<code>state</code>çŠ¶æ€çš„æ“ä½œ</p>
<p>å¤§å¤šæ•°ç»„ä»¶å¯ä»¥å†™ä¸ºæ— çŠ¶æ€ç»„ä»¶ï¼Œé€šè¿‡ç®€å•ç»„åˆæ„å»ºå…¶ä»–ç»„ä»¶</p>
<p>åœ¨<code>React</code>ä¸­ï¼Œé€šè¿‡å‡½æ•°ç®€å•åˆ›å»ºç»„ä»¶çš„ç¤ºä¾‹å¦‚ä¸‹ï¼š</p>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">HelloComponent</span>(<span class="params">props, <span class="comment">/* context */</span></span>) &#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="language-xml"><span class="tag">&lt;<span class="name">div</span>&gt;</span>Hello &#123;props.name&#125;<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="é€šè¿‡-React-createClass-æ–¹æ³•åˆ›å»º"><a href="#é€šè¿‡-React-createClass-æ–¹æ³•åˆ›å»º" class="headerlink" title="é€šè¿‡ React.createClass æ–¹æ³•åˆ›å»º"></a>é€šè¿‡ React.createClass æ–¹æ³•åˆ›å»º</h3><p><code>React.createClass</code>æ˜¯reactåˆšå¼€å§‹æ¨èçš„åˆ›å»ºç»„ä»¶çš„æ–¹å¼ï¼Œç›®å‰è¿™ç§åˆ›å»ºæ–¹å¼å·²ç»ä¸æ€ä¹ˆç”¨äº†</p>
<p>åƒä¸Šè¿°é€šè¿‡å‡½æ•°å¼åˆ›å»ºçš„ç»„ä»¶çš„æ–¹å¼ï¼Œæœ€ç»ˆä¼šé€šè¿‡<code>babel</code>è½¬åŒ–æˆ<code>React.createClass</code>è¿™ç§å½¢å¼ï¼Œè½¬åŒ–æˆå¦‚ä¸‹ï¼š</p>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">HelloComponent</span>(<span class="params">props</span>) <span class="comment">/* context */</span>&#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="title class_">React</span>.<span class="title function_">createElement</span>(</span><br><span class="line">    <span class="string">&quot;div&quot;</span>,</span><br><span class="line">    <span class="literal">null</span>,</span><br><span class="line">    <span class="string">&quot;Hello &quot;</span>,</span><br><span class="line">    props.<span class="property">name</span></span><br><span class="line">  );</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>ç”±äºä¸Šè¿°çš„ç¼–å†™æ–¹å¼è¿‡äºå†—æ‚ï¼Œç›®å‰åŸºæœ¬ä¸Šä¸ä½¿ç”¨ä¸Š</p>
<h3 id="ç»§æ‰¿-React-Component-åˆ›å»º"><a href="#ç»§æ‰¿-React-Component-åˆ›å»º" class="headerlink" title="ç»§æ‰¿ React.Component åˆ›å»º"></a>ç»§æ‰¿ React.Component åˆ›å»º</h3><p>åŒæ ·åœ¨<code>react hooks</code>å‡ºæ¥ä¹‹å‰ï¼Œæœ‰çŠ¶æ€çš„ç»„ä»¶åªèƒ½é€šè¿‡ç»§æ‰¿<code>React.Component</code>è¿™ç§å½¢å¼è¿›è¡Œåˆ›å»º</p>
<p>æœ‰çŠ¶æ€çš„ç»„ä»¶ä¹Ÿå°±æ˜¯ç»„ä»¶å†…éƒ¨å­˜åœ¨ç»´æŠ¤çš„æ•°æ®ï¼Œåœ¨ç±»åˆ›å»ºçš„æ–¹å¼ä¸­é€šè¿‡<code>this.state</code>è¿›è¡Œè®¿é—®</p>
<p>å½“è°ƒç”¨<code>this.setState</code>ä¿®æ”¹ç»„ä»¶çš„çŠ¶æ€æ—¶ï¼Œç»„ä»·ä¼šå†æ¬¡ä¼šè°ƒç”¨<code>render()</code>æ–¹æ³•è¿›è¡Œé‡æ–°æ¸²æŸ“</p>
<p>é€šè¿‡ç»§æ‰¿<code>React.Component</code>åˆ›å»ºä¸€ä¸ªæ—¶é’Ÿç¤ºä¾‹å¦‚ä¸‹ï¼š</p>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Timer</span> <span class="keyword">extends</span> <span class="title class_ inherited__">React.Component</span> &#123;</span><br><span class="line">  <span class="title function_">constructor</span>(<span class="params">props</span>) &#123;</span><br><span class="line">    <span class="variable language_">super</span>(props);</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">state</span> = &#123; <span class="attr">seconds</span>: <span class="number">0</span> &#125;;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="title function_">tick</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="title function_">setState</span>(<span class="function"><span class="params">state</span> =&gt;</span> (&#123;</span><br><span class="line">      <span class="attr">seconds</span>: state.<span class="property">seconds</span> + <span class="number">1</span></span><br><span class="line">    &#125;));</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="title function_">componentDidMount</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">interval</span> = <span class="built_in">setInterval</span>(<span class="function">() =&gt;</span> <span class="variable language_">this</span>.<span class="title function_">tick</span>(), <span class="number">1000</span>);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="title function_">componentWillUnmount</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="built_in">clearInterval</span>(<span class="variable language_">this</span>.<span class="property">interval</span>);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="title function_">render</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> (</span><br><span class="line">      <span class="language-xml"><span class="tag">&lt;<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">        Seconds: &#123;this.state.seconds&#125;</span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line">    );</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h2 id="äºŒã€åŒºåˆ«"><a href="#äºŒã€åŒºåˆ«" class="headerlink" title="äºŒã€åŒºåˆ«"></a>äºŒã€åŒºåˆ«</h2><p>ç”±äº<code>React.createClass</code>åˆ›å»ºçš„æ–¹å¼è¿‡äºå†—æ‚ï¼Œå¹¶ä¸å»ºè®®ä½¿ç”¨</p>
<p>è€Œåƒå‡½æ•°å¼åˆ›å»ºå’Œç±»ç»„ä»¶åˆ›å»ºçš„åŒºåˆ«ä¸»è¦åœ¨äºéœ€è¦åˆ›å»ºçš„ç»„ä»¶æ˜¯å¦éœ€è¦ä¸ºæœ‰çŠ¶æ€ç»„ä»¶ï¼š</p>
<ul>
<li>å¯¹äºä¸€äº›æ— çŠ¶æ€çš„ç»„ä»¶åˆ›å»ºï¼Œå»ºè®®ä½¿ç”¨å‡½æ•°å¼åˆ›å»ºçš„æ–¹å¼</li>
<li>ç”±äº<code>react hooks</code>çš„å‡ºç°ï¼Œå‡½æ•°å¼ç»„ä»¶åˆ›å»ºçš„ç»„ä»¶é€šè¿‡ä½¿ç”¨<code>hooks</code>æ–¹æ³•ä¹Ÿèƒ½ä½¿ä¹‹æˆä¸ºæœ‰çŠ¶æ€ç»„ä»¶ï¼Œå†åŠ ä¸Šç›®å‰æ¨å´‡å‡½æ•°å¼ç¼–ç¨‹ï¼Œæ‰€ä»¥è¿™é‡Œå»ºè®®éƒ½ä½¿ç”¨å‡½æ•°å¼çš„æ–¹å¼æ¥åˆ›å»ºç»„ä»¶</li>
</ul>
<p>åœ¨è€ƒè™‘ç»„ä»¶çš„é€‰æ‹©åŸåˆ™ä¸Šï¼Œèƒ½ç”¨æ— çŠ¶æ€ç»„ä»¶åˆ™ç”¨æ— çŠ¶æ€ç»„ä»¶</p>

        
    </article>
    <footer class="cube-excerpt-footer">
        <a class="cube-excerpt-more" href="/2020/03/25/React/React-%E6%9E%84%E5%BB%BA%E7%BB%84%E4%BB%B6%E7%9A%84%E6%96%B9%E5%BC%8F/">Read More</a>
    </footer>
</div>

<div class="cube-excerpt" id="cube-excerpt-React-super() å’Œ super(props)çš„åŒºåˆ«">
    <header class="cube-excerpt-header">
        <h1><a href="/2020/03/23/React/React-super()%20%E5%92%8C%20super(props)%E7%9A%84%E5%8C%BA%E5%88%AB/">React-super() å’Œ super(props)çš„åŒºåˆ«</a></h1>
        <div class="cube-excerpt-header-msg">
            <div class="cube-excerpt-date">
                <i class="cube-icon cube-icon-date" aria-hidden="true"></i>
                2020-03-23
            </div>
            <div class="cube-excerpt-tags">
                <i class="cube-icon cube-icon-tag" aria-hidden="true"></i>
                
                <a href="/tags/React/" class="cube-excerpt-tag-link">#React</a>
                
            </div>
        </div>
    </header>
    <article class="cube-excerpt-entry cube-markdown">
        
        
           <h2 id="ä¸€ã€ES6-ç±»"><a href="#ä¸€ã€ES6-ç±»" class="headerlink" title="ä¸€ã€ES6 ç±»"></a>ä¸€ã€ES6 ç±»</h2><p>åœ¨ <code>ES6</code> ä¸­ï¼Œé€šè¿‡ <code>extends</code> å…³é”®å­—å®ç°ç±»çš„ç»§æ‰¿ï¼Œæ–¹å¼å¦‚ä¸‹ï¼š</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">sup</span> &#123;</span><br><span class="line">  <span class="title function_">constructor</span>(<span class="params">name</span>) &#123;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">name</span> = name;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="title function_">printName</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="variable language_">this</span>.<span class="property">name</span>);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">sub</span> <span class="keyword">extends</span> <span class="title class_ inherited__">sup</span> &#123;</span><br><span class="line">  <span class="title function_">constructor</span>(<span class="params">name, age</span>) &#123;</span><br><span class="line">    <span class="variable language_">super</span>(name); <span class="comment">// superä»£è¡¨çš„äº‹çˆ¶ç±»çš„æ„é€ å‡½æ•°</span></span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">age</span> = age;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="title function_">printAge</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="variable language_">this</span>.<span class="property">age</span>);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> jack = <span class="keyword">new</span> <span class="title function_">sub</span>(<span class="string">&quot;jack&quot;</span>, <span class="number">20</span>);</span><br><span class="line">jack.<span class="title function_">printName</span>(); <span class="comment">//è¾“å‡º : jack</span></span><br><span class="line">jack.<span class="title function_">printAge</span>(); <span class="comment">//è¾“å‡º : 20</span></span><br></pre></td></tr></table></figure>

<p>åœ¨ä¸Šé¢çš„ä¾‹å­ä¸­ï¼Œå¯ä»¥çœ‹åˆ°é€šè¿‡ <code>super</code> å…³é”®å­—å®ç°è°ƒç”¨çˆ¶ç±»ï¼Œ<code>super</code> ä»£æ›¿çš„æ˜¯çˆ¶ç±»çš„æ„å»ºå‡½æ•°ï¼Œä½¿ç”¨ <code>super(name)</code> ç›¸å½“äºè°ƒç”¨ <code>sup.prototype.constructor.call(this,name)</code></p>
<p>å¦‚æœåœ¨å­ç±»ä¸­ä¸ä½¿ç”¨ <code>super</code>ï¼Œå…³é”®å­—ï¼Œåˆ™ä¼šå¼•å‘æŠ¥é”™ï¼Œå¦‚ä¸‹ï¼š</p>
<p><img src="https://static.vue-js.com/6ab40190-d71c-11eb-85f6-6fac77c0c9b3.png" alt="img"></p>
<p>æŠ¥é”™çš„åŸå› æ˜¯ å­ç±»æ˜¯æ²¡æœ‰è‡ªå·±çš„ <code>this</code> å¯¹è±¡çš„ï¼Œå®ƒåªèƒ½ç»§æ‰¿çˆ¶ç±»çš„ <code>this</code> å¯¹è±¡ï¼Œç„¶åå¯¹å…¶è¿›è¡ŒåŠ å·¥</p>
<p>è€Œ <code>super()</code> å°±æ˜¯å°†çˆ¶ç±»ä¸­çš„ <code>this</code> å¯¹è±¡ç»§æ‰¿ç»™å­ç±»çš„ï¼Œæ²¡æœ‰ <code>super()</code> å­ç±»å°±å¾—ä¸åˆ° <code>this</code> å¯¹è±¡</p>
<p>å¦‚æœå…ˆè°ƒç”¨ <code>this</code>ï¼Œå†åˆå§‹åŒ– <code>super()</code>ï¼ŒåŒæ ·æ˜¯ç¦æ­¢çš„è¡Œä¸º</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">sub</span> <span class="keyword">extends</span> <span class="title class_ inherited__">sup</span> &#123;</span><br><span class="line">  <span class="title function_">constructor</span>(<span class="params">name, age</span>) &#123;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">age</span> = age;</span><br><span class="line">    <span class="variable language_">super</span>(name); <span class="comment">// superä»£è¡¨çš„äº‹çˆ¶ç±»çš„æ„é€ å‡½æ•°</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>æ‰€ä»¥åœ¨å­ç±» <code>constructor</code> ä¸­ï¼Œå¿…é¡»å…ˆä»£ç”¨ <code>super</code> æ‰èƒ½å¼•ç”¨ <code>this</code></p>
<h2 id="äºŒã€ç±»ç»„ä»¶"><a href="#äºŒã€ç±»ç»„ä»¶" class="headerlink" title="äºŒã€ç±»ç»„ä»¶"></a>äºŒã€ç±»ç»„ä»¶</h2><p>åœ¨ <code>React</code> ä¸­ï¼Œç±»ç»„ä»¶æ˜¯åŸºäº <code>ES6</code> çš„è§„èŒƒå®ç°çš„ï¼Œç»§æ‰¿ <code>React.Component</code>ï¼Œå› æ­¤å¦‚æœç”¨åˆ° <code>constructor</code> å°±å¿…é¡»å†™ <code>super()</code> æ‰åˆå§‹åŒ– <code>this</code></p>
<p>è¿™æ—¶å€™ï¼Œåœ¨è°ƒç”¨ <code>super()</code> çš„æ—¶å€™ï¼Œæˆ‘ä»¬ä¸€èˆ¬éƒ½éœ€è¦ä¼ å…¥ <code>props</code> ä½œä¸ºå‚æ•°ï¼Œå¦‚æœä¸ä¼ è¿›å»ï¼Œ<code>React</code> å†…éƒ¨ä¹Ÿä¼šå°†å…¶å®šä¹‰åœ¨ç»„ä»¶å®ä¾‹ä¸­</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// React å†…éƒ¨</span></span><br><span class="line"><span class="keyword">const</span> instance = <span class="keyword">new</span> <span class="title class_">YourComponent</span>(props);</span><br><span class="line">instance.<span class="property">props</span> = props;</span><br></pre></td></tr></table></figure>

<p>æ‰€ä»¥æ— è®ºæœ‰æ²¡æœ‰ <code>constructor</code>ï¼Œåœ¨ <code>render</code> ä¸­ <code>this.props</code> éƒ½æ˜¯å¯ä»¥ä½¿ç”¨çš„ï¼Œè¿™æ˜¯ <code>React</code> è‡ªåŠ¨é™„å¸¦çš„ï¼Œæ˜¯å¯ä»¥ä¸å†™çš„ï¼š</p>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">HelloMessage</span> <span class="keyword">extends</span> <span class="title class_ inherited__">React.Component</span> &#123;</span><br><span class="line">  <span class="title function_">render</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="language-xml"><span class="tag">&lt;<span class="name">div</span>&gt;</span>nice to meet you! &#123;this.props.name&#125;<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span>;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>ï¼Œè°ƒç”¨ <code>this.props</code> ä¸º <code>undefined</code>ï¼Œå¦‚ä¸‹æƒ…å†µï¼š</p>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Button</span> <span class="keyword">extends</span> <span class="title class_ inherited__">React.Component</span> &#123;</span><br><span class="line">  <span class="title function_">constructor</span>(<span class="params">props</span>) &#123;</span><br><span class="line">    <span class="variable language_">super</span>(); <span class="comment">// æ²¡ä¼ å…¥ props</span></span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(props);      <span class="comment">//  &#123;&#125;</span></span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="variable language_">this</span>.<span class="property">props</span>); <span class="comment">//  undefined</span></span><br><span class="line">    <span class="comment">// ...</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<p>è€Œä¼ å…¥ <code>props</code> çš„åˆ™éƒ½èƒ½æ­£å¸¸è®¿é—®ï¼Œç¡®ä¿äº† <code>this.props</code> åœ¨æ„é€ å‡½æ•°æ‰§è¡Œå®Œæ¯•ä¹‹å‰å·²è¢«èµ‹å€¼ï¼Œæ›´ç¬¦åˆé€»è¾‘ï¼Œå¦‚ä¸‹ï¼š</p>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Button</span> <span class="keyword">extends</span> <span class="title class_ inherited__">React.Component</span> &#123;</span><br><span class="line">  <span class="title function_">constructor</span>(<span class="params">props</span>) &#123;</span><br><span class="line">    <span class="variable language_">super</span>(props); <span class="comment">// æ²¡ä¼ å…¥ props</span></span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(props);      <span class="comment">//  &#123;&#125;</span></span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="variable language_">this</span>.<span class="property">props</span>); <span class="comment">//  &#123;&#125;</span></span><br><span class="line">    <span class="comment">// ...</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h2><p>åœ¨ <code>React</code> ä¸­ï¼Œç±»ç»„ä»¶åŸºäº <code>ES6</code>ï¼Œæ‰€ä»¥åœ¨ <code>constructor</code> ä¸­å¿…é¡»ä½¿ç”¨ <code>super</code></p>
<p>åœ¨è°ƒç”¨ <code>super</code> è¿‡ç¨‹ï¼Œæ— è®ºæ˜¯å¦ä¼ å…¥ <code>props</code>ï¼Œ<code>React</code> å†…éƒ¨éƒ½ä¼šå°† <code>porps</code> èµ‹å€¼ç»™ç»„ä»¶å®ä¾‹ <code>porps</code> å±æ€§ä¸­</p>
<p>å¦‚æœåªè°ƒç”¨äº† <code>super()</code>ï¼Œé‚£ä¹ˆ <code>this.props</code> åœ¨ <code>super()</code> å’Œæ„é€ å‡½æ•°ç»“æŸä¹‹é—´ä»æ˜¯ <code>undefined</code></p>

        
    </article>
    <footer class="cube-excerpt-footer">
        <a class="cube-excerpt-more" href="/2020/03/23/React/React-super()%20%E5%92%8C%20super(props)%E7%9A%84%E5%8C%BA%E5%88%AB/">Read More</a>
    </footer>
</div>

<div class="cube-excerpt" id="cube-excerpt-å°ç¨‹åºå®ç°åŸç†">
    <header class="cube-excerpt-header">
        <h1><a href="/2020/02/13/%E5%B0%8F%E7%A8%8B%E5%BA%8F+uniapp/%E5%B0%8F%E7%A8%8B%E5%BA%8F%E5%AE%9E%E7%8E%B0%E5%8E%9F%E7%90%86/">å°ç¨‹åºå®ç°åŸç†</a></h1>
        <div class="cube-excerpt-header-msg">
            <div class="cube-excerpt-date">
                <i class="cube-icon cube-icon-date" aria-hidden="true"></i>
                2020-02-13
            </div>
            <div class="cube-excerpt-tags">
                <i class="cube-icon cube-icon-tag" aria-hidden="true"></i>
                
                <a href="/tags/%E5%B0%8F%E7%A8%8B%E5%BA%8F/" class="cube-excerpt-tag-link">#å°ç¨‹åº</a>
                
            </div>
        </div>
    </header>
    <article class="cube-excerpt-entry cube-markdown">
        
        
           <h2 id="ä¸€ã€èƒŒæ™¯"><a href="#ä¸€ã€èƒŒæ™¯" class="headerlink" title="ä¸€ã€èƒŒæ™¯"></a>ä¸€ã€èƒŒæ™¯</h2><p>ç½‘é¡µå¼€å‘ï¼Œæ¸²æŸ“çº¿ç¨‹å’Œè„šæœ¬æ˜¯äº’æ–¥çš„ï¼Œè¿™ä¹Ÿæ˜¯ä¸ºä»€ä¹ˆé•¿æ—¶é—´çš„è„šæœ¬è¿è¡Œå¯èƒ½ä¼šå¯¼è‡´é¡µé¢å¤±å»å“åº”çš„åŸå› ï¼Œæœ¬è´¨å°±æ˜¯æˆ‘ä»¬å¸¸è¯´çš„ <code>JS</code> æ˜¯å•çº¿ç¨‹çš„</p>
<p>è€Œåœ¨å°ç¨‹åºä¸­ï¼Œé€‰æ‹©äº† <code>Hybrid</code> çš„æ¸²æŸ“æ–¹å¼ï¼Œå°†è§†å›¾å±‚å’Œé€»è¾‘å±‚æ˜¯åˆ†å¼€çš„ï¼ŒåŒçº¿ç¨‹åŒæ—¶è¿è¡Œï¼Œè§†å›¾å±‚çš„ç•Œé¢ä½¿ç”¨ <code>WebView</code> è¿›è¡Œæ¸²æŸ“ï¼Œé€»è¾‘å±‚è¿è¡Œåœ¨ <code>JSCore</code> ä¸­</p>
<p><img src="https://static.vue-js.com/4e322e50-3722-11ec-8e64-91fdec0f05a1.png" alt="img"></p>
<ul>
<li>æ¸²æŸ“å±‚ï¼šç•Œé¢æ¸²æŸ“ç›¸å…³çš„ä»»åŠ¡å…¨éƒ½åœ¨ WebView çº¿ç¨‹é‡Œæ‰§è¡Œã€‚ä¸€ä¸ªå°ç¨‹åºå­˜åœ¨å¤šä¸ªç•Œé¢ï¼Œæ‰€ä»¥æ¸²æŸ“å±‚å­˜åœ¨å¤šä¸ª WebView çº¿ç¨‹</li>
<li>é€»è¾‘å±‚ï¼šé‡‡ç”¨ JsCore çº¿ç¨‹è¿è¡Œ JS è„šæœ¬ï¼Œåœ¨è¿™ä¸ªç¯å¢ƒä¸‹æ‰§è¡Œçš„éƒ½æ˜¯æœ‰å…³å°ç¨‹åºä¸šåŠ¡é€»è¾‘çš„ä»£ç </li>
</ul>
<h2 id="äºŒã€é€šä¿¡"><a href="#äºŒã€é€šä¿¡" class="headerlink" title="äºŒã€é€šä¿¡"></a>äºŒã€é€šä¿¡</h2><p>å°ç¨‹åºåœ¨æ¸²æŸ“å±‚ï¼Œå®¿ä¸»ç¯å¢ƒä¼šæŠŠ<code>wxml</code>è½¬åŒ–æˆå¯¹åº”çš„<code>JS</code>å¯¹è±¡</p>
<p>åœ¨é€»è¾‘å±‚å‘ç”Ÿæ•°æ®å˜æ›´çš„æ—¶å€™ï¼Œé€šè¿‡å®¿ä¸»ç¯å¢ƒæä¾›çš„<code>setData</code>æ–¹æ³•æŠŠæ•°æ®ä»é€»è¾‘å±‚ä¼ é€’åˆ°æ¸²æŸ“å±‚ï¼Œå†ç»è¿‡å¯¹æ¯”å‰åå·®å¼‚ï¼ŒæŠŠå·®å¼‚åº”ç”¨åœ¨åŸæ¥çš„<code>Dom</code>æ ‘ä¸Šï¼Œæ¸²æŸ“å‡ºæ­£ç¡®çš„è§†å›¾</p>
<p><img src="https://static.vue-js.com/5948ed10-3722-11ec-a752-75723a64e8f5.png" alt="img"></p>
<p>å½“è§†å›¾å­˜åœ¨äº¤äº’çš„æ—¶å€™ï¼Œä¾‹å¦‚ç”¨æˆ·ç‚¹å‡»ä½ ç•Œé¢ä¸ŠæŸä¸ªæŒ‰é’®ï¼Œè¿™ç±»åé¦ˆåº”è¯¥é€šçŸ¥ç»™å¼€å‘è€…çš„é€»è¾‘å±‚ï¼Œéœ€è¦å°†å¯¹åº”çš„å¤„ç†çŠ¶æ€å‘ˆç°ç»™ç”¨æˆ·</p>
<p>å¯¹äºäº‹ä»¶çš„åˆ†å‘å¤„ç†ï¼Œå¾®ä¿¡è¿›è¡Œäº†ç‰¹æ®Šçš„å¤„ç†ï¼Œå°†æ‰€æœ‰çš„äº‹ä»¶æ‹¦æˆªåï¼Œä¸¢åˆ°é€»è¾‘å±‚äº¤ç»™<code>JavaScript</code>è¿›è¡Œå¤„ç†</p>
<p><img src="https://static.vue-js.com/61f9f670-3722-11ec-a752-75723a64e8f5.png" alt="img"></p>
<p>ç”±äºå°ç¨‹åºæ˜¯åŸºäºåŒçº¿ç¨‹çš„ï¼Œä¹Ÿå°±æ˜¯ä»»ä½•åœ¨è§†å›¾å±‚å’Œé€»è¾‘å±‚ä¹‹é—´çš„æ•°æ®ä¼ é€’éƒ½æ˜¯çº¿ç¨‹é—´çš„é€šä¿¡ï¼Œä¼šæœ‰ä¸€å®šçš„å»¶æ—¶ï¼Œå› æ­¤åœ¨å°ç¨‹åºä¸­ï¼Œé¡µé¢æ›´æ–°æˆäº†å¼‚æ­¥æ“ä½œ</p>
<p>å¼‚æ­¥ä¼šä½¿å¾—å„éƒ¨åˆ†çš„è¿è¡Œæ—¶åºå˜å¾—å¤æ‚ä¸€äº›ï¼Œæ¯”å¦‚åœ¨æ¸²æŸ“é¦–å±çš„æ—¶å€™ï¼Œé€»è¾‘å±‚ä¸æ¸²æŸ“å±‚ä¼šåŒæ—¶å¼€å§‹åˆå§‹åŒ–å·¥ä½œï¼Œä½†æ˜¯æ¸²æŸ“å±‚éœ€è¦æœ‰é€»è¾‘å±‚çš„æ•°æ®æ‰èƒ½æŠŠç•Œé¢æ¸²æŸ“å‡ºæ¥</p>
<p>å¦‚æœæ¸²æŸ“å±‚åˆå§‹åŒ–å·¥ä½œè¾ƒå¿«å®Œæˆï¼Œå°±è¦ç­‰é€»è¾‘å±‚çš„æŒ‡ä»¤æ‰èƒ½è¿›è¡Œä¸‹ä¸€æ­¥å·¥ä½œ</p>
<p>å› æ­¤é€»è¾‘å±‚ä¸æ¸²æŸ“å±‚éœ€è¦æœ‰ä¸€å®šçš„æœºåˆ¶ä¿è¯æ—¶åºæ­£ç¡®ï¼Œåœ¨æ¯ä¸ªå°ç¨‹åºé¡µé¢çš„ç”Ÿå‘½å‘¨æœŸä¸­ï¼Œå­˜åœ¨ç€è‹¥å¹²æ¬¡é¡µé¢æ•°æ®é€šä¿¡</p>
<p><img src="https://static.vue-js.com/6cb798b0-3722-11ec-a752-75723a64e8f5.png" alt="img"></p>
<h2 id="ä¸‰ã€è¿è¡Œæœºåˆ¶"><a href="#ä¸‰ã€è¿è¡Œæœºåˆ¶" class="headerlink" title="ä¸‰ã€è¿è¡Œæœºåˆ¶"></a>ä¸‰ã€è¿è¡Œæœºåˆ¶</h2><p>å°ç¨‹åºå¯åŠ¨è¿è¡Œä¸¤ç§æƒ…å†µï¼š</p>
<ul>
<li>å†·å¯åŠ¨ï¼ˆé‡æ–°å¼€å§‹ï¼‰ï¼šç”¨æˆ·é¦–æ¬¡æ‰“å¼€æˆ–è€…å°ç¨‹åºè¢«å¾®ä¿¡ä¸»åŠ¨é”€æ¯åå†æ¬¡æ‰“å¼€çš„æƒ…å†µï¼Œæ­¤æ—¶å°ç¨‹åºéœ€è¦é‡æ–°åŠ è½½å¯åŠ¨ï¼Œå³ä¸ºå†·å¯åŠ¨</li>
<li>çƒ­å¯åŠ¨ï¼šç”¨æˆ·å·²ç»æ‰“å¼€è¿‡å°ç¨‹åºï¼Œç„¶ååœ¨ä¸€å®šæ—¶é—´å†…å†æ¬¡æ‰“å¼€è¯¥å°ç¨‹åºï¼Œæ­¤æ—¶æ— éœ€é‡æ–°å¯åŠ¨ï¼Œåªéœ€è¦å°†åå°æ€çš„å°ç¨‹åºåˆ‡æ¢åˆ°å‰å°ï¼Œè¿™ä¸ªè¿‡ç¨‹å°±æ˜¯çƒ­å¯åŠ¨</li>
</ul>
<h4 id="éœ€è¦æ³¨æ„ï¼š"><a href="#éœ€è¦æ³¨æ„ï¼š" class="headerlink" title="éœ€è¦æ³¨æ„ï¼š"></a>éœ€è¦æ³¨æ„ï¼š</h4><blockquote>
<p>1.å°ç¨‹åºæ²¡æœ‰é‡å¯çš„æ¦‚å¿µ<br>2.å½“å°ç¨‹åºè¿›å…¥åå°ï¼Œå®¢æˆ·ç«¯ä¼šç»´æŒä¸€æ®µæ—¶é—´çš„è¿è¡ŒçŠ¶æ€ï¼Œè¶…è¿‡ä¸€å®šæ—¶é—´åä¼šè¢«å¾®ä¿¡ä¸»åŠ¨é”€æ¯<br>3.çŸ­æ—¶é—´å†…æ”¶åˆ°ç³»ç»Ÿä¸¤æ¬¡ä»¥ä¸Šå†…å­˜è­¦å‘Šï¼Œä¹Ÿä¼šå¯¹å°ç¨‹åºè¿›è¡Œé”€æ¯ï¼Œè¿™ä¹Ÿå°±ä¸ºä»€ä¹ˆä¸€æ—¦é¡µé¢å†…å­˜æº¢å‡ºï¼Œé¡µé¢ä¼šå¥”æºƒçš„æœ¬è´¨åŸå› äº†</p>
</blockquote>
<p><img src="https://static.vue-js.com/968c8510-3722-11ec-a752-75723a64e8f5.png" alt="img"></p>
<p>å¼€å‘è€…åœ¨åå°å‘å¸ƒæ–°ç‰ˆæœ¬ä¹‹åï¼Œæ— æ³•ç«‹åˆ»å½±å“åˆ°æ‰€æœ‰ç°ç½‘ç”¨æˆ·ï¼Œä½†æœ€å·®æƒ…å†µä¸‹ï¼Œä¹Ÿåœ¨å‘å¸ƒä¹‹å 24 å°æ—¶ä¹‹å†…ä¸‹å‘æ–°ç‰ˆæœ¬ä¿¡æ¯åˆ°ç”¨æˆ·</p>
<p>æ¯æ¬¡å†·å¯åŠ¨æ—¶ï¼Œéƒ½ä¼šæ£€æŸ¥æ˜¯å¦æœ‰æ›´æ–°ç‰ˆæœ¬ï¼Œå¦‚æœå‘ç°æœ‰æ–°ç‰ˆæœ¬ï¼Œå°†ä¼šå¼‚æ­¥ä¸‹è½½æ–°ç‰ˆæœ¬çš„ä»£ç åŒ…ï¼Œå¹¶åŒæ—¶ç”¨å®¢æˆ·ç«¯æœ¬åœ°çš„åŒ…è¿›è¡Œå¯åŠ¨ï¼Œå³æ–°ç‰ˆæœ¬çš„å°ç¨‹åºéœ€è¦ç­‰ä¸‹ä¸€æ¬¡å†·å¯åŠ¨æ‰ä¼šåº”ç”¨ä¸Š</p>

        
    </article>
    <footer class="cube-excerpt-footer">
        <a class="cube-excerpt-more" href="/2020/02/13/%E5%B0%8F%E7%A8%8B%E5%BA%8F+uniapp/%E5%B0%8F%E7%A8%8B%E5%BA%8F%E5%AE%9E%E7%8E%B0%E5%8E%9F%E7%90%86/">Read More</a>
    </footer>
</div>

<div class="cube-excerpt" id="cube-excerpt-Real DOM å’Œ Virtual DOM çš„åŒºåˆ«">
    <header class="cube-excerpt-header">
        <h1><a href="/2020/02/06/React/React-Real%20DOM%20%E5%92%8C%20Virtual%20DOM%20%E7%9A%84%E5%8C%BA%E5%88%AB/">Real DOM å’Œ Virtual DOM çš„åŒºåˆ«</a></h1>
        <div class="cube-excerpt-header-msg">
            <div class="cube-excerpt-date">
                <i class="cube-icon cube-icon-date" aria-hidden="true"></i>
                2020-02-06
            </div>
            <div class="cube-excerpt-tags">
                <i class="cube-icon cube-icon-tag" aria-hidden="true"></i>
                
                <a href="/tags/React/" class="cube-excerpt-tag-link">#React</a>
                
            </div>
        </div>
    </header>
    <article class="cube-excerpt-entry cube-markdown">
        
        
           <h2 id="ä¸€ã€æ˜¯ä»€ä¹ˆ"><a href="#ä¸€ã€æ˜¯ä»€ä¹ˆ" class="headerlink" title="ä¸€ã€æ˜¯ä»€ä¹ˆ"></a>ä¸€ã€æ˜¯ä»€ä¹ˆ</h2><p>Real DOMï¼ŒçœŸå® <code>DOM</code>ï¼Œæ„æ€ä¸ºæ–‡æ¡£å¯¹è±¡æ¨¡å‹ï¼Œæ˜¯ä¸€ä¸ªç»“æ„åŒ–æ–‡æœ¬çš„æŠ½è±¡ï¼Œåœ¨é¡µé¢æ¸²æŸ“å‡ºçš„æ¯ä¸€ä¸ªç»“ç‚¹éƒ½æ˜¯ä¸€ä¸ªçœŸå® <code>DOM</code> ç»“æ„ï¼Œå¦‚ä¸‹ï¼š</p>
<p><img src="https://static.vue-js.com/fc7ba8d0-d302-11eb-85f6-6fac77c0c9b3.png" alt="img"></p>
<p><code>Virtual Dom</code>ï¼Œæœ¬è´¨ä¸Šæ˜¯ä»¥ <code>JavaScript</code> å¯¹è±¡å½¢å¼å­˜åœ¨çš„å¯¹ <code>DOM</code> çš„æè¿°</p>
<p>åˆ›å»ºè™šæ‹Ÿ <code>DOM</code> ç›®çš„å°±æ˜¯ä¸ºäº†æ›´å¥½å°†è™šæ‹Ÿçš„èŠ‚ç‚¹æ¸²æŸ“åˆ°é¡µé¢è§†å›¾ä¸­ï¼Œè™šæ‹Ÿ <code>DOM</code> å¯¹è±¡çš„èŠ‚ç‚¹ä¸çœŸå® <code>DOM</code>çš„å±æ€§ä¸€ä¸€ç…§åº”</p>
<p>åœ¨ <code>React</code> ä¸­ï¼Œ<code>JSX</code> æ˜¯å…¶ä¸€å¤§ç‰¹æ€§ï¼Œå¯ä»¥è®©ä½ åœ¨ <code>JS</code> ä¸­é€šè¿‡ä½¿ç”¨ <code>XML</code> çš„æ–¹å¼å»ç›´æ¥å£°æ˜ç•Œé¢çš„ <code>DOM</code>ç»“æ„</p>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// åˆ›å»º h1 æ ‡ç­¾ï¼Œå³è¾¹åƒä¸‡ä¸èƒ½åŠ å¼•å·</span></span><br><span class="line"><span class="keyword">const</span> vDom = <span class="language-xml"><span class="tag">&lt;<span class="name">h1</span>&gt;</span>Hello World<span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span>; </span><br><span class="line"><span class="comment">// æ‰¾åˆ° &lt;div id=&quot;root&quot;&gt;&lt;/div&gt; èŠ‚ç‚¹</span></span><br><span class="line"><span class="keyword">const</span> root = <span class="variable language_">document</span>.<span class="title function_">getElementById</span>(<span class="string">&quot;root&quot;</span>); </span><br><span class="line"><span class="comment">// æŠŠåˆ›å»ºçš„ h1 æ ‡ç­¾æ¸²æŸ“åˆ° root èŠ‚ç‚¹ä¸Š</span></span><br><span class="line"><span class="title class_">ReactDOM</span>.<span class="title function_">render</span>(vDom, root); </span><br></pre></td></tr></table></figure>

<p>ä¸Šè¿°ä¸­ï¼Œ<code>ReactDOM.render()</code> ç”¨äºå°†ä½ åˆ›å»ºå¥½çš„è™šæ‹Ÿ <code>DOM</code> èŠ‚ç‚¹æ’å…¥åˆ°æŸä¸ªçœŸå®èŠ‚ç‚¹ä¸Šï¼Œå¹¶æ¸²æŸ“åˆ°é¡µé¢ä¸Š</p>
<p><code>JSX</code> å®é™…æ˜¯ä¸€ç§è¯­æ³•ç³–ï¼Œåœ¨ä½¿ç”¨è¿‡ç¨‹ä¸­ä¼šè¢« <code>babel</code> è¿›è¡Œç¼–è¯‘è½¬åŒ–æˆ <code>JS</code> ä»£ç ï¼Œä¸Šè¿° <code>VDOM</code> è½¬åŒ–ä¸ºå¦‚ä¸‹ï¼š</p>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> vDom = <span class="title class_">React</span>.<span class="title function_">createElement</span>(</span><br><span class="line">  <span class="string">&#x27;h1&#x27;</span>ï¼Œ</span><br><span class="line">  &#123; <span class="attr">className</span>: <span class="string">&#x27;hClass&#x27;</span>, <span class="attr">id</span>: <span class="string">&#x27;hId&#x27;</span> &#125;,</span><br><span class="line">  <span class="string">&#x27;hello world&#x27;</span></span><br><span class="line">)</span><br></pre></td></tr></table></figure>

<p>å¯ä»¥çœ‹åˆ°ï¼Œ<code>JSX</code> å°±æ˜¯ä¸ºäº†ç®€åŒ–ç›´æ¥è°ƒç”¨ <code>React.createElement()</code> æ–¹æ³•ï¼š</p>
<ul>
<li>ç¬¬ä¸€ä¸ªå‚æ•°æ˜¯æ ‡ç­¾åï¼Œä¾‹å¦‚ h1ã€spanã€tableâ€¦</li>
<li>ç¬¬äºŒä¸ªå‚æ•°æ˜¯ä¸ªå¯¹è±¡ï¼Œé‡Œé¢å­˜ç€æ ‡ç­¾çš„ä¸€äº›å±æ€§ï¼Œä¾‹å¦‚ idã€class ç­‰</li>
<li>ç¬¬ä¸‰ä¸ªå‚æ•°æ˜¯èŠ‚ç‚¹ä¸­çš„æ–‡æœ¬</li>
</ul>
<p>é€šè¿‡ <code>console.log(VDOM)</code>ï¼Œåˆ™èƒ½å¤Ÿå¾—åˆ°è™šæ‹Ÿ <code>VDOM</code> æ¶ˆæ¯</p>
<p><img src="https://static.vue-js.com/1716b9a0-d303-11eb-ab90-d9ae814b240d.png" alt="img"></p>
<p>æ‰€ä»¥å¯ä»¥å¾—åˆ°ï¼Œ<code>JSX</code> é€šè¿‡ <code>babel</code> çš„æ–¹å¼è½¬åŒ–æˆ <code>React.createElement</code> æ‰§è¡Œï¼Œè¿”å›å€¼æ˜¯ä¸€ä¸ªå¯¹è±¡ï¼Œä¹Ÿå°±æ˜¯è™šæ‹Ÿ <code>DOM</code></p>
<h2 id="äºŒã€åŒºåˆ«"><a href="#äºŒã€åŒºåˆ«" class="headerlink" title="äºŒã€åŒºåˆ«"></a>äºŒã€åŒºåˆ«</h2><p>ä¸¤è€…çš„åŒºåˆ«å¦‚ä¸‹ï¼š</p>
<ul>
<li>è™šæ‹Ÿ DOM ä¸ä¼šè¿›è¡Œæ’ç‰ˆä¸é‡ç»˜æ“ä½œï¼Œè€ŒçœŸå® DOM ä¼šé¢‘ç¹é‡æ’ä¸é‡ç»˜</li>
<li>è™šæ‹Ÿ DOM çš„æ€»æŸè€—æ˜¯â€œè™šæ‹Ÿ DOM å¢åˆ æ”¹+çœŸå® DOM å·®å¼‚å¢åˆ æ”¹+æ’ç‰ˆä¸é‡ç»˜â€ï¼ŒçœŸå® DOM çš„æ€»æŸè€—æ˜¯â€œçœŸå® DOM å®Œå…¨å¢åˆ æ”¹+æ’ç‰ˆä¸é‡ç»˜â€</li>
</ul>
<p>æ‹¿<a target="_blank" rel="noopener" href="https://mp.weixin.qq.com/s?__biz=MzU1OTgxNDQ1Nw==&mid=2247484516&idx=1&sn=965a4ce32bf93adb9ed112922c5cb8f5&chksm=fc10c632cb674f2484fdf914d76fba55afcefca3b5adcbe6cf4b0c7fd36e29d0292e8cefceb5&scene=178&cur_album_id=1711105826272116736#rd">ä»¥å‰æ–‡ç«  (opens new window)</a>ä¸¾è¿‡çš„ä¾‹å­ï¼š</p>
<p>ä¼ ç»Ÿçš„åŸç”Ÿ <code>api</code> æˆ– <code>jQuery</code> å»æ“ä½œ <code>DOM</code> æ—¶ï¼Œæµè§ˆå™¨ä¼šä»æ„å»º <code>DOM</code> æ ‘å¼€å§‹ä»å¤´åˆ°å°¾æ‰§è¡Œä¸€éæµç¨‹</p>
<p>å½“ä½ åœ¨ä¸€æ¬¡æ“ä½œæ—¶ï¼Œéœ€è¦æ›´æ–° 10 ä¸ª <code>DOM</code> èŠ‚ç‚¹ï¼Œæµè§ˆå™¨æ²¡è¿™ä¹ˆæ™ºèƒ½ï¼Œæ”¶åˆ°ç¬¬ä¸€ä¸ªæ›´æ–° <code>DOM</code> è¯·æ±‚åï¼Œå¹¶ä¸çŸ¥é“åç»­è¿˜æœ‰ 9 æ¬¡æ›´æ–°æ“ä½œï¼Œå› æ­¤ä¼šé©¬ä¸Šæ‰§è¡Œæµç¨‹ï¼Œæœ€ç»ˆæ‰§è¡Œ 10 æ¬¡æµç¨‹</p>
<p>è€Œé€šè¿‡ <code>VNode</code>ï¼ŒåŒæ ·æ›´æ–° 10 ä¸ª <code>DOM</code> èŠ‚ç‚¹ï¼Œè™šæ‹Ÿ <code>DOM</code> ä¸ä¼šç«‹å³æ“ä½œ <code>DOM</code>ï¼Œè€Œæ˜¯å°†è¿™ 10 æ¬¡æ›´æ–°çš„ <code>diff</code> å†…å®¹ä¿å­˜åˆ°æœ¬åœ°çš„ä¸€ä¸ª <code>js</code> å¯¹è±¡ä¸­ï¼Œæœ€ç»ˆå°†è¿™ä¸ª <code>js</code> å¯¹è±¡ä¸€æ¬¡æ€§ <code>attach</code> åˆ° <code>DOM</code> æ ‘ä¸Šï¼Œé¿å…å¤§é‡çš„æ— è°“è®¡ç®—</p>
<h2 id="ä¸‰ã€ä¼˜ç¼ºç‚¹"><a href="#ä¸‰ã€ä¼˜ç¼ºç‚¹" class="headerlink" title="ä¸‰ã€ä¼˜ç¼ºç‚¹"></a>ä¸‰ã€ä¼˜ç¼ºç‚¹</h2><p>çœŸå® <code>DOM</code> çš„ä¼˜åŠ¿ï¼š</p>
<ul>
<li>æ˜“ç”¨</li>
</ul>
<p>ç¼ºç‚¹ï¼š</p>
<ul>
<li>æ•ˆç‡ä½ï¼Œè§£æé€Ÿåº¦æ…¢ï¼Œå†…å­˜å ç”¨é‡è¿‡é«˜</li>
<li>æ€§èƒ½å·®ï¼šé¢‘ç¹æ“ä½œçœŸå® DOMï¼Œæ˜“äºå¯¼è‡´é‡ç»˜ä¸å›æµ</li>
</ul>
<p>ä½¿ç”¨è™šæ‹Ÿ <code>DOM</code> çš„ä¼˜åŠ¿å¦‚ä¸‹ï¼š</p>
<ul>
<li>ç®€å•æ–¹ä¾¿ï¼šå¦‚æœä½¿ç”¨æ‰‹åŠ¨æ“ä½œçœŸå® <code>DOM</code> æ¥å®Œæˆé¡µé¢ï¼Œç¹çåˆå®¹æ˜“å‡ºé”™ï¼Œåœ¨å¤§è§„æ¨¡åº”ç”¨ä¸‹ç»´æŠ¤èµ·æ¥ä¹Ÿå¾ˆå›°éš¾</li>
<li>æ€§èƒ½æ–¹é¢ï¼šä½¿ç”¨ Virtual DOMï¼Œèƒ½å¤Ÿæœ‰æ•ˆé¿å…çœŸå® DOM æ•°é¢‘ç¹æ›´æ–°ï¼Œå‡å°‘å¤šæ¬¡å¼•èµ·é‡ç»˜ä¸å›æµï¼Œæé«˜æ€§èƒ½</li>
<li>è·¨å¹³å°ï¼šReact å€ŸåŠ©è™šæ‹Ÿ DOMï¼Œå¸¦æ¥äº†è·¨å¹³å°çš„èƒ½åŠ›ï¼Œä¸€å¥—ä»£ç å¤šç«¯è¿è¡Œ</li>
</ul>
<p>ç¼ºç‚¹ï¼š</p>
<ul>
<li>åœ¨ä¸€äº›æ€§èƒ½è¦æ±‚æé«˜çš„åº”ç”¨ä¸­è™šæ‹Ÿ DOM æ— æ³•è¿›è¡Œé’ˆå¯¹æ€§çš„æè‡´ä¼˜åŒ–</li>
<li>é¦–æ¬¡æ¸²æŸ“å¤§é‡ DOM æ—¶ï¼Œç”±äºå¤šäº†ä¸€å±‚è™šæ‹Ÿ DOM çš„è®¡ç®—ï¼Œé€Ÿåº¦æ¯”æ­£å¸¸ç¨æ…¢</li>
</ul>

        
    </article>
    <footer class="cube-excerpt-footer">
        <a class="cube-excerpt-more" href="/2020/02/06/React/React-Real%20DOM%20%E5%92%8C%20Virtual%20DOM%20%E7%9A%84%E5%8C%BA%E5%88%AB/">Read More</a>
    </footer>
</div>

<div class="cube-excerpt" id="cube-excerpt-React-Jsxè½¬æ¢æˆçœŸå®DOMè¿‡ç¨‹">
    <header class="cube-excerpt-header">
        <h1><a href="/2020/02/03/React/React-Jsx%E8%BD%AC%E6%8D%A2%E6%88%90%E7%9C%9F%E5%AE%9EDOM%E8%BF%87%E7%A8%8B/">React-Jsxè½¬æ¢æˆçœŸå®DOMè¿‡ç¨‹</a></h1>
        <div class="cube-excerpt-header-msg">
            <div class="cube-excerpt-date">
                <i class="cube-icon cube-icon-date" aria-hidden="true"></i>
                2020-02-03
            </div>
            <div class="cube-excerpt-tags">
                <i class="cube-icon cube-icon-tag" aria-hidden="true"></i>
                
                <a href="/tags/React/" class="cube-excerpt-tag-link">#React</a>
                
            </div>
        </div>
    </header>
    <article class="cube-excerpt-entry cube-markdown">
        
        
           <h2 id="ä¸€ã€æ˜¯ä»€ä¹ˆ"><a href="#ä¸€ã€æ˜¯ä»€ä¹ˆ" class="headerlink" title="ä¸€ã€æ˜¯ä»€ä¹ˆ"></a>ä¸€ã€æ˜¯ä»€ä¹ˆ</h2><p><code>react</code>é€šè¿‡å°†ç»„ä»¶ç¼–å†™çš„<code>JSX</code>æ˜ å°„åˆ°å±å¹•ï¼Œä»¥åŠç»„ä»¶ä¸­çš„çŠ¶æ€å‘ç”Ÿäº†å˜åŒ–ä¹‹å <code>React</code>ä¼šå°†è¿™äº›ã€Œå˜åŒ–ã€æ›´æ–°åˆ°å±å¹•ä¸Š</p>
<p><code>JSX</code>é€šè¿‡<code>babel</code>æœ€ç»ˆè½¬åŒ–æˆ<code>React.createElement</code>è¿™ç§å½¢å¼ï¼Œä¾‹å¦‚ï¼š</p>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&lt;div&gt;</span><br><span class="line">  &lt; img src=<span class="string">&quot;avatar.png&quot;</span> className=<span class="string">&quot;profile&quot;</span> /&gt;</span><br><span class="line">  <span class="language-xml"><span class="tag">&lt;<span class="name">Hello</span> /&gt;</span></span></span><br><span class="line">&lt;/div&gt;</span><br></pre></td></tr></table></figure>

<p>ä¼šè¢«<code>bebel</code>è½¬åŒ–æˆå¦‚ä¸‹ï¼š</p>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="title class_">React</span>.<span class="title function_">createElement</span>(</span><br><span class="line">  <span class="string">&quot;div&quot;</span>,</span><br><span class="line">  <span class="literal">null</span>,</span><br><span class="line">  <span class="title class_">React</span>.<span class="title function_">createElement</span>(<span class="string">&quot;img&quot;</span>, &#123;</span><br><span class="line">    <span class="attr">src</span>: <span class="string">&quot;avatar.png&quot;</span>,</span><br><span class="line">    <span class="attr">className</span>: <span class="string">&quot;profile&quot;</span></span><br><span class="line">  &#125;),</span><br><span class="line">  <span class="title class_">React</span>.<span class="title function_">createElement</span>(<span class="title class_">Hello</span>, <span class="literal">null</span>)</span><br><span class="line">);</span><br></pre></td></tr></table></figure>

<p>åœ¨è½¬åŒ–è¿‡ç¨‹ä¸­ï¼Œ<code>babel</code>åœ¨ç¼–è¯‘æ—¶ä¼šåˆ¤æ–­ JSX ä¸­ç»„ä»¶çš„é¦–å­—æ¯ï¼š</p>
<ul>
<li>å½“é¦–å­—æ¯ä¸ºå°å†™æ—¶ï¼Œå…¶è¢«è®¤å®šä¸ºåŸç”Ÿ <code>DOM</code> æ ‡ç­¾ï¼Œ<code>createElement</code> çš„ç¬¬ä¸€ä¸ªå˜é‡è¢«ç¼–è¯‘ä¸ºå­—ç¬¦ä¸²</li>
<li>å½“é¦–å­—æ¯ä¸ºå¤§å†™æ—¶ï¼Œå…¶è¢«è®¤å®šä¸ºè‡ªå®šä¹‰ç»„ä»¶ï¼ŒcreateElement çš„ç¬¬ä¸€ä¸ªå˜é‡è¢«ç¼–è¯‘ä¸ºå¯¹è±¡</li>
</ul>
<p>æœ€ç»ˆéƒ½ä¼šé€šè¿‡<code>RenderDOM.render(...)</code>æ–¹æ³•è¿›è¡ŒæŒ‚è½½ï¼Œå¦‚ä¸‹ï¼š</p>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="title class_">ReactDOM</span>.<span class="title function_">render</span>(<span class="language-xml"><span class="tag">&lt;<span class="name">App</span> /&gt;</span></span>,  <span class="variable language_">document</span>.<span class="title function_">getElementById</span>(<span class="string">&quot;root&quot;</span>));</span><br></pre></td></tr></table></figure>

<h2 id="äºŒã€è¿‡ç¨‹"><a href="#äºŒã€è¿‡ç¨‹" class="headerlink" title="äºŒã€è¿‡ç¨‹"></a>äºŒã€è¿‡ç¨‹</h2><p>åœ¨<code>react</code>ä¸­ï¼ŒèŠ‚ç‚¹å¤§è‡´å¯ä»¥åˆ†æˆå››ä¸ªç±»åˆ«ï¼š</p>
<ul>
<li>åŸç”Ÿæ ‡ç­¾èŠ‚ç‚¹</li>
<li>æ–‡æœ¬èŠ‚ç‚¹</li>
<li>å‡½æ•°ç»„ä»¶</li>
<li>ç±»ç»„ä»¶</li>
</ul>
<p>å¦‚ä¸‹æ‰€ç¤ºï¼š</p>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">ClassComponent</span> <span class="keyword">extends</span> <span class="title class_ inherited__">Component</span> &#123;</span><br><span class="line">  <span class="keyword">static</span> defaultProps = &#123;</span><br><span class="line">    <span class="attr">color</span>: <span class="string">&quot;pink&quot;</span></span><br><span class="line">  &#125;;</span><br><span class="line">  <span class="title function_">render</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> (</span><br><span class="line">      &lt;div className=&quot;border&quot;&gt;</span><br><span class="line">        &lt;h3&gt;ClassComponent&lt;/h3&gt;</span><br><span class="line">        &lt;p className=&#123;this.props.color&#125;&gt;&#123;this.props.name&#125;&lt;/p &gt;</span><br><span class="line">      &lt;/div&gt;</span><br><span class="line">    );</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">function FunctionComponent(props) &#123;</span><br><span class="line">  return (</span><br><span class="line">    &lt;div className=&quot;border&quot;&gt;</span><br><span class="line">      FunctionComponent</span><br><span class="line">      &lt;p&gt;&#123;props.name&#125;&lt;/p &gt;</span><br><span class="line">    &lt;/div&gt;</span><br><span class="line">  );</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">const jsx = (</span><br><span class="line">  &lt;div className=&quot;border&quot;&gt;</span><br><span class="line">    &lt;p&gt;xx&lt;/p &gt;</span><br><span class="line">    &lt; a href=&quot; &quot;&gt;xxx&lt;/ a&gt;</span><br><span class="line">    &lt;FunctionComponent name=&quot;å‡½æ•°ç»„ä»¶&quot; /&gt;</span><br><span class="line">    &lt;ClassComponent name=&quot;ç±»ç»„ä»¶&quot; color=&quot;red&quot; /&gt;</span><br><span class="line">  &lt;/div&gt;</span><br><span class="line">);</span><br></pre></td></tr></table></figure>

<p>è¿™äº›ç±»åˆ«æœ€ç»ˆéƒ½ä¼šè¢«è½¬åŒ–æˆ<code>React.createElement</code>è¿™ç§å½¢å¼</p>
<p><code>React.createElement</code>å…¶è¢«è°ƒç”¨æ—¶ä¼šä¼ â¼Šæ ‡ç­¾ç±»å‹<code>type</code>ï¼Œæ ‡ç­¾å±æ€§<code>props</code>åŠè‹¥å¹²å­å…ƒç´ <code>children</code>ï¼Œä½œç”¨æ˜¯ç”Ÿæˆä¸€ä¸ªè™šæ‹Ÿ<code>Dom</code>å¯¹è±¡ï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">createElement</span>(<span class="params">type, config, ...children</span>) &#123;</span><br><span class="line">    <span class="keyword">if</span> (config) &#123;</span><br><span class="line">        <span class="keyword">delete</span> config.<span class="property">__self</span>;</span><br><span class="line">        <span class="keyword">delete</span> config.<span class="property">__source</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// ! æºç ä¸­åšäº†è¯¦ç»†å¤„ç†ï¼Œâ½å¦‚è¿‡æ»¤æ‰keyã€refç­‰</span></span><br><span class="line">    <span class="keyword">const</span> props = &#123;</span><br><span class="line">        ...config,</span><br><span class="line">        <span class="attr">children</span>: children.<span class="title function_">map</span>(<span class="function"><span class="params">child</span> =&gt;</span></span><br><span class="line">   <span class="keyword">typeof</span> child === <span class="string">&quot;object&quot;</span> ? child : <span class="title function_">createTextNode</span>(child)</span><br><span class="line">  )</span><br><span class="line">    &#125;;</span><br><span class="line">    <span class="keyword">return</span> &#123;</span><br><span class="line">        type,</span><br><span class="line">        props</span><br><span class="line">    &#125;;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">function</span> <span class="title function_">createTextNode</span>(<span class="params">text</span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> &#123;</span><br><span class="line">        <span class="attr">type</span>: <span class="variable constant_">TEXT</span>,</span><br><span class="line">        <span class="attr">props</span>: &#123;</span><br><span class="line">            <span class="attr">children</span>: [],</span><br><span class="line">            <span class="attr">nodeValue</span>: text</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span><br><span class="line">    createElement</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<p><code>createElement</code>ä¼šæ ¹æ®ä¼ å…¥çš„èŠ‚ç‚¹ä¿¡æ¯è¿›è¡Œä¸€ä¸ªåˆ¤æ–­ï¼š</p>
<ul>
<li>å¦‚æœæ˜¯åŸç”Ÿæ ‡ç­¾èŠ‚ç‚¹ï¼Œ type æ˜¯å­—ç¬¦ä¸²ï¼Œå¦‚divã€span</li>
<li>å¦‚æœæ˜¯æ–‡æœ¬èŠ‚ç‚¹ï¼Œ typeå°±æ²¡æœ‰ï¼Œè¿™é‡Œæ˜¯ TEXT</li>
<li>å¦‚æœæ˜¯å‡½æ•°ç»„ä»¶ï¼Œtype æ˜¯å‡½æ•°å</li>
<li>å¦‚æœæ˜¯ç±»ç»„ä»¶ï¼Œtype æ˜¯ç±»å</li>
</ul>
<p>è™šæ‹Ÿ<code>DOM</code>ä¼šé€šè¿‡<code>ReactDOM.render</code>è¿›è¡Œæ¸²æŸ“æˆçœŸå®<code>DOM</code>ï¼Œä½¿ç”¨æ–¹æ³•å¦‚ä¸‹ï¼š</p>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="title class_">ReactDOM</span>.<span class="title function_">render</span>(element, container[, callback])</span><br></pre></td></tr></table></figure>

<p>å½“é¦–æ¬¡è°ƒç”¨æ—¶ï¼Œå®¹å™¨èŠ‚ç‚¹é‡Œçš„æ‰€æœ‰ <code>DOM</code> å…ƒç´ éƒ½ä¼šè¢«æ›¿æ¢ï¼Œåç»­çš„è°ƒç”¨åˆ™ä¼šä½¿ç”¨ <code>React</code> çš„ <code>diff</code>ç®—æ³•è¿›è¡Œé«˜æ•ˆçš„æ›´æ–°</p>
<p>å¦‚æœæä¾›äº†å¯é€‰çš„å›è°ƒå‡½æ•°<code>callback</code>ï¼Œè¯¥å›è°ƒå°†åœ¨ç»„ä»¶è¢«æ¸²æŸ“æˆ–æ›´æ–°ä¹‹åè¢«æ‰§è¡Œ</p>
<p><code>render</code>å¤§è‡´å®ç°æ–¹æ³•å¦‚ä¸‹ï¼š</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">render</span>(<span class="params">vnode, container</span>) &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;vnode&quot;</span>, vnode); <span class="comment">// è™šæ‹ŸDOMå¯¹è±¡</span></span><br><span class="line">    <span class="comment">// vnode _&gt; node</span></span><br><span class="line">    <span class="keyword">const</span> node = <span class="title function_">createNode</span>(vnode, container);</span><br><span class="line">    container.<span class="title function_">appendChild</span>(node);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// åˆ›å»ºçœŸå®DOMèŠ‚ç‚¹</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">createNode</span>(<span class="params">vnode, parentNode</span>) &#123;</span><br><span class="line">    <span class="keyword">let</span> node = <span class="literal">null</span>;</span><br><span class="line">    <span class="keyword">const</span> &#123;type, props&#125; = vnode;</span><br><span class="line">    <span class="keyword">if</span> (type === <span class="variable constant_">TEXT</span>) &#123;</span><br><span class="line">        node = <span class="variable language_">document</span>.<span class="title function_">createTextNode</span>(<span class="string">&quot;&quot;</span>);</span><br><span class="line">    &#125; <span class="keyword">else</span> <span class="keyword">if</span> (<span class="keyword">typeof</span> type === <span class="string">&quot;string&quot;</span>) &#123;</span><br><span class="line">        node = <span class="variable language_">document</span>.<span class="title function_">createElement</span>(type);</span><br><span class="line">    &#125; <span class="keyword">else</span> <span class="keyword">if</span> (<span class="keyword">typeof</span> type === <span class="string">&quot;function&quot;</span>) &#123;</span><br><span class="line">        node = type.<span class="property">isReactComponent</span></span><br><span class="line">            ? <span class="title function_">updateClassComponent</span>(vnode, parentNode)</span><br><span class="line">        : <span class="title function_">updateFunctionComponent</span>(vnode, parentNode);</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        node = <span class="variable language_">document</span>.<span class="title function_">createDocumentFragment</span>();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="title function_">reconcileChildren</span>(props.<span class="property">children</span>, node);</span><br><span class="line">    <span class="title function_">updateNode</span>(node, props);</span><br><span class="line">    <span class="keyword">return</span> node;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// éå†ä¸‹å­vnodeï¼Œç„¶åæŠŠå­vnode-&gt;çœŸå®DOMèŠ‚ç‚¹ï¼Œå†æ’å…¥çˆ¶nodeä¸­</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">reconcileChildren</span>(<span class="params">children, node</span>) &#123;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">let</span> i = <span class="number">0</span>; i &lt; children.<span class="property">length</span>; i++) &#123;</span><br><span class="line">        <span class="keyword">let</span> child = children[i];</span><br><span class="line">        <span class="keyword">if</span> (<span class="title class_">Array</span>.<span class="title function_">isArray</span>(child)) &#123;</span><br><span class="line">            <span class="keyword">for</span> (<span class="keyword">let</span> j = <span class="number">0</span>; j &lt; child.<span class="property">length</span>; j++) &#123;</span><br><span class="line">                <span class="title function_">render</span>(child[j], node);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="title function_">render</span>(child, node);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">function</span> <span class="title function_">updateNode</span>(<span class="params">node, nextVal</span>) &#123;</span><br><span class="line">    <span class="title class_">Object</span>.<span class="title function_">keys</span>(nextVal)</span><br><span class="line">        .<span class="title function_">filter</span>(<span class="function"><span class="params">k</span> =&gt;</span> k !== <span class="string">&quot;children&quot;</span>)</span><br><span class="line">        .<span class="title function_">forEach</span>(<span class="function"><span class="params">k</span> =&gt;</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (k.<span class="title function_">slice</span>(<span class="number">0</span>, <span class="number">2</span>) === <span class="string">&quot;on&quot;</span>) &#123;</span><br><span class="line">            <span class="keyword">let</span> eventName = k.<span class="title function_">slice</span>(<span class="number">2</span>).<span class="title function_">toLocaleLowerCase</span>();</span><br><span class="line">            node.<span class="title function_">addEventListener</span>(eventName, nextVal[k]);</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            node[k] = nextVal[k];</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// è¿”å›çœŸå®domèŠ‚ç‚¹</span></span><br><span class="line"><span class="comment">// æ‰§è¡Œå‡½æ•°</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">updateFunctionComponent</span>(<span class="params">vnode, parentNode</span>) &#123;</span><br><span class="line">    <span class="keyword">const</span> &#123;type, props&#125; = vnode;</span><br><span class="line">    <span class="keyword">let</span> vvnode = <span class="title function_">type</span>(props);</span><br><span class="line">    <span class="keyword">const</span> node = <span class="title function_">createNode</span>(vvnode, parentNode);</span><br><span class="line">    <span class="keyword">return</span> node;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// è¿”å›çœŸå®domèŠ‚ç‚¹</span></span><br><span class="line"><span class="comment">// å…ˆå®ä¾‹åŒ–ï¼Œå†æ‰§è¡Œrenderå‡½æ•°</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">updateClassComponent</span>(<span class="params">vnode, parentNode</span>) &#123;</span><br><span class="line">    <span class="keyword">const</span> &#123;type, props&#125; = vnode;</span><br><span class="line">    <span class="keyword">let</span> cmp = <span class="keyword">new</span> <span class="title function_">type</span>(props);</span><br><span class="line">    <span class="keyword">const</span> vvnode = cmp.<span class="title function_">render</span>();</span><br><span class="line">    <span class="keyword">const</span> node = <span class="title function_">createNode</span>(vvnode, parentNode);</span><br><span class="line">    <span class="keyword">return</span> node;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span><br><span class="line">    render</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<h2 id="ä¸‰ã€æ€»ç»“"><a href="#ä¸‰ã€æ€»ç»“" class="headerlink" title="ä¸‰ã€æ€»ç»“"></a>ä¸‰ã€æ€»ç»“</h2><p>åœ¨<code>react</code>æºç ä¸­ï¼Œè™šæ‹Ÿ<code>Dom</code>è½¬åŒ–æˆçœŸå®<code>Dom</code>æ•´ä½“æµç¨‹å¦‚ä¸‹å›¾æ‰€ç¤ºï¼š</p>
<p><img src="https://static.vue-js.com/28824fa0-f00a-11eb-ab90-d9ae814b240d.png" alt="img"></p>
<p>å…¶æ¸²æŸ“æµç¨‹å¦‚ä¸‹æ‰€ç¤ºï¼š</p>
<ul>
<li>ä½¿ç”¨React.createElementæˆ–JSXç¼–å†™Reactç»„ä»¶ï¼Œå®é™…ä¸Šæ‰€æœ‰çš„ JSX ä»£ç æœ€åéƒ½ä¼šè½¬æ¢æˆReact.createElement(â€¦) ï¼ŒBabelå¸®åŠ©æˆ‘ä»¬å®Œæˆäº†è¿™ä¸ªè½¬æ¢çš„è¿‡ç¨‹ã€‚</li>
<li>createElementå‡½æ•°å¯¹keyå’Œrefç­‰ç‰¹æ®Šçš„propsè¿›è¡Œå¤„ç†ï¼Œå¹¶è·å–defaultPropså¯¹é»˜è®¤propsè¿›è¡Œèµ‹å€¼ï¼Œå¹¶ä¸”å¯¹ä¼ å…¥çš„å­©å­èŠ‚ç‚¹è¿›è¡Œå¤„ç†ï¼Œæœ€ç»ˆæ„é€ æˆä¸€ä¸ªè™šæ‹ŸDOMå¯¹è±¡</li>
<li>ReactDOM.renderå°†ç”Ÿæˆå¥½çš„è™šæ‹ŸDOMæ¸²æŸ“åˆ°æŒ‡å®šå®¹å™¨ä¸Šï¼Œå…¶ä¸­é‡‡ç”¨äº†æ‰¹å¤„ç†ã€äº‹åŠ¡ç­‰æœºåˆ¶å¹¶ä¸”å¯¹ç‰¹å®šæµè§ˆå™¨è¿›è¡Œäº†æ€§èƒ½ä¼˜åŒ–ï¼Œæœ€ç»ˆè½¬æ¢ä¸ºçœŸå®DOM</li>
</ul>

        
    </article>
    <footer class="cube-excerpt-footer">
        <a class="cube-excerpt-more" href="/2020/02/03/React/React-Jsx%E8%BD%AC%E6%8D%A2%E6%88%90%E7%9C%9F%E5%AE%9EDOM%E8%BF%87%E7%A8%8B/">Read More</a>
    </footer>
</div>



<ul class="cube-pagination cube-pagination-9">
    
    <li class="cube-pagination-prev">
        <a href="/page/7/">Â« Prev</a>
    </li>
    
    
        
                <li class="cube-pagination-index">
                    <a href="/">1</a>
                </li>
                <li class="cube-pagination-ellipses">
                    <span>...</span>
                </li>
            
                
                <li class="cube-pagination-index">
                    <a href="/page/7">7</a>
                </li>
                
            
                
                <li class="cube-pagination-index disabled">
                    <span>8</span>
                </li>
                
            
                
                <li class="cube-pagination-index">
                    <a href="/page/9">9</a>
                </li>
                
            
                <li class="cube-pagination-ellipses">
                    <span>...</span>
                </li>
                <li class="cube-pagination-index">
                    <a href="/page/19">19</a>
                </li>
        
    

    
    <li class="cube-pagination-next">
        <a href="/page/9/">Next Â»</a>
    </li>
    
</ul>

<!--å…¶ä»–ç»„ä»¶åç»­æ·»åŠ -->
        </div>
        <div class="cube-right">
            

<div class="cube-search cube-sidebar" id="cube-search">
    <div class="search-container">
        <input type="text" placeholder="Search" class="cube-search-input" id="cube-search-input">
        <i class="cube-icon cube-icon-search cube-search-submit" aria-hidden="true"></i>
    </div>
    <!-- TODO é€šè¿‡ç»™windowèµ‹ä¸€ä¸ªå…¨å±€å˜é‡ï¼Œé€šè¿‡è„šæœ¬èµ‹å€¼ -->
</div>
<script>
    (function (window) {
        'use strict';
        window.searchModule = {}
        window.searchModule.JSONUrl = '/content.json'
        window.searchModule.rootUrl = '/'
    })(window)
</script>
<div class="cube-search-form">
    <div class="cube-search-control">
        <input type="text" placeholder="Search" class="search-input">
        <a class="close-button">
            <i class="cube-icon cube-close" aria-hidden="true"></i>
        </a>
    </div>
    <div class="cube-search-result"></div>
</div>


<div class="cube-author cube-sidebar" id="cube-author">
    
    
    <span>John Doe</span>
    
    
    <div class="count">
        <a class="count articles"><span>186</span>Article</a>
        <a class="count tags"><span>35</span>Tags</a>
        <a class="count categories"><span>23</span>Categories</a>
    </div>
</div>



<div class="cube-music cube-sidebar" id="cube-music">
    <div class="cube-player aplayer" id="cube-player"></div>
</div>
<script>
    (function (window) {
        window.musicModule = {}
        window.musicModule.musicConfig = '{"narrow":false,"autoplay":false,"showlrc":3,"theme":"#b7daff","mutex":true,"mode":"circulation","preload":"auto","listmaxheight":"513px","music":[{"title":"Dear friends","author":"TRIPLANE","url":"http://cube-1252774894.cosgz.myqcloud.com/music/source/TRIPLANE - Dear friends.mp3","lrc":"http://cube-1252774894.cosgz.myqcloud.com/music/lrc/Dear friends - TRIPLANE.lrc","pic":"http://cube-1252774894.cosgz.myqcloud.com/music/image/TRIPLANE - Dear friends.jpg"},{"title":"Butter-Fly","author":"å’Œç”°å…‰å¸","url":"http://cube-1252774894.cosgz.myqcloud.com/music/source/å’Œç”°å…‰å¸ - Butter-Fly (ãƒ”ã‚¢ãƒãƒ´ã‚¡ãƒ¼ã‚¸ãƒ§ãƒ³).mp3","lrc":"http://cube-1252774894.cosgz.myqcloud.com/music/lrc/Butter-Fly (ãƒ”ã‚¢ãƒãƒ´ã‚¡ãƒ¼ã‚¸ãƒ§ãƒ³) - å’Œç”°å…‰å¸.lrc","pic":"http://cube-1252774894.cosgz.myqcloud.com/music/image/å’Œç”°å…‰å¸ - Butter-Fly (ãƒ”ã‚¢ãƒãƒ´ã‚¡ãƒ¼ã‚¸ãƒ§ãƒ³).jpg"},{"title":"å®µé—‡èŠ±ç«","author":"è‘‰æœˆã‚†ã‚‰","url":"http://cube-1252774894.cosgz.myqcloud.com/music/source/è‘‰æœˆã‚†ã‚‰ - å®µé—‡èŠ±ç«.mp3","lrc":"http://cube-1252774894.cosgz.myqcloud.com/music/lrc/å®µé—‡èŠ±ç« - è‘‰æœˆã‚†ã‚‰.lrc","pic":"http://cube-1252774894.cosgz.myqcloud.com/music/image/è‘‰æœˆã‚†ã‚‰ - å®µé—‡èŠ±ç«.jpg"}]}'
        window.musicModule.lrcConfig = {
            open: 'Open Lyrics',
            close: 'Close Lyrics'
        }
    })(window)
</script>



<div class="cube-recent-posts cube-sidebar" id="cube-recent-posts">
    <div class="title">
        <a>Recent Posts</a>
    </div>
    <ul class="list">
        
        
        <li>
            <!-- TODO å¦‚æœæ–‡ç« è¦æ˜¾ç¤ºå›¾ç‰‡ï¼Œé‚£ä¹ˆåœ¨front-matterä¸Šæ·»åŠ previewå±æ€§(url or path) -->
            
            <div class="normal">
                <p class="index first">
                    <span>1</span>
                </p>
                <p class="title">
                    <a href="/2022/08/25/Js%E5%9F%BA%E6%9C%AC%E6%95%B0%E6%8D%AE%E7%B1%BB%E5%9E%8B/" title="å˜é‡ç±»å‹">å˜é‡ç±»å‹</a>
                </p>
            </div>
            
        </li>
        
        
        
        <li>
            <div class="normal">
                <p class="index">
                    <span>2</span>
                </p>
                <p class="title">
                    <a href="/2022/07/15/bug/echarts%E5%9B%BE%E6%A0%87%E8%87%AA%E9%80%82%E5%BA%94%E6%96%B9%E6%B3%95/" title="echartså›¾æ ‡è‡ªé€‚åº”æ–¹æ³•">echartså›¾æ ‡è‡ªé€‚åº”æ–¹æ³•</a>
                </p>
            </div>
        </li>
        
        
        
        <li>
            <div class="normal">
                <p class="index">
                    <span>3</span>
                </p>
                <p class="title">
                    <a href="/2022/07/15/bug/a01/" title="æµè§ˆå™¨å¤šè¿›ç¨‹ä¸å¤šçº¿ç¨‹">æµè§ˆå™¨å¤šè¿›ç¨‹ä¸å¤šçº¿ç¨‹</a>
                </p>
            </div>
        </li>
        
        
        
        <li>
            <div class="normal">
                <p class="index">
                    <span>4</span>
                </p>
                <p class="title">
                    <a href="/2022/06/09/html+css+js+ts/3-js%E5%B8%B8%E7%94%A8%E4%BB%A3%E7%A0%81%E6%93%8D%E4%BD%9C%E5%AE%9E%E4%BE%8B/" title="js-å¸¸ç”¨ä»£ç æ“ä½œå®ä¾‹">js-å¸¸ç”¨ä»£ç æ“ä½œå®ä¾‹</a>
                </p>
            </div>
        </li>
        
        
        
        <li>
            <div class="normal">
                <p class="index">
                    <span>5</span>
                </p>
                <p class="title">
                    <a href="/2022/05/28/html+css+js+ts/1-%E9%9F%B3%E8%A7%86%E9%A2%91/" title="html-åŸç”ŸéŸ³è§†é¢‘">html-åŸç”ŸéŸ³è§†é¢‘</a>
                </p>
            </div>
        </li>
        
        
    </ul>
</div>



<div class="cube-categories cube-sidebar" id="cube-categories">
    <div class="title">
        <a href="/categories">Categories</a>
    </div>
    <div class="cube-boxs">
        
        
        <div class="cube-box-bg ">
            <a href="/categories/http/">#http</a>
        </div>
        
        
        <div class="cube-box ">
            <a href="/categories/%E6%A1%86%E6%9E%B6/">#æ¡†æ¶</a>
        </div>
        
        
        <div class="cube-box ">
            <a href="/categories/React/">#React</a>
        </div>
        
        
        <div class="cube-box ">
            <a href="/categories/%E6%95%B0%E6%8D%AE%E5%8F%AF%E8%A7%86%E5%8C%96/">#æ•°æ®å¯è§†åŒ–</a>
        </div>
        
        
        <div class="cube-box ">
            <a href="/categories/%E6%9E%B6%E6%9E%84%E6%A8%A1%E5%BC%8F/">#æ¶æ„æ¨¡å¼</a>
        </div>
        
        
        <div class="cube-box ">
            <a href="/categories/%E6%9E%B6%E6%9E%84%E6%A8%A1%E5%BC%8F/%E6%A1%86%E6%9E%B6/">#æ¡†æ¶</a>
        </div>
        
        
        <div class="cube-box-bg ">
            <a href="/categories/%E5%89%8D%E7%AB%AF/">#å‰ç«¯</a>
        </div>
        
        
        <div class="cube-box-bg ">
            <a href="/categories/%E5%89%8D%E7%AB%AF/%E7%A7%BB%E5%8A%A8%E7%AB%AF/">#ç§»åŠ¨ç«¯</a>
        </div>
        
        
        <div class="cube-box ">
            <a href="/categories/%E5%89%8D%E7%AB%AF/%E9%9F%B3%E8%A7%86%E9%A2%91/">#éŸ³è§†é¢‘</a>
        </div>
        
        
        <div class="cube-box-bg ">
            <a href="/categories/javascript/">#javascript</a>
        </div>
        
        
        <div class="cube-box ">
            <a href="/categories/%E5%89%8D%E7%AB%AF/%E9%97%AE%E9%A2%98/">#é—®é¢˜</a>
        </div>
        
        
        <div class="cube-box ">
            <a href="/categories/%E5%90%8E%E7%AB%AF/">#åç«¯</a>
        </div>
        
        
        <div class="cube-box ">
            <a href="/categories/%E5%B0%8F%E7%A8%8B%E5%BA%8F/">#å°ç¨‹åº</a>
        </div>
        
        
        <div class="cube-box ">
            <a href="/categories/%E5%90%8E%E7%AB%AF/%E6%A1%86%E6%9E%B6/">#æ¡†æ¶</a>
        </div>
        
        
        <div class="cube-box ">
            <a href="/categories/%E5%90%8E%E7%AB%AF/%E7%AE%97%E6%B3%95/">#ç®—æ³•</a>
        </div>
        
        
        <div class="cube-box ">
            <a href="/categories/%E5%89%8D%E7%AB%AF%E5%B7%A5%E7%A8%8B%E5%8C%96/">#å‰ç«¯å·¥ç¨‹åŒ–</a>
        </div>
        
        
        <div class="cube-box ">
            <a href="/categories/%E5%B7%A5%E5%85%B7/">#å·¥å…·</a>
        </div>
        
        
        <div class="cube-box ">
            <a href="/categories/%E6%AD%A3%E5%88%99%E8%A1%A8%E8%BE%BE%E5%BC%8F/">#æ­£åˆ™è¡¨è¾¾å¼</a>
        </div>
        
        
        <div class="cube-box ">
            <a href="/categories/%E5%89%8D%E7%AB%AF%E6%80%A7%E8%83%BD%E4%BC%98%E5%8C%96/">#å‰ç«¯æ€§èƒ½ä¼˜åŒ–</a>
        </div>
        
        
        <div class="cube-box ">
            <a href="/categories/%E6%95%B0%E6%8D%AE%E5%BA%93/">#æ•°æ®åº“</a>
        </div>
        
        
        <div class="cube-box-bg ">
            <a href="/categories/%E7%AE%97%E6%B3%95/">#ç®—æ³•</a>
        </div>
        
        
        <div class="cube-box ">
            <a href="/categories/liunx/">#liunx</a>
        </div>
        
        
        <div class="cube-box ">
            <a href="/categories/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/">#è®¾è®¡æ¨¡å¼</a>
        </div>
        
    </div>
</div>



<div class="cube-tagcloud cube-sidebar" id="cube-tagcloud">
    <div class="title">
        <a href="/tags">Tagcloud</a>
    </div>
    <div class="cube-boxs">
        
        
        <div class="cube-box ">
            <a href="/tags/http/">#http</a>
        </div>
        
        
        <div class="cube-box ">
            <a href="/tags/vue/">#vue</a>
        </div>
        
        
        <div class="cube-box-bg ">
            <a href="/tags/React/">#React</a>
        </div>
        
        
        <div class="cube-box ">
            <a href="/tags/Redux/">#Redux</a>
        </div>
        
        
        <div class="cube-box ">
            <a href="/tags/echart/">#echart</a>
        </div>
        
        
        <div class="cube-box ">
            <a href="/tags/vue3/">#vue3</a>
        </div>
        
        
        <div class="cube-box-bg ">
            <a href="/tags/react/">#react</a>
        </div>
        
        
        <div class="cube-box ">
            <a href="/tags/html/">#html</a>
        </div>
        
        
        <div class="cube-box ">
            <a href="/tags/xml/">#xml</a>
        </div>
        
        
        <div class="cube-box ">
            <a href="/tags/%E7%A7%BB%E5%8A%A8%E7%AB%AF/">#ç§»åŠ¨ç«¯</a>
        </div>
        
        
        <div class="cube-box ">
            <a href="/tags/css/">#css</a>
        </div>
        
        
        <div class="cube-box ">
            <a href="/tags/javascript/">#javascript</a>
        </div>
        
        
        <div class="cube-box ">
            <a href="/tags/Promise/">#Promise</a>
        </div>
        
        
        <div class="cube-box ">
            <a href="/tags/es6/">#es6</a>
        </div>
        
        
        <div class="cube-box ">
            <a href="/tags/typescript/">#typescript</a>
        </div>
        
        
        <div class="cube-box ">
            <a href="/tags/async-await/">#async/await</a>
        </div>
        
        
        <div class="cube-box-bg ">
            <a href="/tags/nodejs/">#nodejs</a>
        </div>
        
        
        <div class="cube-box ">
            <a href="/tags/%E5%B0%8F%E7%A8%8B%E5%BA%8F/">#å°ç¨‹åº</a>
        </div>
        
        
        <div class="cube-box-bg ">
            <a href="/tags/python/">#python</a>
        </div>
        
        
        <div class="cube-box-bg ">
            <a href="/tags/glup/">#glup</a>
        </div>
        
        
        <div class="cube-box ">
            <a href="/tags/webpack/">#webpack</a>
        </div>
        
        
        <div class="cube-box ">
            <a href="/tags/%E5%89%8D%E7%AB%AF/">#å‰ç«¯</a>
        </div>
        
        
        <div class="cube-box ">
            <a href="/tags/git/">#git</a>
        </div>
        
        
        <div class="cube-box ">
            <a href="/tags/Mock/">#Mock</a>
        </div>
        
        
        <div class="cube-box-bg ">
            <a href="/tags/eslint/">#eslint</a>
        </div>
        
        
        <div class="cube-box ">
            <a href="/tags/RESTful/">#RESTful</a>
        </div>
        
        
        <div class="cube-box-bg ">
            <a href="/tags/hexo/">#hexo</a>
        </div>
        
        
        <div class="cube-box ">
            <a href="/tags/vs-code/">#vs code</a>
        </div>
        
        
        <div class="cube-box ">
            <a href="/tags/%E6%AD%A3%E5%88%99%E8%A1%A8%E8%BE%BE%E5%BC%8F/">#æ­£åˆ™è¡¨è¾¾å¼</a>
        </div>
        
        
        <div class="cube-box ">
            <a href="/tags/%E4%BC%98%E5%8C%96/">#ä¼˜åŒ–</a>
        </div>
        
        
        <div class="cube-box-bg ">
            <a href="/tags/mongodb/">#mongodb</a>
        </div>
        
        
        <div class="cube-box-bg ">
            <a href="/tags/mysql/">#mysql</a>
        </div>
        
        
        <div class="cube-box ">
            <a href="/tags/%E7%AE%97%E6%B3%95/">#ç®—æ³•</a>
        </div>
        
        
        <div class="cube-box ">
            <a href="/tags/nginx/">#nginx</a>
        </div>
        
        
        <div class="cube-box ">
            <a href="/tags/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/">#è®¾è®¡æ¨¡å¼</a>
        </div>
        
    </div>
</div>



<div class="cube-links cube-sidebar" id="cube-links">
    <div class="title">
        <a>Links</a>
    </div>
    <ul class="list">
        
        <li>
            
            
            <img src="http://cube-1252774894.cosgz.myqcloud.com/links/GitHub.png">
            
            <a href="https://github.com/ZEROKISEKI" target="_blank">GitHub</a>
        </li>
        
        <li>
            
            
            <img src="http://cube-1252774894.cosgz.myqcloud.com/links/Coding.png">
            
            <a href="https://coding.net/u/SORA1" target="_blank">Coding</a>
        </li>
        
        <li>
            
            
            <img src="http://cube-1252774894.cosgz.myqcloud.com/links/SF.png">
            
            <a href="https://segmentfault.com/u/aonosora" target="_blank">SFç¤¾åŒº</a>
        </li>
        
        <li>
            
            
            <img src="http://cube-1252774894.cosgz.myqcloud.com/links/å¼€å‘è€…å¤´æ¡.png">
            
            <a href="https://toutiao.io/u/148070" target="_blank">å¼€å‘è€…å¤´æ¡</a>
        </li>
        
    </ul>
</div>



<div class="cube-friend-links cube-sidebar" id="cube-friend-links">
    <div class="title">
        <a>Friend Links</a>
    </div>
    <ul class="list">
        
        <li>
            <!-- TODO change avatar.png to friend.png-->
            <img src="http://cube-1252774894.cosgz.myqcloud.com/friend_links/micblo.png">
            <a href="https://blog.micblo.com/" target="_blank">ç½—å¤§ä½¬</a>
        </li>
        
        <li>
            <!-- TODO change avatar.png to friend.png-->
            <img src="http://cube-1252774894.cosgz.myqcloud.com/friend_links/DIYgod.jpg">
            <a href="https://www.anotherhome.net/" target="_blank">DIYgod</a>
        </li>
        
        <li>
            <!-- TODO change avatar.png to friend.png-->
            <img src="/images/friend_links.jpg ">
            <a href="https://aonosora.com/" target="_blank">å’ªè¥¿è¥¿ã®éƒ¨è½æ ¼</a>
        </li>
        
    </ul>
</div>


        </div>
    </div>
</div>
<footer class="cube-footer">
    
Â© 2017 John Doe

<br>
Powered by <a href="https://hexo.io/" target="_blank">Hexo</a>.&nbsp;Theme by <a href="https://github.com/ZEROKISEKI" target="_blank">AONOSORA</a>
</footer>
<!-- inject:script -->
<script src="/js/script.js"></script>
<!-- endinject -->
<div class="cube-loading out"></div>
</body>
</html>